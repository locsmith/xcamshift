<!-- Generated by Cython 0.18 on Thu Aug 15 08:00:21 2013 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.18 on Thu Aug 15 08:00:21 2013
<p>Raw output: <a href="Cython_shift_calculator.cpp">Cython_shift_calculator.cpp</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: #-------------------------------------------------------------------------------</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1
 * #-------------------------------------------------------------------------------             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * # Copyright (c) 2013 Gary Thompson & The University of Leeds.
 * # All rights reserved. This program and the accompanying materials
 */
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s____test__, ((PyObject *)__pyx_t_1)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # Copyright (c) 2013 Gary Thompson &amp; The University of Leeds.</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: # All rights reserved. This program and the accompanying materials</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: # are made available under the terms of the GNU Lesser Public License v3.0</pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: # which accompanies this distribution, and is available at</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: # http://www.gnu.org/licenses/lgpl-3.0.html</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: #</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # Contributors:</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: #     gary thompson - initial API and implementation</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: #-------------------------------------------------------------------------------</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: # cython: profile=False</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: # cython: boundscheck=False</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: # cython: wraparound=False</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: # cython: cdivision=True</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: </pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: '''</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: Created on 31 Jul 2012</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: </pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: @author: garyt</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: </pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: '''</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: from shift_calculators cimport Fast_energy_calculator, Constant_cache</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line23")'> 23: from derivList import DerivList as PyDerivList</pre>
<pre id='line23' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":23
 * '''
 * from shift_calculators cimport Fast_energy_calculator, Constant_cache
 * from derivList import DerivList as PyDerivList             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from math import ceil
 * cimport cython
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__DerivList));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__DerivList));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__DerivList));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__derivList), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__DerivList);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__DerivList);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__PyDerivList, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line24")'> 24: from math import ceil</pre>
<pre id='line24' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":24
 * from shift_calculators cimport Fast_energy_calculator, Constant_cache
 * from derivList import DerivList as PyDerivList
 * from math import ceil             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cimport cython
 * from vec3 import Vec3 as python_vec3
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__ceil));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__ceil));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__ceil));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__math), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__ceil);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__ceil);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__ceil, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25: cimport cython</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line26")'> 26: from vec3 import Vec3 as python_vec3</pre>
<pre id='line26' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":26
 * from math import ceil
 * cimport cython
 * from vec3 import Vec3 as python_vec3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from common_constants import TARGET_ATOM_IDS_CHANGED, STRUCTURE_CHANGED
 * from  xplor_access cimport norm,Vec3, Dihedral, Atom,  dot,  cross,  Simulation, CDSVector, DerivList, clearVector, EnsembleSimulation, createSharedVec
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Vec3));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__Vec3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Vec3));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__vec3), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__Vec3);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Vec3);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__python_vec3, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line27")'> 27: from common_constants import TARGET_ATOM_IDS_CHANGED, STRUCTURE_CHANGED</pre>
<pre id='line27' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":27
 * cimport cython
 * from vec3 import Vec3 as python_vec3
 * from common_constants import TARGET_ATOM_IDS_CHANGED, STRUCTURE_CHANGED             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from  xplor_access cimport norm,Vec3, Dihedral, Atom,  dot,  cross,  Simulation, CDSVector, DerivList, clearVector, EnsembleSimulation, createSharedVec
 * from libc.math cimport cos,sin,  fabs, tanh, pow, cosh
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s_87));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s_87));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s_87));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__STRUCTURE_CHANGED));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__STRUCTURE_CHANGED));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__STRUCTURE_CHANGED));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__common_constants), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s_87);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s_87);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_87, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__STRUCTURE_CHANGED);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__STRUCTURE_CHANGED);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: from  xplor_access cimport norm,Vec3, Dihedral, Atom,  dot,  cross,  Simulation, CDSVector, DerivList, clearVector, EnsembleSimulation, createSharedVec</pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29: from libc.math cimport cos,sin,  fabs, tanh, pow, cosh</pre>
<pre id='line29' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: from libc.stdlib cimport malloc, free</pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31: from libc.string cimport strcmp</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line32")'> 32: from time import time</pre>
<pre id='line32' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":32
 * from libc.stdlib cimport malloc, free
 * from libc.string cimport strcmp
 * from time import time             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from utils import Atom_utils
 * from cpython cimport array
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__time));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__time));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__time));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__time), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__time);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__time);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__time, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line33")'> 33: from utils import Atom_utils</pre>
<pre id='line33' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":33
 * from libc.string cimport strcmp
 * from time import time
 * from utils import Atom_utils             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from cpython cimport array
 * import ctypes
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Atom_utils));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__Atom_utils));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Atom_utils));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__utils), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__Atom_utils);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Atom_utils);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__Atom_utils, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34: from cpython cimport array</pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line35")'> 35: import ctypes</pre>
<pre id='line35' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":35
 * from utils import Atom_utils
 * from cpython cimport array
 * import ctypes             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from component_list import  Component_list, Native_component_list
 * from ensembleSimulation import EnsembleSimulation as pyEnsembleSimulation
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__ctypes), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__ctypes, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line36")'> 36: from component_list import  Component_list, Native_component_list</pre>
<pre id='line36' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":36
 * from cpython cimport array
 * import ctypes
 * from component_list import  Component_list, Native_component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from ensembleSimulation import EnsembleSimulation as pyEnsembleSimulation
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Component_list));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__Component_list));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Component_list));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s_88));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_n_s_88));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s_88));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__component_list), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__Component_list);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Component_list);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__Component_list, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s_88);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s_88);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_88, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line37")'> 37: from ensembleSimulation import EnsembleSimulation as pyEnsembleSimulation</pre>
<pre id='line37' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":37
 * import ctypes
 * from component_list import  Component_list, Native_component_list
 * from ensembleSimulation import EnsembleSimulation as pyEnsembleSimulation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #TODO: should be ensembleSimulationAsNative
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__EnsembleSimulation));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__EnsembleSimulation));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__EnsembleSimulation));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__ensembleSimulation), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__EnsembleSimulation);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__EnsembleSimulation);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_4, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38: </pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39: #TODO: should be ensembleSimulationAsNative</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40: cdef inline EnsembleSimulation* simulationAsNative(object simulation) except NULL:</pre>
<pre id='line40' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":40
 * 
 * #TODO: should be ensembleSimulationAsNative
 * cdef inline EnsembleSimulation* simulationAsNative(object simulation) except NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #TODO tell charles his __eq__ method has problems
 *     if id(None) == id(simulation):
 */

static CYTHON_INLINE EnsembleSimulation *__pyx_f_17shift_calculators_simulationAsNative(PyObject *__pyx_v_simulation) {
  EnsembleSimulation *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("simulationAsNative", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41:     #TODO tell charles his __eq__ method has problems</pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line42")'> 42:     if id(None) == id(simulation):</pre>
<pre id='line42' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":42
 * cdef inline EnsembleSimulation* simulationAsNative(object simulation) except NULL:
 *     #TODO tell charles his __eq__ method has problems
 *     if id(None) == id(simulation):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise Exception("_simulation cannot be None!")
 *     if not isinstance(simulation, pyEnsembleSimulation):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_id, ((PyObject *)__pyx_k_tuple_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_simulation);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_simulation);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_simulation);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_id, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_t_3, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {

  /* "Cython_shift_calculator.pyx":42
 * cdef inline EnsembleSimulation* simulationAsNative(object simulation) except NULL:
 *     #TODO tell charles his __eq__ method has problems
 *     if id(None) == id(simulation):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise Exception("_simulation cannot be None!")
 *     if not isinstance(simulation, pyEnsembleSimulation):
 */
  __pyx_k_tuple_1 = <span class='py_c_api'>PyTuple_Pack</span>(1, Py_None);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_1));
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line43")'> 43:         raise Exception("_simulation cannot be None!")</pre>
<pre id='line43' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":43
 *     #TODO tell charles his __eq__ method has problems
 *     if id(None) == id(simulation):
 *         raise Exception("_simulation cannot be None!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not isinstance(simulation, pyEnsembleSimulation):
 *         raise Exception("a %s can't be converted to a EnsembleSimulation*" % simulation.__class__.__name__)
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_k_tuple_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "Cython_shift_calculator.pyx":43
 *     #TODO tell charles his __eq__ method has problems
 *     if id(None) == id(simulation):
 *         raise Exception("_simulation cannot be None!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not isinstance(simulation, pyEnsembleSimulation):
 *         raise Exception("a %s can't be converted to a EnsembleSimulation*" % simulation.__class__.__name__)
 */
  __pyx_k_tuple_3 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)__pyx_kp_s_2));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_3));
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line44")'> 44:     if not isinstance(simulation, pyEnsembleSimulation):</pre>
<pre id='line44' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":44
 *     if id(None) == id(simulation):
 *         raise Exception("_simulation cannot be None!")
 *     if not isinstance(simulation, pyEnsembleSimulation):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise Exception("a %s can't be converted to a EnsembleSimulation*" % simulation.__class__.__name__)
 *     return <code><</code>EnsembleSimulation*><code><</code>size_t>int(simulation.this)
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_simulation, __pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = (!__pyx_t_4);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line45")'> 45:         raise Exception("a %s can't be converted to a EnsembleSimulation*" % simulation.__class__.__name__)</pre>
<pre id='line45' class='code' style='background-color: #FFFF3c'>
    /* "Cython_shift_calculator.pyx":45
 *         raise Exception("_simulation cannot be None!")
 *     if not isinstance(simulation, pyEnsembleSimulation):
 *         raise Exception("a %s can't be converted to a EnsembleSimulation*" % simulation.__class__.__name__)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return <code><</code>EnsembleSimulation*><code><</code>size_t>int(simulation.this)
 * 
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_simulation, __pyx_n_s____class__);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____name__);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_5), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line46")'> 46:     return &lt;EnsembleSimulation*&gt;&lt;size_t&gt;int(simulation.this)</pre>
<pre id='line46' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":46
 *     if not isinstance(simulation, pyEnsembleSimulation):
 *         raise Exception("a %s can't be converted to a EnsembleSimulation*" % simulation.__class__.__name__)
 *     return <code><</code>EnsembleSimulation*><code><</code>size_t>int(simulation.this)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cpdef array.array allocate_array(int len, type='d'):
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_simulation, __pyx_n_s__this);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_6 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = ((EnsembleSimulation *)((size_t)__pyx_t_6));
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.simulationAsNative", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47: </pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line48")'> 48: cpdef array.array allocate_array(int len, type='d'):</pre>
<pre id='line48' class='code' style='background-color: #FFFF9f'>
/* "Cython_shift_calculator.pyx":48
 *     return <code><</code>EnsembleSimulation*><code><</code>size_t>int(simulation.this)
 * 
 * cpdef array.array allocate_array(int len, type='d'):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 */

static PyObject *__pyx_pw_17shift_calculators_1allocate_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static arrayobject *__pyx_f_17shift_calculators_allocate_array(int __pyx_v_len, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_17shift_calculators_allocate_array *__pyx_optional_args) {
  PyObject *__pyx_v_type = ((PyObject *)__pyx_n_s__d);
  PyObject *__pyx_v_result = NULL;
  arrayobject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("allocate_array", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_type = __pyx_optional_args->type;
    }
  }

/* "Cython_shift_calculator.pyx":48
 *     return <code><</code>EnsembleSimulation*><code><</code>size_t>int(simulation.this)
 * 
 * cpdef array.array allocate_array(int len, type='d'):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 */

static PyObject *__pyx_pf_17shift_calculators_allocate_array(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_len, PyObject *__pyx_v_type) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("allocate_array", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.type = __pyx_v_type;
  __pyx_t_1 = ((PyObject *)__pyx_f_17shift_calculators_allocate_array(__pyx_v_len, 0, &__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.allocate_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* "Cython_shift_calculator.pyx":48
 *     return <code><</code>EnsembleSimulation*><code><</code>size_t>int(simulation.this)
 * 
 * cpdef array.array allocate_array(int len, type='d'):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 */
struct __pyx_opt_args_17shift_calculators_allocate_array {
  int __pyx_n;
  PyObject *type;
};
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line49")'> 49:     result = array.array(type,[0])</pre>
<pre id='line49' class='code' style='background-color: #FFFF52'>
  /* "Cython_shift_calculator.pyx":49
 * 
 * cpdef array.array allocate_array(int len, type='d'):
 *     result = array.array(type,[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     array.resize(result, len)
 *     array.zero(result)
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_int_0);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_0);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_type);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_type);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_type);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_t_1));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_1));
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_7cpython_5array_array)), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line50")'> 50:     array.resize(result, len)</pre>
<pre id='line50' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":50
 * cpdef array.array allocate_array(int len, type='d'):
 *     result = array.array(type,[0])
 *     array.resize(result, len)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     array.zero(result)
 *     return result
 */
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_result, __pyx_ptype_7cpython_5array_array))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  resize(((arrayobject *)__pyx_v_result), __pyx_v_len);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line51")'> 51:     array.zero(result)</pre>
<pre id='line51' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":51
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 *     array.zero(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return result
 * 
 */
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_result, __pyx_ptype_7cpython_5array_array))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_f_7cpython_5array_zero(((arrayobject *)__pyx_v_result));
</pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line52")'> 52:     return result</pre>
<pre id='line52' class='code' style='background-color: #FFFF29'>
  /* "Cython_shift_calculator.pyx":52
 *     array.resize(result, len)
 *     array.zero(result)
 *     return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cpdef zero_array(array.array in_array):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_result, __pyx_ptype_7cpython_5array_array))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = ((arrayobject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = ((arrayobject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.allocate_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_1allocate_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_1allocate_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_len;
  PyObject *__pyx_v_type = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("allocate_array (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__len,&__pyx_n_s__type,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)__pyx_n_s__d);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__len)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__type);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "allocate_array") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_len = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_len == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_type = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("allocate_array", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.allocate_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_allocate_array(__pyx_self, __pyx_v_len, __pyx_v_type);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53: </pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line54")'> 54: cpdef zero_array(array.array in_array):</pre>
<pre id='line54' class='code' style='background-color: #FFFF9f'>
/* "Cython_shift_calculator.pyx":54
 *     return result
 * 
 * cpdef zero_array(array.array in_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      array.zero(in_array)
 * 
 */

static PyObject *__pyx_pw_17shift_calculators_3zero_array(PyObject *__pyx_self, PyObject *__pyx_v_in_array); /*proto*/
static PyObject *__pyx_f_17shift_calculators_zero_array(arrayobject *__pyx_v_in_array, CYTHON_UNUSED int __pyx_skip_dispatch) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("zero_array", 0);

/* "Cython_shift_calculator.pyx":54
 *     return result
 * 
 * cpdef zero_array(array.array in_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      array.zero(in_array)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_2zero_array(CYTHON_UNUSED PyObject *__pyx_self, arrayobject *__pyx_v_in_array) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("zero_array", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_17shift_calculators_zero_array(__pyx_v_in_array, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.zero_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line55")'> 55:      array.zero(in_array)</pre>
<pre id='line55' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":55
 * 
 * cpdef zero_array(array.array in_array):
 *      array.zero(in_array)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cpdef resize_array(array.array in_array, int len):
 */
  __pyx_f_7cpython_5array_zero(__pyx_v_in_array);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_3zero_array(PyObject *__pyx_self, PyObject *__pyx_v_in_array); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_3zero_array(PyObject *__pyx_self, PyObject *__pyx_v_in_array) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("zero_array (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_in_array), __pyx_ptype_7cpython_5array_array, 1, "in_array", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_2zero_array(__pyx_self, ((arrayobject *)__pyx_v_in_array));
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56: </pre>
<pre id='line56' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line57")'> 57: cpdef resize_array(array.array in_array, int len):</pre>
<pre id='line57' class='code' style='background-color: #FFFF29'>
/* "Cython_shift_calculator.pyx":57
 *      array.zero(in_array)
 * 
 * cpdef resize_array(array.array in_array, int len):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     array.resize(in_array, len)
 * 
 */

static PyObject *__pyx_pw_17shift_calculators_5resize_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_17shift_calculators_resize_array(arrayobject *__pyx_v_in_array, int __pyx_v_len, CYTHON_UNUSED int __pyx_skip_dispatch) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("resize_array", 0);

/* "Cython_shift_calculator.pyx":57
 *      array.zero(in_array)
 * 
 * cpdef resize_array(array.array in_array, int len):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     array.resize(in_array, len)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_4resize_array(CYTHON_UNUSED PyObject *__pyx_self, arrayobject *__pyx_v_in_array, int __pyx_v_len) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("resize_array", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_17shift_calculators_resize_array(__pyx_v_in_array, __pyx_v_len, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.resize_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_7test_dump_component_index_pair(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_17shift_calculators_7test_dump_component_index_pair = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("test_dump_component_index_pair"), (PyCFunction)__pyx_pw_17shift_calculators_7test_dump_component_index_pair, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_17shift_calculators_7test_dump_component_index_pair(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_data = 0;
  int __pyx_v_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_component_index_pair (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__data,&__pyx_n_s__index,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("test_dump_component_index_pair", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "test_dump_component_index_pair") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_data = ((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)values[0]);
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("test_dump_component_index_pair", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.test_dump_component_index_pair", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_17shift_calculators_Non_bonded_interaction_list, 1, "data", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_6test_dump_component_index_pair(__pyx_self, __pyx_v_data, __pyx_v_index);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line58")'> 58:     array.resize(in_array, len)</pre>
<pre id='line58' class='code' style='background-color: #FFFF2d'>
  /* "Cython_shift_calculator.pyx":58
 * 
 * cpdef resize_array(array.array in_array, int len):
 *     array.resize(in_array, len)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef struct Random_coil_component:
 */
  resize(__pyx_v_in_array, __pyx_v_len);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_5resize_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_5resize_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  arrayobject *__pyx_v_in_array = 0;
  int __pyx_v_len;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("resize_array (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__in_array,&__pyx_n_s__len,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__in_array)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__len)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("resize_array", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "resize_array") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_in_array = ((arrayobject *)values[0]);
    __pyx_v_len = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_len == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("resize_array", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.resize_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_in_array), __pyx_ptype_7cpython_5array_array, 1, "in_array", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_4resize_array(__pyx_self, __pyx_v_in_array, __pyx_v_len);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59: </pre>
<pre id='line59' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60: cdef struct Random_coil_component:</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":60
 *     array.resize(in_array, len)
 * 
 * cdef struct Random_coil_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int target_atom
 *     float shift
 */
struct __pyx_t_17shift_calculators_Random_coil_component {
  int target_atom;
  float shift;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61:     int target_atom</pre>
<pre id='line61' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62:     float shift</pre>
<pre id='line62' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line63")'> 63: </pre>
<pre id='line63' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64: cdef struct Nonbonded_coefficient_component:</pre>
<pre id='line64' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":64
 *     float shift
 * 
 * cdef struct Nonbonded_coefficient_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int chem_type_id
 *     int sphere_id
 */
struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component {
  int chem_type_id;
  int sphere_id;
  float exponent;
  float coefficients[(3 * 7)];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65:     int chem_type_id</pre>
<pre id='line65' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66:     int sphere_id</pre>
<pre id='line66' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:     float exponent</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68:     float[3*7] coefficients</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69: </pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70: cdef struct Distance_component:</pre>
<pre id='line70' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":70
 *     float[3*7] coefficients
 * 
 * cdef struct Distance_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom
 *       int remote_atom_1
 */
struct __pyx_t_17shift_calculators_Distance_component {
  int target_atom;
  int remote_atom_1;
  int remote_atom_2;
  float coefficient;
  float exponent;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71:       int target_atom</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72:       int remote_atom_1</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73:       int remote_atom_2</pre>
<pre id='line73' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:       float coefficient</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75:       float exponent</pre>
<pre id='line75' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76: </pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77: cdef struct Dihedral_component:</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":77
 *       float exponent
 * 
 * cdef struct Dihedral_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom
 *       int[4] dihedral_atoms
 */
struct __pyx_t_17shift_calculators_Dihedral_component {
  int target_atom;
  int dihedral_atoms[4];
  float coefficient;
  float parameters[6];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78:       int target_atom</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:       int[4] dihedral_atoms</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:       float coefficient</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81:       float[6] parameters</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:       #TODO: there seems to be an extra float here...</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83: </pre>
<pre id='line83' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84: #TODO: same as sing target component unite and rename</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85: cdef struct Non_bonded_target_component:</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":85
 * 
 * #TODO: same as sing target component unite and rename
 * cdef struct Non_bonded_target_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom_id
 *       int atom_type_id
 */
struct __pyx_t_17shift_calculators_Non_bonded_target_component {
  int target_atom_id;
  int atom_type_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:       int target_atom_id</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87:       int atom_type_id</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88: </pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89: cdef struct Non_bonded_remote_atom_component:</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":89
 *       int atom_type_id
 * 
 * cdef struct Non_bonded_remote_atom_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int remote_atom_id
 *       int chem_type[2] # one for each sphere
 */
struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component {
  int remote_atom_id;
  int chem_type[2];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90:       int remote_atom_id</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91:       int chem_type[2] # one for each sphere</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92: </pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93: cdef struct Component_index_pair:</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":93
 *       int chem_type[2] # one for each sphere
 * 
 * cdef struct Component_index_pair:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int target_atom_id
 *     int target_index
 */
struct __pyx_t_17shift_calculators_Component_index_pair {
  int target_atom_id;
  int target_index;
  int remote_index;
  int component_index;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:     int target_atom_id</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:     int target_index</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96:     int remote_index</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97:     int component_index</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98: </pre>
<pre id='line98' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99: </pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100: </pre>
<pre id='line100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: </pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line102")'> 102: def test_dump_component_index_pair(Non_bonded_interaction_list data, int index):</pre>
<pre id='line102' class='code' style='background-color: #FFFF62'>
/* "Cython_shift_calculator.pyx":102
 * 
 * 
 * def test_dump_component_index_pair(Non_bonded_interaction_list data, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Component_index_pair* result =  data.get(index)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_6test_dump_component_index_pair(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_data, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_Component_index_pair *__pyx_v_result;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_component_index_pair", 0);

  /* "Cython_shift_calculator.pyx":102
 * 
 * 
 * def test_dump_component_index_pair(Non_bonded_interaction_list data, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Component_index_pair* result =  data.get(index)
 * 
 */
  __pyx_k_tuple_89 = <span class='py_c_api'>PyTuple_Pack</span>(3, ((PyObject *)__pyx_n_s__data), ((PyObject *)__pyx_n_s__index), ((PyObject *)__pyx_n_s__result));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_89)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_89);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_89));

  /* "Cython_shift_calculator.pyx":102
 * 
 * 
 * def test_dump_component_index_pair(Non_bonded_interaction_list data, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Component_index_pair* result =  data.get(index)
 * 
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_17shift_calculators_7test_dump_component_index_pair, NULL, __pyx_n_s__shift_calculators);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_91, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_k_codeobj_90 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(2, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_89, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_92, __pyx_n_s_91, 102, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_90)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103:     cdef Component_index_pair* result =  data.get(index)</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":103
 * 
 * def test_dump_component_index_pair(Non_bonded_interaction_list data, int index):
 *     cdef Component_index_pair* result =  data.get(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return result[0].target_atom_id, result[0].target_index, result[0].remote_index, result[0].component_index
 */
  __pyx_v_result = __pyx_f_17shift_calculators_27Non_bonded_interaction_list_get(__pyx_v_data, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104: </pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line105")'> 105:     return result[0].target_atom_id, result[0].target_index, result[0].remote_index, result[0].component_index</pre>
<pre id='line105' class='code' style='background-color: #FFFF31'>
  /* "Cython_shift_calculator.pyx":105
 *     cdef Component_index_pair* result =  data.get(index)
 * 
 *     return result[0].target_atom_id, result[0].target_index, result[0].remote_index, result[0].component_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def test_dump_component_offsets(data):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_result[0]).target_atom_id);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_result[0]).target_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_result[0]).remote_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_result[0]).component_index);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 3, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_r = ((PyObject *)__pyx_t_5);
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.test_dump_component_index_pair", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9test_dump_component_offsets(PyObject *__pyx_self, PyObject *__pyx_v_data); /*proto*/
static PyMethodDef __pyx_mdef_17shift_calculators_9test_dump_component_offsets = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("test_dump_component_offsets"), (PyCFunction)__pyx_pw_17shift_calculators_9test_dump_component_offsets, METH_O, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_17shift_calculators_9test_dump_component_offsets(PyObject *__pyx_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_component_offsets (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_8test_dump_component_offsets(__pyx_self, ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106: </pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line107")'> 107: def test_dump_component_offsets(data):</pre>
<pre id='line107' class='code' style='background-color: #FFFF62'>
/* "Cython_shift_calculator.pyx":107
 *     return result[0].target_atom_id, result[0].target_index, result[0].remote_index, result[0].component_index
 * 
 * def test_dump_component_offsets(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Component_Offsets* test2 = <code><</code>Component_Offsets*> test
 */

static PyObject *__pyx_pf_17shift_calculators_8test_dump_component_offsets(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data) {
  size_t __pyx_v_test;
  struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_v_test2;
  __Pyx_memviewslice __pyx_v_dummy_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_result_data = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_component_offsets", 0);

  /* "Cython_shift_calculator.pyx":107
 *     return result[0].target_atom_id, result[0].target_index, result[0].remote_index, result[0].component_index
 * 
 * def test_dump_component_offsets(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Component_Offsets* test2 = <code><</code>Component_Offsets*> test
 */
  __pyx_k_tuple_93 = <span class='py_c_api'>PyTuple_Pack</span>(7, ((PyObject *)__pyx_n_s__data), ((PyObject *)__pyx_n_s__test), ((PyObject *)__pyx_n_s__test2), ((PyObject *)__pyx_n_s__dummy_view), ((PyObject *)__pyx_n_s__result), ((PyObject *)__pyx_n_s__result_data), ((PyObject *)__pyx_n_s__i));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_93)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_93);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_93));

  /* "Cython_shift_calculator.pyx":107
 *     return result[0].target_atom_id, result[0].target_index, result[0].remote_index, result[0].component_index
 * 
 * def test_dump_component_offsets(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Component_Offsets* test2 = <code><</code>Component_Offsets*> test
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_17shift_calculators_9test_dump_component_offsets, NULL, __pyx_n_s__shift_calculators);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_95, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_k_codeobj_94 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(1, 0, 7, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_93, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_92, __pyx_n_s_95, 107, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_94)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line108")'> 108:     cdef size_t  test  = ctypes.addressof(data)</pre>
<pre id='line108' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":108
 * 
 * def test_dump_component_offsets(data):
 *     cdef size_t  test  = ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Component_Offsets* test2 = <code><</code>Component_Offsets*> test
 *     cdef Component_Offsets[:] dummy_view
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_test = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109:     cdef Component_Offsets* test2 = &lt;Component_Offsets*&gt; test</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":109
 * def test_dump_component_offsets(data):
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Component_Offsets* test2 = <code><</code>Component_Offsets*> test             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Component_Offsets[:] dummy_view
 *     if len(data) == 0:
 */
  __pyx_v_test2 = ((struct __pyx_t_17shift_calculators_Component_Offsets *)__pyx_v_test);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line110")'> 110:     cdef Component_Offsets[:] dummy_view</pre>
<pre id='line110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line111")'> 111:     if len(data) == 0:</pre>
<pre id='line111' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":111
 *     cdef Component_Offsets* test2 = <code><</code>Component_Offsets*> test
 *     cdef Component_Offsets[:] dummy_view
 *     if len(data) == 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = ()
 *     else:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = (__pyx_t_5 == 0);
  if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line112")'> 112:         result = ()</pre>
<pre id='line112' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":112
 *     cdef Component_Offsets[:] dummy_view
 *     if len(data) == 0:
 *         result = ()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     else:
 *         dummy_view = <code><</code>Component_Offsets[:len(data)/ sizeof(Component_Offsets)]> &test2[0]
 */
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_empty_tuple));
    __pyx_v_result = __pyx_empty_tuple;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113:     else:</pre>
<pre id='line113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line114")'> 114:         dummy_view = &lt;Component_Offsets[:len(data)/ sizeof(Component_Offsets)]&gt; &amp;test2[0]</pre>
<pre id='line114' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":114
 *         result = ()
 *     else:
 *         dummy_view = <code><</code>Component_Offsets[:len(data)/ sizeof(Component_Offsets)]> &test2[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result_data = []
 */
    __pyx_t_7 = (&(__pyx_v_test2[0]));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    if (!__pyx_t_7) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_1 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_nn_struct___pyx_t_17shift_calculators_Component_Offsets);
    __pyx_t_3 = Py_BuildValue("("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Component_Offsets)))));
    if (unlikely(!__pyx_t_1 || !__pyx_t_3 || !<span class='py_c_api'>PyBytes_AsString</span>(__pyx_t_1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_8 = __pyx_array_new(__pyx_t_3, sizeof(struct __pyx_t_17shift_calculators_Component_Offsets), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_1), (char *) "c", (char *) __pyx_t_7);
    if (unlikely(!__pyx_t_8))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_struct___pyx_t_17shift_calculators_Component_Offsets(((PyObject *)__pyx_t_8));
    if (unlikely(!__pyx_t_9.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_v_dummy_view = __pyx_t_9;
    __pyx_t_9.memview = NULL;
    __pyx_t_9.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115: </pre>
<pre id='line115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line116")'> 116:         result_data = []</pre>
<pre id='line116' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":116
 *         dummy_view = <code><</code>Component_Offsets[:len(data)/ sizeof(Component_Offsets)]> &test2[0]
 * 
 *         result_data = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(len(data)/ sizeof(Component_Offsets)):
 *             result_data.append((dummy_view[i].id,  dummy_view[i].offset,  dummy_view[i].length))
 */
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_v_result_data = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line117")'> 117:         for i in range(len(data)/ sizeof(Component_Offsets)):</pre>
<pre id='line117' class='code' style='background-color: #FFFF1e'>
    /* "Cython_shift_calculator.pyx":117
 * 
 *         result_data = []
 *         for i in range(len(data)/ sizeof(Component_Offsets)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result_data.append((dummy_view[i].id,  dummy_view[i].offset,  dummy_view[i].length))
 *         result = tuple(result_data)
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_FromSize_t</span>((__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Component_Offsets))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_10 = Py_TYPE(__pyx_t_3)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (!__pyx_t_10 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_10 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_1 = __pyx_t_10(__pyx_t_3);
        if (unlikely(!__pyx_t_1)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
      __pyx_v_i = __pyx_t_1;
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line118")'> 118:             result_data.append((dummy_view[i].id,  dummy_view[i].offset,  dummy_view[i].length))</pre>
<pre id='line118' class='code' style='background-color: #FFFF24'>
      /* "Cython_shift_calculator.pyx":118
 *         result_data = []
 *         for i in range(len(data)/ sizeof(Component_Offsets)):
 *             result_data.append((dummy_view[i].id,  dummy_view[i].offset,  dummy_view[i].length))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = tuple(result_data)
 *     return result
 */
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __pyx_t_11;
      __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Component_Offsets *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_12 * __pyx_v_dummy_view.strides[0]) ))).id);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_13 = __pyx_t_11;
      __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Component_Offsets *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_13 * __pyx_v_dummy_view.strides[0]) ))).offset);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_14 = __pyx_t_11;
      __pyx_t_15 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Component_Offsets *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_14 * __pyx_v_dummy_view.strides[0]) ))).length);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_15);
      __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_16);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_1);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 2, __pyx_t_15);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_15);
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_15 = 0;
      __pyx_t_17 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result_data, ((PyObject *)__pyx_t_16));<span class='error_goto'> if (unlikely(__pyx_t_17 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_16)); __pyx_t_16 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line119")'> 119:         result = tuple(result_data)</pre>
<pre id='line119' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":119
 *         for i in range(len(data)/ sizeof(Component_Offsets)):
 *             result_data.append((dummy_view[i].id,  dummy_view[i].offset,  dummy_view[i].length))
 *         result = tuple(result_data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return result
 * 
 */
    __pyx_t_3 = ((PyObject *)<span class='py_c_api'>PyList_AsTuple</span>(__pyx_v_result_data));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_v_result = ((PyObject*)__pyx_t_3);
    __pyx_t_3 = 0;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line120")'> 120:     return result</pre>
<pre id='line120' class='code' style='background-color: #FFFF5b'>
  /* "Cython_shift_calculator.pyx":120
 *             result_data.append((dummy_view[i].id,  dummy_view[i].offset,  dummy_view[i].length))
 *         result = tuple(result_data)
 *     return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_8));
  __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.test_dump_component_offsets", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_dummy_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_11test_dump_dist_comp(PyObject *__pyx_self, PyObject *__pyx_v_data); /*proto*/
static PyMethodDef __pyx_mdef_17shift_calculators_11test_dump_dist_comp = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("test_dump_dist_comp"), (PyCFunction)__pyx_pw_17shift_calculators_11test_dump_dist_comp, METH_O, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_17shift_calculators_11test_dump_dist_comp(PyObject *__pyx_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_dist_comp (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_10test_dump_dist_comp(__pyx_self, ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121: </pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122: </pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line123")'> 123: def test_dump_dist_comp(data):</pre>
<pre id='line123' class='code' style='background-color: #FFFF62'>
/* "Cython_shift_calculator.pyx":123
 * 
 * 
 * def test_dump_dist_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 */

static PyObject *__pyx_pf_17shift_calculators_10test_dump_dist_comp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data) {
  size_t __pyx_v_test;
  struct __pyx_t_17shift_calculators_Distance_component *__pyx_v_test2;
  __Pyx_memviewslice __pyx_v_dummy_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_result_data = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_dist_comp", 0);

  /* "Cython_shift_calculator.pyx":123
 * 
 * 
 * def test_dump_dist_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 */
  __pyx_k_tuple_96 = <span class='py_c_api'>PyTuple_Pack</span>(7, ((PyObject *)__pyx_n_s__data), ((PyObject *)__pyx_n_s__test), ((PyObject *)__pyx_n_s__test2), ((PyObject *)__pyx_n_s__dummy_view), ((PyObject *)__pyx_n_s__result), ((PyObject *)__pyx_n_s__result_data), ((PyObject *)__pyx_n_s__i));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_96)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_96);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_96));

  /* "Cython_shift_calculator.pyx":123
 * 
 * 
 * def test_dump_dist_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_17shift_calculators_11test_dump_dist_comp, NULL, __pyx_n_s__shift_calculators);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__test_dump_dist_comp, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_k_codeobj_97 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(1, 0, 7, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_96, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_92, __pyx_n_s__test_dump_dist_comp, 123, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_97)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line124")'> 124:     cdef size_t  test  = ctypes.addressof(data)</pre>
<pre id='line124' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":124
 * 
 * def test_dump_dist_comp(data):
 *     cdef size_t  test  = ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 *     cdef Distance_component[:] dummy_view
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_test = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125:     cdef Distance_component* test2 = &lt;Distance_component*&gt; test</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":125
 * def test_dump_dist_comp(data):
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Distance_component[:] dummy_view
 *     if len(data) == 0:
 */
  __pyx_v_test2 = ((struct __pyx_t_17shift_calculators_Distance_component *)__pyx_v_test);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126:     cdef Distance_component[:] dummy_view</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line127")'> 127:     if len(data) == 0:</pre>
<pre id='line127' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":127
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 *     cdef Distance_component[:] dummy_view
 *     if len(data) == 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = ()
 *     else:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = (__pyx_t_5 == 0);
  if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line128")'> 128:         result = ()</pre>
<pre id='line128' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":128
 *     cdef Distance_component[:] dummy_view
 *     if len(data) == 0:
 *         result = ()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     else:
 *         dummy_view = <code><</code>Distance_component[:len(data)/ sizeof(Distance_component)]> &test2[0]
 */
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_empty_tuple));
    __pyx_v_result = __pyx_empty_tuple;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129:     else:</pre>
<pre id='line129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line130")'> 130:         dummy_view = &lt;Distance_component[:len(data)/ sizeof(Distance_component)]&gt; &amp;test2[0]</pre>
<pre id='line130' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":130
 *         result = ()
 *     else:
 *         dummy_view = <code><</code>Distance_component[:len(data)/ sizeof(Distance_component)]> &test2[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result_data = []
 */
    __pyx_t_7 = (&(__pyx_v_test2[0]));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    if (!__pyx_t_7) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_1 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_nn_struct___pyx_t_17shift_calculators_Distance_component);
    __pyx_t_3 = Py_BuildValue("("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Distance_component)))));
    if (unlikely(!__pyx_t_1 || !__pyx_t_3 || !<span class='py_c_api'>PyBytes_AsString</span>(__pyx_t_1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_8 = __pyx_array_new(__pyx_t_3, sizeof(struct __pyx_t_17shift_calculators_Distance_component), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_1), (char *) "c", (char *) __pyx_t_7);
    if (unlikely(!__pyx_t_8))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_struct___pyx_t_17shift_calculators_Distance_component(((PyObject *)__pyx_t_8));
    if (unlikely(!__pyx_t_9.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_v_dummy_view = __pyx_t_9;
    __pyx_t_9.memview = NULL;
    __pyx_t_9.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131: </pre>
<pre id='line131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line132")'> 132:         result_data = []</pre>
<pre id='line132' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":132
 *         dummy_view = <code><</code>Distance_component[:len(data)/ sizeof(Distance_component)]> &test2[0]
 * 
 *         result_data = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(len(data)/ sizeof(Distance_component)):
 *             result_data.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))
 */
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_v_result_data = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line133")'> 133:         for i in range(len(data)/ sizeof(Distance_component)):</pre>
<pre id='line133' class='code' style='background-color: #FFFF1e'>
    /* "Cython_shift_calculator.pyx":133
 * 
 *         result_data = []
 *         for i in range(len(data)/ sizeof(Distance_component)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result_data.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))
 *         result = tuple(result_data)
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_FromSize_t</span>((__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Distance_component))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_10 = Py_TYPE(__pyx_t_3)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (!__pyx_t_10 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_10 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_1 = __pyx_t_10(__pyx_t_3);
        if (unlikely(!__pyx_t_1)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
      __pyx_v_i = __pyx_t_1;
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF19' onclick='toggleDiv("line134")'> 134:             result_data.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))</pre>
<pre id='line134' class='code' style='background-color: #FFFF19'>
      /* "Cython_shift_calculator.pyx":134
 *         result_data = []
 *         for i in range(len(data)/ sizeof(Distance_component)):
 *             result_data.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = tuple(result_data)
 *     return result
 */
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __pyx_t_11;
      __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_12 * __pyx_v_dummy_view.strides[0]) ))).target_atom);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_13 = __pyx_t_11;
      __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_13 * __pyx_v_dummy_view.strides[0]) ))).remote_atom_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_14 = __pyx_t_11;
      __pyx_t_15 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_14 * __pyx_v_dummy_view.strides[0]) ))).remote_atom_2);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_15);
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_16 = __pyx_t_11;
      __pyx_t_17 = <span class='py_c_api'>PyFloat_FromDouble</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_16 * __pyx_v_dummy_view.strides[0]) ))).coefficient);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_17);
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_18 = __pyx_t_11;
      __pyx_t_19 = <span class='py_c_api'>PyFloat_FromDouble</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_18 * __pyx_v_dummy_view.strides[0]) ))).exponent);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_19);
      __pyx_t_20 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_20)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_20);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_20, 0, __pyx_t_1);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_20, 1, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_20, 2, __pyx_t_15);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_15);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_20, 3, __pyx_t_17);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_17);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_20, 4, __pyx_t_19);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_19);
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_15 = 0;
      __pyx_t_17 = 0;
      __pyx_t_19 = 0;
      __pyx_t_21 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result_data, ((PyObject *)__pyx_t_20));<span class='error_goto'> if (unlikely(__pyx_t_21 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_20)); __pyx_t_20 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line135")'> 135:         result = tuple(result_data)</pre>
<pre id='line135' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":135
 *         for i in range(len(data)/ sizeof(Distance_component)):
 *             result_data.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))
 *         result = tuple(result_data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return result
 * 
 */
    __pyx_t_3 = ((PyObject *)<span class='py_c_api'>PyList_AsTuple</span>(__pyx_v_result_data));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_v_result = ((PyObject*)__pyx_t_3);
    __pyx_t_3 = 0;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line136")'> 136:     return result</pre>
<pre id='line136' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":136
 *             result_data.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))
 *         result = tuple(result_data)
 *     return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def test_dump_dihedral_comp(data):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_8));
  __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.test_dump_dist_comp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_dummy_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_13test_dump_dihedral_comp(PyObject *__pyx_self, PyObject *__pyx_v_data); /*proto*/
static PyMethodDef __pyx_mdef_17shift_calculators_13test_dump_dihedral_comp = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("test_dump_dihedral_comp"), (PyCFunction)__pyx_pw_17shift_calculators_13test_dump_dihedral_comp, METH_O, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_17shift_calculators_13test_dump_dihedral_comp(PyObject *__pyx_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_dihedral_comp (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_12test_dump_dihedral_comp(__pyx_self, ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137: </pre>
<pre id='line137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line138")'> 138: def test_dump_dihedral_comp(data):</pre>
<pre id='line138' class='code' style='background-color: #FFFF62'>
/* "Cython_shift_calculator.pyx":138
 *     return result
 * 
 * def test_dump_dihedral_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_12test_dump_dihedral_comp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data) {
  size_t __pyx_v_test;
  struct __pyx_t_17shift_calculators_Dihedral_component *__pyx_v_compiled_components;
  PyObject *__pyx_v_num_components = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_dihedral_comp", 0);

  /* "Cython_shift_calculator.pyx":138
 *     return result
 * 
 * def test_dump_dihedral_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 * 
 */
  __pyx_k_tuple_98 = <span class='py_c_api'>PyTuple_Pack</span>(5, ((PyObject *)__pyx_n_s__data), ((PyObject *)__pyx_n_s__test), ((PyObject *)__pyx_n_s__compiled_components), ((PyObject *)__pyx_n_s__num_components), ((PyObject *)__pyx_n_s__i));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_98)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_98);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_98));

  /* "Cython_shift_calculator.pyx":138
 *     return result
 * 
 * def test_dump_dihedral_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 * 
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_17shift_calculators_13test_dump_dihedral_comp, NULL, __pyx_n_s__shift_calculators);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_100, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_k_codeobj_99 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(1, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_98, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_92, __pyx_n_s_100, 138, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_99)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line139")'> 139:     cdef size_t  test  = ctypes.addressof(data)</pre>
<pre id='line139' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":139
 * 
 * def test_dump_dihedral_comp(data):
 *     cdef size_t  test  = ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_test = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140: </pre>
<pre id='line140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line141")'> 141:     compiled_components =  &lt;Dihedral_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line141' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":141
 *     cdef size_t  test  = ctypes.addressof(data)
 * 
 *     compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     num_components =  len(data)/ sizeof(Dihedral_component)
 *     print 'dump num comp',num_components, test
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_compiled_components = ((struct __pyx_t_17shift_calculators_Dihedral_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line142")'> 142:     num_components =  len(data)/ sizeof(Dihedral_component)</pre>
<pre id='line142' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":142
 * 
 *     compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)
 *     num_components =  len(data)/ sizeof(Dihedral_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     print 'dump num comp',num_components, test
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_FromSize_t</span>((__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Dihedral_component))));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_v_num_components = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line143")'> 143:     print 'dump num comp',num_components, test</pre>
<pre id='line143' class='code' style='background-color: #FFFF5b'>
  /* "Cython_shift_calculator.pyx":143
 *     compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)
 *     num_components =  len(data)/ sizeof(Dihedral_component)
 *     print 'dump num comp',num_components, test             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for i in range(num_components):
 */
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_FromSize_t</span>(__pyx_v_test);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_6));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_kp_s_6));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_6));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_num_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_v_num_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_num_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_3), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144: </pre>
<pre id='line144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line145")'> 145:     for i in range(num_components):</pre>
<pre id='line145' class='code' style='background-color: #FFFF22'>
  /* "Cython_shift_calculator.pyx":145
 *     print 'dump num comp',num_components, test
 * 
 *     for i in range(num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         print 'target_atom',i, compiled_components[0].target_atom
 */
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_num_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_num_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_num_components);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
    __pyx_t_3 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146: </pre>
<pre id='line146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line147")'> 147:         print 'target_atom',i, compiled_components[0].target_atom</pre>
<pre id='line147' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":147
 *     for i in range(num_components):
 * 
 *         print 'target_atom',i, compiled_components[0].target_atom             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         print 'dihedral_atoms',i, compiled_components[i].dihedral_atoms[0],compiled_components[i].dihedral_atoms[1],\
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_compiled_components[0]).target_atom);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__target_atom));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__target_atom));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__target_atom));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_i);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148: </pre>
<pre id='line148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line149")'> 149:         print 'dihedral_atoms',i, compiled_components[i].dihedral_atoms[0],compiled_components[i].dihedral_atoms[1],\</pre>
<pre id='line149' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":149
 *         print 'target_atom',i, compiled_components[0].target_atom
 * 
 *         print 'dihedral_atoms',i, compiled_components[i].dihedral_atoms[0],compiled_components[i].dihedral_atoms[1],\             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                compiled_components[i].dihedral_atoms[2], compiled_components[i].dihedral_atoms[4]
 *         print 'coeff',i, compiled_components[i].coefficient
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(((__pyx_v_compiled_components[__pyx_t_7]).dihedral_atoms[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(((__pyx_v_compiled_components[__pyx_t_7]).dihedral_atoms[1]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line150")'> 150:                                compiled_components[i].dihedral_atoms[2], compiled_components[i].dihedral_atoms[4]</pre>
<pre id='line150' class='code' style='background-color: #FFFF2d'>
    /* "Cython_shift_calculator.pyx":150
 * 
 *         print 'dihedral_atoms',i, compiled_components[i].dihedral_atoms[0],compiled_components[i].dihedral_atoms[1],\
 *                                compiled_components[i].dihedral_atoms[2], compiled_components[i].dihedral_atoms[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         print 'coeff',i, compiled_components[i].coefficient
 *         print 'param',i, compiled_components[i].parameters[0], compiled_components[i].parameters[1],\
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_8 = <span class='py_c_api'>PyInt_FromLong</span>(((__pyx_v_compiled_components[__pyx_t_7]).dihedral_atoms[2]));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = <span class='py_c_api'>PyInt_FromLong</span>(((__pyx_v_compiled_components[__pyx_t_7]).dihedral_atoms[4]));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__dihedral_atoms));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, ((PyObject *)__pyx_n_s__dihedral_atoms));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__dihedral_atoms));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_v_i);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 2, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 3, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 4, __pyx_t_8);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 5, __pyx_t_9);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_9);
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_8 = 0;
    __pyx_t_9 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_10), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line151")'> 151:         print 'coeff',i, compiled_components[i].coefficient</pre>
<pre id='line151' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":151
 *         print 'dihedral_atoms',i, compiled_components[i].dihedral_atoms[0],compiled_components[i].dihedral_atoms[1],\
 *                                compiled_components[i].dihedral_atoms[2], compiled_components[i].dihedral_atoms[4]
 *         print 'coeff',i, compiled_components[i].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         print 'param',i, compiled_components[i].parameters[0], compiled_components[i].parameters[1],\
 *                       compiled_components[i].parameters[2], compiled_components[i].parameters[3],\
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_compiled_components[__pyx_t_7]).coefficient);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__coeff));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, ((PyObject *)__pyx_n_s__coeff));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__coeff));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_v_i);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2, __pyx_t_10);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_10);
    __pyx_t_10 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_9), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line152")'> 152:         print 'param',i, compiled_components[i].parameters[0], compiled_components[i].parameters[1],\</pre>
<pre id='line152' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":152
 *                                compiled_components[i].dihedral_atoms[2], compiled_components[i].dihedral_atoms[4]
 *         print 'coeff',i, compiled_components[i].coefficient
 *         print 'param',i, compiled_components[i].parameters[0], compiled_components[i].parameters[1],\             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                       compiled_components[i].parameters[2], compiled_components[i].parameters[3],\
 *                       compiled_components[i].parameters[4], compiled_components[i].parameters[5],\
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_compiled_components[__pyx_t_7]).parameters[0]));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_compiled_components[__pyx_t_7]).parameters[1]));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line153")'> 153:                       compiled_components[i].parameters[2], compiled_components[i].parameters[3],\</pre>
<pre id='line153' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":153
 *         print 'coeff',i, compiled_components[i].coefficient
 *         print 'param',i, compiled_components[i].parameters[0], compiled_components[i].parameters[1],\
 *                       compiled_components[i].parameters[2], compiled_components[i].parameters[3],\             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                       compiled_components[i].parameters[4], compiled_components[i].parameters[5],\
 *                       compiled_components[i].parameters[6]
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_compiled_components[__pyx_t_7]).parameters[2]));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_compiled_components[__pyx_t_7]).parameters[3]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line154")'> 154:                       compiled_components[i].parameters[4], compiled_components[i].parameters[5],\</pre>
<pre id='line154' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":154
 *         print 'param',i, compiled_components[i].parameters[0], compiled_components[i].parameters[1],\
 *                       compiled_components[i].parameters[2], compiled_components[i].parameters[3],\
 *                       compiled_components[i].parameters[4], compiled_components[i].parameters[5],\             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                       compiled_components[i].parameters[6]
 * 
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_compiled_components[__pyx_t_7]).parameters[4]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_compiled_components[__pyx_t_7]).parameters[5]));<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line155")'> 155:                       compiled_components[i].parameters[6]</pre>
<pre id='line155' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":155
 *                       compiled_components[i].parameters[2], compiled_components[i].parameters[3],\
 *                       compiled_components[i].parameters[4], compiled_components[i].parameters[5],\
 *                       compiled_components[i].parameters[6]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_compiled_components[__pyx_t_7]).parameters[6]));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
    __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(9);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__param));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, ((PyObject *)__pyx_n_s__param));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__param));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_v_i);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2, __pyx_t_9);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_9);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 3, __pyx_t_10);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_10);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 4, __pyx_t_8);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 5, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 6, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 7, __pyx_t_11);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 8, __pyx_t_12);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_12);
    __pyx_t_9 = 0;
    __pyx_t_10 = 0;
    __pyx_t_8 = 0;
    __pyx_t_2 = 0;
    __pyx_t_1 = 0;
    __pyx_t_11 = 0;
    __pyx_t_12 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_13), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_13)); __pyx_t_13 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.test_dump_dihedral_comp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_num_components);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_20CDSSharedVectorFloat_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_20CDSSharedVectorFloat_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_size;
  PyObject *__pyx_v_ensembleSimulation = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__size,&__pyx_n_s__ensembleSimulation,0};
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156: </pre>
<pre id='line156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157: </pre>
<pre id='line157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158: cdef class CDSSharedVectorFloat:</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":158
 * 
 * 
 * cdef class CDSSharedVectorFloat:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[double]*  data
 * 
 */
struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *__pyx_vtab;
  CDSVector<code><</code>double> *data;
};


/* "Cython_shift_calculator.pyx":158
 * 
 * 
 * cdef class CDSSharedVectorFloat:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[double]*  data
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat {
  void (*resize)(struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *, int);
  CDSVector<code><</code>double> *(*get_data)(struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *);
};
static struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *__pyx_vtabptr_17shift_calculators_CDSSharedVectorFloat;


</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159:     cdef CDSVector[double]*  data</pre>
<pre id='line159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160: </pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161: </pre>
<pre id='line161' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line162")'> 162:     def __cinit__(self, int size=0, object ensembleSimulation=None):</pre>
<pre id='line162' class='code' style='background-color: #FFFF33'>
    /* "Cython_shift_calculator.pyx":162
 * 
 * 
 *     def __cinit__(self, int size=0, object ensembleSimulation=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef EnsembleSimulation* cEnsembleSimulation = simulationAsNative(ensembleSimulation)
 *         #TODO: get rid of this casting
 */
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__size);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ensembleSimulation);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    if (values[0]) {
      __pyx_v_size = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_size == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_size = ((int)0);
    }
    __pyx_v_ensembleSimulation = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.CDSSharedVectorFloat.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_20CDSSharedVectorFloat___cinit__(((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_self), __pyx_v_size, __pyx_v_ensembleSimulation);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static int __pyx_pf_17shift_calculators_20CDSSharedVectorFloat___cinit__(struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_self, int __pyx_v_size, PyObject *__pyx_v_ensembleSimulation) {
  EnsembleSimulation *__pyx_v_cEnsembleSimulation;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163:         cdef EnsembleSimulation* cEnsembleSimulation = simulationAsNative(ensembleSimulation)</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":163
 * 
 *     def __cinit__(self, int size=0, object ensembleSimulation=None):
 *         cdef EnsembleSimulation* cEnsembleSimulation = simulationAsNative(ensembleSimulation)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO: get rid of this casting
 *         self.data = <code><</code>CDSVector[double]*>createSharedVec(size, 0.0,  cEnsembleSimulation)
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_simulationAsNative(__pyx_v_ensembleSimulation);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_cEnsembleSimulation = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:         #TODO: get rid of this casting</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165:         self.data = &lt;CDSVector[double]*&gt;createSharedVec(size, 0.0,  cEnsembleSimulation)</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":165
 *         cdef EnsembleSimulation* cEnsembleSimulation = simulationAsNative(ensembleSimulation)
 *         #TODO: get rid of this casting
 *         self.data = <code><</code>CDSVector[double]*>createSharedVec(size, 0.0,  cEnsembleSimulation)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.resize(size)
 * 
 */
  __pyx_v_self->data = ((CDSVector<code><</code>double> *)SharedCDSVectorFactory::createSharedVec(__pyx_v_size, 0.0, __pyx_v_cEnsembleSimulation));
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line166")'> 166:         self.resize(size)</pre>
<pre id='line166' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":166
 *         #TODO: get rid of this casting
 *         self.data = <code><</code>CDSVector[double]*>createSharedVec(size, 0.0,  cEnsembleSimulation)
 *         self.resize(size)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #     cpdef int size(self):
 */
  ((struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_self->__pyx_vtab)->resize(__pyx_v_self, __pyx_v_size);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.CDSSharedVectorFloat.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167: </pre>
<pre id='line167' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168: #     cpdef int size(self):</pre>
<pre id='line168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169: #         return self[0].data.size()</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170: </pre>
<pre id='line170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171:     cdef void resize(self,int size) nogil:</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":171
 * #         return self[0].data.size()
 * 
 *     cdef void resize(self,int size) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0].resize(size)
 * 
 */

static void __pyx_f_17shift_calculators_20CDSSharedVectorFloat_resize(struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_self, int __pyx_v_size) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line172")'> 172:         self.data[0].resize(size)</pre>
<pre id='line172' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":172
 * 
 *     cdef void resize(self,int size) nogil:
 *         self.data[0].resize(size)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def clear(self):
 */
  (__pyx_v_self->data[0]).resize(__pyx_v_size);

}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_20CDSSharedVectorFloat_3clear(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_20CDSSharedVectorFloat_3clear(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_20CDSSharedVectorFloat_2clear(((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173: </pre>
<pre id='line173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174:     def clear(self):</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":174
 *         self.data[0].resize(size)
 * 
 *     def clear(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         clearVector(self.data)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_20CDSSharedVectorFloat_2clear(struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line175")'> 175:         clearVector(self.data)</pre>
<pre id='line175' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":175
 * 
 *     def clear(self):
 *         clearVector(self.data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: a bit ugly can we use operator
 */
  SharedCDSVectorFactory::clearVector(__pyx_v_self->data);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176: </pre>
<pre id='line176' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:     #TODO: a bit ugly can we use operator</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:     cdef CDSVector[double]* get_data(self) nogil:</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":178
 * 
 *     #TODO: a bit ugly can we use operator
 *     cdef CDSVector[double]* get_data(self) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self.data
 * 
 */

static CDSVector<code><</code>double> *__pyx_f_17shift_calculators_20CDSSharedVectorFloat_get_data(struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_self) {
  CDSVector<code><</code>double> *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line179")'> 179:         return  self.data</pre>
<pre id='line179' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":179
 *     #TODO: a bit ugly can we use operator
 *     cdef CDSVector[double]* get_data(self) nogil:
 *         return  self.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __len__(self):
 */
  __pyx_r = __pyx_v_self->data;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static Py_ssize_t __pyx_pw_17shift_calculators_20CDSSharedVectorFloat_5__len__(PyObject *__pyx_v_self); /*proto*/
static Py_ssize_t __pyx_pw_17shift_calculators_20CDSSharedVectorFloat_5__len__(PyObject *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__len__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_20CDSSharedVectorFloat_4__len__(((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180: </pre>
<pre id='line180' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181:     def __len__(self):</pre>
<pre id='line181' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":181
 *         return  self.data
 * 
 *     def __len__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self.data[0].size()
 * 
 */

static Py_ssize_t __pyx_pf_17shift_calculators_20CDSSharedVectorFloat_4__len__(struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__len__", 0);
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line182")'> 182:         return self.data[0].size()</pre>
<pre id='line182' class='code' style='background-color: #FFFF2f'>
  /* "Cython_shift_calculator.pyx":182
 * 
 *     def __len__(self):
 *         return self.data[0].size()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef  class Non_bonded_interaction_list:
 */
  __pyx_r = (__pyx_v_self->data[0]).size();
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_27Non_bonded_interaction_list_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_27Non_bonded_interaction_list_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_length;
  double __pyx_v_fill_factor;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__length,&__pyx_n_s__fill_factor,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__length);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__fill_factor);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    if (values[0]) {
      __pyx_v_length = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_length == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_length = ((int)0);
    }
    if (values[1]) {
      __pyx_v_fill_factor = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_fill_factor == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183: </pre>
<pre id='line183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line184")'> 184: cdef  class Non_bonded_interaction_list:</pre>
<pre id='line184' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":184
 *         return self.data[0].size()
 * 
 * cdef  class Non_bonded_interaction_list:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[int]  *data
 *     cdef int length
 */
struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Non_bonded_interaction_list *__pyx_vtab;
  CDSVector<code><</code>int> *data;
  int length;
  int size_increment;
  int RECORD_LENGTH;
};


/* "Cython_shift_calculator.pyx":184
 *         return self.data[0].size()
 * 
 * cdef  class Non_bonded_interaction_list:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[int]  *data
 *     cdef int length
 */

struct __pyx_vtabstruct_17shift_calculators_Non_bonded_interaction_list {
  void (*append)(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *, int, int, int, int);
  void (*resize)(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *);
  struct __pyx_t_17shift_calculators_Component_index_pair *(*get)(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *, int);
  int (*get_length)(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *);
};
static struct __pyx_vtabstruct_17shift_calculators_Non_bonded_interaction_list *__pyx_vtabptr_17shift_calculators_Non_bonded_interaction_list;
static CYTHON_INLINE void __pyx_f_17shift_calculators_27Non_bonded_interaction_list_append(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *, int, int, int, int);
static CYTHON_INLINE void __pyx_f_17shift_calculators_27Non_bonded_interaction_list_resize(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_Component_index_pair *__pyx_f_17shift_calculators_27Non_bonded_interaction_list_get(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185:     cdef CDSVector[int]  *data</pre>
<pre id='line185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:     cdef int length</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187:     cdef int size_increment</pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188:     cdef int RECORD_LENGTH</pre>
<pre id='line188' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189: </pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line190")'> 190:     def __cinit__(self, int length=0, double fill_factor=1.0):</pre>
<pre id='line190' class='code' style='background-color: #FFFF96'>
      /* "Cython_shift_calculator.pyx":190
 *     cdef int RECORD_LENGTH
 * 
 *     def __cinit__(self, int length=0, double fill_factor=1.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data = new CDSVector[int]()
 *         self.data[0].resize(<code><</code>int>ceil(length*fill_factor*2))
 */
      __pyx_v_fill_factor = ((double)1.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list___cinit__(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self), __pyx_v_length, __pyx_v_fill_factor);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static int __pyx_pf_17shift_calculators_27Non_bonded_interaction_list___cinit__(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self, int __pyx_v_length, double __pyx_v_fill_factor) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191:         self.data = new CDSVector[int]()</pre>
<pre id='line191' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":191
 * 
 *     def __cinit__(self, int length=0, double fill_factor=1.0):
 *         self.data = new CDSVector[int]()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0].resize(<code><</code>int>ceil(length*fill_factor*2))
 *         self.length =  0
 */
  try {
    __pyx_t_1 = new CDSVector<code><</code>int>();
  } catch(...) {
    __Pyx_CppExn2PyErr();
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_self->data = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line192")'> 192:         self.data[0].resize(&lt;int&gt;ceil(length*fill_factor*2))</pre>
<pre id='line192' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":192
 *     def __cinit__(self, int length=0, double fill_factor=1.0):
 *         self.data = new CDSVector[int]()
 *         self.data[0].resize(<code><</code>int>ceil(length*fill_factor*2))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.length =  0
 *         self.size_increment =  20
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ceil);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_length * __pyx_v_fill_factor) * 2.0));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  (__pyx_v_self->data[0]).resize(((int)__pyx_t_5));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193:         self.length =  0</pre>
<pre id='line193' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":193
 *         self.data = new CDSVector[int]()
 *         self.data[0].resize(<code><</code>int>ceil(length*fill_factor*2))
 *         self.length =  0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.size_increment =  20
 *         self.RECORD_LENGTH = 4
 */
  __pyx_v_self->length = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:         self.size_increment =  20</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":194
 *         self.data[0].resize(<code><</code>int>ceil(length*fill_factor*2))
 *         self.length =  0
 *         self.size_increment =  20             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.RECORD_LENGTH = 4
 * 
 */
  __pyx_v_self->size_increment = 20;
</pre><pre class='line' style='background-color: #FFFF1a' onclick='toggleDiv("line195")'> 195:         self.RECORD_LENGTH = 4</pre>
<pre id='line195' class='code' style='background-color: #FFFF1a'>
  /* "Cython_shift_calculator.pyx":195
 *         self.length =  0
 *         self.size_increment =  20
 *         self.RECORD_LENGTH = 4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def test_append(self,int target_atom_id, int target_id, int remote_id, component_index):
 */
  __pyx_v_self->RECORD_LENGTH = 4;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_3test_append(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_3test_append(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  int __pyx_v_target_id;
  int __pyx_v_remote_id;
  PyObject *__pyx_v_component_index = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_append (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__target_id,&__pyx_n_s__remote_id,&__pyx_n_s__component_index,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("test_append", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__remote_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("test_append", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_index)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("test_append", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "test_append") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_target_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_target_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_remote_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_remote_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_component_index = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("test_append", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.test_append", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_2test_append(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_target_id, __pyx_v_remote_id, __pyx_v_component_index);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196: </pre>
<pre id='line196' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197:     def test_append(self,int target_atom_id, int target_id, int remote_id, component_index):</pre>
<pre id='line197' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":197
 *         self.RECORD_LENGTH = 4
 * 
 *     def test_append(self,int target_atom_id, int target_id, int remote_id, component_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.append(target_atom_id,  target_id,  remote_id, component_index)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_27Non_bonded_interaction_list_2test_append(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_target_id, int __pyx_v_remote_id, PyObject *__pyx_v_component_index) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_append", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line198")'> 198:         self.append(target_atom_id,  target_id,  remote_id, component_index)</pre>
<pre id='line198' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":198
 * 
 *     def test_append(self,int target_atom_id, int target_id, int remote_id, component_index):
 *         self.append(target_atom_id,  target_id,  remote_id, component_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def clear(self):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_component_index);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_f_17shift_calculators_27Non_bonded_interaction_list_append(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_target_id, __pyx_v_remote_id, __pyx_t_1);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.test_append", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_5clear(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_5clear(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_4clear(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199: </pre>
<pre id='line199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:     def clear(self):</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":200
 *         self.append(target_atom_id,  target_id,  remote_id, component_index)
 * 
 *     def clear(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.length = 0
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_27Non_bonded_interaction_list_4clear(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line201")'> 201:         self.length = 0</pre>
<pre id='line201' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":201
 * 
 *     def clear(self):
 *         self.length = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void append(self, int target_atom_id, int target_id, int remote_id, int component_index):
 */
  __pyx_v_self->length = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202: </pre>
<pre id='line202' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:     cdef inline void append(self, int target_atom_id, int target_id, int remote_id, int component_index):</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":203
 *         self.length = 0
 * 
 *     cdef inline void append(self, int target_atom_id, int target_id, int remote_id, int component_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if  self.data[0].size()*self.RECORD_LENGTH <code><</code>= self.length*self.RECORD_LENGTH:
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_27Non_bonded_interaction_list_append(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_target_id, int __pyx_v_remote_id, int __pyx_v_component_index) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("append", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204: </pre>
<pre id='line204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205:         if  self.data[0].size()*self.RECORD_LENGTH &lt;= self.length*self.RECORD_LENGTH:</pre>
<pre id='line205' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":205
 *     cdef inline void append(self, int target_atom_id, int target_id, int remote_id, int component_index):
 * 
 *         if  self.data[0].size()*self.RECORD_LENGTH <code><</code>= self.length*self.RECORD_LENGTH:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self.resize()
 *         self.data[0][self.length] = target_atom_id
 */
  __pyx_t_1 = (((__pyx_v_self->data[0]).size() * __pyx_v_self->RECORD_LENGTH) <code><</code>= (__pyx_v_self->length * __pyx_v_self->RECORD_LENGTH));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206:             self.resize()</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":206
 * 
 *         if  self.data[0].size()*self.RECORD_LENGTH <code><</code>= self.length*self.RECORD_LENGTH:
 *             self.resize()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0][self.length] = target_atom_id
 *         self.data[0][self.length+1] = target_id
 */
    __pyx_f_17shift_calculators_27Non_bonded_interaction_list_resize(__pyx_v_self);
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207:         self.data[0][self.length] = target_atom_id</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":207
 *         if  self.data[0].size()*self.RECORD_LENGTH <code><</code>= self.length*self.RECORD_LENGTH:
 *             self.resize()
 *         self.data[0][self.length] = target_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0][self.length+1] = target_id
 *         self.data[0][self.length+2] = remote_id
 */
  ((__pyx_v_self->data[0])[__pyx_v_self->length]) = __pyx_v_target_atom_id;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:         self.data[0][self.length+1] = target_id</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":208
 *             self.resize()
 *         self.data[0][self.length] = target_atom_id
 *         self.data[0][self.length+1] = target_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0][self.length+2] = remote_id
 *         self.data[0][self.length+3] = component_index
 */
  ((__pyx_v_self->data[0])[(__pyx_v_self->length + 1)]) = __pyx_v_target_id;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209:         self.data[0][self.length+2] = remote_id</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":209
 *         self.data[0][self.length] = target_atom_id
 *         self.data[0][self.length+1] = target_id
 *         self.data[0][self.length+2] = remote_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0][self.length+3] = component_index
 * 
 */
  ((__pyx_v_self->data[0])[(__pyx_v_self->length + 2)]) = __pyx_v_remote_id;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210:         self.data[0][self.length+3] = component_index</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":210
 *         self.data[0][self.length+1] = target_id
 *         self.data[0][self.length+2] = remote_id
 *         self.data[0][self.length+3] = component_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.length += self.RECORD_LENGTH
 */
  ((__pyx_v_self->data[0])[(__pyx_v_self->length + 3)]) = __pyx_v_component_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211: </pre>
<pre id='line211' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line212")'> 212:         self.length += self.RECORD_LENGTH</pre>
<pre id='line212' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":212
 *         self.data[0][self.length+3] = component_index
 * 
 *         self.length += self.RECORD_LENGTH             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->length = (__pyx_v_self->length + __pyx_v_self->RECORD_LENGTH);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213: </pre>
<pre id='line213' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214: </pre>
<pre id='line214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215:     cdef inline void resize(self):</pre>
<pre id='line215' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":215
 * 
 * 
 *     cdef inline void resize(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0].resize(self.data[0].size()+self.size_increment*self.RECORD_LENGTH)
 * 
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_27Non_bonded_interaction_list_resize(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("resize", 0);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line216")'> 216:         self.data[0].resize(self.data[0].size()+self.size_increment*self.RECORD_LENGTH)</pre>
<pre id='line216' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":216
 * 
 *     cdef inline void resize(self):
 *         self.data[0].resize(self.data[0].size()+self.size_increment*self.RECORD_LENGTH)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline Component_index_pair* get(self,int offset) nogil:
 */
  (__pyx_v_self->data[0]).resize(((__pyx_v_self->data[0]).size() + (__pyx_v_self->size_increment * __pyx_v_self->RECORD_LENGTH)));

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217: </pre>
<pre id='line217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218:     cdef inline Component_index_pair* get(self,int offset) nogil:</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":218
 *         self.data[0].resize(self.data[0].size()+self.size_increment*self.RECORD_LENGTH)
 * 
 *     cdef inline Component_index_pair* get(self,int offset) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return <code><</code>Component_index_pair *> &self.data[0][offset*self.RECORD_LENGTH]
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_Component_index_pair *__pyx_f_17shift_calculators_27Non_bonded_interaction_list_get(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self, int __pyx_v_offset) {
  struct __pyx_t_17shift_calculators_Component_index_pair *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line219")'> 219:         return &lt;Component_index_pair *&gt; &amp;self.data[0][offset*self.RECORD_LENGTH]</pre>
<pre id='line219' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":219
 * 
 *     cdef inline Component_index_pair* get(self,int offset) nogil:
 *         return <code><</code>Component_index_pair *> &self.data[0][offset*self.RECORD_LENGTH]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def get_allocation(self):
 */
  __pyx_r = ((struct __pyx_t_17shift_calculators_Component_index_pair *)(&((__pyx_v_self->data[0])[(__pyx_v_offset * __pyx_v_self->RECORD_LENGTH)])));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_7get_allocation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_7get_allocation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_allocation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_6get_allocation(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: </pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221:     def get_allocation(self):</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":221
 *         return <code><</code>Component_index_pair *> &self.data[0][offset*self.RECORD_LENGTH]
 * 
 *     def get_allocation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self.data[0].size()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_27Non_bonded_interaction_list_6get_allocation(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_allocation", 0);
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line222")'> 222:         return self.data[0].size()</pre>
<pre id='line222' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":222
 * 
 *     def get_allocation(self):
 *         return self.data[0].size()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def get_size_increment(self):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_self->data[0]).size());<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.get_allocation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_9get_size_increment(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_9get_size_increment(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_size_increment (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_8get_size_increment(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223: </pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224:     def get_size_increment(self):</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":224
 *         return self.data[0].size()
 * 
 *     def get_size_increment(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self.size_increment
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_27Non_bonded_interaction_list_8get_size_increment(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_size_increment", 0);
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line225")'> 225:         return self.size_increment</pre>
<pre id='line225' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":225
 * 
 *     def get_size_increment(self):
 *         return self.size_increment             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __len__(self):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->size_increment);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.get_size_increment", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static Py_ssize_t __pyx_pw_17shift_calculators_27Non_bonded_interaction_list_11__len__(PyObject *__pyx_v_self); /*proto*/
static Py_ssize_t __pyx_pw_17shift_calculators_27Non_bonded_interaction_list_11__len__(PyObject *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__len__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_10__len__(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226: </pre>
<pre id='line226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227:     def __len__(self):</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":227
 *         return self.size_increment
 * 
 *     def __len__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self.size()
 * 
 */

static Py_ssize_t __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_10__len__(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__len__", 0);
</pre><pre class='line' style='background-color: #FFFF44' onclick='toggleDiv("line228")'> 228:         return self.size()</pre>
<pre id='line228' class='code' style='background-color: #FFFF44'>
  /* "Cython_shift_calculator.pyx":228
 * 
 *     def __len__(self):
 *         return self.size()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef int get_length(self) nogil:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.__len__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229: </pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:     cdef int get_length(self) nogil:</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":230
 *         return self.size()
 * 
 *     cdef int get_length(self) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self.length/self.RECORD_LENGTH
 * 
 */

static int __pyx_f_17shift_calculators_27Non_bonded_interaction_list_get_length(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self) {
  int __pyx_r;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line231")'> 231:         return self.length/self.RECORD_LENGTH</pre>
<pre id='line231' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":231
 * 
 *     cdef int get_length(self) nogil:
 *         return self.length/self.RECORD_LENGTH             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __getitem__(self, int key):
 */
  __pyx_r = (__pyx_v_self->length / __pyx_v_self->RECORD_LENGTH);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_13__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_key); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_13__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_key) {
  int __pyx_v_key;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__ (wrapper)", 0);
  assert(__pyx_arg_key); {
    __pyx_v_key = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_arg_key);<span class='error_goto'> if (unlikely((__pyx_v_key == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_12__getitem__(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self), ((int)__pyx_v_key));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232: </pre>
<pre id='line232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233:     def __getitem__(self, int key):</pre>
<pre id='line233' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":233
 *         return self.length/self.RECORD_LENGTH
 * 
 *     def __getitem__(self, int key):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if key >= self.length/self.RECORD_LENGTH:
 *             raise IndexError("index (%i) out of range (%i)" % (key, self.length/self.RECORD_LENGTH))
 */

static PyObject *__pyx_pf_17shift_calculators_27Non_bonded_interaction_list_12__getitem__(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self, int __pyx_v_key) {
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:         if key &gt;= self.length/self.RECORD_LENGTH:</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":234
 * 
 *     def __getitem__(self, int key):
 *         if key >= self.length/self.RECORD_LENGTH:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError("index (%i) out of range (%i)" % (key, self.length/self.RECORD_LENGTH))
 *         result  = []
 */
  __pyx_t_1 = (__pyx_v_key >= (__pyx_v_self->length / __pyx_v_self->RECORD_LENGTH));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line235")'> 235:             raise IndexError("index (%i) out of range (%i)" % (key, self.length/self.RECORD_LENGTH))</pre>
<pre id='line235' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":235
 *     def __getitem__(self, int key):
 *         if key >= self.length/self.RECORD_LENGTH:
 *             raise IndexError("index (%i) out of range (%i)" % (key, self.length/self.RECORD_LENGTH))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = []
 *         for i in range(self.RECORD_LENGTH):
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_key);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_self->length / __pyx_v_self->RECORD_LENGTH));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_7), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line236")'> 236:         result  = []</pre>
<pre id='line236' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":236
 *         if key >= self.length/self.RECORD_LENGTH:
 *             raise IndexError("index (%i) out of range (%i)" % (key, self.length/self.RECORD_LENGTH))
 *         result  = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self.RECORD_LENGTH):
 *             result.append(self.data[0][key*self.RECORD_LENGTH+i])
 */
  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_v_result = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line237")'> 237:         for i in range(self.RECORD_LENGTH):</pre>
<pre id='line237' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":237
 *             raise IndexError("index (%i) out of range (%i)" % (key, self.length/self.RECORD_LENGTH))
 *         result  = []
 *         for i in range(self.RECORD_LENGTH):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result.append(self.data[0][key*self.RECORD_LENGTH+i])
 *         return tuple(result)
 */
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->RECORD_LENGTH);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
    __pyx_t_4 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line238")'> 238:             result.append(self.data[0][key*self.RECORD_LENGTH+i])</pre>
<pre id='line238' class='code' style='background-color: #FFFF39'>
    /* "Cython_shift_calculator.pyx":238
 *         result  = []
 *         for i in range(self.RECORD_LENGTH):
 *             result.append(self.data[0][key*self.RECORD_LENGTH+i])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return tuple(result)
 * 
 */
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_key * __pyx_v_self->RECORD_LENGTH));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(((__pyx_v_self->data[0])[__pyx_t_7]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_8 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, __pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line239")'> 239:         return tuple(result)</pre>
<pre id='line239' class='code' style='background-color: #FFFF35'>
  /* "Cython_shift_calculator.pyx":239
 *         for i in range(self.RECORD_LENGTH):
 *             result.append(self.data[0][key*self.RECORD_LENGTH+i])
 *         return tuple(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def build_selection_list(self, accept = lambda x: True):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = ((PyObject *)<span class='py_c_api'>PyList_AsTuple</span>(__pyx_v_result));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  __pyx_r = ((PyObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_15build_selection_list(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_15build_selection_list(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_accept = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("build_selection_list (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__accept,0};
    PyObject* values[1] = {0};
    values[0] = __pyx_k_8;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__accept);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "build_selection_list") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_accept = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("build_selection_list", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.build_selection_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_14build_selection_list(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self), __pyx_v_accept);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240: </pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line241")'> 241:     def build_selection_list(self, accept = lambda x: True):</pre>
<pre id='line241' class='code' style='background-color: #FFFF6e'>
/* "Cython_shift_calculator.pyx":241
 *         return tuple(result)
 * 
 *     def build_selection_list(self, accept = lambda x: True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = []
 *         for i,elem in enumerate(self):
 */

static PyObject *__pyx_lambda_funcdef_17shift_calculators_lambda1(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_x) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("lambda1", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* "Cython_shift_calculator.pyx":241
 *         return tuple(result)
 * 
 *     def build_selection_list(self, accept = lambda x: True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = []
 *         for i,elem in enumerate(self):
 */

static PyObject *__pyx_pf_17shift_calculators_27Non_bonded_interaction_list_14build_selection_list(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self, PyObject *__pyx_v_accept) {
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_elem = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("build_selection_list", 0);

  /* "Cython_shift_calculator.pyx":241
 *         return tuple(result)
 * 
 *     def build_selection_list(self, accept = lambda x: True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = []
 *         for i,elem in enumerate(self):
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_CyFunction_NewEx</span>(&__pyx_mdef_17shift_calculators_14lambda1, 0, __pyx_n_s_101, NULL, __pyx_n_s__shift_calculators, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_8 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line242")'> 242:         result = []</pre>
<pre id='line242' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":242
 * 
 *     def build_selection_list(self, accept = lambda x: True):
 *         result = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,elem in enumerate(self):
 *             if accept(elem):
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line243")'> 243:         for i,elem in enumerate(self):</pre>
<pre id='line243' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":243
 *     def build_selection_list(self, accept = lambda x: True):
 *         result = []
 *         for i,elem in enumerate(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if accept(elem):
 *                 result.append(i)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_1 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(((PyObject *)__pyx_v_self)) || <span class='py_c_api'>PyTuple_CheckExact</span>(((PyObject *)__pyx_v_self))) {
    __pyx_t_2 = ((PyObject *)__pyx_v_self); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(((PyObject *)__pyx_v_self));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_3 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_3 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_elem);
    __pyx_v_elem = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1);
    __pyx_t_1 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line244")'> 244:             if accept(elem):</pre>
<pre id='line244' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":244
 *         result = []
 *         for i,elem in enumerate(self):
 *             if accept(elem):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result.append(i)
 *         return array.array('i',result)
 */
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_elem);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_elem);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_elem);
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_v_accept, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_7 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_7) {
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line245")'> 245:                 result.append(i)</pre>
<pre id='line245' class='code' style='background-color: #FFFF96'>
      /* "Cython_shift_calculator.pyx":245
 *         for i,elem in enumerate(self):
 *             if accept(elem):
 *                 result.append(i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return array.array('i',result)
 * 
 */
      __pyx_t_8 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line246")'> 246:         return array.array('i',result)</pre>
<pre id='line246' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":246
 *             if accept(elem):
 *                 result.append(i)
 *         return array.array('i',result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__i));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__i));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__i));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_result));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_result));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_7cpython_5array_array)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.build_selection_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_elem);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_17get_all_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_27Non_bonded_interaction_list_17get_all_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_all_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_27Non_bonded_interaction_list_16get_all_components(((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247: </pre>
<pre id='line247' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line248")'> 248: </pre>
<pre id='line248' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249:     def get_all_components(self):</pre>
<pre id='line249' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":249
 * 
 * 
 *     def get_all_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result = []
 *         for i in range(self.length/self.RECORD_LENGTH):
 */

static PyObject *__pyx_pf_17shift_calculators_27Non_bonded_interaction_list_16get_all_components(struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_self) {
  PyObject *__pyx_v_result = NULL;
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_all_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line250")'> 250:         result = []</pre>
<pre id='line250' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":250
 * 
 *     def get_all_components(self):
 *         result = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self.length/self.RECORD_LENGTH):
 *             result.append(self[i])
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251:         for i in range(self.length/self.RECORD_LENGTH):</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":251
 *     def get_all_components(self):
 *         result = []
 *         for i in range(self.length/self.RECORD_LENGTH):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result.append(self[i])
 *         return result
 */
  __pyx_t_2 = (__pyx_v_self->length / __pyx_v_self->RECORD_LENGTH);
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line252")'> 252:             result.append(self[i])</pre>
<pre id='line252' class='code' style='background-color: #FFFF8d'>
    /* "Cython_shift_calculator.pyx":252
 *         result = []
 *         for i in range(self.length/self.RECORD_LENGTH):
 *             result.append(self[i])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_self), __pyx_v_i, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line253")'> 253:         return result</pre>
<pre id='line253' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":253
 *         for i in range(self.length/self.RECORD_LENGTH):
 *             result.append(self[i])
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Vec3_list:
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Non_bonded_interaction_list.get_all_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_9Vec3_list_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_9Vec3_list_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_9Vec3_list___cinit__(((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254: </pre>
<pre id='line254' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line255")'> 255: cdef class Vec3_list:</pre>
<pre id='line255' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":255
 *         return result
 * 
 * cdef class Vec3_list:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[Vec3] *data
 * 
 */
struct __pyx_obj_17shift_calculators_Vec3_list {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Vec3_list *__pyx_vtab;
  CDSVector<code><</code>Vec3> *data;
};


/* "Cython_shift_calculator.pyx":255
 *         return result
 * 
 * cdef class Vec3_list:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[Vec3] *data
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Vec3_list {
  PyObject *(*set_length)(struct __pyx_obj_17shift_calculators_Vec3_list *, int);
  Vec3 *(*get)(struct __pyx_obj_17shift_calculators_Vec3_list *, int);
  PyObject *(*set)(struct __pyx_obj_17shift_calculators_Vec3_list *, int, Vec3 &);
};
static struct __pyx_vtabstruct_17shift_calculators_Vec3_list *__pyx_vtabptr_17shift_calculators_Vec3_list;
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_9Vec3_list_get(struct __pyx_obj_17shift_calculators_Vec3_list *, int);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_9Vec3_list_set(struct __pyx_obj_17shift_calculators_Vec3_list *, int, Vec3 &);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256:     cdef CDSVector[Vec3] *data</pre>
<pre id='line256' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line257")'> 257: </pre>
<pre id='line257' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258:     def __cinit__(self):</pre>
<pre id='line258' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":258
 *     cdef CDSVector[Vec3] *data
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *          self.data = new CDSVector[Vec3]()
 * 
 */

static int __pyx_pf_17shift_calculators_9Vec3_list___cinit__(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line259")'> 259:          self.data = new CDSVector[Vec3]()</pre>
<pre id='line259' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":259
 * 
 *     def __cinit__(self):
 *          self.data = new CDSVector[Vec3]()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  try {
    __pyx_t_1 = new CDSVector<code><</code>Vec3>();
  } catch(...) {
    __Pyx_CppExn2PyErr();
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_self->data = __pyx_t_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Vec3_list.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line260")'> 260: </pre>
<pre id='line260' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261: </pre>
<pre id='line261' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262:     cdef set_length(self,int length):</pre>
<pre id='line262' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":262
 * 
 * 
 *     cdef set_length(self,int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data.resize(length)
 * 
 */

static PyObject *__pyx_f_17shift_calculators_9Vec3_list_set_length(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self, int __pyx_v_length) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_length", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line263")'> 263:         self.data.resize(length)</pre>
<pre id='line263' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":263
 * 
 *     cdef set_length(self,int length):
 *         self.data.resize(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_v_self->data->resize(__pyx_v_length);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264: </pre>
<pre id='line264' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265:     @cython.profile(False)</pre>
<pre id='line265' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line266")'> 266:     cdef inline Vec3*  get(self, int offset) nogil:</pre>
<pre id='line266' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":266
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3*  get(self, int offset) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return &self.data[0][offset]
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_9Vec3_list_get(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self, int __pyx_v_offset) {
  Vec3 *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267:         return &amp;self.data[0][offset]</pre>
<pre id='line267' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":267
 *     @cython.profile(False)
 *     cdef inline Vec3*  get(self, int offset) nogil:
 *         return &self.data[0][offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = (&((__pyx_v_self->data[0])[__pyx_v_offset]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268: </pre>
<pre id='line268' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269:     @cython.profile(False)</pre>
<pre id='line269' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270:     cdef inline set(self, int x, Vec3&amp; y):</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":270
 * 
 *     @cython.profile(False)
 *     cdef inline set(self, int x, Vec3& y):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0][x] =  y
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_9Vec3_list_set(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self, int __pyx_v_x, Vec3 &__pyx_v_y) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line271")'> 271:         self.data[0][x] =  y</pre>
<pre id='line271' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":271
 *     @cython.profile(False)
 *     cdef inline set(self, int x, Vec3& y):
 *         self.data[0][x] =  y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
  ((__pyx_v_self->data[0])[__pyx_v_x]) = __pyx_v_y;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_9Vec3_list_3__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_9Vec3_list_3__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_9Vec3_list_2__dealloc__(((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272: </pre>
<pre id='line272' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line273")'> 273:     def __dealloc__(self):</pre>
<pre id='line273' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":273
 *         self.data[0][x] =  y
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self.data != NULL:
 */

static void __pyx_pf_17shift_calculators_9Vec3_list_2__dealloc__(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274: </pre>
<pre id='line274' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275:         if self.data != NULL:</pre>
<pre id='line275' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":275
 *     def __dealloc__(self):
 * 
 *         if self.data != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             del self.data
 * 
 */
  __pyx_t_1 = (__pyx_v_self->data != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line276")'> 276:             del self.data</pre>
<pre id='line276' class='code' style='background-color: #FFFFd4'>
    /* "Cython_shift_calculator.pyx":276
 * 
 *         if self.data != NULL:
 *             del self.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    delete __pyx_v_self->data;
    goto __pyx_L3;
  }
  __pyx_L3:;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
static PyObject *__pyx_gb_17shift_calculators_9Vec3_list_6generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Vec3_list_5__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Vec3_list_5__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Vec3_list_4__iter__(((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277: </pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278: </pre>
<pre id='line278' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line279")'> 279:     def __iter__(self):</pre>
<pre id='line279' class='code' style='background-color: #FFFF79'>
/* "Cython_shift_calculator.pyx":279
 * 
 * 
 *     def __iter__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 vec3
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_9Vec3_list_4__iter__(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self) {
  struct __pyx_obj_17shift_calculators___pyx_scope_struct____iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_17shift_calculators___pyx_scope_struct____iter__ *)__pyx_ptype_17shift_calculators___pyx_scope_struct____iter__->tp_new(__pyx_ptype_17shift_calculators___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
    return NULL;
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_cur_scope->__pyx_v_self);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = <span class='pyx_c_api'>__Pyx_Generator_New</span>((__pyx_generator_body_t) __pyx_gb_17shift_calculators_9Vec3_list_6generator, (PyObject *) __pyx_cur_scope);<span class='error_goto'> if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 279; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_cur_scope);
    <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Vec3_list.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_cur_scope));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

static PyObject *__pyx_gb_17shift_calculators_9Vec3_list_6generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("None", 0);
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 279; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

/* "Cython_shift_calculator.pyx":279
 * 
 * 
 *     def __iter__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 vec3
 * 
 */
struct __pyx_obj_17shift_calculators___pyx_scope_struct____iter__ {
  PyObject_HEAD
  int __pyx_v_i;
  struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self;
  Vec3 __pyx_v_vec3;
  int __pyx_t_0;
  int __pyx_t_1;
};

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280:         cdef Vec3 vec3</pre>
<pre id='line280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281: </pre>
<pre id='line281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282: </pre>
<pre id='line282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283: </pre>
<pre id='line283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284:         for i in range(self.data.size()):</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":284
 * 
 * 
 *         for i in range(self.data.size()):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             vec3 = self.get(i)[0]
 *             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))
 */
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->data->size();
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_cur_scope->__pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285:             vec3 = self.get(i)[0]</pre>
<pre id='line285' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":285
 * 
 *         for i in range(self.data.size()):
 *             vec3 = self.get(i)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))
 * 
 */
    __pyx_cur_scope->__pyx_v_vec3 = (__pyx_f_17shift_calculators_9Vec3_list_get(__pyx_cur_scope->__pyx_v_self, __pyx_cur_scope->__pyx_v_i)[0]);
</pre><pre class='line' style='background-color: #FFFF18' onclick='toggleDiv("line286")'> 286:             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))</pre>
<pre id='line286' class='code' style='background-color: #FFFF18'>
    /* "Cython_shift_calculator.pyx":286
 *         for i in range(self.data.size()):
 *             vec3 = self.get(i)[0]
 *             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_cur_scope->__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__python_vec3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_cur_scope->__pyx_v_vec3[0]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_cur_scope->__pyx_v_vec3[1]));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_cur_scope->__pyx_v_vec3[2]));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_5);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_6);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2, __pyx_t_7);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_8), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_7);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
    __pyx_t_3 = 0;
    __pyx_t_7 = 0;
    __pyx_r = ((PyObject *)__pyx_t_8);
    __pyx_t_8 = 0;
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
    <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    if (unlikely(!__pyx_sent_value))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='py_c_api'>PyErr_SetNone</span>(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_generator->resume_label = -1;
  <span class='pyx_c_api'>__Pyx_Generator_clear</span>((PyObject*)__pyx_generator);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_9Out_array_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_9Out_array_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_length = 0;
  PyObject *__pyx_v_simulation = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__length,&__pyx_n_s__simulation,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 295; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 295; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_length = values[0];
    __pyx_v_simulation = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 295; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array___init__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_length, __pyx_v_simulation);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287: </pre>
<pre id='line287' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288: </pre>
<pre id='line288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289: cdef class Out_array:</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":289
 * 
 * 
 * cdef class Out_array:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long _length
 *     cdef double[60000] _data
 */
struct __pyx_obj_17shift_calculators_Out_array {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Out_array *__pyx_vtab;
  long _length;
  double _data[60000];
  int _mask[60000];
  EnsembleSimulation *_simulation;
};


/* "Cython_shift_calculator.pyx":289
 * 
 * 
 * cdef class Out_array:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long _length
 *     cdef double[60000] _data
 */

struct __pyx_vtabstruct_17shift_calculators_Out_array {
  PyObject *(*get_length)(struct __pyx_obj_17shift_calculators_Out_array *, int __pyx_skip_dispatch);
  PyObject *(*add_all)(struct __pyx_obj_17shift_calculators_Out_array *, struct __pyx_obj_17shift_calculators_Out_array *, int __pyx_skip_dispatch);
  int (*_check_clear_length)(struct __pyx_obj_17shift_calculators_Out_array *, long);
  int (*_check_offset)(struct __pyx_obj_17shift_calculators_Out_array *, long);
  int (*realloc)(struct __pyx_obj_17shift_calculators_Out_array *, long, int __pyx_skip_dispatch);
  int (*_check_state)(struct __pyx_obj_17shift_calculators_Out_array *);
  PyObject *(*_clear)(struct __pyx_obj_17shift_calculators_Out_array *, PyObject *);
  void (*add)(struct __pyx_obj_17shift_calculators_Out_array *, long, Vec3 &);
};
static struct __pyx_vtabstruct_17shift_calculators_Out_array *__pyx_vtabptr_17shift_calculators_Out_array;
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_clear_length(struct __pyx_obj_17shift_calculators_Out_array *, long);
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_offset(struct __pyx_obj_17shift_calculators_Out_array *, long);
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_state(struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_9Out_array_add(struct __pyx_obj_17shift_calculators_Out_array *, long, Vec3 &);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290:     cdef long _length</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291:     cdef double[60000] _data</pre>
<pre id='line291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292:     cdef int[60000] _mask</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293:     cdef EnsembleSimulation* _simulation</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294: </pre>
<pre id='line294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295:     def __init__ (self, length, simulation):</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":295
 *     cdef EnsembleSimulation* _simulation
 * 
 *     def __init__ (self, length, simulation):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._length = length
 *         self._simulation = simulationAsNative(simulation)
 */

static int __pyx_pf_17shift_calculators_9Out_array___init__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length, PyObject *__pyx_v_simulation) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line296")'> 296:         self._length = length</pre>
<pre id='line296' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":296
 * 
 *     def __init__ (self, length, simulation):
 *         self._length = length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = simulationAsNative(simulation)
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely((__pyx_t_1 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_length = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line297")'> 297:         self._simulation = simulationAsNative(simulation)</pre>
<pre id='line297' class='code' style='background-color: #FFFF38'>
  /* "Cython_shift_calculator.pyx":297
 *     def __init__ (self, length, simulation):
 *         self._length = length
 *         self._simulation = simulationAsNative(simulation)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_2 = __pyx_f_17shift_calculators_simulationAsNative(__pyx_v_simulation);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_simulation = __pyx_t_2;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_9Out_array_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_9Out_array_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_length = 0;
  CYTHON_UNUSED PyObject *__pyx_v_simulation = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__length,&__pyx_n_s__simulation,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_length = values[0];
    __pyx_v_simulation = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_2__cinit__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_length, __pyx_v_simulation);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298: </pre>
<pre id='line298' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299: </pre>
<pre id='line299' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line300")'> 300:     def __cinit__(self,  length, simulation):</pre>
<pre id='line300' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":300
 * 
 * 
 *     def __cinit__(self,  length, simulation):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._length =  60000
 * 
 */

static int __pyx_pf_17shift_calculators_9Out_array_2__cinit__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length, CYTHON_UNUSED PyObject *__pyx_v_simulation) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line301")'> 301:         self._length =  60000</pre>
<pre id='line301' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":301
 * 
 *     def __cinit__(self,  length, simulation):
 *         self._length =  60000             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if length > 60000:
 */
  __pyx_v_self->_length = 60000;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302: </pre>
<pre id='line302' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line303")'> 303:         if length &gt; 60000:</pre>
<pre id='line303' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":303
 *         self._length =  60000
 * 
 *         if length > 60000:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError("couldn't allocate array beyond length %i" % 60000)
 * #        self._data = <code><</code>double *>malloc(length * sizeof(double))
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_length, __pyx_int_60000, Py_GT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line304")'> 304:             raise MemoryError("couldn't allocate array beyond length %i" % 60000)</pre>
<pre id='line304' class='code' style='background-color: #FFFF48'>
    /* "Cython_shift_calculator.pyx":304
 * 
 *         if length > 60000:
 *             raise MemoryError("couldn't allocate array beyond length %i" % 60000)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._data = <code><</code>double *>malloc(length * sizeof(double))
 * #        if not self._data:
 */
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_9), __pyx_int_60000);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_t_1));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_1));
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line305")'> 305: #        self._data = &lt;double *&gt;malloc(length * sizeof(double))</pre>
<pre id='line305' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line306")'> 306: #        if not self._data:</pre>
<pre id='line306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line307")'> 307: #            raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line307' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308: #</pre>
<pre id='line308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line309")'> 309: #        self._mask = &lt;long *&gt;malloc(length * sizeof(long))</pre>
<pre id='line309' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line310")'> 310: #        if not self._mask:</pre>
<pre id='line310' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line311")'> 311: #            raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line311' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line312")'> 312: #</pre>
<pre id='line312' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line313")'> 313: #        if  self._data  and self._mask:</pre>
<pre id='line313' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line314")'> 314: #            self._clear(length)</pre>
<pre id='line314' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line315")'> 315: #        print 'allocated'</pre>
<pre id='line315' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line316")'> 316: </pre>
<pre id='line316' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line317")'> 317:     cpdef get_length(self):</pre>
<pre id='line317' class='code' style='background-color: #FFFF57'>
/* "Cython_shift_calculator.pyx":317
 * #        print 'allocated'
 * 
 *     cpdef get_length(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._length
 * 
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_f_17shift_calculators_9Out_array_get_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, int __pyx_skip_dispatch) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__get_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_5get_length)) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":317
 * #        print 'allocated'
 * 
 *     cpdef get_length(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._length
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_4get_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->get_length(__pyx_v_self, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.get_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line318")'> 318:         return self._length</pre>
<pre id='line318' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":318
 * 
 *     cpdef get_length(self):
 *         return self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef add_all(self, Out_array target_array):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.get_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_4get_length(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line319")'> 319: </pre>
<pre id='line319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line320")'> 320:     cpdef add_all(self, Out_array target_array):</pre>
<pre id='line320' class='code' style='background-color: #FFFF43'>
/* "Cython_shift_calculator.pyx":320
 *         return self._length
 * 
 *     cpdef add_all(self, Out_array target_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array); /*proto*/
static PyObject *__pyx_f_17shift_calculators_9Out_array_add_all(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_target_array, int __pyx_skip_dispatch) {
  Vec3 __pyx_v_value;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__add_all);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_7add_all)) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_target_array));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_target_array));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_target_array));
      __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":320
 *         return self._length
 * 
 *     cpdef add_all(self, Out_array target_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_6add_all(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_target_array) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->add_all(__pyx_v_self, __pyx_v_target_array, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_all", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_9Out_array_9__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_9Out_array_9__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_9Out_array_8__dealloc__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line321")'> 321:         cdef Vec3 value</pre>
<pre id='line321' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line322")'> 322:         for i in range(target_array._length):</pre>
<pre id='line322' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":322
 *     cpdef add_all(self, Out_array target_array):
 *         cdef Vec3 value
 *         for i in range(target_array._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_target_array->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF44' onclick='toggleDiv("line323")'> 323:             if i &lt; self._length and target_array._mask[i]:</pre>
<pre id='line323' class='code' style='background-color: #FFFF44'>
    /* "Cython_shift_calculator.pyx":323
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 *             if i <code><</code> self._length and target_array._mask[i]:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 *                 self.add(i, value)
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_i, __pyx_t_1, Py_LT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_6 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_6) {
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_8 = (__pyx_v_target_array->_mask[__pyx_t_7]);
    } else {
      __pyx_t_8 = __pyx_t_6;
    }
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line324")'> 324:                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])</pre>
<pre id='line324' class='code' style='background-color: #FFFF21'>
      /* "Cython_shift_calculator.pyx":324
 *         for i in range(target_array._length):
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self.add(i, value)
 * 
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_value = Vec3((__pyx_v_target_array->_data[__pyx_t_7]), (__pyx_v_target_array->_data[__pyx_t_9]), (__pyx_v_target_array->_data[__pyx_t_10]));
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line325")'> 325:                 self.add(i, value)</pre>
<pre id='line325' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":325
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 *                 self.add(i, value)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_self, __pyx_t_11, __pyx_v_value);
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_all", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_target_array), __pyx_ptype_17shift_calculators_Out_array, 1, "target_array", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_6add_all(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_target_array));
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line326")'> 326: </pre>
<pre id='line326' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line327")'> 327:     def __dealloc__(self):</pre>
<pre id='line327' class='code' style='background-color: #FFFFe7'>
/* "Cython_shift_calculator.pyx":327
 *                 self.add(i, value)
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * #        free(self._data)
 */

static void __pyx_pf_17shift_calculators_9Out_array_8__dealloc__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line328")'> 328:         pass</pre>
<pre id='line328' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line329")'> 329: #        free(self._data)</pre>
<pre id='line329' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line330")'> 330: #        self._data = NULL</pre>
<pre id='line330' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line331")'> 331: #        free(self._mask)</pre>
<pre id='line331' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line332")'> 332: #        self._mask = NULL</pre>
<pre id='line332' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line333")'> 333: </pre>
<pre id='line333' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line334")'> 334:     cdef inline bint _check_clear_length(self, long length) except -1:</pre>
<pre id='line334' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":334
 * #        self._mask = NULL
 * 
 *     cdef inline bint _check_clear_length(self, long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_clear_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_clear_length", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line335")'> 335:         if not length &lt;= self._length:</pre>
<pre id='line335' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":335
 * 
 *     cdef inline bint _check_clear_length(self, long length) except -1:
 *         if not length <code><</code>= self._length:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 */
  __pyx_t_1 = (!(__pyx_v_length <code><</code>= __pyx_v_self->_length));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line336")'> 336:             raise IndexError("tried to clear to %i length is %i" % (length,self._length))</pre>
<pre id='line336' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":336
 *     cdef inline bint _check_clear_length(self, long length) except -1:
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_10), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line337")'> 337:         if self._data is NULL:</pre>
<pre id='line337' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":337
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line338")'> 338:             raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line338' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":338
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_AttributeError, ((PyObject *)__pyx_k_tuple_12), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_clear_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":338
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 */
  __pyx_k_tuple_12 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)__pyx_kp_s_11));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_12);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_12));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line339")'> 339: </pre>
<pre id='line339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line340")'> 340:     cdef inline bint _check_offset(self, long offset) except -1:</pre>
<pre id='line340' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":340
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_offset(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_offset) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_offset", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line341")'> 341:         if not offset &lt; self._length:</pre>
<pre id='line341' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":341
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 *         if not offset <code><</code> self._length:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 */
  __pyx_t_1 = (!(__pyx_v_offset <code><</code> __pyx_v_self->_length));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line342")'> 342:             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))</pre>
<pre id='line342' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":342
 *     cdef inline bint _check_offset(self, long offset) except -1:
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_13), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343:         if self._data is NULL:</pre>
<pre id='line343' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":343
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line344")'> 344:             raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line344' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":344
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef bint realloc(self,long length) except -1:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_AttributeError, ((PyObject *)__pyx_k_tuple_14), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_offset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":344
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef bint realloc(self,long length) except -1:
 */
  __pyx_k_tuple_14 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)__pyx_kp_s_11));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_14);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_14));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line345")'> 345: </pre>
<pre id='line345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line346")'> 346:     cpdef bint realloc(self,long length) except -1:</pre>
<pre id='line346' class='code' style='background-color: #FFFF2d'>
/* "Cython_shift_calculator.pyx":346
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cpdef bint realloc(self,long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if length <code><</code>60000:
 * #            free(self._data)
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length); /*proto*/
static int __pyx_f_17shift_calculators_9Out_array_realloc(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length, int __pyx_skip_dispatch) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__realloc);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_11realloc)) {
      __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_4;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":346
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cpdef bint realloc(self,long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if length <code><</code>60000:
 * #            free(self._data)
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_10realloc(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->realloc(__pyx_v_self, __pyx_v_length, 1);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line347")'> 347:         if length &lt;60000:</pre>
<pre id='line347' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":347
 * 
 *     cpdef bint realloc(self,long length) except -1:
 *         if length <code><</code>60000:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #            free(self._data)
 * #            self._data = NULL
 */
  __pyx_t_4 = (__pyx_v_length <code><</code> 60000);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line348")'> 348: #            free(self._data)</pre>
<pre id='line348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line349")'> 349: #            self._data = NULL</pre>
<pre id='line349' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line350")'> 350: #            self._data = &lt;double *&gt;malloc(3 *(length+1) * sizeof(double))</pre>
<pre id='line350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line351")'> 351: #            if not self._data:</pre>
<pre id='line351' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352: #                raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line353")'> 353: #            if  self._data:</pre>
<pre id='line353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line354")'> 354: #                self._length =length</pre>
<pre id='line354' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line355")'> 355:             self._clear(length)</pre>
<pre id='line355' class='code' style='background-color: #FFFF96'>
    /* "Cython_shift_calculator.pyx":355
 * #            if  self._data:
 * #                self._length =length
 *             self._clear(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             raise MemoryError("couldn't beyond of length %i" % 60000)
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->_clear(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line356")'> 356:         else:</pre>
<pre id='line356' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line357")'> 357:             raise MemoryError("couldn't beyond of length %i" % 60000)</pre>
<pre id='line357' class='code' style='background-color: #FFFF33'>
    /* "Cython_shift_calculator.pyx":357
 *             self._clear(length)
 *         else:
 *             raise MemoryError("couldn't beyond of length %i" % 60000)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 * #            free(self._mask)
 */
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_15), __pyx_int_60000);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length) {
  long __pyx_v_length;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc (wrapper)", 0);
  assert(__pyx_arg_length); {
    __pyx_v_length = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_arg_length);<span class='error_goto'> if (unlikely((__pyx_v_length == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_10realloc(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((long)__pyx_v_length));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line358")'> 358: #</pre>
<pre id='line358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line359")'> 359: #            free(self._mask)</pre>
<pre id='line359' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line360")'> 360: #            self._mask = NULL</pre>
<pre id='line360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line361")'> 361: #            self._mask = &lt;int *&gt;malloc((length+1) * sizeof(int))</pre>
<pre id='line361' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line362")'> 362: #            if not self._mask:</pre>
<pre id='line362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line363")'> 363: #                raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line363' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line364")'> 364: #            if  self._mask:</pre>
<pre id='line364' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line365")'> 365: #                self._clear_mask(length)</pre>
<pre id='line365' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line366")'> 366: </pre>
<pre id='line366' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line367")'> 367:     cdef inline bint _check_state(self) except -1:</pre>
<pre id='line367' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":367
 * #                self._clear_mask(length)
 * 
 *     cdef inline bint _check_state(self) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_state(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_state", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line368")'> 368:         if self._data is NULL:</pre>
<pre id='line368' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":368
 * 
 *     cdef inline bint _check_state(self) except -1:
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line369")'> 369:             raise MemoryError("couldn't reallocate array of length %i" % self._length)</pre>
<pre id='line369' class='code' style='background-color: #FFFF3e'>
    /* "Cython_shift_calculator.pyx":369
 *     cdef inline bint _check_state(self) except -1:
 *         if self._data is NULL:
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _clear(self, length):
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_16), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line370")'> 370: </pre>
<pre id='line370' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line371")'> 371:     cdef _clear(self, length):</pre>
<pre id='line371' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":371
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 * 
 *     cdef _clear(self, length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._check_clear_length(length)
 *         for i in range(length*3):
 */

static PyObject *__pyx_f_17shift_calculators_9Out_array__clear(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_clear", 0);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line372")'> 372:         self._check_clear_length(length)</pre>
<pre id='line372' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":372
 * 
 *     cdef _clear(self, length):
 *         self._check_clear_length(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(length*3):
 *             self._data[i] = 0.0
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely((__pyx_t_1 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __pyx_f_17shift_calculators_9Out_array__check_clear_length(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line373")'> 373:         for i in range(length*3):</pre>
<pre id='line373' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":373
 *     cdef _clear(self, length):
 *         self._check_clear_length(length)
 *         for i in range(length*3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[i] = 0.0
 *         for i in range(length):
 */
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_length, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
    __pyx_t_4 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line374")'> 374:             self._data[i] = 0.0</pre>
<pre id='line374' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":374
 *         self._check_clear_length(length)
 *         for i in range(length*3):
 *             self._data[i] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(length):
 *             self._mask[i]=0
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_data[__pyx_t_7]) = 0.0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line375")'> 375:         for i in range(length):</pre>
<pre id='line375' class='code' style='background-color: #FFFF22'>
  /* "Cython_shift_calculator.pyx":375
 *         for i in range(length*3):
 *             self._data[i] = 0.0
 *         for i in range(length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._mask[i]=0
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_length);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_length);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_length);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
    __pyx_t_4 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line376")'> 376:             self._mask[i]=0</pre>
<pre id='line376' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":376
 *             self._data[i] = 0.0
 *         for i in range(length):
 *             self._mask[i]=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def padd(self,offset,value):
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_mask[__pyx_t_7]) = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._clear", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_13padd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_13padd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_value = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("padd (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__value,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__value)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("padd", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "padd") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_offset = values[0];
    __pyx_v_value = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("padd", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.padd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_12padd(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_offset, __pyx_v_value);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line377")'> 377: </pre>
<pre id='line377' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line378")'> 378:     def padd(self,offset,value):</pre>
<pre id='line378' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":378
 *             self._mask[i]=0
 * 
 *     def padd(self,offset,value):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])
 *         self.add(offset, cvalue)
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_12padd(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_value) {
  Vec3 __pyx_v_cvalue;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("padd", 0);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line379")'> 379:         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])</pre>
<pre id='line379' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":379
 * 
 *     def padd(self,offset,value):
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.add(offset, cvalue)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_cvalue = Vec3(__pyx_t_2, __pyx_t_3, __pyx_t_4);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line380")'> 380:         self.add(offset, cvalue)</pre>
<pre id='line380' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":380
 *     def padd(self,offset,value):
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])
 *         self.add(offset, cvalue)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_self, __pyx_t_5, __pyx_v_cvalue);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.padd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line381")'> 381: </pre>
<pre id='line381' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line382")'> 382:     @cython.profile(False)</pre>
<pre id='line382' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line383")'> 383:     cdef inline void  add(self,long offset, Vec3&amp; value):</pre>
<pre id='line383' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":383
 * 
 *     @cython.profile(False)
 *     cdef inline void  add(self,long offset, Vec3& value):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_offset(offset)
 *         cdef long id3 = offset *3
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_9Out_array_add(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_offset, Vec3 &__pyx_v_value) {
  long __pyx_v_id3;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line384")'> 384: #        self._check_offset(offset)</pre>
<pre id='line384' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line385")'> 385:         cdef long id3 = offset *3</pre>
<pre id='line385' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":385
 *     cdef inline void  add(self,long offset, Vec3& value):
 * #        self._check_offset(offset)
 *         cdef long id3 = offset *3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._data[id3]   += value[0]
 */
  __pyx_v_id3 = (__pyx_v_offset * 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line386")'> 386: </pre>
<pre id='line386' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line387")'> 387:         self._data[id3]   += value[0]</pre>
<pre id='line387' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":387
 *         cdef long id3 = offset *3
 * 
 *         self._data[id3]   += value[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._data[id3+1] += value[1]
 *         self._data[id3+2] += value[2]
 */
  __pyx_t_1 = __pyx_v_id3;
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line388")'> 388:         self._data[id3+1] += value[1]</pre>
<pre id='line388' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":388
 * 
 *         self._data[id3]   += value[0]
 *         self._data[id3+1] += value[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._data[id3+2] += value[2]
 * 
 */
  __pyx_t_1 = (__pyx_v_id3 + 1);
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line389")'> 389:         self._data[id3+2] += value[2]</pre>
<pre id='line389' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":389
 *         self._data[id3]   += value[0]
 *         self._data[id3+1] += value[1]
 *         self._data[id3+2] += value[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._mask[offset] = 1
 */
  __pyx_t_1 = (__pyx_v_id3 + 2);
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[2]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line390")'> 390: </pre>
<pre id='line390' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line391")'> 391:         self._mask[offset] = 1</pre>
<pre id='line391' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":391
 *         self._data[id3+2] += value[2]
 * 
 *         self._mask[offset] = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def clear_by_id(self,target_ids):
 */
  (__pyx_v_self->_mask[__pyx_v_offset]) = 1;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_15clear_by_id(PyObject *__pyx_v_self, PyObject *__pyx_v_target_ids); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_15clear_by_id(PyObject *__pyx_v_self, PyObject *__pyx_v_target_ids) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear_by_id (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_14clear_by_id(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((PyObject *)__pyx_v_target_ids));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line392")'> 392: </pre>
<pre id='line392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line393")'> 393:     def clear_by_id(self,target_ids):</pre>
<pre id='line393' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":393
 *         self._mask[offset] = 1
 * 
 *     def clear_by_id(self,target_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3 = 0
 *         for target_id in target_ids:
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_14clear_by_id(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_target_ids) {
  long __pyx_v_id3;
  PyObject *__pyx_v_target_id = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear_by_id", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line394")'> 394:         cdef long id3 = 0</pre>
<pre id='line394' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":394
 * 
 *     def clear_by_id(self,target_ids):
 *         cdef long id3 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for target_id in target_ids:
 *             self._check_offset(target_id)
 */
  __pyx_v_id3 = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line395")'> 395:         for target_id in target_ids:</pre>
<pre id='line395' class='code' style='background-color: #FFFF2a'>
  /* "Cython_shift_calculator.pyx":395
 *     def clear_by_id(self,target_ids):
 *         cdef long id3 = 0
 *         for target_id in target_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._check_offset(target_id)
 *             id3 = target_id *3
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_target_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_target_ids)) {
    __pyx_t_1 = __pyx_v_target_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_target_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_3 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_3 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_id);
    __pyx_v_target_id = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line396")'> 396:             self._check_offset(target_id)</pre>
<pre id='line396' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":396
 *         cdef long id3 = 0
 *         for target_id in target_ids:
 *             self._check_offset(target_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             id3 = target_id *3
 * 
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_target_id);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = __pyx_f_17shift_calculators_9Out_array__check_offset(__pyx_v_self, __pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line397")'> 397:             id3 = target_id *3</pre>
<pre id='line397' class='code' style='background-color: #FFFF62'>
    /* "Cython_shift_calculator.pyx":397
 *         for target_id in target_ids:
 *             self._check_offset(target_id)
 *             id3 = target_id *3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._data[id3]   = 0.0
 */
    __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_target_id, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_id3 = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line398")'> 398: </pre>
<pre id='line398' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line399")'> 399:             self._data[id3]   = 0.0</pre>
<pre id='line399' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":399
 *             id3 = target_id *3
 * 
 *             self._data[id3]   = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[id3+1] = 0.0
 *             self._data[id3+2] = 0.0
 */
    (__pyx_v_self->_data[__pyx_v_id3]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line400")'> 400:             self._data[id3+1] = 0.0</pre>
<pre id='line400' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":400
 * 
 *             self._data[id3]   = 0.0
 *             self._data[id3+1] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[id3+2] = 0.0
 * 
 */
    (__pyx_v_self->_data[(__pyx_v_id3 + 1)]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line401")'> 401:             self._data[id3+2] = 0.0</pre>
<pre id='line401' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":401
 *             self._data[id3]   = 0.0
 *             self._data[id3+1] = 0.0
 *             self._data[id3+2] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._mask[target_id] = 0
 */
    (__pyx_v_self->_data[(__pyx_v_id3 + 2)]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line402")'> 402: </pre>
<pre id='line402' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line403")'> 403:             self._mask[target_id] = 0</pre>
<pre id='line403' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":403
 *             self._data[id3+2] = 0.0
 * 
 *             self._mask[target_id] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_target_id);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_mask[__pyx_t_7]) = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.clear_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_id);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_17add_forces_to_result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_17add_forces_to_result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_result = 0;
  PyObject *__pyx_v_weight = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__result,&__pyx_n_s__weight,0};
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line404")'> 404: </pre>
<pre id='line404' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line405")'> 405:     def add_forces_to_result(self, result=None, weight=1.0):</pre>
<pre id='line405' class='code' style='background-color: #FFFF37'>
    /* "Cython_shift_calculator.pyx":405
 *             self._mask[target_id] = 0
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3
 *         cdef DerivList *derivList
 */
    values[0] = ((PyObject *)Py_None);
    values[1] = __pyx_k_17;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__result);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__weight);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_forces_to_result") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_result = values[0];
    __pyx_v_weight = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_forces_to_result", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_16add_forces_to_result(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_result, __pyx_v_weight);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_17shift_calculators_9Out_array_16add_forces_to_result(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_result, PyObject *__pyx_v_weight) {
  long __pyx_v_id3;
  DerivList *__pyx_v_derivList;
  CDSVector<code><</code>Vec3> *__pyx_v_derivs;
  PyObject *__pyx_v_pointer = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);

  /* "Cython_shift_calculator.pyx":405
 *             self._mask[target_id] = 0
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3
 *         cdef DerivList *derivList
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(1.0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_17 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line406")'> 406:         cdef long id3</pre>
<pre id='line406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line407")'> 407:         cdef DerivList *derivList</pre>
<pre id='line407' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line408")'> 408:         cdef CDSVector[Vec3]* derivs</pre>
<pre id='line408' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line409")'> 409:         cdef Vec3* test</pre>
<pre id='line409' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line410")'> 410: </pre>
<pre id='line410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line411")'> 411:         if isinstance(result,PyDerivList):</pre>
<pre id='line411' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":411
 *         cdef Vec3* test
 * 
 *         if isinstance(result,PyDerivList):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             pointer = int(result.this)
 *             derivList = (<code><</code>DerivList*><code><</code>size_t>pointer)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__PyDerivList);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 411; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_result, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 411; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line412")'> 412:             pointer = int(result.this)</pre>
<pre id='line412' class='code' style='background-color: #FFFF5e'>
    /* "Cython_shift_calculator.pyx":412
 * 
 *         if isinstance(result,PyDerivList):
 *             pointer = int(result.this)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             derivList = (<code><</code>DerivList*><code><</code>size_t>pointer)
 *             #TODO: references don't work here lots of problems -> cython mailing list
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_result, __pyx_n_s__this);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_v_pointer = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line413")'> 413:             derivList = (&lt;DerivList*&gt;&lt;size_t&gt;pointer)</pre>
<pre id='line413' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":413
 *         if isinstance(result,PyDerivList):
 *             pointer = int(result.this)
 *             derivList = (<code><</code>DerivList*><code><</code>size_t>pointer)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             #TODO: references don't work here lots of problems -> cython mailing list
 *             derivs  = &derivList[0][self._simulation]
 */
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_v_pointer);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_derivList = ((DerivList *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line414")'> 414:             #TODO: references don't work here lots of problems -&gt; cython mailing list</pre>
<pre id='line414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line415")'> 415:             derivs  = &amp;derivList[0][self._simulation]</pre>
<pre id='line415' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":415
 *             derivList = (<code><</code>DerivList*><code><</code>size_t>pointer)
 *             #TODO: references don't work here lots of problems -> cython mailing list
 *             derivs  = &derivList[0][self._simulation]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:
 */
    __pyx_v_derivs = (&((__pyx_v_derivList[0])[__pyx_v_self->_simulation]));
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line416")'> 416:             for i in range(self._length):</pre>
<pre id='line416' class='code' style='background-color: #FFFF20'>
    /* "Cython_shift_calculator.pyx":416
 *             #TODO: references don't work here lots of problems -> cython mailing list
 *             derivs  = &derivList[0][self._simulation]
 *             for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._mask[i] != 0:
 *                     id3 = i * 3
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5 = 0;
      __pyx_t_6 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_6 = Py_TYPE(__pyx_t_3)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_1 = __pyx_t_6(__pyx_t_3);
        if (unlikely(!__pyx_t_1)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
      __pyx_v_i = __pyx_t_1;
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line417")'> 417:                 if self._mask[i] != 0:</pre>
<pre id='line417' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":417
 *             derivs  = &derivList[0][self._simulation]
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     id3 = i * 3
 * 
 */
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_7]) != 0);
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line418")'> 418:                     id3 = i * 3</pre>
<pre id='line418' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":418
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:
 *                     id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     derivs[0][i][0]  +=  self._data[id3] * weight
 */
        __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line419")'> 419: </pre>
<pre id='line419' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line420")'> 420:                     derivs[0][i][0]  +=  self._data[id3] * weight</pre>
<pre id='line420' class='code' style='background-color: #FFFF2f'>
        /* "Cython_shift_calculator.pyx":420
 *                     id3 = i * 3
 * 
 *                     derivs[0][i][0]  +=  self._data[id3] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     derivs[0][i][1]  +=  self._data[id3+1] *weight
 *                     derivs[0][i][2]  +=  self._data[id3+2] * weight
 */
        __pyx_t_8 = 0;
        __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_10 = 0;
        __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        __pyx_t_12 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_11, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_1, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        (((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]) = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line421")'> 421:                     derivs[0][i][1]  +=  self._data[id3+1] *weight</pre>
<pre id='line421' class='code' style='background-color: #FFFF2f'>
        /* "Cython_shift_calculator.pyx":421
 * 
 *                     derivs[0][i][0]  +=  self._data[id3] * weight
 *                     derivs[0][i][1]  +=  self._data[id3+1] *weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     derivs[0][i][2]  +=  self._data[id3+2] * weight
 * 
 */
        __pyx_t_8 = 0;
        __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_10 = 1;
        __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>((((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]));<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_12, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_11, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_12);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        (((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]) = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line422")'> 422:                     derivs[0][i][2]  +=  self._data[id3+2] * weight</pre>
<pre id='line422' class='code' style='background-color: #FFFF2e'>
        /* "Cython_shift_calculator.pyx":422
 *                     derivs[0][i][0]  +=  self._data[id3] * weight
 *                     derivs[0][i][1]  +=  self._data[id3+1] *weight
 *                     derivs[0][i][2]  +=  self._data[id3+2] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
        __pyx_t_8 = 0;
        __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_10 = 2;
        __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>((((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_12, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        (((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]) = __pyx_t_13;
        goto __pyx_L6;
      }
      __pyx_L6:;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L3;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line423")'> 423: </pre>
<pre id='line423' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line424")'> 424: </pre>
<pre id='line424' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line425")'> 425:         elif result == None:</pre>
<pre id='line425' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":425
 * 
 * 
 *         elif result == None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if result ==  None:
 *                 result = [None] * self._length
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_result, Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line426")'> 426:             if result ==  None:</pre>
<pre id='line426' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":426
 * 
 *         elif result == None:
 *             if result ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result = [None] * self._length
 *             for i in range(self._length):
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_result, Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line427")'> 427:                 result = [None] * self._length</pre>
<pre id='line427' class='code' style='background-color: #FFFF8d'>
      /* "Cython_shift_calculator.pyx":427
 *         elif result == None:
 *             if result ==  None:
 *                 result = [None] * self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:
 */
      __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1 * ((__pyx_v_self->_length<code><</code>0) ? 0:__pyx_v_self->_length));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      { Py_ssize_t __pyx_temp;
        for (__pyx_temp=0; __pyx_temp <code><</code> __pyx_v_self->_length; __pyx_temp++) {
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, __pyx_temp, Py_None);
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_result);
      __pyx_v_result = ((PyObject *)__pyx_t_3);
      __pyx_t_3 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line428")'> 428:             for i in range(self._length):</pre>
<pre id='line428' class='code' style='background-color: #FFFF20'>
    /* "Cython_shift_calculator.pyx":428
 *             if result ==  None:
 *                 result = [None] * self._length
 *             for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._mask[i] != 0:
 *                     if result[i] ==  None:
 */
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      __pyx_t_1 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5 = 0;
      __pyx_t_6 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_3 = __pyx_t_6(__pyx_t_1);
        if (unlikely(!__pyx_t_3)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
      __pyx_v_i = __pyx_t_3;
      __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line429")'> 429:                 if self._mask[i] != 0:</pre>
<pre id='line429' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":429
 *                 result = [None] * self._length
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     if result[i] ==  None:
 *                         result[i] = [0.0]*3
 */
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_7]) != 0);
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line430")'> 430:                     if result[i] ==  None:</pre>
<pre id='line430' class='code' style='background-color: #FFFF5e'>
        /* "Cython_shift_calculator.pyx":430
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:
 *                     if result[i] ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         result[i] = [0.0]*3
 *                     id3 = i * 3
 */
        __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 430; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_11 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_3, Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 430; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 430; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line431")'> 431:                         result[i] = [0.0]*3</pre>
<pre id='line431' class='code' style='background-color: #FFFF57'>
          /* "Cython_shift_calculator.pyx":431
 *                 if self._mask[i] != 0:
 *                     if result[i] ==  None:
 *                         result[i] = [0.0]*3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     id3 = i * 3
 *                     result[i][0] += self._data[id3] * weight
 */
          __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
          __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1 * 3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
          { Py_ssize_t __pyx_temp;
            for (__pyx_temp=0; __pyx_temp <code><</code> 3; __pyx_temp++) {
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
              <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, __pyx_temp, __pyx_t_11);
              <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_11);
            }
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
          if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_result, __pyx_v_i, ((PyObject *)__pyx_t_3)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
          goto __pyx_L11;
        }
        __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line432")'> 432:                     id3 = i * 3</pre>
<pre id='line432' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":432
 *                     if result[i] ==  None:
 *                         result[i] = [0.0]*3
 *                     id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i][0] += self._data[id3] * weight
 *                     result[i][1] += self._data[id3+1] *weight
 */
        __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line433")'> 433:                     result[i][0] += self._data[id3] * weight</pre>
<pre id='line433' class='code' style='background-color: #FFFF41'>
        /* "Cython_shift_calculator.pyx":433
 *                         result[i] = [0.0]*3
 *                     id3 = i * 3
 *                     result[i][0] += self._data[id3] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i][1] += self._data[id3+1] *weight
 *                     result[i][2] += self._data[id3+2] * weight
 */
        __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_7 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, __pyx_t_7, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        __pyx_t_14 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_12, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_11, __pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_3, __pyx_t_7, __pyx_t_12, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line434")'> 434:                     result[i][1] += self._data[id3+1] *weight</pre>
<pre id='line434' class='code' style='background-color: #FFFF41'>
        /* "Cython_shift_calculator.pyx":434
 *                     id3 = i * 3
 *                     result[i][0] += self._data[id3] * weight
 *                     result[i][1] += self._data[id3+1] *weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i][2] += self._data[id3+2] * weight
 *         else:
 */
        __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_7 = 1;
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, __pyx_t_7, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        __pyx_t_14 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_14);
        __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_14, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_12, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_3, __pyx_t_7, __pyx_t_14, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line435")'> 435:                     result[i][2] += self._data[id3+2] * weight</pre>
<pre id='line435' class='code' style='background-color: #FFFF3f'>
        /* "Cython_shift_calculator.pyx":435
 *                     result[i][0] += self._data[id3] * weight
 *                     result[i][1] += self._data[id3+1] *weight
 *                     result[i][2] += self._data[id3+2] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             # raw pointer
 */
        __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_7 = 2;
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, __pyx_t_7, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_14) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_14);
        __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        __pyx_t_12 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_11, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_14, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_3, __pyx_t_7, __pyx_t_11, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L10;
      }
      __pyx_L10:;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line436")'> 436:         else:</pre>
<pre id='line436' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line437")'> 437:             # raw pointer</pre>
<pre id='line437' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line438")'> 438:             pointer = int(result)</pre>
<pre id='line438' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":438
 *         else:
 *             # raw pointer
 *             pointer = int(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             derivList = (<code><</code>DerivList*><code><</code>size_t>pointer)
 *             #TODO: references don't work here lots of problems -> cython mailing list
 */
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 438; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_result);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_result);
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 438; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_v_pointer = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line439")'> 439:             derivList = (&lt;DerivList*&gt;&lt;size_t&gt;pointer)</pre>
<pre id='line439' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":439
 *             # raw pointer
 *             pointer = int(result)
 *             derivList = (<code><</code>DerivList*><code><</code>size_t>pointer)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             #TODO: references don't work here lots of problems -> cython mailing list
 *             derivs  = &derivList[0][self._simulation]
 */
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_v_pointer);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_derivList = ((DerivList *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line440")'> 440:             #TODO: references don't work here lots of problems -&gt; cython mailing list</pre>
<pre id='line440' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line441")'> 441:             derivs  = &amp;derivList[0][self._simulation]</pre>
<pre id='line441' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":441
 *             derivList = (<code><</code>DerivList*><code><</code>size_t>pointer)
 *             #TODO: references don't work here lots of problems -> cython mailing list
 *             derivs  = &derivList[0][self._simulation]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:
 */
    __pyx_v_derivs = (&((__pyx_v_derivList[0])[__pyx_v_self->_simulation]));
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line442")'> 442:             for i in range(self._length):</pre>
<pre id='line442' class='code' style='background-color: #FFFF20'>
    /* "Cython_shift_calculator.pyx":442
 *             #TODO: references don't work here lots of problems -> cython mailing list
 *             derivs  = &derivList[0][self._simulation]
 *             for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._mask[i] != 0:
 *                     id3 = i * 3
 */
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      __pyx_t_1 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5 = 0;
      __pyx_t_6 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
        if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_3 = __pyx_t_6(__pyx_t_1);
        if (unlikely(!__pyx_t_3)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
      __pyx_v_i = __pyx_t_3;
      __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line443")'> 443:                 if self._mask[i] != 0:</pre>
<pre id='line443' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":443
 *             derivs  = &derivList[0][self._simulation]
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     id3 = i * 3
 * 
 */
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 443; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_7]) != 0);
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line444")'> 444:                     id3 = i * 3</pre>
<pre id='line444' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":444
 *             for i in range(self._length):
 *                 if self._mask[i] != 0:
 *                     id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     derivs[0][i][0]  +=  self._data[id3] * weight
 */
        __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line445")'> 445: </pre>
<pre id='line445' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line446")'> 446:                     derivs[0][i][0]  +=  self._data[id3] * weight</pre>
<pre id='line446' class='code' style='background-color: #FFFF2f'>
        /* "Cython_shift_calculator.pyx":446
 *                     id3 = i * 3
 * 
 *                     derivs[0][i][0]  +=  self._data[id3] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     derivs[0][i][1]  +=  self._data[id3+1] *weight
 *                     derivs[0][i][2]  +=  self._data[id3+2] * weight
 */
        __pyx_t_8 = 0;
        __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_10 = 0;
        __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        __pyx_t_12 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_11, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_3, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        (((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]) = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line447")'> 447:                     derivs[0][i][1]  +=  self._data[id3+1] *weight</pre>
<pre id='line447' class='code' style='background-color: #FFFF2f'>
        /* "Cython_shift_calculator.pyx":447
 * 
 *                     derivs[0][i][0]  +=  self._data[id3] * weight
 *                     derivs[0][i][1]  +=  self._data[id3+1] *weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     derivs[0][i][2]  +=  self._data[id3+2] * weight
 * 
 */
        __pyx_t_8 = 0;
        __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_10 = 1;
        __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>((((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]));<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_12, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_11, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_12);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        (((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]) = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line448")'> 448:                     derivs[0][i][2]  +=  self._data[id3+2] * weight</pre>
<pre id='line448' class='code' style='background-color: #FFFF2e'>
        /* "Cython_shift_calculator.pyx":448
 *                     derivs[0][i][0]  +=  self._data[id3] * weight
 *                     derivs[0][i][1]  +=  self._data[id3+1] *weight
 *                     derivs[0][i][2]  +=  self._data[id3+2] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
        __pyx_t_8 = 0;
        __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_10 = 2;
        __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>((((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
        __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_12, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        (((__pyx_v_derivs[__pyx_t_8])[__pyx_t_9])[__pyx_t_10]) = __pyx_t_13;
        goto __pyx_L14;
      }
      __pyx_L14:;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line449")'> 449: </pre>
<pre id='line449' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line450")'> 450:         return result</pre>
<pre id='line450' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":450
 *                     derivs[0][i][2]  +=  self._data[id3+2] * weight
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pointer);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_19add_forces_to_result_by_id(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_19add_forces_to_result_by_id(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_target_atom_ids = 0;
  PyObject *__pyx_v_result = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result_by_id (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,&__pyx_n_s__result,0};
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line451")'> 451: </pre>
<pre id='line451' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line452")'> 452:     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):</pre>
<pre id='line452' class='code' style='background-color: #FFFF38'>
    /* "Cython_shift_calculator.pyx":452
 *         return result
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if result ==  None:
 *             result = [None] * self._length
 */
    values[1] = ((PyObject*)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__result);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_forces_to_result_by_id") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_target_atom_ids = ((PyObject*)values[0]);
    __pyx_v_result = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_forces_to_result_by_id", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_target_atom_ids), (&PyList_Type), 1, "target_atom_ids", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_result), (&PyList_Type), 1, "result", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_18add_forces_to_result_by_id(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_target_atom_ids, __pyx_v_result);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_17shift_calculators_9Out_array_18add_forces_to_result_by_id(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_target_atom_ids, PyObject *__pyx_v_result) {
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  long __pyx_v_id3;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result_by_id", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line453")'> 453:         if result ==  None:</pre>
<pre id='line453' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":453
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 *         if result ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = [None] * self._length
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_result), Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line454")'> 454:             result = [None] * self._length</pre>
<pre id='line454' class='code' style='background-color: #FFFF8d'>
    /* "Cython_shift_calculator.pyx":454
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 *         if result ==  None:
 *             result = [None] * self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double x = 0.0
 */
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1 * ((__pyx_v_self->_length<code><</code>0) ? 0:__pyx_v_self->_length));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp <code><</code> __pyx_v_self->_length; __pyx_temp++) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, __pyx_temp, Py_None);
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_result));
    __pyx_v_result = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line455")'> 455: </pre>
<pre id='line455' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line456")'> 456:         cdef double x = 0.0</pre>
<pre id='line456' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":456
 *             result = [None] * self._length
 * 
 *         cdef double x = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double y = 0.0
 *         cdef double z = 0.0
 */
  __pyx_v_x = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line457")'> 457:         cdef double y = 0.0</pre>
<pre id='line457' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":457
 * 
 *         cdef double x = 0.0
 *         cdef double y = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double z = 0.0
 *         cdef long id3
 */
  __pyx_v_y = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line458")'> 458:         cdef double z = 0.0</pre>
<pre id='line458' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":458
 *         cdef double x = 0.0
 *         cdef double y = 0.0
 *         cdef double z = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3
 *         for i in target_atom_ids:
 */
  __pyx_v_z = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line459")'> 459:         cdef long id3</pre>
<pre id='line459' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line460")'> 460:         for i in target_atom_ids:</pre>
<pre id='line460' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":460
 *         cdef double z = 0.0
 *         cdef long id3
 *         for i in target_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 */
  if (unlikely(((PyObject *)__pyx_v_target_atom_ids) == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_1 = ((PyObject *)__pyx_v_target_atom_ids); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_3 = 0;
  for (;;) {
    if (__pyx_t_3 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    #else
    __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    #endif
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line461")'> 461:             if self._mask[i] != 0:</pre>
<pre id='line461' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":461
 *         cdef long id3
 *         for i in target_atom_ids:
 *             if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_5]) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line462")'> 462:                 if result[i] ==  None:</pre>
<pre id='line462' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":462
 *         for i in target_atom_ids:
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line463")'> 463:                     result[i] = [0.0]*3</pre>
<pre id='line463' class='code' style='background-color: #FFFF4b'>
        /* "Cython_shift_calculator.pyx":463
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 id3 = i * 3
 *                 x  = self._data[id3]
 */
        __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
        __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(1 * 3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
        { Py_ssize_t __pyx_temp;
          for (__pyx_temp=0; __pyx_temp <code><</code> 3; __pyx_temp++) {
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
            <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, __pyx_temp, __pyx_t_6);
            <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
          }
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        if (<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i, ((PyObject *)__pyx_t_4)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line464")'> 464:                 id3 = i * 3</pre>
<pre id='line464' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":464
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]
 */
      __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_7 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_id3 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line465")'> 465:                 x  = self._data[id3]</pre>
<pre id='line465' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":465
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 *                 x  = self._data[id3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]
 */
      __pyx_v_x = (__pyx_v_self->_data[__pyx_v_id3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line466")'> 466:                 y  = self._data[id3+1]</pre>
<pre id='line466' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":466
 *                 id3 = i * 3
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x
 */
      __pyx_v_y = (__pyx_v_self->_data[(__pyx_v_id3 + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line467")'> 467:                 z  = self._data[id3+2]</pre>
<pre id='line467' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":467
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][0] += x
 *                 result[i][1] += y
 */
      __pyx_v_z = (__pyx_v_self->_data[(__pyx_v_id3 + 2)]);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line468")'> 468:                 result[i][0] += x</pre>
<pre id='line468' class='code' style='background-color: #FFFF43'>
      /* "Cython_shift_calculator.pyx":468
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][1] += y
 *                 result[i][2] += z
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_9, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line469")'> 469:                 result[i][1] += y</pre>
<pre id='line469' class='code' style='background-color: #FFFF43'>
      /* "Cython_shift_calculator.pyx":469
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x
 *                 result[i][1] += y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][2] += z
 * 
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 1;
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_6 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_9, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line470")'> 470:                 result[i][2] += z</pre>
<pre id='line470' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":470
 *                 result[i][0] += x
 *                 result[i][1] += y
 *                 result[i][2] += z             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 2;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_9, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line471")'> 471: </pre>
<pre id='line471' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line472")'> 472: </pre>
<pre id='line472' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line473")'> 473:         return result</pre>
<pre id='line473' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":473
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __str__(self):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_21__str__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_21__str__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_20__str__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line474")'> 474: </pre>
<pre id='line474' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line475")'> 475:     def __str__(self):</pre>
<pre id='line475' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":475
 *         return result
 * 
 *     def __str__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef long id3 =0
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_20__str__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  long __pyx_v_id3;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__str__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line476")'> 476: </pre>
<pre id='line476' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line477")'> 477:         cdef long id3 =0</pre>
<pre id='line477' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":477
 *     def __str__(self):
 * 
 *         cdef long id3 =0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result =  []
 *         result.append('length = %i' % self._length)
 */
  __pyx_v_id3 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line478")'> 478:         result =  []</pre>
<pre id='line478' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":478
 * 
 *         cdef long id3 =0
 *         result =  []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line479")'> 479:         result.append('length = %i' % self._length)</pre>
<pre id='line479' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":479
 *         cdef long id3 =0
 *         result =  []
 *         result.append('length = %i' % self._length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._length):
 *             if self._mask[i] ==0:
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line480")'> 480:         for i in range(self._length):</pre>
<pre id='line480' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":480
 *         result =  []
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] ==0:
 *                 result.append("%5i ." % i)
 */
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line481")'> 481:             if self._mask[i] ==0:</pre>
<pre id='line481' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":481
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):
 *             if self._mask[i] ==0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result.append("%5i ." % i)
 *             else:
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((__pyx_v_self->_mask[__pyx_t_6]) == 0);
    if (__pyx_t_7) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line482")'> 482:                 result.append("%5i ." % i)</pre>
<pre id='line482' class='code' style='background-color: #FFFF79'>
      /* "Cython_shift_calculator.pyx":482
 *         for i in range(self._length):
 *             if self._mask[i] ==0:
 *                 result.append("%5i ." % i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 id3 = i * 3
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_19), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
      __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line483")'> 483:             else:</pre>
<pre id='line483' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line484")'> 484:                 id3 = i * 3</pre>
<pre id='line484' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":484
 *                 result.append("%5i ." % i)
 *             else:
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))
 *         return '\n'.join(result)
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line485")'> 485:                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))</pre>
<pre id='line485' class='code' style='background-color: #FFFF35'>
      /* "Cython_shift_calculator.pyx":485
 *             else:
 *                 id3 = i * 3
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return '\n'.join(result)
 * 
 */
      __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_v_i);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 2, __pyx_t_9);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 3, __pyx_t_10);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_10);
      __pyx_t_2 = 0;
      __pyx_t_9 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_20), ((PyObject *)__pyx_t_11));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_11)); __pyx_t_11 = 0;
      __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_10));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line486")'> 486:         return '\n'.join(result)</pre>
<pre id='line486' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":486
 *                 id3 = i * 3
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))
 *         return '\n'.join(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_kp_s_21), __pyx_n_s__join);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, ((PyObject *)__pyx_v_result));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_result));
  __pyx_t_11 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_10), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  __pyx_r = __pyx_t_11;
  __pyx_t_11 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line487")'> 487: </pre>
<pre id='line487' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line488")'> 488: </pre>
<pre id='line488' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line489")'> 489: #cdef float* out_array = null</pre>
<pre id='line489' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line490")'> 490: #cdef long out_array_length = -1</pre>
<pre id='line490' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line491")'> 491: #cdef bint allocate_out_array_for_forces(long length) except -1:</pre>
<pre id='line491' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line492")'> 492: #    global out_array</pre>
<pre id='line492' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line493")'> 493: #    global out_array_length</pre>
<pre id='line493' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line494")'> 494: #    cdef long required_length = length*3</pre>
<pre id='line494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line495")'> 495: #    cdef bint allocate =  False</pre>
<pre id='line495' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line496")'> 496: #    if out_array ==  null:</pre>
<pre id='line496' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line497")'> 497: #        out_array = &lt;float*&gt; malloc*(required_length *sizeof(float))</pre>
<pre id='line497' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line498")'> 498: #        if out_array  == null:</pre>
<pre id='line498' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line499")'> 499: #            Raise</pre>
<pre id='line499' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line500")'> 500: #        allocate=True</pre>
<pre id='line500' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line501")'> 501: #        out_array_length =</pre>
<pre id='line501' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line502")'> 502: #        elif  len(out_array) &lt; required_length</pre>
<pre id='line502' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line503")'> 503: #    return allocate</pre>
<pre id='line503' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line504")'> 504: #</pre>
<pre id='line504' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line505")'> 505: #def _clear_out_array_for_forces(self, length):</pre>
<pre id='line505' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line506")'> 506: #</pre>
<pre id='line506' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line507")'> 507: #</pre>
<pre id='line507' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line508")'> 508: #    is_new  = self.allocate_out_array_for_forces(length)</pre>
<pre id='line508' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line509")'> 509: #</pre>
<pre id='line509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line510")'> 510: #    if not is_new:</pre>
<pre id='line510' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line511")'> 511: #        length = length*3</pre>
<pre id='line511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line512")'> 512: #        for i in range(length):</pre>
<pre id='line512' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line513")'> 513: #            self._out_array[i] =0.0</pre>
<pre id='line513' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line514")'> 514: #    return self._out_array</pre>
<pre id='line514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line515")'> 515: #</pre>
<pre id='line515' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line516")'> 516: #def _copy_back_forces(self, data_dict, data_array, target_atom_ids):</pre>
<pre id='line516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line517")'> 517: #    for id in target_atom_ids:</pre>
<pre id='line517' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line518")'> 518: #        result =  dict.setdefault(id,[0.0,0.0,0.0])</pre>
<pre id='line518' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line519")'> 519: #        id3 = id*3</pre>
<pre id='line519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line520")'> 520: #        result[0] = data_array[id3]</pre>
<pre id='line520' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line521")'> 521: #        result[1] = data_array[id3+1]</pre>
<pre id='line521' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line522")'> 522: #        result[2] = data_array[id3+2]</pre>
<pre id='line522' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line523")'> 523: </pre>
<pre id='line523' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line524")'> 524: </pre>
<pre id='line524' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line525")'> 525: </pre>
<pre id='line525' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line526")'> 526: cdef object vec3_as_tuple(Vec3&amp; vec_3):</pre>
<pre id='line526' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":526
 * 
 * 
 * cdef object vec3_as_tuple(Vec3& vec_3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 */

static PyObject *__pyx_f_17shift_calculators_vec3_as_tuple(Vec3 &__pyx_v_vec_3) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("vec3_as_tuple", 0);
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line527")'> 527:     return vec_3.x(), vec_3.y(), vec_3.z()</pre>
<pre id='line527' class='code' style='background-color: #FFFF3c'>
  /* "Cython_shift_calculator.pyx":527
 * 
 * cdef object vec3_as_tuple(Vec3& vec_3):
 *     return vec_3.x(), vec_3.y(), vec_3.z()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Vec3_container:
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.x());<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.y());<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.z());<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_r = ((PyObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.vec3_as_tuple", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line528")'> 528: </pre>
<pre id='line528' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line529")'> 529: cdef class Vec3_container:</pre>
<pre id='line529' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":529
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 * cdef class Vec3_container:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float[3] floats
 */
struct __pyx_obj_17shift_calculators_Vec3_container {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Vec3_container *__pyx_vtab;
  float floats[3];
};


/* "Cython_shift_calculator.pyx":529
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 * cdef class Vec3_container:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float[3] floats
 */

struct __pyx_vtabstruct_17shift_calculators_Vec3_container {
  PyObject *(*set_vec3)(struct __pyx_obj_17shift_calculators_Vec3_container *, Vec3 &);
  Vec3 (*get_vec3)(struct __pyx_obj_17shift_calculators_Vec3_container *);
};
static struct __pyx_vtabstruct_17shift_calculators_Vec3_container *__pyx_vtabptr_17shift_calculators_Vec3_container;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line530")'> 530: </pre>
<pre id='line530' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line531")'> 531:     cdef float[3] floats</pre>
<pre id='line531' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line532")'> 532: </pre>
<pre id='line532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line533")'> 533:     cdef set_vec3(self,Vec3&amp; vec3):</pre>
<pre id='line533' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":533
 *     cdef float[3] floats
 * 
 *     cdef set_vec3(self,Vec3& vec3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()
 */

static PyObject *__pyx_f_17shift_calculators_14Vec3_container_set_vec3(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self, Vec3 &__pyx_v_vec3) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_vec3", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line534")'> 534:         self.floats[0] =  vec3.x()</pre>
<pre id='line534' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":534
 * 
 *     cdef set_vec3(self,Vec3& vec3):
 *         self.floats[0] =  vec3.x()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[1] =  vec3.y()
 *         self.floats[2] =  vec3.z()
 */
  (__pyx_v_self->floats[0]) = __pyx_v_vec3.x();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line535")'> 535:         self.floats[1] =  vec3.y()</pre>
<pre id='line535' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":535
 *     cdef set_vec3(self,Vec3& vec3):
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[2] =  vec3.z()
 * 
 */
  (__pyx_v_self->floats[1]) = __pyx_v_vec3.y();
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line536")'> 536:         self.floats[2] =  vec3.z()</pre>
<pre id='line536' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":536
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()
 *         self.floats[2] =  vec3.z()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  (__pyx_v_self->floats[2]) = __pyx_v_vec3.z();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line537")'> 537: </pre>
<pre id='line537' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line538")'> 538:     @cython.profile(False)</pre>
<pre id='line538' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line539")'> 539:     cdef Vec3  get_vec3(self):</pre>
<pre id='line539' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":539
 * 
 *     @cython.profile(False)
 *     cdef Vec3  get_vec3(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])
 * 
 */

static Vec3 __pyx_f_17shift_calculators_14Vec3_container_get_vec3(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self) {
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_vec3", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line540")'> 540:         return Vec3(self.floats[0],self.floats[1],self.floats[2])</pre>
<pre id='line540' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":540
 *     @cython.profile(False)
 *     cdef Vec3  get_vec3(self):
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __getitem__(self, i):
 */
  __pyx_r = Vec3((__pyx_v_self->floats[0]), (__pyx_v_self->floats[1]), (__pyx_v_self->floats[2]));
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_14Vec3_container_1__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_14Vec3_container_1__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_14Vec3_container___getitem__(((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_v_self), ((PyObject *)__pyx_v_i));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line541")'> 541: </pre>
<pre id='line541' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line542")'> 542:     def __getitem__(self, i):</pre>
<pre id='line542' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":542
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])
 * 
 *     def __getitem__(self, i):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"
 */

static PyObject *__pyx_pf_17shift_calculators_14Vec3_container___getitem__(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self, PyObject *__pyx_v_i) {
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_v_values = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__", 0);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line543")'> 543:         if i &gt; 2:</pre>
<pre id='line543' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":543
 * 
 *     def __getitem__(self, i):
 *         if i > 2:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_i, __pyx_int_2, Py_GT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 543; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 543; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line544")'> 544:             msg = "tried to access object at %i length is %i"</pre>
<pre id='line544' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":544
 *     def __getitem__(self, i):
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             values = (i,3)
 *             raise IndexError(msg % values)
 */
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_13));
    __pyx_v_msg = ((PyObject *)__pyx_kp_s_13);
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line545")'> 545:             values = (i,3)</pre>
<pre id='line545' class='code' style='background-color: #FFFF86'>
    /* "Cython_shift_calculator.pyx":545
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError(msg % values)
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_i);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_int_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_3);
    __pyx_v_values = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line546")'> 546:             raise IndexError(msg % values)</pre>
<pre id='line546' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":546
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)
 *             raise IndexError(msg % values)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return self.floats[i]
 */
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Remainder</span>(__pyx_v_msg, ((PyObject *)__pyx_v_values));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line547")'> 547: </pre>
<pre id='line547' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line548")'> 548:         return self.floats[i]</pre>
<pre id='line548' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":548
 *             raise IndexError(msg % values)
 * 
 *         return self.floats[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_4 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->floats[__pyx_t_4]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Vec3_container.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_msg);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_values);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_27Python_ring_force_sub_terms_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_27Python_ring_force_sub_terms_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_27Python_ring_force_sub_terms___init__(((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line549")'> 549: </pre>
<pre id='line549' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line550")'> 550: </pre>
<pre id='line550' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line551")'> 551: cdef struct target_distant_atom:</pre>
<pre id='line551' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":551
 * 
 * 
 * cdef struct target_distant_atom:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int target_atom_id
 *     int distant_atom_id
 */
struct __pyx_t_17shift_calculators_target_distant_atom {
  int target_atom_id;
  int distant_atom_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line552")'> 552:     int target_atom_id</pre>
<pre id='line552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line553")'> 553:     int distant_atom_id</pre>
<pre id='line553' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line554")'> 554: </pre>
<pre id='line554' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line555")'> 555: cdef struct target_type:</pre>
<pre id='line555' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":555
 *     int distant_atom_id
 * 
 * cdef struct target_type:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int  target_atom_id
 *     int  atom_type_id
 */
struct __pyx_t_17shift_calculators_target_type {
  int target_atom_id;
  int atom_type_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line556")'> 556:     int  target_atom_id</pre>
<pre id='line556' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line557")'> 557:     int  atom_type_id</pre>
<pre id='line557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line558")'> 558: </pre>
<pre id='line558' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line559")'> 559: cdef struct coefficient_exponent:</pre>
<pre id='line559' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":559
 *     int  atom_type_id
 * 
 * cdef struct coefficient_exponent:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     float coefficient
 *     float exponent
 */
struct __pyx_t_17shift_calculators_coefficient_exponent {
  float coefficient;
  float exponent;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line560")'> 560:     float coefficient</pre>
<pre id='line560' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line561")'> 561:     float exponent</pre>
<pre id='line561' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line562")'> 562: </pre>
<pre id='line562' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line563")'> 563: cdef struct dihedral_ids:</pre>
<pre id='line563' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":563
 *     float exponent
 * 
 * cdef struct dihedral_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int atom_id_1
 *     int atom_id_2
 */
struct __pyx_t_17shift_calculators_dihedral_ids {
  int atom_id_1;
  int atom_id_2;
  int atom_id_3;
  int atom_id_4;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line564")'> 564:     int atom_id_1</pre>
<pre id='line564' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line565")'> 565:     int atom_id_2</pre>
<pre id='line565' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line566")'> 566:     int atom_id_3</pre>
<pre id='line566' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line567")'> 567:     int atom_id_4</pre>
<pre id='line567' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line568")'> 568: </pre>
<pre id='line568' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line569")'> 569: cdef struct Coef_component:</pre>
<pre id='line569' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":569
 *     int atom_id_4
 * 
 * cdef struct Coef_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int atom_type_id
 *     int ring_id
 */
struct __pyx_t_17shift_calculators_Coef_component {
  int atom_type_id;
  int ring_id;
  float coefficient;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line570")'> 570:     int atom_type_id</pre>
<pre id='line570' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line571")'> 571:     int ring_id</pre>
<pre id='line571' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line572")'> 572:     float coefficient</pre>
<pre id='line572' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line573")'> 573: </pre>
<pre id='line573' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line574")'> 574: cdef struct Ring_force_sub_terms:</pre>
<pre id='line574' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":574
 *     float coefficient
 * 
 * cdef struct Ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     Vec3 d
 *     float dLnL
 */
struct __pyx_t_17shift_calculators_Ring_force_sub_terms {
  Vec3 d;
  float dLnL;
  float dL3nL3;
  float dn;
  float dL;
  float nL;
  Vec3 gradUQ;
  float dL3;
  float u;
  Vec3 gradVQ;
  float dL6;
  Vec3 ring_normal;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line575")'> 575:     Vec3 d</pre>
<pre id='line575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line576")'> 576:     float dLnL</pre>
<pre id='line576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line577")'> 577:     float dL3nL3</pre>
<pre id='line577' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line578")'> 578:     float dn</pre>
<pre id='line578' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line579")'> 579:     float dL</pre>
<pre id='line579' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line580")'> 580:     float nL</pre>
<pre id='line580' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line581")'> 581:     Vec3 gradUQ</pre>
<pre id='line581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line582")'> 582:     float dL3</pre>
<pre id='line582' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line583")'> 583:     float u</pre>
<pre id='line583' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line584")'> 584:     Vec3 gradVQ</pre>
<pre id='line584' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line585")'> 585:     float dL6</pre>
<pre id='line585' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line586")'> 586:     Vec3 ring_normal</pre>
<pre id='line586' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line587")'> 587: </pre>
<pre id='line587' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line588")'> 588: cdef class Python_ring_force_sub_terms:</pre>
<pre id='line588' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":588
 *     Vec3 ring_normal
 * 
 * cdef class Python_ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Ring_force_sub_terms _terms
 * 
 */
struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *__pyx_vtab;
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms _terms;
};


/* "Cython_shift_calculator.pyx":588
 *     Vec3 ring_normal
 * 
 * cdef class Python_ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Ring_force_sub_terms _terms
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms {
  PyObject *(*setup)(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &);
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms (*get_terms)(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *);
};
static struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *__pyx_vtabptr_17shift_calculators_Python_ring_force_sub_terms;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line589")'> 589:     cdef Ring_force_sub_terms _terms</pre>
<pre id='line589' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line590")'> 590: </pre>
<pre id='line590' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line591")'> 591: #    def __cinit__(self):</pre>
<pre id='line591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line592")'> 592: #        self._terms = NULL</pre>
<pre id='line592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line593")'> 593: </pre>
<pre id='line593' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line594")'> 594:     def __init__(self):</pre>
<pre id='line594' class='code' style='background-color: #FFFFe7'>
/* "Cython_shift_calculator.pyx":594
 * #        self._terms = NULL
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static int __pyx_pf_17shift_calculators_27Python_ring_force_sub_terms___init__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line595")'> 595:         pass</pre>
<pre id='line595' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line596")'> 596: </pre>
<pre id='line596' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line597")'> 597:     cdef setup(self, Ring_force_sub_terms&amp; terms):</pre>
<pre id='line597' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":597
 *         pass
 * 
 *     cdef setup(self, Ring_force_sub_terms& terms):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._terms=terms
 * 
 */

static PyObject *__pyx_f_17shift_calculators_27Python_ring_force_sub_terms_setup(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_terms) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("setup", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line598")'> 598:         self._terms=terms</pre>
<pre id='line598' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":598
 * 
 *     cdef setup(self, Ring_force_sub_terms& terms):
 *         self._terms=terms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Ring_force_sub_terms get_terms(self):
 */
  __pyx_v_self->_terms = __pyx_v_terms;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line599")'> 599: </pre>
<pre id='line599' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line600")'> 600:     cdef Ring_force_sub_terms get_terms(self):</pre>
<pre id='line600' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":600
 *         self._terms=terms
 * 
 *     cdef Ring_force_sub_terms get_terms(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._terms
 * 
 */

static struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_f_17shift_calculators_27Python_ring_force_sub_terms_get_terms(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_terms", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line601")'> 601:         return self._terms</pre>
<pre id='line601' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":601
 * 
 *     cdef Ring_force_sub_terms get_terms(self):
 *         return self._terms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_self->_terms;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_15Coef_components_1_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_15Coef_components_1_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_15Coef_components__bytes_to_components(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line602")'> 602: </pre>
<pre id='line602' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line603")'> 603: </pre>
<pre id='line603' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line604")'> 604: cdef struct Component_Offsets:</pre>
<pre id='line604' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":604
 * 
 * 
 * cdef struct Component_Offsets:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int id
 *     int offset
 */
struct __pyx_t_17shift_calculators_Component_Offsets {
  int id;
  int offset;
  int length;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line605")'> 605:     int id</pre>
<pre id='line605' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line606")'> 606:     int offset</pre>
<pre id='line606' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line607")'> 607:     int length</pre>
<pre id='line607' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line608")'> 608: </pre>
<pre id='line608' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line609")'> 609: </pre>
<pre id='line609' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line610")'> 610: cdef class Coef_components:</pre>
<pre id='line610' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":610
 * 
 * 
 * cdef class Coef_components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _raw_data
 *     cdef Coef_component* _components
 */
struct __pyx_obj_17shift_calculators_Coef_components {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Coef_components *__pyx_vtab;
  PyObject *_raw_data;
  struct __pyx_t_17shift_calculators_Coef_component *_components;
  int _num_components;
  PyObject *_raw_component_offsets_data;
  struct __pyx_t_17shift_calculators_Component_Offsets *_component_offsets;
  int num_ids;
};


/* "Cython_shift_calculator.pyx":610
 * 
 * 
 * cdef class Coef_components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _raw_data
 *     cdef Coef_component* _components
 */

struct __pyx_vtabstruct_17shift_calculators_Coef_components {
  void (*_bytes_to_component_offsets)(struct __pyx_obj_17shift_calculators_Coef_components *, PyObject *);
  struct __pyx_t_17shift_calculators_Component_Offsets *(*get_id_offsets)(struct __pyx_obj_17shift_calculators_Coef_components *, int);
  struct __pyx_t_17shift_calculators_Coef_component *(*get_component)(struct __pyx_obj_17shift_calculators_Coef_components *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Coef_components *__pyx_vtabptr_17shift_calculators_Coef_components;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line611")'> 611:     cdef object _raw_data</pre>
<pre id='line611' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line612")'> 612:     cdef Coef_component* _components</pre>
<pre id='line612' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line613")'> 613:     cdef int _num_components</pre>
<pre id='line613' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line614")'> 614: </pre>
<pre id='line614' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line615")'> 615:     cdef object _raw_component_offsets_data</pre>
<pre id='line615' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line616")'> 616:     cdef Component_Offsets* _component_offsets</pre>
<pre id='line616' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line617")'> 617:     cdef int num_ids</pre>
<pre id='line617' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line618")'> 618: </pre>
<pre id='line618' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line619")'> 619:     def _bytes_to_components(self, data):</pre>
<pre id='line619' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":619
 *     cdef int num_ids
 * 
 *     def _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._raw_data =  data
 */

static PyObject *__pyx_pf_17shift_calculators_15Coef_components__bytes_to_components(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line620")'> 620: </pre>
<pre id='line620' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line621")'> 621:         self._raw_data =  data</pre>
<pre id='line621' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":621
 *     def _bytes_to_components(self, data):
 * 
 *         self._raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components =  <code><</code>Coef_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Coef_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_data);
  __pyx_v_self->_raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line622")'> 622:         self._components =  &lt;Coef_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line622' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":622
 * 
 *         self._raw_data =  data
 *         self._components =  <code><</code>Coef_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Coef_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_components = ((struct __pyx_t_17shift_calculators_Coef_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line623")'> 623:         self._num_components =  len(data)/ sizeof(Coef_component)</pre>
<pre id='line623' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":623
 *         self._raw_data =  data
 *         self._components =  <code><</code>Coef_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Coef_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _bytes_to_component_offsets(self, data):
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Coef_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line624")'> 624: </pre>
<pre id='line624' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line625")'> 625:     cdef void _bytes_to_component_offsets(self, data):</pre>
<pre id='line625' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":625
 *         self._num_components =  len(data)/ sizeof(Coef_component)
 * 
 *     cdef void _bytes_to_component_offsets(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._raw_component_offsets_data =  data
 */

static void __pyx_f_17shift_calculators_15Coef_components__bytes_to_component_offsets(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, PyObject *__pyx_v_data) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_component_offsets", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line626")'> 626: </pre>
<pre id='line626' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line627")'> 627:         self._raw_component_offsets_data =  data</pre>
<pre id='line627' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":627
 *     cdef void _bytes_to_component_offsets(self, data):
 * 
 *         self._raw_component_offsets_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._component_offsets =  <code><</code>Component_Offsets*> <code><</code>size_t> ctypes.addressof(data)
 *         self.num_ids =  len(data)/ sizeof(Component_Offsets)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_component_offsets_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_component_offsets_data);
  __pyx_v_self->_raw_component_offsets_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line628")'> 628:         self._component_offsets =  &lt;Component_Offsets*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line628' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":628
 * 
 *         self._raw_component_offsets_data =  data
 *         self._component_offsets =  <code><</code>Component_Offsets*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.num_ids =  len(data)/ sizeof(Component_Offsets)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_component_offsets = ((struct __pyx_t_17shift_calculators_Component_Offsets *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line629")'> 629:         self.num_ids =  len(data)/ sizeof(Component_Offsets)</pre>
<pre id='line629' class='code' style='background-color: #FFFF30'>
  /* "Cython_shift_calculator.pyx":629
 *         self._raw_component_offsets_data =  data
 *         self._component_offsets =  <code><</code>Component_Offsets*> <code><</code>size_t> ctypes.addressof(data)
 *         self.num_ids =  len(data)/ sizeof(Component_Offsets)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __cinit__(self, object coef_components, component_offsets):
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 629; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->num_ids = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Component_Offsets)));

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Coef_components._bytes_to_component_offsets", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_15Coef_components_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_15Coef_components_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_coef_components = 0;
  PyObject *__pyx_v_component_offsets = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__coef_components,&__pyx_n_s__component_offsets,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coef_components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_offsets)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_coef_components = values[0];
    __pyx_v_component_offsets = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_15Coef_components_2__cinit__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self), __pyx_v_coef_components, __pyx_v_component_offsets);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line630")'> 630: </pre>
<pre id='line630' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line631")'> 631:     def __cinit__(self, object coef_components, component_offsets):</pre>
<pre id='line631' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":631
 *         self.num_ids =  len(data)/ sizeof(Component_Offsets)
 * 
 *     def __cinit__(self, object coef_components, component_offsets):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

static int __pyx_pf_17shift_calculators_15Coef_components_2__cinit__(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, PyObject *__pyx_v_coef_components, PyObject *__pyx_v_component_offsets) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line632")'> 632: </pre>
<pre id='line632' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line633")'> 633: </pre>
<pre id='line633' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line634")'> 634:         self._bytes_to_components(coef_components)</pre>
<pre id='line634' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":634
 * 
 * 
 *         self._bytes_to_components(coef_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_component_offsets(component_offsets)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_22);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line635")'> 635:         self._bytes_to_component_offsets(component_offsets)</pre>
<pre id='line635' class='code' style='background-color: #FFFF35'>
  /* "Cython_shift_calculator.pyx":635
 * 
 *         self._bytes_to_components(coef_components)
 *         self._bytes_to_component_offsets(component_offsets)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #         self. num_ids = len(components.get_component_atom_ids())
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Coef_components *)__pyx_v_self->__pyx_vtab)->_bytes_to_component_offsets(__pyx_v_self, __pyx_v_component_offsets);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_15Coef_components_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_15Coef_components_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_coef_components = 0;
  CYTHON_UNUSED PyObject *__pyx_v_components = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__coef_components,&__pyx_n_s__components,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coef_components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_coef_components = values[0];
    __pyx_v_components = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_15Coef_components_4__init__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self), __pyx_v_coef_components, __pyx_v_components);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line636")'> 636: </pre>
<pre id='line636' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line637")'> 637: #         self. num_ids = len(components.get_component_atom_ids())</pre>
<pre id='line637' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line638")'> 638: #         self._component_offsets =  &lt;Component_Offsets*&gt;malloc(self.num_ids * sizeof(Component_Offsets))</pre>
<pre id='line638' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line639")'> 639: #         if not self._component_offsets:</pre>
<pre id='line639' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line640")'> 640: #             raise MemoryError()</pre>
<pre id='line640' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line641")'> 641: #</pre>
<pre id='line641' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line642")'> 642: #</pre>
<pre id='line642' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line643")'> 643: #         ids =  components.get_component_atom_ids()</pre>
<pre id='line643' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line644")'> 644: #         for i,id in enumerate(ids):</pre>
<pre id='line644' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line645")'> 645: #             start,end = components.get_component_range(id)</pre>
<pre id='line645' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line646")'> 646: #             self._component_offsets[i].id = id</pre>
<pre id='line646' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line647")'> 647: #             self._component_offsets[i].offset = start</pre>
<pre id='line647' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line648")'> 648: #             self._component_offsets[i].length = end-start</pre>
<pre id='line648' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line649")'> 649: </pre>
<pre id='line649' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line650")'> 650: </pre>
<pre id='line650' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line651")'> 651:     def __init__ (self, object coef_components, object components):</pre>
<pre id='line651' class='code' style='background-color: #FFFFe7'>
/* "Cython_shift_calculator.pyx":651
 * 
 * 
 *     def __init__ (self, object coef_components, object components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static int __pyx_pf_17shift_calculators_15Coef_components_4__init__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_coef_components, CYTHON_UNUSED PyObject *__pyx_v_components) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line652")'> 652:         pass</pre>
<pre id='line652' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line653")'> 653: </pre>
<pre id='line653' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line654")'> 654: </pre>
<pre id='line654' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line655")'> 655:     cdef inline Component_Offsets* get_id_offsets(self,int id) nogil:</pre>
<pre id='line655' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":655
 * 
 * 
 *     cdef inline Component_Offsets* get_id_offsets(self,int id) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return &self._component_offsets[id]
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_f_17shift_calculators_15Coef_components_get_id_offsets(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, int __pyx_v_id) {
  struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line656")'> 656:         return &amp;self._component_offsets[id]</pre>
<pre id='line656' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":656
 * 
 *     cdef inline Component_Offsets* get_id_offsets(self,int id) nogil:
 *         return &self._component_offsets[id]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
  __pyx_r = (&(__pyx_v_self->_component_offsets[__pyx_v_id]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_15Coef_components_7__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_15Coef_components_7__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_15Coef_components_6__dealloc__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line657")'> 657: </pre>
<pre id='line657' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line658")'> 658:     def __dealloc__(self):</pre>
<pre id='line658' class='code' style='background-color: #FFFFe7'>
/* "Cython_shift_calculator.pyx":658
 *         return &self._component_offsets[id]
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static void __pyx_pf_17shift_calculators_15Coef_components_6__dealloc__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line659")'> 659:         pass</pre>
<pre id='line659' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line660")'> 660: </pre>
<pre id='line660' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line661")'> 661: </pre>
<pre id='line661' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line662")'> 662: </pre>
<pre id='line662' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line663")'> 663: </pre>
<pre id='line663' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line664")'> 664: #         if self._component_offsets != NULL:</pre>
<pre id='line664' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line665")'> 665: #             free(self._component_offsets)</pre>
<pre id='line665' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line666")'> 666: #             self._component_offsets =  NULL</pre>
<pre id='line666' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line667")'> 667: #             self.num_ids = 0</pre>
<pre id='line667' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line668")'> 668: </pre>
<pre id='line668' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line669")'> 669: </pre>
<pre id='line669' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line670")'> 670: #    cdef int _check_offset(self, int offset) except -1:</pre>
<pre id='line670' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line671")'> 671: #</pre>
<pre id='line671' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line672")'> 672: #        if not offset &lt; self.num_components:</pre>
<pre id='line672' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line673")'> 673: #            raise IndexError("tried to access object at %i length is %i" % (offset,self._num_components))</pre>
<pre id='line673' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line674")'> 674: #        if self._components is NULL:</pre>
<pre id='line674' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line675")'> 675: #            raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line675' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line676")'> 676: #        return 0</pre>
<pre id='line676' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line677")'> 677: </pre>
<pre id='line677' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line678")'> 678: </pre>
<pre id='line678' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line679")'> 679: </pre>
<pre id='line679' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line680")'> 680:     @cython.profile(False)</pre>
<pre id='line680' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line681")'> 681:     cdef inline Coef_component* get_component(self,int offset) nogil:</pre>
<pre id='line681' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":681
 * 
 *     @cython.profile(False)
 *     cdef inline Coef_component* get_component(self,int offset) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_offset(offset)
 *         return &self._components[offset]
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_Coef_component *__pyx_f_17shift_calculators_15Coef_components_get_component(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, int __pyx_v_offset) {
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line682")'> 682: #        self._check_offset(offset)</pre>
<pre id='line682' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line683")'> 683:         return &amp;self._components[offset]</pre>
<pre id='line683' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":683
 *     cdef inline Coef_component* get_component(self,int offset) nogil:
 * #        self._check_offset(offset)
 *         return &self._components[offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef struct ring_atom_ids:
 */
  __pyx_r = (&(__pyx_v_self->_components[__pyx_v_offset]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line684")'> 684: </pre>
<pre id='line684' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line685")'> 685: cdef struct ring_atom_ids:</pre>
<pre id='line685' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":685
 *         return &self._components[offset]
 * 
 * cdef struct ring_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int num_atoms
 *     int[6] atom_ids
 */
struct __pyx_t_17shift_calculators_ring_atom_ids {
  int num_atoms;
  int atom_ids[6];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line686")'> 686:     int num_atoms</pre>
<pre id='line686' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line687")'> 687:     int[6] atom_ids</pre>
<pre id='line687' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line688")'> 688: </pre>
<pre id='line688' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line689")'> 689: </pre>
<pre id='line689' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line690")'> 690: </pre>
<pre id='line690' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line691")'> 691: </pre>
<pre id='line691' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line692")'> 692: </pre>
<pre id='line692' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line693")'> 693: </pre>
<pre id='line693' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line694")'> 694: cdef struct dihedral_parameters:</pre>
<pre id='line694' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":694
 * 
 * 
 * cdef struct dihedral_parameters:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     float param_0
 *     float param_1
 */
struct __pyx_t_17shift_calculators_dihedral_parameters {
  float param_0;
  float param_1;
  float param_2;
  float param_3;
  float param_4;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line695")'> 695:     float param_0</pre>
<pre id='line695' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line696")'> 696:     float param_1</pre>
<pre id='line696' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line697")'> 697:     float param_2</pre>
<pre id='line697' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line698")'> 698:     float param_3</pre>
<pre id='line698' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line699")'> 699:     float param_4</pre>
<pre id='line699' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line700")'> 700: </pre>
<pre id='line700' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line701")'> 701: </pre>
<pre id='line701' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line702")'> 702: #cdef float sum(Vec3 vec3):</pre>
<pre id='line702' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line703")'> 703: #    return vec3.x()+vec3.y()+vec3.z()</pre>
<pre id='line703' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line704")'> 704: </pre>
<pre id='line704' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line705")'> 705: </pre>
<pre id='line705' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line706")'> 706: @cython.profile(False)</pre>
<pre id='line706' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line707")'> 707: cdef inline void operator_times (Vec3&amp; vec3, float scale):</pre>
<pre id='line707' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":707
 * 
 * @cython.profile(False)
 * cdef inline void operator_times (Vec3& vec3, float scale):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_operator_times(Vec3 &__pyx_v_vec3, float __pyx_v_scale) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("operator_times", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line708")'> 708:      vec3[0] =  vec3[0] * scale</pre>
<pre id='line708' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":708
 * @cython.profile(False)
 * cdef inline void operator_times (Vec3& vec3, float scale):
 *      vec3[0] =  vec3[0] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[1] =  vec3[1] * scale
 *      vec3[2] =  vec3[2] * scale
 */
  (__pyx_v_vec3[0]) = ((__pyx_v_vec3[0]) * __pyx_v_scale);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line709")'> 709:      vec3[1] =  vec3[1] * scale</pre>
<pre id='line709' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":709
 * cdef inline void operator_times (Vec3& vec3, float scale):
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[2] =  vec3[2] * scale
 * 
 */
  (__pyx_v_vec3[1]) = ((__pyx_v_vec3[1]) * __pyx_v_scale);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line710")'> 710:      vec3[2] =  vec3[2] * scale</pre>
<pre id='line710' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":710
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale
 *      vec3[2] =  vec3[2] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * @cython.profile(False)
 */
  (__pyx_v_vec3[2]) = ((__pyx_v_vec3[2]) * __pyx_v_scale);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line711")'> 711: </pre>
<pre id='line711' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line712")'> 712: @cython.profile(False)</pre>
<pre id='line712' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line713")'> 713: cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, int atom_index_2) nogil:</pre>
<pre id='line713' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":713
 * 
 * @cython.profile(False)
 * cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, int atom_index_2) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_calc_distance_simulation(Simulation *__pyx_v_sim, int __pyx_v_atom_index_1, int __pyx_v_atom_index_2) {
  Vec3 __pyx_v_vec1;
  Vec3 __pyx_v_vec2;
  Vec3 __pyx_v_result;
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line714")'> 714: </pre>
<pre id='line714' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line715")'> 715:     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)</pre>
<pre id='line715' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":715
 * cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, int atom_index_2) nogil:
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1
 */
  __pyx_v_vec1 = (__pyx_v_sim[0]).atomPos(__pyx_v_atom_index_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line716")'> 716:     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)</pre>
<pre id='line716' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":716
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3 result =  vec2 - vec1
 *     return norm(result)
 */
  __pyx_v_vec2 = (__pyx_v_sim[0]).atomPos(__pyx_v_atom_index_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line717")'> 717:     cdef Vec3 result =  vec2 - vec1</pre>
<pre id='line717' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":717
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return norm(result)
 * 
 */
  __pyx_v_result = (__pyx_v_vec2 - __pyx_v_vec1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line718")'> 718:     return norm(result)</pre>
<pre id='line718' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":718
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1
 *     return norm(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = norm(__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line719")'> 719: </pre>
<pre id='line719' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line720")'> 720: </pre>
<pre id='line720' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line721")'> 721: </pre>
<pre id='line721' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line722")'> 722: #</pre>
<pre id='line722' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line723")'> 723: #</pre>
<pre id='line723' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line724")'> 724: #cdef inline bint distance_less_than(int atom_index_1, atom_index_2, float target):</pre>
<pre id='line724' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line725")'> 725: #    cdef float total = 0.0</pre>
<pre id='line725' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line726")'> 726: #    cdef float diff</pre>
<pre id='line726' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line727")'> 727: #    cdef float target2  = target*target</pre>
<pre id='line727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line728")'> 728: #</pre>
<pre id='line728' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line729")'> 729: #    cdef Vec3 vec1 = currentSimulation().atomPosArr().data(atom_index_1)</pre>
<pre id='line729' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line730")'> 730: #    cdef Vec3 vec2 = currentSimulation().atomPosArr().data(atom_index_2)</pre>
<pre id='line730' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line731")'> 731: #    cdef bint result  =  True</pre>
<pre id='line731' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line732")'> 732: #    for i in range(3):</pre>
<pre id='line732' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line733")'> 733: #        diff = vec1[i] - vec2[i]</pre>
<pre id='line733' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line734")'> 734: #        total += diff * diff</pre>
<pre id='line734' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line735")'> 735: #</pre>
<pre id='line735' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line736")'> 736: #        if total &gt; target2:</pre>
<pre id='line736' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line737")'> 737: #            result = False</pre>
<pre id='line737' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line738")'> 738: #            break</pre>
<pre id='line738' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line739")'> 739: #    return result</pre>
<pre id='line739' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line740")'> 740: </pre>
<pre id='line740' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line741")'> 741: </pre>
<pre id='line741' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line742")'> 742: </pre>
<pre id='line742' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line743")'> 743: </pre>
<pre id='line743' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line744")'> 744: </pre>
<pre id='line744' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line745")'> 745: #TODO how does currentSimulation().atomByID work inside</pre>
<pre id='line745' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line746")'> 746: @cython.profile(False)</pre>
<pre id='line746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line747")'> 747: cdef inline float calc_dihedral_angle_simulation(Simulation* simulation, dihedral_ids dihedral_atom_ids) nogil:</pre>
<pre id='line747' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":747
 * #TODO how does currentSimulation().atomByID work inside
 * @cython.profile(False)
 * cdef inline float calc_dihedral_angle_simulation(Simulation* simulation, dihedral_ids dihedral_atom_ids) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(Simulation *__pyx_v_simulation, struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids) {
  Atom __pyx_v_atom_1;
  Atom __pyx_v_atom_2;
  Atom __pyx_v_atom_3;
  Atom __pyx_v_atom_4;
  double __pyx_v_result;
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line748")'> 748: </pre>
<pre id='line748' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line749")'> 749: </pre>
<pre id='line749' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line750")'> 750: </pre>
<pre id='line750' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line751")'> 751:     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)</pre>
<pre id='line751' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":751
 * 
 * 
 *     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 */
  __pyx_v_atom_1 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line752")'> 752:     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)</pre>
<pre id='line752' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":752
 * 
 *     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 */
  __pyx_v_atom_2 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line753")'> 753:     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)</pre>
<pre id='line753' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":753
 *     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 * 
 */
  __pyx_v_atom_3 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line754")'> 754:     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)</pre>
<pre id='line754' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":754
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()
 */
  __pyx_v_atom_4 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line755")'> 755: </pre>
<pre id='line755' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line756")'> 756:     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()</pre>
<pre id='line756' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":756
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 * 
 *     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return result
 * 
 */
  __pyx_v_result = Dihedral(__pyx_v_atom_1, __pyx_v_atom_2, __pyx_v_atom_3, __pyx_v_atom_4).value();
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line757")'> 757:     return result</pre>
<pre id='line757' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":757
 * 
 *     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()
 *     return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_21Base_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_21Base_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_simulation = values[0];
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line758")'> 758: </pre>
<pre id='line758' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line759")'> 759: </pre>
<pre id='line759' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line760")'> 760: </pre>
<pre id='line760' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line761")'> 761: cdef float DEFAULT_CUTOFF = 5.0</pre>
<pre id='line761' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":761
 * 
 * 
 * cdef float DEFAULT_CUTOFF = 5.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 */
  __pyx_v_17shift_calculators_DEFAULT_CUTOFF = 5.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line762")'> 762: cdef float DEFAULT_SMOOTHING_FACTOR = 1.0</pre>
<pre id='line762' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":762
 * 
 * cdef float DEFAULT_CUTOFF = 5.0
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 */
  __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line763")'> 763: cdef float DEFAULT_NB_CUTOFF = 5.0</pre>
<pre id='line763' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":763
 * cdef float DEFAULT_CUTOFF = 5.0
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0
 * cdef float DEFAULT_NB_CUTOFF = 5.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Base_shift_calculator:
 */
  __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF = 5.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line764")'> 764: </pre>
<pre id='line764' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line765")'> 765: cdef class Base_shift_calculator:</pre>
<pre id='line765' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":765
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 * cdef class Base_shift_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef str _name
 */
struct __pyx_obj_17shift_calculators_Base_shift_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator *__pyx_vtab;
  int _verbose;
  PyObject *_name;
  EnsembleSimulation *_simulation;
};


/* "Cython_shift_calculator.pyx":765
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 * cdef class Base_shift_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef str _name
 */

struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator {
  int (*ensemble_size)(struct __pyx_obj_17shift_calculators_Base_shift_calculator *);
  int (*ensemble_member_index)(struct __pyx_obj_17shift_calculators_Base_shift_calculator *);
  int (*ensemble_array_offset)(struct __pyx_obj_17shift_calculators_Base_shift_calculator *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator *__pyx_vtabptr_17shift_calculators_Base_shift_calculator;
static CYTHON_INLINE int __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_size(struct __pyx_obj_17shift_calculators_Base_shift_calculator *);
static CYTHON_INLINE int __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_member_index(struct __pyx_obj_17shift_calculators_Base_shift_calculator *);
static CYTHON_INLINE int __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_array_offset(struct __pyx_obj_17shift_calculators_Base_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line766")'> 766:     cdef bint _verbose</pre>
<pre id='line766' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line767")'> 767:     cdef str _name</pre>
<pre id='line767' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line768")'> 768:     cdef EnsembleSimulation* _simulation</pre>
<pre id='line768' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line769")'> 769: </pre>
<pre id='line769' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line770")'> 770:     def __init__(self, simulation, str name):</pre>
<pre id='line770' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":770
 *     cdef EnsembleSimulation* _simulation
 * 
 *     def __init__(self, simulation, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._verbose = False
 *             self._name = name
 */

static int __pyx_pf_17shift_calculators_21Base_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, PyObject *__pyx_v_simulation, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line771")'> 771:             self._verbose = False</pre>
<pre id='line771' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":771
 * 
 *     def __init__(self, simulation, str name):
 *             self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._name = name
 *             self._simulation =  simulationAsNative(simulation)
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line772")'> 772:             self._name = name</pre>
<pre id='line772' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":772
 *     def __init__(self, simulation, str name):
 *             self._verbose = False
 *             self._name = name             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._simulation =  simulationAsNative(simulation)
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_name);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_name));
  __pyx_v_self->_name = __pyx_v_name;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line773")'> 773:             self._simulation =  simulationAsNative(simulation)</pre>
<pre id='line773' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":773
 *             self._verbose = False
 *             self._name = name
 *             self._simulation =  simulationAsNative(simulation)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_simulationAsNative(__pyx_v_simulation);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_simulation = __pyx_t_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
  int __pyx_v_state;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  assert(__pyx_arg_state); {
    __pyx_v_state = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_arg_state);<span class='error_goto'> if (unlikely((__pyx_v_state == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 777; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), ((int)__pyx_v_state));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line774")'> 774: </pre>
<pre id='line774' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line775")'> 775: </pre>
<pre id='line775' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line776")'> 776: </pre>
<pre id='line776' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line777")'> 777:     def set_verbose(self,bint state):</pre>
<pre id='line777' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":777
 * 
 * 
 *     def set_verbose(self,bint state):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  state
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_shift_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, int __pyx_v_state) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line778")'> 778:         self._verbose =  state</pre>
<pre id='line778' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":778
 * 
 *     def set_verbose(self,bint state):
 *         self._verbose =  state             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_verbose = __pyx_v_state;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator_4_set_components(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line779")'> 779: </pre>
<pre id='line779' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line780")'> 780: </pre>
<pre id='line780' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line781")'> 781: </pre>
<pre id='line781' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line782")'> 782:     def _set_components(self,components):</pre>
<pre id='line782' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":782
 * 
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_components(components['ATOM'])
 *         self._simulation = <code><</code>EnsembleSimulation*><code><</code>size_t>int(components['SIMU'].this)
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_shift_calculator_4_set_components(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line783")'> 783:         self._bytes_to_components(components['ATOM'])</pre>
<pre id='line783' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":783
 * 
 *     def _set_components(self,components):
 *         self._bytes_to_components(components['ATOM'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = <code><</code>EnsembleSimulation*><code><</code>size_t>int(components['SIMU'].this)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_22);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__ATOM));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line784")'> 784:         self._simulation = &lt;EnsembleSimulation*&gt;&lt;size_t&gt;int(components['SIMU'].this)</pre>
<pre id='line784' class='code' style='background-color: #FFFF32'>
  /* "Cython_shift_calculator.pyx":784
 *     def _set_components(self,components):
 *         self._bytes_to_components(components['ATOM'])
 *         self._simulation = <code><</code>EnsembleSimulation*><code><</code>size_t>int(components['SIMU'].this)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__SIMU));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__this);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_simulation = ((EnsembleSimulation *)((size_t)__pyx_t_4));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line785")'> 785: </pre>
<pre id='line785' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line786")'> 786: </pre>
<pre id='line786' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line787")'> 787:     cdef inline int ensemble_size(self) nogil:</pre>
<pre id='line787' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":787
 * 
 * 
 *     cdef inline int ensemble_size(self) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._simulation[0].size()
 * 
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_size(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self) {
  int __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line788")'> 788:         return self._simulation[0].size()</pre>
<pre id='line788' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":788
 * 
 *     cdef inline int ensemble_size(self) nogil:
 *         return self._simulation[0].size()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline int ensemble_member_index(self) nogil:
 */
  __pyx_r = (__pyx_v_self->_simulation[0]).size();
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line789")'> 789: </pre>
<pre id='line789' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line790")'> 790:     cdef inline int ensemble_member_index(self) nogil:</pre>
<pre id='line790' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":790
 *         return self._simulation[0].size()
 * 
 *     cdef inline int ensemble_member_index(self) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._simulation[0].member()[0].memberIndex()
 * 
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_member_index(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self) {
  int __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line791")'> 791:         return self._simulation[0].member()[0].memberIndex()</pre>
<pre id='line791' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":791
 * 
 *     cdef inline int ensemble_member_index(self) nogil:
 *         return self._simulation[0].member()[0].memberIndex()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline int ensemble_array_offset(self,int index) nogil:
 */
  __pyx_r = ((__pyx_v_self->_simulation[0]).member()[0]).memberIndex();
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line792")'> 792: </pre>
<pre id='line792' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line793")'> 793:     cdef inline int ensemble_array_offset(self,int index) nogil:</pre>
<pre id='line793' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":793
 *         return self._simulation[0].member()[0].memberIndex()
 * 
 *     cdef inline int ensemble_array_offset(self,int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return (self.ensemble_size() * index) + self.ensemble_member_index()
 * 
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_array_offset(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  int __pyx_r;
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line794")'> 794:         return (self.ensemble_size() * index) + self.ensemble_member_index()</pre>
<pre id='line794' class='code' style='background-color: #FFFF3c'>
  /* "Cython_shift_calculator.pyx":794
 * 
 *     cdef inline int ensemble_array_offset(self,int index) nogil:
 *         return (self.ensemble_size() * index) + self.ensemble_member_index()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = ((__pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_size(__pyx_v_self) * __pyx_v_index) + __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_member_index(__pyx_v_self));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_simulation = 0;
  CYTHON_UNUSED PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 803; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 803; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_random_coil_shift_calculator.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line795")'> 795: </pre>
<pre id='line795' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line796")'> 796: </pre>
<pre id='line796' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line797")'> 797: cdef class Fast_random_coil_shift_calculator(Base_shift_calculator):</pre>
<pre id='line797' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":797
 * 
 * 
 * cdef class Fast_random_coil_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Random_coil_component* _compiled_components
 */
struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_Random_coil_component *_compiled_components;
  int _num_components;
  PyObject *_raw_data;
};


/* "Cython_shift_calculator.pyx":797
 * 
 * 
 * cdef class Fast_random_coil_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Random_coil_component* _compiled_components
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_random_coil_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  void (*calc)(struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *, __Pyx_memviewslice, __Pyx_memviewslice);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_random_coil_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_random_coil_shift_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line798")'> 798: </pre>
<pre id='line798' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line799")'> 799:     cdef Random_coil_component* _compiled_components</pre>
<pre id='line799' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line800")'> 800:     cdef int _num_components</pre>
<pre id='line800' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line801")'> 801:     cdef object _raw_data</pre>
<pre id='line801' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line802")'> 802: </pre>
<pre id='line802' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line803")'> 803:     def __cinit__(self, simulation,  str name = "not set"):</pre>
<pre id='line803' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":803
 *     cdef object _raw_data
 * 
 *     def __cinit__(self, simulation,  str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_data = None
 *         self._compiled_components  = NULL
 */

static int __pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_simulation, CYTHON_UNUSED PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line804")'> 804:         self._raw_data = None</pre>
<pre id='line804' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":804
 * 
 *     def __cinit__(self, simulation,  str name = "not set"):
 *         self._raw_data = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components  = NULL
 *         self._num_components =  0
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_data);
  __pyx_v_self->_raw_data = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line805")'> 805:         self._compiled_components  = NULL</pre>
<pre id='line805' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":805
 *     def __cinit__(self, simulation,  str name = "not set"):
 *         self._raw_data = None
 *         self._compiled_components  = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line806")'> 806:         self._num_components =  0</pre>
<pre id='line806' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":806
 *         self._raw_data = None
 *         self._compiled_components  = NULL
 *         self._num_components =  0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, simulation, str name = "not set"):
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_random_coil_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line807")'> 807: </pre>
<pre id='line807' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line808")'> 808:     def __init__(self, simulation, str name = "not set"):</pre>
<pre id='line808' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":808
 *         self._num_components =  0
 * 
 *     def __init__(self, simulation, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self, simulation, name)
 * 
 */

static int __pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *__pyx_v_self, PyObject *__pyx_v_simulation, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line809")'> 809:         Base_shift_calculator.__init__(self, simulation, name)</pre>
<pre id='line809' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":809
 * 
 *     def __init__(self, simulation, str name = "not set"):
 *         Base_shift_calculator.__init__(self, simulation, name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_simulation);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_simulation);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_simulation);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_random_coil_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator_4_bytes_to_components(((struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line810")'> 810: </pre>
<pre id='line810' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line811")'> 811: #</pre>
<pre id='line811' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line812")'> 812: #    TODO: this needs to be removed</pre>
<pre id='line812' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line813")'> 813:     def _bytes_to_components(self, data):</pre>
<pre id='line813' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":813
 * #
 * #    TODO: this needs to be removed
 *     def _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._raw_data =  data
 */

static PyObject *__pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator_4_bytes_to_components(struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line814")'> 814: </pre>
<pre id='line814' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line815")'> 815:         self._raw_data =  data</pre>
<pre id='line815' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":815
 *     def _bytes_to_components(self, data):
 * 
 *         self._raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components =  <code><</code>Random_coil_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Random_coil_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_data);
  __pyx_v_self->_raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line816")'> 816:         self._compiled_components =  &lt;Random_coil_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line816' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":816
 * 
 *         self._raw_data =  data
 *         self._compiled_components =  <code><</code>Random_coil_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Random_coil_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Random_coil_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line817")'> 817:         self._num_components =  len(data)/ sizeof(Random_coil_component)</pre>
<pre id='line817' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":817
 *         self._raw_data =  data
 *         self._compiled_components =  <code><</code>Random_coil_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Random_coil_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Random_coil_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_random_coil_shift_calculator._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_33Fast_random_coil_shift_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache = 0;
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_active_components = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__shift_cache,&__pyx_n_s__component_to_target,&__pyx_n_s__active_components,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__shift_cache)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_components)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_components = values[0];
    __pyx_v_shift_cache = ((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)values[1]);
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_active_components = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[3]);<span class='error_goto'> if (unlikely(!__pyx_v_active_components.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_random_coil_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_shift_cache), __pyx_ptype_17shift_calculators_CDSSharedVectorFloat, 1, "shift_cache", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line818")'> 818: </pre>
<pre id='line818' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line819")'> 819: </pre>
<pre id='line819' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line820")'> 820:     @cython.profile(False)</pre>
<pre id='line820' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line821")'> 821:     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components):</pre>
<pre id='line821' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":821
 * 
 *     @cython.profile(False)
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time = 0.0
 */

static PyObject *__pyx_pf_17shift_calculators_33Fast_random_coil_shift_calculator_6__call__(struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line822")'> 822: </pre>
<pre id='line822' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line823")'> 823:         cdef double start_time = 0.0</pre>
<pre id='line823' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":823
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components):
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line824")'> 824:         cdef double end_time = 0.0</pre>
<pre id='line824' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":824
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line825")'> 825: </pre>
<pre id='line825' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line826")'> 826: </pre>
<pre id='line826' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line827")'> 827:         if self._verbose:</pre>
<pre id='line827' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":827
 * 
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time=time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line828")'> 828:             start_time=time()</pre>
<pre id='line828' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":828
 * 
 *         if self._verbose:
 *             start_time=time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line829")'> 829: </pre>
<pre id='line829' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line830")'> 830:         self._set_components(components)</pre>
<pre id='line830' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":830
 *             start_time=time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.calc(shift_cache, component_to_target,  active_components)
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line831")'> 831:         self.calc(shift_cache, component_to_target,  active_components)</pre>
<pre id='line831' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":831
 * 
 *         self._set_components(components)
 *         self.calc(shift_cache, component_to_target,  active_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_random_coil_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->calc(__pyx_v_self, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line832")'> 832: </pre>
<pre id='line832' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line833")'> 833:         if self._verbose:</pre>
<pre id='line833' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":833
 *         self.calc(shift_cache, component_to_target,  active_components)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line834")'> 834:             end_time = time()</pre>
<pre id='line834' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":834
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line835")'> 835:             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"</pre>
<pre id='line835' class='code' style='background-color: #FFFF2d'>
    /* "Cython_shift_calculator.pyx":835
 *         if self._verbose:
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_24));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_24));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_24));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_random_coil_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_components, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line836")'> 836: </pre>
<pre id='line836' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line837")'> 837: </pre>
<pre id='line837' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line838")'> 838:     cdef void calc(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components) nogil:</pre>
<pre id='line838' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":838
 * 
 * 
 *     cdef void calc(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef CDSVector[double]  *results = shift_cache.get_data()
 */

static void __pyx_f_17shift_calculators_33Fast_random_coil_shift_calculator_calc(struct __pyx_obj_17shift_calculators_Fast_random_coil_shift_calculator *__pyx_v_self, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  CDSVector<code><</code>double> *__pyx_v_results;
  int __pyx_v_factor_index;
  int __pyx_v_component_index;
  int __pyx_v_offset;
  int __pyx_v_size;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line839")'> 839: </pre>
<pre id='line839' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line840")'> 840:         cdef CDSVector[double]  *results = shift_cache.get_data()</pre>
<pre id='line840' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":840
 *     cdef void calc(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components) nogil:
 * 
 *         cdef CDSVector[double]  *results = shift_cache.get_data()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_results = ((struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_shift_cache->__pyx_vtab)->get_data(__pyx_v_shift_cache);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line841")'> 841: </pre>
<pre id='line841' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line842")'> 842: </pre>
<pre id='line842' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line843")'> 843: </pre>
<pre id='line843' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line844")'> 844:         cdef int factor_index = 0</pre>
<pre id='line844' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":844
 * 
 * 
 *         cdef int factor_index = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int component_index
 *         cdef int offset
 */
  __pyx_v_factor_index = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line845")'> 845:         cdef int component_index</pre>
<pre id='line845' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line846")'> 846:         cdef int offset</pre>
<pre id='line846' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line847")'> 847: </pre>
<pre id='line847' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line848")'> 848:         #TODO: note to cython list for componnt_index in active_components produces awful code!</pre>
<pre id='line848' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line849")'> 849:         cdef int size = active_components.shape[0]</pre>
<pre id='line849' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":849
 * 
 *         #TODO: note to cython list for componnt_index in active_components produces awful code!
 *         cdef int size = active_components.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for factor_index in range(size):
 *             component_index = active_components[factor_index]
 */
  __pyx_v_size = (__pyx_v_active_components.shape[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line850")'> 850:         for factor_index in range(size):</pre>
<pre id='line850' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":850
 *         #TODO: note to cython list for componnt_index in active_components produces awful code!
 *         cdef int size = active_components.shape[0]
 *         for factor_index in range(size):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component_index = active_components[factor_index]
 * 
 */
  __pyx_t_1 = __pyx_v_size;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_factor_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line851")'> 851:             component_index = active_components[factor_index]</pre>
<pre id='line851' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":851
 *         cdef int size = active_components.shape[0]
 *         for factor_index in range(size):
 *             component_index = active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 */
    __pyx_t_3 = __pyx_v_factor_index;
    __pyx_v_component_index = (*((int *) ( /* dim=0 */ (__pyx_v_active_components.data + __pyx_t_3 * __pyx_v_active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line852")'> 852: </pre>
<pre id='line852' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line853")'> 853:             offset = self.ensemble_array_offset(component_to_target[factor_index])</pre>
<pre id='line853' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":853
 *             component_index = active_components[factor_index]
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             results[0][offset]  += self._compiled_components[component_index].shift
 * 
 */
    __pyx_t_4 = __pyx_v_factor_index;
    __pyx_v_offset = __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_array_offset(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_4 * __pyx_v_component_to_target.strides[0]) ))));
</pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line854")'> 854:             results[0][offset]  += self._compiled_components[component_index].shift</pre>
<pre id='line854' class='code' style='background-color: #FFFF32'>
    /* "Cython_shift_calculator.pyx":854
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 *             results[0][offset]  += self._compiled_components[component_index].shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_offset;
    ((__pyx_v_results[__pyx_t_5])[__pyx_t_6]) = (((__pyx_v_results[__pyx_t_5])[__pyx_t_6]) + (__pyx_v_self->_compiled_components[__pyx_v_component_index]).shift);
  }

}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_simulation = 0;
  CYTHON_UNUSED PyObject *__pyx_v_smoothed = 0;
  CYTHON_UNUSED PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_smoothed = values[1];
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line855")'> 855: </pre>
<pre id='line855' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line856")'> 856: </pre>
<pre id='line856' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line857")'> 857: cdef class Fast_distance_shift_calculator(Base_shift_calculator):</pre>
<pre id='line857' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":857
 * 
 * 
 * cdef class Fast_distance_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  int _target_atom_index;
  int _distance_atom_index_1;
  int _distance_atom_index_2;
  int _exponent_index;
  int _coefficient_index;
  int _smoothed;
  float _smoothing_factor;
  float _cutoff;
  struct __pyx_t_17shift_calculators_Distance_component *_compiled_components;
  int _num_components;
  PyObject *_raw_data;
};


/* "Cython_shift_calculator.pyx":857
 * 
 * 
 * cdef class Fast_distance_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_target_distant_atom (*_get_target_and_distant_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_coefficient_exponent (*_get_coefficient_and_exponent)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
  void (*calc)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *, __Pyx_memviewslice, __Pyx_memviewslice);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_distance_shift_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line858")'> 858: </pre>
<pre id='line858' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line859")'> 859: </pre>
<pre id='line859' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line860")'> 860:     cdef int _target_atom_index</pre>
<pre id='line860' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line861")'> 861:     cdef int _distance_atom_index_1</pre>
<pre id='line861' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line862")'> 862:     cdef int _distance_atom_index_2</pre>
<pre id='line862' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line863")'> 863:     cdef int _exponent_index</pre>
<pre id='line863' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line864")'> 864:     cdef int _coefficient_index</pre>
<pre id='line864' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line865")'> 865:     cdef bint _smoothed</pre>
<pre id='line865' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line866")'> 866:     cdef float _smoothing_factor</pre>
<pre id='line866' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line867")'> 867:     cdef float _cutoff</pre>
<pre id='line867' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line868")'> 868: </pre>
<pre id='line868' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line869")'> 869:     cdef Distance_component* _compiled_components</pre>
<pre id='line869' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line870")'> 870:     cdef int _num_components</pre>
<pre id='line870' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line871")'> 871:     cdef object _raw_data</pre>
<pre id='line871' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line872")'> 872: </pre>
<pre id='line872' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line873")'> 873:     def __cinit__(self, simulation, smoothed, str name = "not set"):</pre>
<pre id='line873' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":873
 *     cdef object _raw_data
 * 
 *     def __cinit__(self, simulation, smoothed, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_data = None
 *         self._compiled_components  = NULL
 */

static int __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_simulation, CYTHON_UNUSED PyObject *__pyx_v_smoothed, CYTHON_UNUSED PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line874")'> 874:         self._raw_data = None</pre>
<pre id='line874' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":874
 * 
 *     def __cinit__(self, simulation, smoothed, str name = "not set"):
 *         self._raw_data = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components  = NULL
 *         self._num_components =  0
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_data);
  __pyx_v_self->_raw_data = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line875")'> 875:         self._compiled_components  = NULL</pre>
<pre id='line875' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":875
 *     def __cinit__(self, simulation, smoothed, str name = "not set"):
 *         self._raw_data = None
 *         self._compiled_components  = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line876")'> 876:         self._num_components =  0</pre>
<pre id='line876' class='code' style='background-color: #FFFF31'>
  /* "Cython_shift_calculator.pyx":876
 *         self._raw_data = None
 *         self._compiled_components  = NULL
 *         self._num_components =  0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, simulation, smoothed, str name = "not set"):
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  PyObject *__pyx_v_smoothed = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_smoothed = values[1];
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line877")'> 877: </pre>
<pre id='line877' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line878")'> 878:     def __init__(self, simulation, smoothed, str name = "not set"):</pre>
<pre id='line878' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":878
 *         self._num_components =  0
 * 
 *     def __init__(self, simulation, smoothed, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self, simulation, name)
 * 
 */

static int __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_simulation, PyObject *__pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line879")'> 879:         Base_shift_calculator.__init__(self, simulation, name)</pre>
<pre id='line879' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":879
 * 
 *     def __init__(self, simulation, smoothed, str name = "not set"):
 *         Base_shift_calculator.__init__(self, simulation, name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._smoothed =  smoothed
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_simulation);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_simulation);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_simulation);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line880")'> 880: </pre>
<pre id='line880' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line881")'> 881:         self._smoothed =  smoothed</pre>
<pre id='line881' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":881
 *         Base_shift_calculator.__init__(self, simulation, name)
 * 
 *         self._smoothed =  smoothed             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 * #
 */
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 881; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_smoothed = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line882")'> 882:         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR</pre>
<pre id='line882' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":882
 * 
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         self._cutoff =  DEFAULT_CUTOFF
 */
  __pyx_v_self->_smoothing_factor = __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line883")'> 883: #</pre>
<pre id='line883' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line884")'> 884:         self._cutoff =  DEFAULT_CUTOFF</pre>
<pre id='line884' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":884
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 * #
 *         self._cutoff =  DEFAULT_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 * #    def set_cutoff(self, cutoff):
 */
  __pyx_v_self->_cutoff = __pyx_v_17shift_calculators_DEFAULT_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_4_bytes_to_components(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line885")'> 885: #</pre>
<pre id='line885' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line886")'> 886: #    def set_cutoff(self, cutoff):</pre>
<pre id='line886' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line887")'> 887: #        self._cutoff =  cutoff</pre>
<pre id='line887' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line888")'> 888: #</pre>
<pre id='line888' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line889")'> 889: #    def set_smoothing_factor(self,smoothing_factor):</pre>
<pre id='line889' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line890")'> 890: #        self._smoothing_factor = smoothing_factor</pre>
<pre id='line890' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line891")'> 891: #</pre>
<pre id='line891' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line892")'> 892: #    TODO: this needs to be removed</pre>
<pre id='line892' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line893")'> 893:     def _bytes_to_components(self, data):</pre>
<pre id='line893' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":893
 * #
 * #    TODO: this needs to be removed
 *     def _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._raw_data =  data
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_4_bytes_to_components(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line894")'> 894: </pre>
<pre id='line894' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line895")'> 895:         self._raw_data =  data</pre>
<pre id='line895' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":895
 *     def _bytes_to_components(self, data):
 * 
 *         self._raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components =  <code><</code>Distance_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Distance_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_data);
  __pyx_v_self->_raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line896")'> 896:         self._compiled_components =  &lt;Distance_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line896' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":896
 * 
 *         self._raw_data =  data
 *         self._compiled_components =  <code><</code>Distance_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Distance_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Distance_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line897")'> 897:         self._num_components =  len(data)/ sizeof(Distance_component)</pre>
<pre id='line897' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":897
 *         self._raw_data =  data
 *         self._compiled_components =  <code><</code>Distance_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Distance_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 897; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Distance_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line898")'> 898: </pre>
<pre id='line898' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line899")'> 899: </pre>
<pre id='line899' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line900")'> 900: </pre>
<pre id='line900' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line901")'> 901: </pre>
<pre id='line901' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line902")'> 902: </pre>
<pre id='line902' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line903")'> 903:     @cython.profile(False)</pre>
<pre id='line903' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line904")'> 904:     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index) nogil:</pre>
<pre id='line904' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":904
 * 
 *     @cython.profile(False)
 *     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef target_distant_atom result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_v_result;
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line905")'> 905:         cdef target_distant_atom result</pre>
<pre id='line905' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line906")'> 906: </pre>
<pre id='line906' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line907")'> 907:         result.target_atom_id = self._compiled_components[index].remote_atom_1</pre>
<pre id='line907' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":907
 *         cdef target_distant_atom result
 * 
 *         result.target_atom_id = self._compiled_components[index].remote_atom_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.distant_atom_id  = self._compiled_components[index].remote_atom_2
 *         return result
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1;
  __pyx_v_result.target_atom_id = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line908")'> 908:         result.distant_atom_id  = self._compiled_components[index].remote_atom_2</pre>
<pre id='line908' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":908
 * 
 *         result.target_atom_id = self._compiled_components[index].remote_atom_1
 *         result.distant_atom_id  = self._compiled_components[index].remote_atom_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2;
  __pyx_v_result.distant_atom_id = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line909")'> 909:         return result</pre>
<pre id='line909' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":909
 *         result.target_atom_id = self._compiled_components[index].remote_atom_1
 *         result.distant_atom_id  = self._compiled_components[index].remote_atom_2
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line910")'> 910: </pre>
<pre id='line910' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line911")'> 911:     @cython.profile(False)</pre>
<pre id='line911' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line912")'> 912:     cdef inline coefficient_exponent _get_coefficient_and_exponent(self, int index) nogil:</pre>
<pre id='line912' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":912
 * 
 *     @cython.profile(False)
 *     cdef inline coefficient_exponent _get_coefficient_and_exponent(self, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef coefficient_exponent result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_result;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line913")'> 913:         cdef coefficient_exponent result</pre>
<pre id='line913' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line914")'> 914: </pre>
<pre id='line914' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line915")'> 915: </pre>
<pre id='line915' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line916")'> 916:         result.coefficient = self._compiled_components[index].coefficient</pre>
<pre id='line916' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":916
 * 
 * 
 *         result.coefficient = self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.exponent = self._compiled_components[index].exponent
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient;
  __pyx_v_result.coefficient = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line917")'> 917:         result.exponent = self._compiled_components[index].exponent</pre>
<pre id='line917' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":917
 * 
 *         result.coefficient = self._compiled_components[index].coefficient
 *         result.exponent = self._compiled_components[index].exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).exponent;
  __pyx_v_result.exponent = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line918")'> 918: </pre>
<pre id='line918' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line919")'> 919:         return result</pre>
<pre id='line919' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":919
 *         result.exponent = self._compiled_components[index].exponent
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache = 0;
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_active_components = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__shift_cache,&__pyx_n_s__component_to_target,&__pyx_n_s__active_components,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__shift_cache)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_components)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_components = values[0];
    __pyx_v_shift_cache = ((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)values[1]);
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_active_components = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[3]);<span class='error_goto'> if (unlikely(!__pyx_v_active_components.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_shift_cache), __pyx_ptype_17shift_calculators_CDSSharedVectorFloat, 1, "shift_cache", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line920")'> 920: </pre>
<pre id='line920' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line921")'> 921:     @cython.profile(False)</pre>
<pre id='line921' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line922")'> 922:     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components):</pre>
<pre id='line922' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":922
 * 
 *     @cython.profile(False)
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_6__call__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line923")'> 923:         cdef double start_time = 0.0</pre>
<pre id='line923' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":923
 *     @cython.profile(False)
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components):
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line924")'> 924:         cdef double end_time = 0.0</pre>
<pre id='line924' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":924
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components):
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line925")'> 925: </pre>
<pre id='line925' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line926")'> 926:         if self._verbose:</pre>
<pre id='line926' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":926
 *         cdef double end_time = 0.0
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time=time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line927")'> 927:             start_time=time()</pre>
<pre id='line927' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":927
 * 
 *         if self._verbose:
 *             start_time=time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line928")'> 928: </pre>
<pre id='line928' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line929")'> 929:         self._set_components(components)</pre>
<pre id='line929' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":929
 *             start_time=time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.calc(shift_cache, component_to_target, active_components)
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line930")'> 930:         self.calc(shift_cache, component_to_target, active_components)</pre>
<pre id='line930' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":930
 * 
 *         self._set_components(components)
 *         self.calc(shift_cache, component_to_target, active_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->calc(__pyx_v_self, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line931")'> 931: </pre>
<pre id='line931' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line932")'> 932:         if self._verbose:</pre>
<pre id='line932' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":932
 *         self.calc(shift_cache, component_to_target, active_components)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line933")'> 933:             end_time = time()</pre>
<pre id='line933' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":933
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line934")'> 934:             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"</pre>
<pre id='line934' class='code' style='background-color: #FFFF2d'>
    /* "Cython_shift_calculator.pyx":934
 *         if self._verbose:
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void calc(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components) nogil:
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_24));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_24));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_24));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_components, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line935")'> 935: </pre>
<pre id='line935' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line936")'> 936:     cdef void calc(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components) nogil:</pre>
<pre id='line936' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":936
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 *     cdef void calc(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef CDSVector[double]  *results = shift_cache.get_data()
 * 
 */

static void __pyx_f_17shift_calculators_30Fast_distance_shift_calculator_calc(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  CDSVector<code><</code>double> *__pyx_v_results;
  float __pyx_v_smoothing_factor;
  float __pyx_v_ratio;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_coef_exp;
  int __pyx_v_target_atom_id;
  int __pyx_v_distant_atom_id;
  float __pyx_v_distance;
  int __pyx_v_factor_index;
  int __pyx_v_component_index;
  int __pyx_v_offset;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line937")'> 937:         cdef CDSVector[double]  *results = shift_cache.get_data()</pre>
<pre id='line937' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":937
 * 
 *     cdef void calc(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target,  int[:] active_components) nogil:
 *         cdef CDSVector[double]  *results = shift_cache.get_data()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_results = ((struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_shift_cache->__pyx_vtab)->get_data(__pyx_v_shift_cache);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line938")'> 938: </pre>
<pre id='line938' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line939")'> 939: </pre>
<pre id='line939' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line940")'> 940: </pre>
<pre id='line940' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line941")'> 941: </pre>
<pre id='line941' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line942")'> 942:         cdef float smoothing_factor = self._smoothing_factor</pre>
<pre id='line942' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":942
 * 
 * 
 *         cdef float smoothing_factor = self._smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float ratio
 *         cdef float result
 */
  __pyx_t_1 = __pyx_v_self->_smoothing_factor;
  __pyx_v_smoothing_factor = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line943")'> 943:         cdef float ratio</pre>
<pre id='line943' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line944")'> 944:         cdef float result</pre>
<pre id='line944' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line945")'> 945:         cdef coefficient_exponent coef_exp</pre>
<pre id='line945' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line946")'> 946:         cdef float coefficent</pre>
<pre id='line946' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line947")'> 947:         cdef float exponent</pre>
<pre id='line947' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line948")'> 948:         cdef int target_atom_id</pre>
<pre id='line948' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line949")'> 949:         cdef int distant_atom_id</pre>
<pre id='line949' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line950")'> 950:         cdef float distance</pre>
<pre id='line950' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line951")'> 951: </pre>
<pre id='line951' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line952")'> 952: </pre>
<pre id='line952' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line953")'> 953: </pre>
<pre id='line953' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line954")'> 954: </pre>
<pre id='line954' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line955")'> 955: </pre>
<pre id='line955' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line956")'> 956:         cdef int factor_index = 0</pre>
<pre id='line956' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":956
 * 
 * 
 *         cdef int factor_index = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int component_index
 *         cdef int offset
 */
  __pyx_v_factor_index = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line957")'> 957:         cdef int component_index</pre>
<pre id='line957' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line958")'> 958:         cdef int offset</pre>
<pre id='line958' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line959")'> 959: </pre>
<pre id='line959' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line960")'> 960:         #TODO: note to cython list for componnt_index in active_components produces awful code!</pre>
<pre id='line960' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line961")'> 961:         for factor_index in range(active_components.shape[0]):</pre>
<pre id='line961' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":961
 * 
 *         #TODO: note to cython list for componnt_index in active_components produces awful code!
 *         for factor_index in range(active_components.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component_index = active_components[factor_index]
 * 
 */
  __pyx_t_2 = (__pyx_v_active_components.shape[0]);
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_factor_index = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line962")'> 962:             component_index = active_components[factor_index]</pre>
<pre id='line962' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":962
 *         #TODO: note to cython list for componnt_index in active_components produces awful code!
 *         for factor_index in range(active_components.shape[0]):
 *             component_index = active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #             component = components[index]
 */
    __pyx_t_4 = __pyx_v_factor_index;
    __pyx_v_component_index = (*((int *) ( /* dim=0 */ (__pyx_v_active_components.data + __pyx_t_4 * __pyx_v_active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line963")'> 963: </pre>
<pre id='line963' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line964")'> 964: #             component = components[index]</pre>
<pre id='line964' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line965")'> 965: </pre>
<pre id='line965' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line966")'> 966: </pre>
<pre id='line966' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line967")'> 967:             target_atom_id = self._compiled_components[component_index].remote_atom_1</pre>
<pre id='line967' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":967
 * 
 * 
 *             target_atom_id = self._compiled_components[component_index].remote_atom_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distant_atom_id  = self._compiled_components[component_index].remote_atom_2
 * 
 */
    __pyx_t_5 = (__pyx_v_self->_compiled_components[__pyx_v_component_index]).remote_atom_1;
    __pyx_v_target_atom_id = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line968")'> 968:             distant_atom_id  = self._compiled_components[component_index].remote_atom_2</pre>
<pre id='line968' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":968
 * 
 *             target_atom_id = self._compiled_components[component_index].remote_atom_1
 *             distant_atom_id  = self._compiled_components[component_index].remote_atom_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = (__pyx_v_self->_compiled_components[__pyx_v_component_index]).remote_atom_2;
    __pyx_v_distant_atom_id = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line969")'> 969: </pre>
<pre id='line969' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line970")'> 970: </pre>
<pre id='line970' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line971")'> 971:             coef_exp = self._get_coefficient_and_exponent(component_index)</pre>
<pre id='line971' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":971
 * 
 * 
 *             coef_exp = self._get_coefficient_and_exponent(component_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 */
    __pyx_v_coef_exp = __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(__pyx_v_self, __pyx_v_component_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line972")'> 972:             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)</pre>
<pre id='line972' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":972
 * 
 *             coef_exp = self._get_coefficient_and_exponent(component_index)
 *             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 * 
 */
    __pyx_v_distance = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_target_atom_id, __pyx_v_distant_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line973")'> 973:     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)</pre>
<pre id='line973' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line974")'> 974: </pre>
<pre id='line974' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line975")'> 975:             if self._smoothed:</pre>
<pre id='line975' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":975
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 * 
 *             if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8
 */
    if (__pyx_v_self->_smoothed) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line976")'> 976:                 ratio = distance / self._cutoff</pre>
<pre id='line976' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":976
 * 
 *             if self._smoothed:
 *                 ratio = distance / self._cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 smoothing_factor = 1.0 - ratio ** 8
 * 
 */
      __pyx_v_ratio = (__pyx_v_distance / __pyx_v_self->_cutoff);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line977")'> 977:                 smoothing_factor = 1.0 - ratio ** 8</pre>
<pre id='line977' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":977
 *             if self._smoothed:
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 */
      __pyx_v_smoothing_factor = (1.0 - powf(__pyx_v_ratio, 8.0));
      goto __pyx_L5;
    }
    __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line978")'> 978: </pre>
<pre id='line978' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line979")'> 979:             offset = self.ensemble_array_offset(component_to_target[factor_index])</pre>
<pre id='line979' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":979
 *                 smoothing_factor = 1.0 - ratio ** 8
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             results[0][offset]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 */
    __pyx_t_5 = __pyx_v_factor_index;
    __pyx_v_offset = __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_array_offset(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_5 * __pyx_v_component_to_target.strides[0]) ))));
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line980")'> 980:             results[0][offset]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient</pre>
<pre id='line980' class='code' style='background-color: #FFFF3c'>
    /* "Cython_shift_calculator.pyx":980
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 *             results[0][offset]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_6 = 0;
    __pyx_t_7 = __pyx_v_offset;
    ((__pyx_v_results[__pyx_t_6])[__pyx_t_7]) = (((__pyx_v_results[__pyx_t_6])[__pyx_t_7]) + ((__pyx_v_smoothing_factor * pow(__pyx_v_distance, __pyx_v_coef_exp.exponent)) * __pyx_v_coef_exp.coefficient));
  }

}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_simulation = 0;
  CYTHON_UNUSED PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line981")'> 981: </pre>
<pre id='line981' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line982")'> 982: </pre>
<pre id='line982' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line983")'> 983: </pre>
<pre id='line983' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line984")'> 984: </pre>
<pre id='line984' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line985")'> 985: </pre>
<pre id='line985' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line986")'> 986: cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):</pre>
<pre id='line986' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":986
 * 
 * 
 * cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component *_compiled_components
 */
struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_Dihedral_component *_compiled_components;
  int _num_components;
  PyObject *_raw_data;
};


/* "Cython_shift_calculator.pyx":986
 * 
 * 
 * cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component *_compiled_components
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_dihedral_ids (*_get_dihedral_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_parameters (*_get_parameters)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  float (*_get_coefficient)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  void (*call)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *, __Pyx_memviewslice, __Pyx_memviewslice);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_dihedral_shift_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line987")'> 987: </pre>
<pre id='line987' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line988")'> 988:     cdef Dihedral_component *_compiled_components</pre>
<pre id='line988' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line989")'> 989:     cdef int _num_components</pre>
<pre id='line989' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line990")'> 990:     cdef object _raw_data</pre>
<pre id='line990' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line991")'> 991: </pre>
<pre id='line991' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line992")'> 992:     def __cinit__(self, simulation, str name = "not set"):</pre>
<pre id='line992' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":992
 *     cdef object _raw_data
 * 
 *     def __cinit__(self, simulation, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_data =  None
 *         self._compiled_components = NULL
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_simulation, CYTHON_UNUSED PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line993")'> 993:         self._raw_data =  None</pre>
<pre id='line993' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":993
 * 
 *     def __cinit__(self, simulation, str name = "not set"):
 *         self._raw_data =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_data);
  __pyx_v_self->_raw_data = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line994")'> 994:         self._compiled_components = NULL</pre>
<pre id='line994' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":994
 *     def __cinit__(self, simulation, str name = "not set"):
 *         self._raw_data =  None
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line995")'> 995:         self._num_components = 0</pre>
<pre id='line995' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":995
 *         self._raw_data =  None
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 998; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 998; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line996")'> 996: </pre>
<pre id='line996' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line997")'> 997: </pre>
<pre id='line997' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line998")'> 998:     def __init__(self, simulation, str name = "not set"):</pre>
<pre id='line998' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":998
 * 
 * 
 *     def __init__(self, simulation, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self, simulation, name)
 * 
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_simulation, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line999")'> 999:         Base_shift_calculator.__init__(self, simulation, name)</pre>
<pre id='line999' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":999
 * 
 *     def __init__(self, simulation, str name = "not set"):
 *         Base_shift_calculator.__init__(self, simulation, name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_simulation);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_simulation);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_simulation);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_4_bytes_to_components(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1000")'> 1000: </pre>
<pre id='line1000' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1001")'> 1001: </pre>
<pre id='line1001' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1002")'> 1002:     def  _bytes_to_components(self, data):</pre>
<pre id='line1002' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1002
 * 
 * 
 *     def  _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_data =  data
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_4_bytes_to_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1003")'> 1003:         self._raw_data =  data</pre>
<pre id='line1003' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1003
 * 
 *     def  _bytes_to_components(self, data):
 *         self._raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_data);
  __pyx_v_self->_raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1004")'> 1004: </pre>
<pre id='line1004' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1005")'> 1005:         self._compiled_components =  &lt;Dihedral_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1005' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1005
 *         self._raw_data =  data
 * 
 *         self._compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Dihedral_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Dihedral_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1006")'> 1006:         self._num_components =  len(data)/ sizeof(Dihedral_component)</pre>
<pre id='line1006' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1006
 * 
 *         self._compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Dihedral_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Dihedral_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1007")'> 1007: </pre>
<pre id='line1007' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1008")'> 1008: </pre>
<pre id='line1008' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1009")'> 1009: #     cdef inline _get_component(self,int index) nogil:</pre>
<pre id='line1009' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1010")'> 1010: #         return self._components[index]</pre>
<pre id='line1010' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1011")'> 1011: </pre>
<pre id='line1011' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1012")'> 1012:     @cython.profile(False)</pre>
<pre id='line1012' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1013")'> 1013:     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index) nogil:</pre>
<pre id='line1013' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1013
 * 
 *     @cython.profile(False)
 *     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1014")'> 1014:         cdef dihedral_ids result</pre>
<pre id='line1014' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1015")'> 1015: </pre>
<pre id='line1015' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1016")'> 1016:         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]</pre>
<pre id='line1016' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1016
 *         cdef dihedral_ids result
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 */
  __pyx_v_result.atom_id_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1017")'> 1017:         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]</pre>
<pre id='line1017' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1017
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 */
  __pyx_v_result.atom_id_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1018")'> 1018:         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]</pre>
<pre id='line1018' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1018
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 */
  __pyx_v_result.atom_id_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1019")'> 1019:         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]</pre>
<pre id='line1019' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1019
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_v_result.atom_id_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1020")'> 1020: </pre>
<pre id='line1020' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1021")'> 1021:         return result</pre>
<pre id='line1021' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1021
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline dihedral_parameters _get_parameters(self, int index) nogil:
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1022")'> 1022: </pre>
<pre id='line1022' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1023")'> 1023:     cdef inline dihedral_parameters _get_parameters(self, int index) nogil:</pre>
<pre id='line1023' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1023
 *         return result
 * 
 *     cdef inline dihedral_parameters _get_parameters(self, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_parameters result
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1024")'> 1024: </pre>
<pre id='line1024' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1025")'> 1025:         cdef dihedral_parameters result</pre>
<pre id='line1025' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1026")'> 1026: </pre>
<pre id='line1026' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1027")'> 1027:         result.param_0 = self._compiled_components[index].parameters[0]</pre>
<pre id='line1027' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1027
 *         cdef dihedral_parameters result
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 */
  __pyx_v_result.param_0 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1028")'> 1028:         result.param_1 = self._compiled_components[index].parameters[3]</pre>
<pre id='line1028' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1028
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 */
  __pyx_v_result.param_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1029")'> 1029:         result.param_2 = self._compiled_components[index].parameters[1]</pre>
<pre id='line1029' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1029
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]
 */
  __pyx_v_result.param_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1030")'> 1030:         result.param_3 = self._compiled_components[index].parameters[4]</pre>
<pre id='line1030' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1030
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_4 = self._compiled_components[index].parameters[2]
 * 
 */
  __pyx_v_result.param_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[4]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1031")'> 1031:         result.param_4 = self._compiled_components[index].parameters[2]</pre>
<pre id='line1031' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1031
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_result.param_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1032")'> 1032: </pre>
<pre id='line1032' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1033")'> 1033: </pre>
<pre id='line1033' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1034")'> 1034: </pre>
<pre id='line1034' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1035")'> 1035: </pre>
<pre id='line1035' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1036")'> 1036:         return result</pre>
<pre id='line1036' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1036
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1037")'> 1037: </pre>
<pre id='line1037' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1038")'> 1038:     @cython.profile(False)</pre>
<pre id='line1038' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1039")'> 1039:     cdef inline float _get_coefficient(self, int index) nogil:</pre>
<pre id='line1039' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1039
 * 
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._compiled_components[index].coefficient
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line1040")'> 1040:         return self._compiled_components[index].coefficient</pre>
<pre id='line1040' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":1040
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index) nogil:
 *         return self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache = 0;
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_active_components = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__shift_cache,&__pyx_n_s__component_to_target,&__pyx_n_s__active_components,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__shift_cache)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_components)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_components = values[0];
    __pyx_v_shift_cache = ((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)values[1]);
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_active_components = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[3]);<span class='error_goto'> if (unlikely(!__pyx_v_active_components.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_shift_cache), __pyx_ptype_17shift_calculators_CDSSharedVectorFloat, 1, "shift_cache", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1041")'> 1041: </pre>
<pre id='line1041' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1042")'> 1042:     @cython.profile(True)</pre>
<pre id='line1042' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1043")'> 1043:     #TODO: architecture different from force calculator no base function/class</pre>
<pre id='line1043' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1044")'> 1044:     #TODO: still uses component to result...</pre>
<pre id='line1044' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1045")'> 1045:     #TODO: add common force and shift base class</pre>
<pre id='line1045' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1046")'> 1046:     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):</pre>
<pre id='line1046' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1046
 *     #TODO: still uses component to result...
 *     #TODO: add common force and shift base class
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time = 0.0
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_6__call__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1046);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1047")'> 1047: </pre>
<pre id='line1047' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1048")'> 1048:         cdef double start_time = 0.0</pre>
<pre id='line1048' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1048
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1049")'> 1049:         cdef double end_time = 0.0</pre>
<pre id='line1049' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1049
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1050")'> 1050:         if self._verbose:</pre>
<pre id='line1050' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1050
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1051")'> 1051:             start_time = time()</pre>
<pre id='line1051' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1051
 *         cdef double end_time = 0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1052")'> 1052: </pre>
<pre id='line1052' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line1053")'> 1053:         self._set_components(components)</pre>
<pre id='line1053' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":1053
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.call(shift_cache, component_to_target, active_components)
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1053; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1053; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1053; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1054")'> 1054:         self.call(shift_cache, component_to_target, active_components)</pre>
<pre id='line1054' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1054
 * 
 *         self._set_components(components)
 *         self.call(shift_cache, component_to_target, active_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->call(__pyx_v_self, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1055")'> 1055: </pre>
<pre id='line1055' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1056")'> 1056:         if self._verbose:</pre>
<pre id='line1056' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1056
 *         self.call(shift_cache, component_to_target, active_components)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1057")'> 1057:             end_time = time()</pre>
<pre id='line1057' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1057
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line1058")'> 1058:             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1058' class='code' style='background-color: #FFFF2d'>
    /* "Cython_shift_calculator.pyx":1058
 *         if self._verbose:
 *             end_time = time()
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_26));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_26));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_26));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_components, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1059")'> 1059: </pre>
<pre id='line1059' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1060")'> 1060: </pre>
<pre id='line1060' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1061")'> 1061:     cdef void call(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:</pre>
<pre id='line1061' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1061
 * 
 * 
 *     cdef void call(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef CDSVector[double]  *results = shift_cache.get_data()
 * 
 */

static void __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator_call(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  CDSVector<code><</code>double> *__pyx_v_results;
  float __pyx_v_angle;
  float __pyx_v_angle_term;
  float __pyx_v_shift;
  float __pyx_v_coefficient;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_parameters;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids;
  int __pyx_v_factor_index;
  int __pyx_v_component_index;
  int __pyx_v_offset;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1062")'> 1062:         cdef CDSVector[double]  *results = shift_cache.get_data()</pre>
<pre id='line1062' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1062
 * 
 *     cdef void call(self, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:
 *         cdef CDSVector[double]  *results = shift_cache.get_data()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_results = ((struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_shift_cache->__pyx_vtab)->get_data(__pyx_v_shift_cache);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1063")'> 1063: </pre>
<pre id='line1063' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1064")'> 1064: </pre>
<pre id='line1064' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1065")'> 1065:         cdef float angle</pre>
<pre id='line1065' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1066")'> 1066:         cdef float angle_term</pre>
<pre id='line1066' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1067")'> 1067:         cdef float shift</pre>
<pre id='line1067' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1068")'> 1068:         cdef float coefficient</pre>
<pre id='line1068' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1069")'> 1069:         cdef dihedral_parameters parameters</pre>
<pre id='line1069' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1070")'> 1070:         cdef dihedral_ids dihedral_atom_ids</pre>
<pre id='line1070' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1071")'> 1071: </pre>
<pre id='line1071' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1072")'> 1072:         cdef int factor_index</pre>
<pre id='line1072' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1073")'> 1073:         cdef int component_index</pre>
<pre id='line1073' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1074")'> 1074:         cdef int offset</pre>
<pre id='line1074' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1075")'> 1075: </pre>
<pre id='line1075' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1076")'> 1076:         for factor_index in range(active_components.shape[0]):</pre>
<pre id='line1076' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1076
 *         cdef int offset
 * 
 *         for factor_index in range(active_components.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component_index = active_components[factor_index]
 * 
 */
  __pyx_t_1 = (__pyx_v_active_components.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_factor_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1077")'> 1077:             component_index = active_components[factor_index]</pre>
<pre id='line1077' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1077
 * 
 *         for factor_index in range(active_components.shape[0]):
 *             component_index = active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(component_index)
 */
    __pyx_t_3 = __pyx_v_factor_index;
    __pyx_v_component_index = (*((int *) ( /* dim=0 */ (__pyx_v_active_components.data + __pyx_t_3 * __pyx_v_active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1078")'> 1078: </pre>
<pre id='line1078' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1079")'> 1079:             dihedral_atom_ids = self._get_dihedral_atom_ids(component_index)</pre>
<pre id='line1079' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1079
 *             component_index = active_components[factor_index]
 * 
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(component_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             coefficient = self._get_coefficient(component_index)
 */
    __pyx_v_dihedral_atom_ids = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_component_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1080")'> 1080: </pre>
<pre id='line1080' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1081")'> 1081:             coefficient = self._get_coefficient(component_index)</pre>
<pre id='line1081' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1081
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(component_index)
 * 
 *             coefficient = self._get_coefficient(component_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             parameters = self._get_parameters(component_index)
 */
    __pyx_v_coefficient = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(__pyx_v_self, __pyx_v_component_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1082")'> 1082: </pre>
<pre id='line1082' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1083")'> 1083:             parameters = self._get_parameters(component_index)</pre>
<pre id='line1083' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1083
 *             coefficient = self._get_coefficient(component_index)
 * 
 *             parameters = self._get_parameters(component_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)
 */
    __pyx_v_parameters = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(__pyx_v_self, __pyx_v_component_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1084")'> 1084: </pre>
<pre id='line1084' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1085")'> 1085:             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)</pre>
<pre id='line1085' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1085
 *             parameters = self._get_parameters(component_index)
 * 
 *             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \
 */
    __pyx_v_angle = __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_dihedral_atom_ids);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1086")'> 1086: </pre>
<pre id='line1086' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1087")'> 1087:             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \</pre>
<pre id='line1087' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1088")'> 1088:                          parameters.param_2 * cos(angle +  parameters.param_3) +      \</pre>
<pre id='line1088' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1089")'> 1089:                          parameters.param_4</pre>
<pre id='line1089' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1089
 *             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \
 *                          parameters.param_2 * cos(angle +  parameters.param_3) +      \
 *                          parameters.param_4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             shift = coefficient * angle_term
 * 
 */
    __pyx_v_angle_term = (((__pyx_v_parameters.param_0 * cos(((3.0 * __pyx_v_angle) + __pyx_v_parameters.param_1))) + (__pyx_v_parameters.param_2 * cos((__pyx_v_angle + __pyx_v_parameters.param_3)))) + __pyx_v_parameters.param_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1090")'> 1090:             shift = coefficient * angle_term</pre>
<pre id='line1090' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1090
 *                          parameters.param_2 * cos(angle +  parameters.param_3) +      \
 *                          parameters.param_4
 *             shift = coefficient * angle_term             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 */
    __pyx_v_shift = (__pyx_v_coefficient * __pyx_v_angle_term);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1091")'> 1091: </pre>
<pre id='line1091' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1092")'> 1092:             offset = self.ensemble_array_offset(component_to_target[factor_index])</pre>
<pre id='line1092' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1092
 *             shift = coefficient * angle_term
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             results[0][offset] += shift
 * 
 */
    __pyx_t_4 = __pyx_v_factor_index;
    __pyx_v_offset = __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_array_offset(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_4 * __pyx_v_component_to_target.strides[0]) ))));
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line1093")'> 1093:             results[0][offset] += shift</pre>
<pre id='line1093' class='code' style='background-color: #FFFF3c'>
    /* "Cython_shift_calculator.pyx":1093
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 *             results[0][offset] += shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_offset;
    ((__pyx_v_results[__pyx_t_5])[__pyx_t_6]) = (((__pyx_v_results[__pyx_t_5])[__pyx_t_6]) + __pyx_v_shift);
  }

}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_simulation = 0;
  CYTHON_UNUSED PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1111; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1111; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1094")'> 1094: </pre>
<pre id='line1094' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1095")'> 1095: </pre>
<pre id='line1095' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1096")'> 1096: cdef class Fast_ring_shift_calculator(Base_shift_calculator):</pre>
<pre id='line1096' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1096
 * 
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3_list _centre_cache
 *     cdef Vec3_list _normal_cache
 */
struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  struct __pyx_obj_17shift_calculators_Vec3_list *_centre_cache;
  struct __pyx_obj_17shift_calculators_Vec3_list *_normal_cache;
  struct __pyx_t_17shift_calculators_Ring_target_component *_compiled_components;
  int _num_components;
  PyObject *raw_data;
  struct __pyx_t_17shift_calculators_Ring_component *_compiled_ring_components;
  int _num_ring_components;
  PyObject *_raw_ring_component_data;
  struct __pyx_obj_17shift_calculators_Coef_components *_compiled_coef_components;
};


/* "Cython_shift_calculator.pyx":1096
 * 
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3_list _centre_cache
 *     cdef Vec3_list _normal_cache
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  void (*_bytes_to_ring_components)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, PyObject *);
  Vec3 *(*_get_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
  Vec3 *(*_get_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
  float (*_calc_sub_component_shift)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int, int, float);
  void (*calc)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *, __Pyx_memviewslice, __Pyx_memviewslice);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_shift_calculator;
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1097")'> 1097:     cdef Vec3_list _centre_cache</pre>
<pre id='line1097' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1098")'> 1098:     cdef Vec3_list _normal_cache</pre>
<pre id='line1098' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1099")'> 1099: </pre>
<pre id='line1099' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1100")'> 1100:     cdef Ring_target_component* _compiled_components</pre>
<pre id='line1100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1101")'> 1101:     cdef int _num_components</pre>
<pre id='line1101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1102")'> 1102:     cdef object raw_data</pre>
<pre id='line1102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1103")'> 1103: </pre>
<pre id='line1103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1104")'> 1104:     cdef Ring_component* _compiled_ring_components</pre>
<pre id='line1104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1105")'> 1105:     cdef int _num_ring_components</pre>
<pre id='line1105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1106")'> 1106:     cdef object _raw_ring_component_data</pre>
<pre id='line1106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1107")'> 1107: </pre>
<pre id='line1107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1108")'> 1108: </pre>
<pre id='line1108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1109")'> 1109:     cdef Coef_components _compiled_coef_components</pre>
<pre id='line1109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1110")'> 1110: </pre>
<pre id='line1110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1111")'> 1111:     def __cinit__(self, simulation, str name = "not set"):</pre>
<pre id='line1111' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1111
 *     cdef Coef_components _compiled_coef_components
 * 
 *     def __cinit__(self, simulation, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.raw_data = None
 *         self._compiled_components = NULL
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_simulation, CYTHON_UNUSED PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1112")'> 1112:         self.raw_data = None</pre>
<pre id='line1112' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1112
 * 
 *     def __cinit__(self, simulation, str name = "not set"):
 *         self.raw_data = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->raw_data);
  __pyx_v_self->raw_data = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1113")'> 1113:         self._compiled_components = NULL</pre>
<pre id='line1113' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1113
 *     def __cinit__(self, simulation, str name = "not set"):
 *         self.raw_data = None
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1114")'> 1114:         self._num_components = 0</pre>
<pre id='line1114' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1114
 *         self.raw_data = None
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_ring_components = NULL
 */
  __pyx_v_self->_num_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1115")'> 1115: </pre>
<pre id='line1115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1116")'> 1116:         self._compiled_ring_components = NULL</pre>
<pre id='line1116' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1116
 *         self._num_components = 0
 * 
 *         self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = 0
 *         self._raw_ring_component_data = None
 */
  __pyx_v_self->_compiled_ring_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1117")'> 1117:         self._num_ring_components = 0</pre>
<pre id='line1117' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1117
 * 
 *         self._compiled_ring_components = NULL
 *         self._num_ring_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_ring_component_data = None
 * 
 */
  __pyx_v_self->_num_ring_components = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1118")'> 1118:         self._raw_ring_component_data = None</pre>
<pre id='line1118' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1118
 *         self._compiled_ring_components = NULL
 *         self._num_ring_components = 0
 *         self._raw_ring_component_data = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_ring_component_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_ring_component_data);
  __pyx_v_self->_raw_ring_component_data = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1119")'> 1119: </pre>
<pre id='line1119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1120")'> 1120:         #note this is not a raw array of structs it's a compiled python class</pre>
<pre id='line1120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1121")'> 1121:         self._compiled_coef_components = None</pre>
<pre id='line1121' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1121
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 *         self._compiled_coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._centre_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)Py_None);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1122")'> 1122: </pre>
<pre id='line1122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1123")'> 1123:         self._centre_cache = None</pre>
<pre id='line1123' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1123
 *         self._compiled_coef_components = None
 * 
 *         self._centre_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = None
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);
</pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line1124")'> 1124:         self._normal_cache = None</pre>
<pre id='line1124' class='code' style='background-color: #FFFF38'>
  /* "Cython_shift_calculator.pyx":1124
 * 
 *         self._centre_cache = None
 *         self._normal_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, simulation, str name = "not set"):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1125")'> 1125: </pre>
<pre id='line1125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1126")'> 1126:     def __init__(self, simulation, str name = "not set"):</pre>
<pre id='line1126' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1126
 *         self._normal_cache = None
 * 
 *     def __init__(self, simulation, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self,simulation, name)
 * 
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_simulation, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line1127")'> 1127:         Base_shift_calculator.__init__(self,simulation, name)</pre>
<pre id='line1127' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":1127
 * 
 *     def __init__(self, simulation, str name = "not set"):
 *         Base_shift_calculator.__init__(self,simulation, name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _bytes_to_components(self, data):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_simulation);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_simulation);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_simulation);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_4_bytes_to_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1128")'> 1128: </pre>
<pre id='line1128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1129")'> 1129:     def _bytes_to_components(self, data):</pre>
<pre id='line1129' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1129
 *         Base_shift_calculator.__init__(self,simulation, name)
 * 
 *     def _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_4_bytes_to_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1130")'> 1130:         self.raw_data =  data</pre>
<pre id='line1130' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1130
 * 
 *     def _bytes_to_components(self, data):
 *         self.raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Ring_target_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->raw_data);
  __pyx_v_self->raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1131")'> 1131:         self._compiled_components =  &lt;Ring_target_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1131' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1131
 *     def _bytes_to_components(self, data):
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Ring_target_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Ring_target_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1132")'> 1132:         self._num_components =  len(data)/ sizeof(Ring_target_component)</pre>
<pre id='line1132' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1132
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Ring_target_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Ring_target_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_7_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_7_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_6_set_normal_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_normals));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1133")'> 1133: </pre>
<pre id='line1133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1134")'> 1134: </pre>
<pre id='line1134' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1135")'> 1135: </pre>
<pre id='line1135' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1136")'> 1136: </pre>
<pre id='line1136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1137")'> 1137: </pre>
<pre id='line1137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1138")'> 1138:     def _set_normal_cache(self,normals):</pre>
<pre id='line1138' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1138
 * 
 * 
 *     def _set_normal_cache(self,normals):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_6_set_normal_cache(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1139")'> 1139:         self._normal_cache = &lt;Vec3_list&gt; normals</pre>
<pre id='line1139' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1139
 * 
 *     def _set_normal_cache(self,normals):
 *         self._normal_cache = <code><</code>Vec3_list> normals             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_centre_cache(self,centres):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_9_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_9_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_8_set_centre_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_centres));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1140")'> 1140: </pre>
<pre id='line1140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1141")'> 1141:     def _set_centre_cache(self,centres):</pre>
<pre id='line1141' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1141
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 *     def _set_centre_cache(self,centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = <code><</code>Vec3_list> centres
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_8_set_centre_cache(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache", 0);
</pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line1142")'> 1142:         self._centre_cache = &lt;Vec3_list&gt; centres</pre>
<pre id='line1142' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":1142
 * 
 *     def _set_centre_cache(self,centres):
 *         self._centre_cache = <code><</code>Vec3_list> centres             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_coef_components(self,coef_components, component_offsets):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_11_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_11_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_coef_components = 0;
  PyObject *__pyx_v_component_offsets = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__coef_components,&__pyx_n_s__component_offsets,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coef_components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_offsets)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_set_coef_components", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_set_coef_components") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_coef_components = values[0];
    __pyx_v_component_offsets = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_set_coef_components", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._set_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_10_set_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_coef_components, __pyx_v_component_offsets);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1143")'> 1143: </pre>
<pre id='line1143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1144")'> 1144:     def _set_coef_components(self,coef_components, component_offsets):</pre>
<pre id='line1144' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1144
 *         self._centre_cache = <code><</code>Vec3_list> centres
 * 
 *     def _set_coef_components(self,coef_components, component_offsets):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coef_components = Coef_components(coef_components, component_offsets)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_10_set_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_coef_components, PyObject *__pyx_v_component_offsets) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1145")'> 1145:         self._compiled_coef_components = Coef_components(coef_components, component_offsets)</pre>
<pre id='line1145' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":1145
 * 
 *     def _set_coef_components(self,coef_components, component_offsets):
 *         self._compiled_coef_components = Coef_components(coef_components, component_offsets)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _bytes_to_ring_components(self, data):
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_component_offsets);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_component_offsets);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_component_offsets);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Coef_components)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_t_2);
  __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._set_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1146")'> 1146: </pre>
<pre id='line1146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1147")'> 1147:     cdef void _bytes_to_ring_components(self, data):</pre>
<pre id='line1147' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1147
 *         self._compiled_coef_components = Coef_components(coef_components, component_offsets)
 * 
 *     cdef void _bytes_to_ring_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_ring_component_data =  data
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)
 */

static void __pyx_f_17shift_calculators_26Fast_ring_shift_calculator__bytes_to_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1148")'> 1148:         self._raw_ring_component_data =  data</pre>
<pre id='line1148' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1148
 * 
 *     cdef void _bytes_to_ring_components(self, data):
 *         self._raw_ring_component_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_ring_components =  len(data)/ sizeof(Ring_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_ring_component_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_ring_component_data);
  __pyx_v_self->_raw_ring_component_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1149")'> 1149:         self._compiled_ring_components =  &lt;Ring_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1149' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1149
 *     cdef void _bytes_to_ring_components(self, data):
 *         self._raw_ring_component_data =  data
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components =  len(data)/ sizeof(Ring_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_ring_components = ((struct __pyx_t_17shift_calculators_Ring_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1150")'> 1150:         self._num_ring_components =  len(data)/ sizeof(Ring_component)</pre>
<pre id='line1150' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1150
 *         self._raw_ring_component_data =  data
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_ring_components =  len(data)/ sizeof(Ring_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_ring_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Ring_component)));

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_shift_calculator._bytes_to_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_12_set_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1151")'> 1151: </pre>
<pre id='line1151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1152")'> 1152: </pre>
<pre id='line1152' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1153")'> 1153:     #TODO: not needed ?</pre>
<pre id='line1153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1154")'> 1154:     def _set_ring_components(self,ring_components):</pre>
<pre id='line1154' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1154
 * 
 *     #TODO: not needed ?
 *     def _set_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self. _bytes_to_ring_components(ring_components)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_12_set_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1155")'> 1155:         self. _bytes_to_ring_components(ring_components)</pre>
<pre id='line1155' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1155
 *     #TODO: not needed ?
 *     def _set_ring_components(self,ring_components):
 *         self. _bytes_to_ring_components(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_bytes_to_ring_components(__pyx_v_self, __pyx_v_ring_components);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1156")'> 1156: </pre>
<pre id='line1156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1157")'> 1157: </pre>
<pre id='line1157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1158")'> 1158: </pre>
<pre id='line1158' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1159")'> 1159:     @cython.profile(False)</pre>
<pre id='line1159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1160")'> 1160:     cdef inline Vec3* _get_ring_normal(self, int ring_id) nogil:</pre>
<pre id='line1160' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1160
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._normal_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1161")'> 1161:         return  self._normal_cache.get(ring_id)</pre>
<pre id='line1161' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1161
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id) nogil:
 *         return  self._normal_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_normal_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1162")'> 1162: </pre>
<pre id='line1162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1163")'> 1163:     @cython.profile(False)</pre>
<pre id='line1163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1164")'> 1164:     cdef inline Vec3* _get_ring_centre(self, int ring_id) nogil:</pre>
<pre id='line1164' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1164
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._centre_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1165")'> 1165:         return  self._centre_cache.get(ring_id)</pre>
<pre id='line1165' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1165
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id) nogil:
 *         return  self._centre_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient) nogil:
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_centre_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1166")'> 1166: </pre>
<pre id='line1166' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1167")'> 1167:     cdef float _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient) nogil:</pre>
<pre id='line1167' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1167
 *         return  self._centre_cache.get(ring_id)
 * 
 *     cdef float _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_atom_pos
 */

static float __pyx_f_17shift_calculators_26Fast_ring_shift_calculator__calc_sub_component_shift(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id, float __pyx_v_coefficient) {
  Vec3 __pyx_v_target_atom_pos;
  Vec3 __pyx_v_ring_centre;
  Vec3 __pyx_v_ring_normal;
  float __pyx_v_length_normal;
  Vec3 __pyx_v_direction_vector;
  float __pyx_v_distance;
  float __pyx_v_distance3;
  float __pyx_v_angle;
  float __pyx_v_contrib;
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1168")'> 1168: </pre>
<pre id='line1168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1169")'> 1169:         cdef Vec3 target_atom_pos</pre>
<pre id='line1169' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1170")'> 1170:         cdef Vec3 ring_centre</pre>
<pre id='line1170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1171")'> 1171:         cdef Vec3 ring_normal</pre>
<pre id='line1171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1172")'> 1172:         cdef float length_normal</pre>
<pre id='line1172' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1173")'> 1173:         cdef Vec3 direction_vector</pre>
<pre id='line1173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1174")'> 1174:         cdef float distance, distance3, angle, contrib</pre>
<pre id='line1174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1175")'> 1175: </pre>
<pre id='line1175' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1176")'> 1176:         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)</pre>
<pre id='line1176' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1176
 *         cdef float distance, distance3, angle, contrib
 * 
 *         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         ring_centre = self._get_ring_centre(ring_id)[0]
 * 
 */
  __pyx_v_target_atom_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1177")'> 1177:         ring_centre = self._get_ring_centre(ring_id)[0]</pre>
<pre id='line1177' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1177
 * 
 *         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)
 *         ring_centre = self._get_ring_centre(ring_id)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #TODO add this to a cache the same way that camshift does
 */
  __pyx_v_ring_centre = (__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_centre(__pyx_v_self, __pyx_v_ring_id)[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1178")'> 1178: </pre>
<pre id='line1178' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1179")'> 1179:         #TODO add this to a cache the same way that camshift does</pre>
<pre id='line1179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1180")'> 1180:         ring_normal = self._get_ring_normal(ring_id)[0]</pre>
<pre id='line1180' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1180
 * 
 *         #TODO add this to a cache the same way that camshift does
 *         ring_normal = self._get_ring_normal(ring_id)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         length_normal = norm(ring_normal)
 * #
 */
  __pyx_v_ring_normal = (__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_normal(__pyx_v_self, __pyx_v_ring_id)[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1181")'> 1181:         length_normal = norm(ring_normal)</pre>
<pre id='line1181' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1181
 *         #TODO add this to a cache the same way that camshift does
 *         ring_normal = self._get_ring_normal(ring_id)[0]
 *         length_normal = norm(ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         #correct name?
 */
  __pyx_v_length_normal = norm(__pyx_v_ring_normal);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1182")'> 1182: #</pre>
<pre id='line1182' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1183")'> 1183:         #correct name?</pre>
<pre id='line1183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1184")'> 1184:         direction_vector = target_atom_pos - ring_centre</pre>
<pre id='line1184' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1184
 * #
 *         #correct name?
 *         direction_vector = target_atom_pos - ring_centre             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         distance = norm(direction_vector)
 */
  __pyx_v_direction_vector = (__pyx_v_target_atom_pos - __pyx_v_ring_centre);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1185")'> 1185: </pre>
<pre id='line1185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1186")'> 1186:         distance = norm(direction_vector)</pre>
<pre id='line1186' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1186
 *         direction_vector = target_atom_pos - ring_centre
 * 
 *         distance = norm(direction_vector)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distance3 = distance ** 3
 * 
 */
  __pyx_v_distance = norm(__pyx_v_direction_vector);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1187")'> 1187:         distance3 = distance ** 3</pre>
<pre id='line1187' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1187
 * 
 *         distance = norm(direction_vector)
 *         distance3 = distance ** 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)
 */
  __pyx_v_distance3 = powf(__pyx_v_distance, 3.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1188")'> 1188: </pre>
<pre id='line1188' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1189")'> 1189:         angle = dot(direction_vector, ring_normal) / (distance * length_normal)</pre>
<pre id='line1189' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1189
 *         distance3 = distance ** 3
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3
 * 
 */
  __pyx_v_angle = (dot(__pyx_v_direction_vector, __pyx_v_ring_normal) / (__pyx_v_distance * __pyx_v_length_normal));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1190")'> 1190:         contrib = (1.0 - 3.0 * angle ** 2) / distance3</pre>
<pre id='line1190' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1190
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return contrib * coefficient
 */
  __pyx_v_contrib = ((1.0 - (3.0 * powf(__pyx_v_angle, 2.0))) / __pyx_v_distance3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1191")'> 1191: </pre>
<pre id='line1191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line1192")'> 1192:         return contrib * coefficient</pre>
<pre id='line1192' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":1192
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3
 * 
 *         return contrib * coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = (__pyx_v_contrib * __pyx_v_coefficient);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_15__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_15__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache = 0;
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_active_components = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__shift_cache,&__pyx_n_s__component_to_target,&__pyx_n_s__active_components,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__shift_cache)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_components)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_components = values[0];
    __pyx_v_shift_cache = ((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)values[1]);
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_active_components = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[3]);<span class='error_goto'> if (unlikely(!__pyx_v_active_components.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_shift_cache), __pyx_ptype_17shift_calculators_CDSSharedVectorFloat, 1, "shift_cache", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_14__call__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1193")'> 1193: </pre>
<pre id='line1193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1194")'> 1194:     @cython.profile(True)</pre>
<pre id='line1194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1195")'> 1195:     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):</pre>
<pre id='line1195' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1195
 * 
 *     @cython.profile(True)
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time = 0.0
 *         cdef double end_time =0.0
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_14__call__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1195);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1196")'> 1196:         cdef double start_time = 0.0</pre>
<pre id='line1196' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1196
 *     @cython.profile(True)
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1197")'> 1197:         cdef double end_time =0.0</pre>
<pre id='line1197' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1197
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):
 *         cdef double start_time = 0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1198")'> 1198: </pre>
<pre id='line1198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1199")'> 1199:         if self._verbose:</pre>
<pre id='line1199' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1199
 *         cdef double end_time =0.0
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1200")'> 1200:             start_time = time()</pre>
<pre id='line1200' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1200
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1201")'> 1201: </pre>
<pre id='line1201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line1202")'> 1202:         self._set_components(components)</pre>
<pre id='line1202' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":1202
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.calc(shift_cache, component_to_target, active_components)
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1203")'> 1203:         self.calc(shift_cache, component_to_target, active_components)</pre>
<pre id='line1203' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1203
 * 
 *         self._set_components(components)
 *         self.calc(shift_cache, component_to_target, active_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->calc(__pyx_v_self, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1204")'> 1204: </pre>
<pre id='line1204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1205")'> 1205:         if self._verbose:</pre>
<pre id='line1205' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1205
 *         self.calc(shift_cache, component_to_target, active_components)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1206")'> 1206:             end_time = time()</pre>
<pre id='line1206' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1206
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line1207")'> 1207:             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1207' class='code' style='background-color: #FFFF2b'>
    /* "Cython_shift_calculator.pyx":1207
 *         if self._verbose:
 *             end_time = time()
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_27));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_27));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_27));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_components, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1208")'> 1208: </pre>
<pre id='line1208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1209")'> 1209: </pre>
<pre id='line1209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1210")'> 1210:     cdef void calc (self, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:</pre>
<pre id='line1210' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1210
 * 
 * 
 *     cdef void calc (self, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef CDSVector[double]  *results = shift_cache.get_data()
 *         cdef int target_atom_id
 */

static void __pyx_f_17shift_calculators_26Fast_ring_shift_calculator_calc(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  CDSVector<code><</code>double> *__pyx_v_results;
  int __pyx_v_target_atom_id;
  int __pyx_v_atom_type_id;
  int __pyx_v_ring_id;
  float __pyx_v_coefficient;
  struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_v_coeff_offset;
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component;
  int __pyx_v_factor_index;
  int __pyx_v_component_index;
  int __pyx_v_offset;
  double __pyx_v_shift;
  int __pyx_v_coef_offset;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1211")'> 1211:         cdef CDSVector[double]  *results = shift_cache.get_data()</pre>
<pre id='line1211' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1211
 * 
 *     cdef void calc (self, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:
 *         cdef CDSVector[double]  *results = shift_cache.get_data()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int target_atom_id
 *         cdef int atom_type_id
 */
  __pyx_v_results = ((struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_shift_cache->__pyx_vtab)->get_data(__pyx_v_shift_cache);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1212")'> 1212:         cdef int target_atom_id</pre>
<pre id='line1212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1213")'> 1213:         cdef int atom_type_id</pre>
<pre id='line1213' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1214")'> 1214:         cdef int ring_id</pre>
<pre id='line1214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1215")'> 1215:         cdef float coefficient</pre>
<pre id='line1215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1216")'> 1216:         cdef Component_Offsets* coeff_offset</pre>
<pre id='line1216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1217")'> 1217:         cdef Coef_component* coef_component</pre>
<pre id='line1217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1218")'> 1218: </pre>
<pre id='line1218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1219")'> 1219: </pre>
<pre id='line1219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1220")'> 1220: </pre>
<pre id='line1220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1221")'> 1221: </pre>
<pre id='line1221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1222")'> 1222: </pre>
<pre id='line1222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1223")'> 1223: </pre>
<pre id='line1223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1224")'> 1224:         cdef int factor_index</pre>
<pre id='line1224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1225")'> 1225:         cdef int component_index</pre>
<pre id='line1225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1226")'> 1226:         cdef int offset</pre>
<pre id='line1226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1227")'> 1227: </pre>
<pre id='line1227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1228")'> 1228:         for factor_index in range(active_components.shape[0]):</pre>
<pre id='line1228' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1228
 *         cdef int offset
 * 
 *         for factor_index in range(active_components.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component_index = active_components[factor_index]
 * 
 */
  __pyx_t_1 = (__pyx_v_active_components.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_factor_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1229")'> 1229:             component_index = active_components[factor_index]</pre>
<pre id='line1229' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1229
 * 
 *         for factor_index in range(active_components.shape[0]):
 *             component_index = active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             target_atom_id = self._compiled_components[component_index].target_atom_id
 */
    __pyx_t_3 = __pyx_v_factor_index;
    __pyx_v_component_index = (*((int *) ( /* dim=0 */ (__pyx_v_active_components.data + __pyx_t_3 * __pyx_v_active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1230")'> 1230: </pre>
<pre id='line1230' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1231")'> 1231:             target_atom_id = self._compiled_components[component_index].target_atom_id</pre>
<pre id='line1231' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1231
 *             component_index = active_components[factor_index]
 * 
 *             target_atom_id = self._compiled_components[component_index].target_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             atom_type_id = self._compiled_components[component_index].atom_type_id
 * 
 */
    __pyx_t_4 = (__pyx_v_self->_compiled_components[__pyx_v_component_index]).target_atom_id;
    __pyx_v_target_atom_id = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1232")'> 1232:             atom_type_id = self._compiled_components[component_index].atom_type_id</pre>
<pre id='line1232' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1232
 * 
 *             target_atom_id = self._compiled_components[component_index].target_atom_id
 *             atom_type_id = self._compiled_components[component_index].atom_type_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             shift = 0.0
 */
    __pyx_t_4 = (__pyx_v_self->_compiled_components[__pyx_v_component_index]).atom_type_id;
    __pyx_v_atom_type_id = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1233")'> 1233: </pre>
<pre id='line1233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1234")'> 1234:             shift = 0.0</pre>
<pre id='line1234' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1234
 *             atom_type_id = self._compiled_components[component_index].atom_type_id
 * 
 *             shift = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 */
    __pyx_v_shift = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1235")'> 1235: </pre>
<pre id='line1235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1236")'> 1236:             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)</pre>
<pre id='line1236' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1236
 *             shift = 0.0
 * 
 *             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):
 */
    __pyx_v_coeff_offset = __pyx_f_17shift_calculators_15Coef_components_get_id_offsets(__pyx_v_self->_compiled_coef_components, __pyx_v_atom_type_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1237")'> 1237: </pre>
<pre id='line1237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1238")'> 1238:             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):</pre>
<pre id='line1238' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1238
 *             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 * 
 *             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #                TODO: remove magic numbers or add structs
 *                 coef_component = self._compiled_coef_components.get_component(coef_offset)
 */
    __pyx_t_4 = ((__pyx_v_coeff_offset[0]).offset + (__pyx_v_coeff_offset[0]).length);
    for (__pyx_t_5 = (__pyx_v_coeff_offset[0]).offset; __pyx_t_5 <code><</code> __pyx_t_4; __pyx_t_5+=1) {
      __pyx_v_coef_offset = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1239")'> 1239: #                TODO: remove magic numbers or add structs</pre>
<pre id='line1239' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1240")'> 1240:                 coef_component = self._compiled_coef_components.get_component(coef_offset)</pre>
<pre id='line1240' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1240
 *             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):
 * #                TODO: remove magic numbers or add structs
 *                 coef_component = self._compiled_coef_components.get_component(coef_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 ring_id = coef_component[0].ring_id
 */
      __pyx_v_coef_component = __pyx_f_17shift_calculators_15Coef_components_get_component(__pyx_v_self->_compiled_coef_components, __pyx_v_coef_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1241")'> 1241: </pre>
<pre id='line1241' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1242")'> 1242:                 ring_id = coef_component[0].ring_id</pre>
<pre id='line1242' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1242
 *                 coef_component = self._compiled_coef_components.get_component(coef_offset)
 * 
 *                 ring_id = coef_component[0].ring_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 coefficient = coef_component[0].coefficient
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 */
      __pyx_t_6 = (__pyx_v_coef_component[0]).ring_id;
      __pyx_v_ring_id = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1243")'> 1243:                 coefficient = coef_component[0].coefficient</pre>
<pre id='line1243' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1243
 * 
 *                 ring_id = coef_component[0].ring_id
 *                 coefficient = coef_component[0].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 * 
 */
      __pyx_t_7 = (__pyx_v_coef_component[0]).coefficient;
      __pyx_v_coefficient = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1244")'> 1244:                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)</pre>
<pre id='line1244' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1244
 *                 ring_id = coef_component[0].ring_id
 *                 coefficient = coef_component[0].coefficient
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 */
      __pyx_v_shift = (__pyx_v_shift + ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calc_sub_component_shift(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_coefficient));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1245")'> 1245: </pre>
<pre id='line1245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1246")'> 1246:             offset = self.ensemble_array_offset(component_to_target[factor_index])</pre>
<pre id='line1246' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1246
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             results[0][offset] += shift
 * 
 */
    __pyx_t_4 = __pyx_v_factor_index;
    __pyx_v_offset = __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_array_offset(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_4 * __pyx_v_component_to_target.strides[0]) ))));
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line1247")'> 1247:             results[0][offset] += shift</pre>
<pre id='line1247' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":1247
 * 
 *             offset = self.ensemble_array_offset(component_to_target[factor_index])
 *             results[0][offset] += shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_8 = 0;
    __pyx_t_5 = __pyx_v_offset;
    ((__pyx_v_results[__pyx_t_8])[__pyx_t_5]) = (((__pyx_v_results[__pyx_t_8])[__pyx_t_5]) + __pyx_v_shift);
  }

}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_25Fast_ring_data_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_25Fast_ring_data_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_simulation = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self), __pyx_v_simulation);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1248")'> 1248: </pre>
<pre id='line1248' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1249")'> 1249: </pre>
<pre id='line1249' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1250")'> 1250: #</pre>
<pre id='line1250' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1251")'> 1251: cdef int RING_ATOM_IDS = 1</pre>
<pre id='line1251' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1251
 * 
 * #
 * cdef int RING_ATOM_IDS = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_ring_data_calculator:
 */
  __pyx_v_17shift_calculators_RING_ATOM_IDS = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1252")'> 1252: </pre>
<pre id='line1252' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1253")'> 1253: cdef class Fast_ring_data_calculator:</pre>
<pre id='line1253' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1253
 * cdef int RING_ATOM_IDS = 1
 * 
 * cdef class Fast_ring_data_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef EnsembleSimulation* _simulation
 */
struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *__pyx_vtab;
  int _verbose;
  EnsembleSimulation *_simulation;
};


/* "Cython_shift_calculator.pyx":1253
 * cdef int RING_ATOM_IDS = 1
 * 
 * cdef class Fast_ring_data_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef EnsembleSimulation* _simulation
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator {
  void (*_calculate_one_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
  void (*_calculate_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, int *, Vec3 *);
  void (*_calculate_one_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
  void (*_build_atom_triplet)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, int *);
  void (*_average_2_vec_3)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, Vec3 &, Vec3 &, Vec3 *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_data_calculator;
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, int *, Vec3 *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, int *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, Vec3 &, Vec3 &, Vec3 *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1254")'> 1254:     cdef bint _verbose</pre>
<pre id='line1254' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1255")'> 1255:     cdef EnsembleSimulation* _simulation</pre>
<pre id='line1255' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1256")'> 1256: </pre>
<pre id='line1256' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1257")'> 1257:     def __init__(self,simulation):</pre>
<pre id='line1257' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1257
 *     cdef EnsembleSimulation* _simulation
 * 
 *     def __init__(self,simulation):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self._simulation = simulationAsNative(simulation)
 */

static int __pyx_pf_17shift_calculators_25Fast_ring_data_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_simulation) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1258")'> 1258:         self._verbose = False</pre>
<pre id='line1258' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1258
 * 
 *     def __init__(self,simulation):
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = simulationAsNative(simulation)
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1259")'> 1259:         self._simulation = simulationAsNative(simulation)</pre>
<pre id='line1259' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":1259
 *     def __init__(self,simulation):
 *         self._verbose = False
 *         self._simulation = simulationAsNative(simulation)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_simulationAsNative(__pyx_v_simulation);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_simulation = __pyx_t_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1260")'> 1260: </pre>
<pre id='line1260' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1261")'> 1261: </pre>
<pre id='line1261' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1262")'> 1262:     def set_verbose(self,on):</pre>
<pre id='line1262' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1262
 * 
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line1263")'> 1263:         self._verbose =  on</pre>
<pre id='line1263' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":1263
 * 
 *     def set_verbose(self,on):
 *         self._verbose =  on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1264")'> 1264: </pre>
<pre id='line1264' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1265")'> 1265:     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):</pre>
<pre id='line1265' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1265
 *         self._verbose =  on
 * 
 *     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_ring_component, Vec3 *__pyx_v_result) {
  PyObject *__pyx_v_atom_ids = NULL;
  float __pyx_v_num_atom_ids;
  int __pyx_v_atom_id;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_one_ring_centre", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1266")'> 1266: </pre>
<pre id='line1266' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1267")'> 1267:         atom_ids = ring_component[RING_ATOM_IDS]</pre>
<pre id='line1267' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1267
 *     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float num_atom_ids = len(atom_ids)
 *         cdef Vec3 total
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, __pyx_v_17shift_calculators_RING_ATOM_IDS, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_atom_ids = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1268")'> 1268:         cdef float num_atom_ids = len(atom_ids)</pre>
<pre id='line1268' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1268
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 *         cdef float num_atom_ids = len(atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 total
 *         cdef int atom_id
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_ids);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_num_atom_ids = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1269")'> 1269:         cdef Vec3 total</pre>
<pre id='line1269' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1270")'> 1270:         cdef int atom_id</pre>
<pre id='line1270' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1271")'> 1271: </pre>
<pre id='line1271' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1272")'> 1272:         result[0]=Vec3(0.0,0.0,0.0)</pre>
<pre id='line1272' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1272
 *         cdef int atom_id
 * 
 *         result[0]=Vec3(0.0,0.0,0.0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for atom_id in atom_ids:
 *             result[0] += self._simulation.atomPos(atom_id)
 */
  (__pyx_v_result[0]) = Vec3(0.0, 0.0, 0.0);
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1273")'> 1273:         for atom_id in atom_ids:</pre>
<pre id='line1273' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1273
 * 
 *         result[0]=Vec3(0.0,0.0,0.0)
 *         for atom_id in atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[0] += self._simulation.atomPos(atom_id)
 * 
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_atom_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_atom_ids)) {
    __pyx_t_1 = __pyx_v_atom_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_atom_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_3 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_3 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    }
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_atom_id = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1274")'> 1274:             result[0] += self._simulation.atomPos(atom_id)</pre>
<pre id='line1274' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1274
 *         result[0]=Vec3(0.0,0.0,0.0)
 *         for atom_id in atom_ids:
 *             result[0] += self._simulation.atomPos(atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         operator_times(result[0],1.0/float(num_atom_ids))
 */
    (__pyx_v_result[0]) += __pyx_v_self->_simulation->atomPos(__pyx_v_atom_id);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1275")'> 1275: </pre>
<pre id='line1275' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1276")'> 1276:         operator_times(result[0],1.0/float(num_atom_ids))</pre>
<pre id='line1276' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1276
 *             result[0] += self._simulation.atomPos(atom_id)
 * 
 *         operator_times(result[0],1.0/float(num_atom_ids))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #
 */
  __pyx_f_17shift_calculators_operator_times((__pyx_v_result[0]), (1.0 / ((double)__pyx_v_num_atom_ids)));

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_data_calculator._calculate_one_ring_centre", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1277")'> 1277: </pre>
<pre id='line1277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1278")'> 1278: #</pre>
<pre id='line1278' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1279")'> 1279: </pre>
<pre id='line1279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1280")'> 1280: </pre>
<pre id='line1280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1281")'> 1281: </pre>
<pre id='line1281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1282")'> 1282: #    def _check_ring_size_ok(self, atom_ids):</pre>
<pre id='line1282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1283")'> 1283: #        num_atom_ids = len(atom_ids)</pre>
<pre id='line1283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1284")'> 1284: #        if num_atom_ids &lt; 5 or num_atom_ids &gt; 6:</pre>
<pre id='line1284' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1285")'> 1285: #            template = "ring normals function is only implemented for 5 or six member rings i got %d atoms"</pre>
<pre id='line1285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1286")'> 1286: #            msg = template % num_atom_ids</pre>
<pre id='line1286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1287")'> 1287: #            raise Exception(msg)</pre>
<pre id='line1287' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1288")'> 1288: #</pre>
<pre id='line1288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1289")'> 1289: </pre>
<pre id='line1289' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1290")'> 1290:     cdef inline void  _calculate_normal(self, int[3] atom_id_triplet, Vec3* result):</pre>
<pre id='line1290' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1290
 * #
 * 
 *     cdef inline void  _calculate_normal(self, int[3] atom_id_triplet, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 normal
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, int *__pyx_v_atom_id_triplet, Vec3 *__pyx_v_result) {
  Vec3 __pyx_v_vec_1;
  Vec3 __pyx_v_vec_2;
  Vec3 __pyx_v_atom_vector_1;
  Vec3 __pyx_v_atom_vector_2;
  Vec3 __pyx_v_atom_vector_3;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_normal", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1291")'> 1291: </pre>
<pre id='line1291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1292")'> 1292:         cdef Vec3 normal</pre>
<pre id='line1292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1293")'> 1293:         cdef Vec3 vec_1</pre>
<pre id='line1293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1294")'> 1294:         cdef Vec3 vec_2</pre>
<pre id='line1294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1295")'> 1295: </pre>
<pre id='line1295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1296")'> 1296:         cdef Vec3 atom_vector_1, atom_vector_2, atom_vector_3</pre>
<pre id='line1296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1297")'> 1297: </pre>
<pre id='line1297' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1298")'> 1298:         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])</pre>
<pre id='line1298' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1298
 *         cdef Vec3 atom_vector_1, atom_vector_2, atom_vector_3
 * 
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 */
  __pyx_v_atom_vector_1 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1299")'> 1299:         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])</pre>
<pre id='line1299' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1299
 * 
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 * 
 */
  __pyx_v_atom_vector_2 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1300")'> 1300:         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])</pre>
<pre id='line1300' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1300
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2
 */
  __pyx_v_atom_vector_3 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[2]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1301")'> 1301: </pre>
<pre id='line1301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1302")'> 1302:         vec_1 =  atom_vector_1 -atom_vector_2</pre>
<pre id='line1302' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1302
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         vec_2 =  atom_vector_3- atom_vector_2
 * 
 */
  __pyx_v_vec_1 = (__pyx_v_atom_vector_1 - __pyx_v_atom_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1303")'> 1303:         vec_2 =  atom_vector_3- atom_vector_2</pre>
<pre id='line1303' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1303
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2
 *         vec_2 =  atom_vector_3- atom_vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result[0] =  cross(vec_1,vec_2)
 */
  __pyx_v_vec_2 = (__pyx_v_atom_vector_3 - __pyx_v_atom_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1304")'> 1304: </pre>
<pre id='line1304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1305")'> 1305:         result[0] =  cross(vec_1,vec_2)</pre>
<pre id='line1305' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1305
 *         vec_2 =  atom_vector_3- atom_vector_2
 * 
 *         result[0] =  cross(vec_1,vec_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal
 */
  (__pyx_v_result[0]) = cross(__pyx_v_vec_1, __pyx_v_vec_2);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1306")'> 1306: </pre>
<pre id='line1306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1307")'> 1307:     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal</pre>
<pre id='line1307' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1308")'> 1308:     cdef inline  void  _calculate_one_ring_normal(self, ring_component, Vec3* result):</pre>
<pre id='line1308' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1308
 * 
 *     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal
 *     cdef inline  void  _calculate_one_ring_normal(self, ring_component, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_ring_component, Vec3 *__pyx_v_result) {
  PyObject *__pyx_v_atom_ids = NULL;
  int *__pyx_v_atom_triplet_1;
  int *__pyx_v_atom_triplet_2;
  Vec3 __pyx_v_normal_1;
  Vec3 __pyx_v_normal_2;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_one_ring_normal", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1309")'> 1309: </pre>
<pre id='line1309' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1310")'> 1310:         atom_ids = ring_component[RING_ATOM_IDS]</pre>
<pre id='line1310' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1310
 *     cdef inline  void  _calculate_one_ring_normal(self, ring_component, Vec3* result):
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_ring_size_ok(atom_ids)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, __pyx_v_17shift_calculators_RING_ATOM_IDS, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_atom_ids = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1311")'> 1311: #        self._check_ring_size_ok(atom_ids)</pre>
<pre id='line1311' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1312")'> 1312: </pre>
<pre id='line1312' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1313")'> 1313:         cdef int* atom_triplet_1 = [0,0,0]</pre>
<pre id='line1313' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1313
 * #        self._check_ring_size_ok(atom_ids)
 * 
 *         cdef int* atom_triplet_1 = [0,0,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int* atom_triplet_2 = [0,0,0]
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)
 */
  __pyx_t_2[0] = 0;
  __pyx_t_2[1] = 0;
  __pyx_t_2[2] = 0;
  __pyx_v_atom_triplet_1 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1314")'> 1314:         cdef int* atom_triplet_2 = [0,0,0]</pre>
<pre id='line1314' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1314
 * 
 *         cdef int* atom_triplet_1 = [0,0,0]
 *         cdef int* atom_triplet_2 = [0,0,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)
 */
  __pyx_t_3[0] = 0;
  __pyx_t_3[1] = 0;
  __pyx_t_3[2] = 0;
  __pyx_v_atom_triplet_2 = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1315")'> 1315:         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)</pre>
<pre id='line1315' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1315
 *         cdef int* atom_triplet_1 = [0,0,0]
 *         cdef int* atom_triplet_2 = [0,0,0]
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_atom_ids, 0, 3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(__pyx_v_self, __pyx_t_1, __pyx_v_atom_triplet_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1316")'> 1316:         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)</pre>
<pre id='line1316' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1316
 *         cdef int* atom_triplet_2 = [0,0,0]
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_atom_ids, -3, PY_SSIZE_T_MAX);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(__pyx_v_self, __pyx_t_1, __pyx_v_atom_triplet_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1317")'> 1317: </pre>
<pre id='line1317' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1318")'> 1318: </pre>
<pre id='line1318' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1319")'> 1319:         cdef Vec3 normal_1</pre>
<pre id='line1319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1320")'> 1320:         self._calculate_normal(atom_triplet_1, &amp;normal_1)</pre>
<pre id='line1320' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1320
 * 
 *         cdef Vec3 normal_1
 *         self._calculate_normal(atom_triplet_1, &normal_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 normal_2
 *         self._calculate_normal(atom_triplet_2,  &normal_2)
 */
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(__pyx_v_self, __pyx_v_atom_triplet_1, (&__pyx_v_normal_1));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1321")'> 1321:         cdef Vec3 normal_2</pre>
<pre id='line1321' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1322")'> 1322:         self._calculate_normal(atom_triplet_2,  &amp;normal_2)</pre>
<pre id='line1322' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1322
 *         self._calculate_normal(atom_triplet_1, &normal_1)
 *         cdef Vec3 normal_2
 *         self._calculate_normal(atom_triplet_2,  &normal_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #         cdef Vec3_container result = Vec3_container()
 */
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(__pyx_v_self, __pyx_v_atom_triplet_2, (&__pyx_v_normal_2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1323")'> 1323: </pre>
<pre id='line1323' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1324")'> 1324: #         cdef Vec3_container result = Vec3_container()</pre>
<pre id='line1324' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1325")'> 1325:         self._average_2_vec_3(normal_1, normal_2, result)</pre>
<pre id='line1325' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1325
 * 
 * #         cdef Vec3_container result = Vec3_container()
 *         self._average_2_vec_3(normal_1, normal_2, result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #         result.set_vec3(average)
 * #         return result
 */
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(__pyx_v_self, __pyx_v_normal_1, __pyx_v_normal_2, __pyx_v_result);

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_data_calculator._calculate_one_ring_normal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1326")'> 1326: #         result.set_vec3(average)</pre>
<pre id='line1326' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1327")'> 1327: #         return result</pre>
<pre id='line1327' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1328")'> 1328: </pre>
<pre id='line1328' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1329")'> 1329:     cdef inline void  _build_atom_triplet(self,atom_ids, int[3]&amp; result):</pre>
<pre id='line1329' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1329
 * #         return result
 * 
 *     cdef inline void  _build_atom_triplet(self,atom_ids, int[3]& result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int i
 *         for i in range(3):
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_atom_ids, int *__pyx_v_result) {
  int __pyx_v_i;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_atom_triplet", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1330")'> 1330:         cdef int i</pre>
<pre id='line1330' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1331")'> 1331:         for i in range(3):</pre>
<pre id='line1331' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1331
 *     cdef inline void  _build_atom_triplet(self,atom_ids, int[3]& result):
 *         cdef int i
 *         for i in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[i] = atom_ids[i]
 * 
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1332")'> 1332:             result[i] = atom_ids[i]</pre>
<pre id='line1332' class='code' style='background-color: #FFFF5e'>
    /* "Cython_shift_calculator.pyx":1332
 *         cdef int i
 *         for i in range(3):
 *             result[i] = atom_ids[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_atom_ids, __pyx_v_i, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    (__pyx_v_result[__pyx_v_i]) = __pyx_t_3;
  }

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_data_calculator._build_atom_triplet", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1333")'> 1333: </pre>
<pre id='line1333' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1334")'> 1334: </pre>
<pre id='line1334' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1335")'> 1335:     cdef inline void _average_2_vec_3(self, Vec3&amp; vector_1, Vec3&amp; vector_2, Vec3* result):</pre>
<pre id='line1335' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1335
 * 
 * 
 *     cdef inline void _average_2_vec_3(self, Vec3& vector_1, Vec3& vector_2, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result[0] =  vector_1 + vector_2
 * 
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, Vec3 &__pyx_v_vector_1, Vec3 &__pyx_v_vector_2, Vec3 *__pyx_v_result) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_average_2_vec_3", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1336")'> 1336:         result[0] =  vector_1 + vector_2</pre>
<pre id='line1336' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1336
 * 
 *     cdef inline void _average_2_vec_3(self, Vec3& vector_1, Vec3& vector_2, Vec3* result):
 *         result[0] =  vector_1 + vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         operator_times(result[0], 1.0/2.0)
 */
  (__pyx_v_result[0]) = (__pyx_v_vector_1 + __pyx_v_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1337")'> 1337: </pre>
<pre id='line1337' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line1338")'> 1338:         operator_times(result[0], 1.0/2.0)</pre>
<pre id='line1338' class='code' style='background-color: #FFFF2d'>
  /* "Cython_shift_calculator.pyx":1338
 *         result[0] =  vector_1 + vector_2
 * 
 *         operator_times(result[0], 1.0/2.0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_operator_times((__pyx_v_result[0]), (1.0 / 2.0));

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_rings = 0;
  struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_normals = 0;
  struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_centres = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__rings,&__pyx_n_s__normals,&__pyx_n_s__centres,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__rings)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__normals)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1342; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__centres)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1342; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1342; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_rings = values[0];
    __pyx_v_normals = ((struct __pyx_obj_17shift_calculators_Vec3_list *)values[1]);
    __pyx_v_centres = ((struct __pyx_obj_17shift_calculators_Vec3_list *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1342; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_normals), __pyx_ptype_17shift_calculators_Vec3_list, 1, "normals", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_centres), __pyx_ptype_17shift_calculators_Vec3_list, 1, "centres", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_4__call__(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self), __pyx_v_rings, __pyx_v_normals, __pyx_v_centres);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1339")'> 1339: </pre>
<pre id='line1339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1340")'> 1340: </pre>
<pre id='line1340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1341")'> 1341:     @cython.profile(True)</pre>
<pre id='line1341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1342")'> 1342:     def __call__(self, rings, Vec3_list normals, Vec3_list centres):</pre>
<pre id='line1342' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1342
 * 
 *     @cython.profile(True)
 *     def __call__(self, rings, Vec3_list normals, Vec3_list centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        cdef Vec3_container centre
 * #         cdef Vec3_container normal
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_4__call__(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_rings, struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_normals, struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_centres) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  int __pyx_v_ring_id;
  PyObject *__pyx_v_ring_component = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1342);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1343")'> 1343: #        cdef Vec3_container centre</pre>
<pre id='line1343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1344")'> 1344: #         cdef Vec3_container normal</pre>
<pre id='line1344' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1345")'> 1345:         cdef double start_time = 0.0</pre>
<pre id='line1345' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1345
 * #        cdef Vec3_container centre
 * #         cdef Vec3_container normal
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1346")'> 1346:         cdef double end_time = 0.0</pre>
<pre id='line1346' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1346
 * #         cdef Vec3_container normal
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1347")'> 1347: </pre>
<pre id='line1347' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1348")'> 1348:         if self._verbose:</pre>
<pre id='line1348' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1348
 *         cdef double end_time = 0.0
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1349")'> 1349:             start_time = time()</pre>
<pre id='line1349' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1349
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         normals.set_length(len(rings))
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1350")'> 1350: </pre>
<pre id='line1350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1351")'> 1351:         normals.set_length(len(rings))</pre>
<pre id='line1351' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1351
 *             start_time = time()
 * 
 *         normals.set_length(len(rings))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         centres.set_length(len(rings))
 *         cdef int ring_id
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_list *)__pyx_v_normals->__pyx_vtab)->set_length(__pyx_v_normals, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1352")'> 1352:         centres.set_length(len(rings))</pre>
<pre id='line1352' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1352
 * 
 *         normals.set_length(len(rings))
 *         centres.set_length(len(rings))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int ring_id
 *         for ring_id,ring_component in enumerate(rings):
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_list *)__pyx_v_centres->__pyx_vtab)->set_length(__pyx_v_centres, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1353")'> 1353:         cdef int ring_id</pre>
<pre id='line1353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1354")'> 1354:         for ring_id,ring_component in enumerate(rings):</pre>
<pre id='line1354' class='code' style='background-color: #FFFF2a'>
  /* "Cython_shift_calculator.pyx":1354
 *         centres.set_length(len(rings))
 *         cdef int ring_id
 *         for ring_id,ring_component in enumerate(rings):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ring_id = ring_component[0]
 * 
 */
  __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_rings) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_rings)) {
    __pyx_t_2 = __pyx_v_rings; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
    __pyx_v_ring_component = __pyx_t_1;
    __pyx_t_1 = 0;
    __pyx_v_ring_id = __pyx_t_5;
    __pyx_t_5 = (__pyx_t_5 + 1);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1355")'> 1355:             ring_id = ring_component[0]</pre>
<pre id='line1355' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":1355
 *         cdef int ring_id
 *         for ring_id,ring_component in enumerate(rings):
 *             ring_id = ring_component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._calculate_one_ring_centre(ring_component, centres.get(ring_id))
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_ring_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1356")'> 1356: </pre>
<pre id='line1356' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1357")'> 1357:             self._calculate_one_ring_centre(ring_component, centres.get(ring_id))</pre>
<pre id='line1357' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1357
 *             ring_id = ring_component[0]
 * 
 *             self._calculate_one_ring_centre(ring_component, centres.get(ring_id))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_centre(__pyx_v_self, __pyx_v_ring_component, __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_centres, __pyx_v_ring_id));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1358")'> 1358: </pre>
<pre id='line1358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1359")'> 1359: </pre>
<pre id='line1359' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1360")'> 1360:             self._calculate_one_ring_normal(ring_component, normals.get(ring_id))</pre>
<pre id='line1360' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1360
 * 
 * 
 *             self._calculate_one_ring_normal(ring_component, normals.get(ring_id))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #             normal_component = ring_id, normal
 * #             normals.add_component(normal_component)
 */
    __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_normal(__pyx_v_self, __pyx_v_ring_component, __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_normals, __pyx_v_ring_id));
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1361")'> 1361: #             normal_component = ring_id, normal</pre>
<pre id='line1361' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1362")'> 1362: #             normals.add_component(normal_component)</pre>
<pre id='line1362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1363")'> 1363: </pre>
<pre id='line1363' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1364")'> 1364:         if self._verbose:</pre>
<pre id='line1364' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1364
 * #             normals.add_component(normal_component)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1365")'> 1365:             end_time = time()</pre>
<pre id='line1365' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1365
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF15' onclick='toggleDiv("line1366")'> 1366:             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1366' class='code' style='background-color: #FFFF15'>
    /* "Cython_shift_calculator.pyx":1366
 *         if self._verbose:
 *             end_time = time()
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_non_bonded_calculator:
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_normals));<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_9 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_28));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, ((PyObject *)__pyx_kp_s_28));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_28));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_29));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2, ((PyObject *)__pyx_kp_s_29));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_29));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 3, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 4, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 5, ((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_9 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_8), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  PyObject *__pyx_v_min_residue_seperation = 0;
  PyObject *__pyx_v_cutoff_distance = 0;
  PyObject *__pyx_v_jitter = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s_30,&__pyx_n_s__cutoff_distance,&__pyx_n_s__jitter,0};
    PyObject* values[4] = {0,0,0,0};
    values[2] = __pyx_k_31;
    values[3] = __pyx_k_32;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_30)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__cutoff_distance);
          if (value) { values[2] = value; kw_args--; }
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__jitter);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_simulation = values[0];
    __pyx_v_min_residue_seperation = values[1];
    __pyx_v_cutoff_distance = values[2];
    __pyx_v_jitter = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_min_residue_seperation, __pyx_v_cutoff_distance, __pyx_v_jitter);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1367")'> 1367: </pre>
<pre id='line1367' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1368")'> 1368: cdef class Fast_non_bonded_calculator:</pre>
<pre id='line1368' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1368
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_non_bonded_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int _min_residue_seperation
 *     cdef float _cutoff_distance
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *__pyx_vtab;
  int _min_residue_seperation;
  float _cutoff_distance;
  float _jitter;
  float _full_cutoff_distance;
  int _verbose;
  EnsembleSimulation *_simulation;
};


/* "Cython_shift_calculator.pyx":1368
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_non_bonded_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int _min_residue_seperation
 *     cdef float _cutoff_distance
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator {
  int (*_filter_by_residue)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, char *, int, char *, int);
  int (*_is_non_bonded)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, int, int);
  int (*_bytes_to_target_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, PyObject *, struct __pyx_t_17shift_calculators_Non_bonded_target_component **);
  int (*_bytes_to_remote_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, PyObject *, struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component **);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_calculator;
static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, char *, int, char *, int);
static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, int, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1369")'> 1369:     cdef int _min_residue_seperation</pre>
<pre id='line1369' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1370")'> 1370:     cdef float _cutoff_distance</pre>
<pre id='line1370' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1371")'> 1371:     cdef float _jitter</pre>
<pre id='line1371' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1372")'> 1372:     cdef float _full_cutoff_distance</pre>
<pre id='line1372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1373")'> 1373:     cdef bint _verbose</pre>
<pre id='line1373' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1374")'> 1374:     cdef EnsembleSimulation* _simulation</pre>
<pre id='line1374' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1375")'> 1375: </pre>
<pre id='line1375' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1376")'> 1376:     def __init__(self,simulation, min_residue_seperation,cutoff_distance=5.0,jitter=0.2):</pre>
<pre id='line1376' class='code' style='background-color: #FFFF7f'>
/* "Cython_shift_calculator.pyx":1376
 *     cdef EnsembleSimulation* _simulation
 * 
 *     def __init__(self,simulation, min_residue_seperation,cutoff_distance=5.0,jitter=0.2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = simulationAsNative(simulation)
 * 
 */

static int __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_simulation, PyObject *__pyx_v_min_residue_seperation, PyObject *__pyx_v_cutoff_distance, PyObject *__pyx_v_jitter) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);

  /* "Cython_shift_calculator.pyx":1376
 *     cdef EnsembleSimulation* _simulation
 * 
 *     def __init__(self,simulation, min_residue_seperation,cutoff_distance=5.0,jitter=0.2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = simulationAsNative(simulation)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(5.0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_31 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_32 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1377")'> 1377:         self._simulation = simulationAsNative(simulation)</pre>
<pre id='line1377' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1377
 * 
 *     def __init__(self,simulation, min_residue_seperation,cutoff_distance=5.0,jitter=0.2):
 *         self._simulation = simulationAsNative(simulation)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._min_residue_seperation =  min_residue_seperation
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_simulationAsNative(__pyx_v_simulation);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_simulation = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1378")'> 1378: </pre>
<pre id='line1378' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1379")'> 1379:         self._min_residue_seperation =  min_residue_seperation</pre>
<pre id='line1379' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1379
 *         self._simulation = simulationAsNative(simulation)
 * 
 *         self._min_residue_seperation =  min_residue_seperation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter
 */
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_min_residue_seperation);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_min_residue_seperation = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1380")'> 1380:         self._cutoff_distance =  cutoff_distance</pre>
<pre id='line1380' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1380
 * 
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 */
  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_cutoff_distance);<span class='error_goto'> if (unlikely((__pyx_t_3 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_cutoff_distance = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1381")'> 1381:         self._jitter = jitter</pre>
<pre id='line1381' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1381
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False
 */
  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_jitter);<span class='error_goto'> if (unlikely((__pyx_t_3 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_jitter = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1382")'> 1382:         self._full_cutoff_distance =  self._cutoff_distance + self._jitter</pre>
<pre id='line1382' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1382
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  False
 * 
 */
  __pyx_v_self->_full_cutoff_distance = (__pyx_v_self->_cutoff_distance + __pyx_v_self->_jitter);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1383")'> 1383:         self._verbose =  False</pre>
<pre id='line1383' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":1383
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_verbose = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1384")'> 1384: </pre>
<pre id='line1384' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1385")'> 1385: </pre>
<pre id='line1385' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1386")'> 1386:     def set_verbose(self,on):</pre>
<pre id='line1386' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1386
 * 
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose=on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line1387")'> 1387:         self._verbose=on</pre>
<pre id='line1387' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":1387
 * 
 *     def set_verbose(self,on):
 *         self._verbose=on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1388")'> 1388: </pre>
<pre id='line1388' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1389")'> 1389:     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):</pre>
<pre id='line1389' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1389
 *         self._verbose=on
 * 
 *     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int sequence_distance
 *         cdef bint result
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, char *__pyx_v_seg_1, int __pyx_v_residue_1, char *__pyx_v_seg_2, int __pyx_v_residue_2) {
  int __pyx_v_sequence_distance;
  int __pyx_v_result;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_filter_by_residue", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1390")'> 1390:         cdef int sequence_distance</pre>
<pre id='line1390' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1391")'> 1391:         cdef bint result</pre>
<pre id='line1391' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1392")'> 1392: </pre>
<pre id='line1392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1393")'> 1393:         result = False</pre>
<pre id='line1393' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1393
 *         cdef bint result
 * 
 *         result = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if strcmp(seg_1, seg_2) == 0:
 */
  __pyx_v_result = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1394")'> 1394: </pre>
<pre id='line1394' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1395")'> 1395:         if strcmp(seg_1, seg_2) == 0:</pre>
<pre id='line1395' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1395
 *         result = False
 * 
 *         if strcmp(seg_1, seg_2) == 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 */
  __pyx_t_1 = (strcmp(__pyx_v_seg_1, __pyx_v_seg_2) == 0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1396")'> 1396:             sequence_distance =abs(residue_1-residue_2)</pre>
<pre id='line1396' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1396
 * 
 *         if strcmp(seg_1, seg_2) == 0:
 *             sequence_distance =abs(residue_1-residue_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True
 */
    __pyx_t_2 = __Pyx_abs_int((__pyx_v_residue_1 - __pyx_v_residue_2)); 
    __pyx_v_sequence_distance = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1397")'> 1397:             if sequence_distance &lt; self._min_residue_seperation:</pre>
<pre id='line1397' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1397
 *         if strcmp(seg_1, seg_2) == 0:
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result =True
 *         return result
 */
    __pyx_t_1 = (__pyx_v_sequence_distance <code><</code> __pyx_v_self->_min_residue_seperation);
    if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1398")'> 1398:                 result =True</pre>
<pre id='line1398' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1398
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
      __pyx_v_result = 1;
      goto __pyx_L4;
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1399")'> 1399:         return result</pre>
<pre id='line1399' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1399
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1400")'> 1400: </pre>
<pre id='line1400' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1401")'> 1401:     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):</pre>
<pre id='line1401' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1401
 *         return result
 * 
 *     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Atom atom_1, atom_2
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, int __pyx_v_atom_id_1, int __pyx_v_atom_id_2) {
  Atom __pyx_v_atom_1;
  Atom __pyx_v_atom_2;
  char *__pyx_v_seg_1;
  char *__pyx_v_seg_2;
  int __pyx_v_residue_1;
  int __pyx_v_residue_2;
  int __pyx_v_is_non_bonded;
  float __pyx_v_distance;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_is_non_bonded", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1402")'> 1402: </pre>
<pre id='line1402' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1403")'> 1403:         cdef Atom atom_1, atom_2</pre>
<pre id='line1403' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1404")'> 1404:         cdef char *seg_1, *seg_2</pre>
<pre id='line1404' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1405")'> 1405:         cdef int residue_1, residue_2</pre>
<pre id='line1405' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1406")'> 1406:         cdef bint is_non_bonded</pre>
<pre id='line1406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1407")'> 1407:         cdef float distance</pre>
<pre id='line1407' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1408")'> 1408: </pre>
<pre id='line1408' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1409")'> 1409:         atom_1 = self._simulation[0].atomByID(atom_id_1)</pre>
<pre id='line1409' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1409
 *         cdef float distance
 * 
 *         atom_1 = self._simulation[0].atomByID(atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_2 = self._simulation[0].atomByID(atom_id_2)
 * 
 */
  __pyx_v_atom_1 = (__pyx_v_self->_simulation[0]).atomByID(__pyx_v_atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1410")'> 1410:         atom_2 = self._simulation[0].atomByID(atom_id_2)</pre>
<pre id='line1410' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1410
 * 
 *         atom_1 = self._simulation[0].atomByID(atom_id_1)
 *         atom_2 = self._simulation[0].atomByID(atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()
 */
  __pyx_v_atom_2 = (__pyx_v_self->_simulation[0]).atomByID(__pyx_v_atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1411")'> 1411: </pre>
<pre id='line1411' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1412")'> 1412:         seg_1 =  &lt;char *&gt;atom_1.segmentName()</pre>
<pre id='line1412' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1412
 *         atom_2 = self._simulation[0].atomByID(atom_id_2)
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         residue_1 = atom_1.residueNum()
 * 
 */
  __pyx_v_seg_1 = ((char *)__pyx_v_atom_1.segmentName());
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1413")'> 1413:         residue_1 = atom_1.residueNum()</pre>
<pre id='line1413' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1413
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()
 *         residue_1 = atom_1.residueNum()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()
 */
  __pyx_v_residue_1 = __pyx_v_atom_1.residueNum();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1414")'> 1414: </pre>
<pre id='line1414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1415")'> 1415:         seg_2 = &lt;char*&gt;atom_2.segmentName()</pre>
<pre id='line1415' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1415
 *         residue_1 = atom_1.residueNum()
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         residue_2 =  atom_2.residueNum()
 * 
 */
  __pyx_v_seg_2 = ((char *)__pyx_v_atom_2.segmentName());
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1416")'> 1416:         residue_2 =  atom_2.residueNum()</pre>
<pre id='line1416' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1416
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()
 *         residue_2 =  atom_2.residueNum()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         is_non_bonded = True
 */
  __pyx_v_residue_2 = __pyx_v_atom_2.residueNum();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1417")'> 1417: </pre>
<pre id='line1417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1418")'> 1418:         is_non_bonded = True</pre>
<pre id='line1418' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1418
 *         residue_2 =  atom_2.residueNum()
 * 
 *         is_non_bonded = True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):
 *             is_non_bonded = False
 */
  __pyx_v_is_non_bonded = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1419")'> 1419:         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):</pre>
<pre id='line1419' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1419
 * 
 *         is_non_bonded = True
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             is_non_bonded = False
 *         else:
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(__pyx_v_self, __pyx_v_seg_1, __pyx_v_residue_1, __pyx_v_seg_2, __pyx_v_residue_2);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1420")'> 1420:             is_non_bonded = False</pre>
<pre id='line1420' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1420
 *         is_non_bonded = True
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):
 *             is_non_bonded = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())
 */
    __pyx_v_is_non_bonded = 0;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1421")'> 1421:         else:</pre>
<pre id='line1421' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1422")'> 1422:             distance = norm(atom_1.pos() - atom_2.pos())</pre>
<pre id='line1422' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1422
 *             is_non_bonded = False
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance
 *         return is_non_bonded
 */
    __pyx_v_distance = norm((__pyx_v_atom_1.pos() - __pyx_v_atom_2.pos()));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1423")'> 1423:             is_non_bonded =  distance &lt; self._full_cutoff_distance</pre>
<pre id='line1423' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1423
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return is_non_bonded
 * 
 */
    __pyx_v_is_non_bonded = (__pyx_v_distance <code><</code> __pyx_v_self->_full_cutoff_distance);
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1424")'> 1424:         return is_non_bonded</pre>
<pre id='line1424' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1424
 *             distance = norm(atom_1.pos() - atom_2.pos())
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance
 *         return is_non_bonded             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #     cdef struct Non_bonded_target_component:
 */
  __pyx_r = __pyx_v_is_non_bonded;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1425")'> 1425: </pre>
<pre id='line1425' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1426")'> 1426: #     cdef struct Non_bonded_target_component:</pre>
<pre id='line1426' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1427")'> 1427: #       int target_atom_id</pre>
<pre id='line1427' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1428")'> 1428: #       int atom_type_id</pre>
<pre id='line1428' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1429")'> 1429: #</pre>
<pre id='line1429' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1430")'> 1430: # cdef struct Non_bonded_remote_atom_component:</pre>
<pre id='line1430' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1431")'> 1431: #       int remote_atom</pre>
<pre id='line1431' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1432")'> 1432: #       int chem_type[2] # one for each sphere</pre>
<pre id='line1432' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1433")'> 1433: </pre>
<pre id='line1433' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1434")'> 1434:     cdef   int _bytes_to_target_components(self, data, Non_bonded_target_component** target_pointer):</pre>
<pre id='line1434' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1434
 * #       int chem_type[2] # one for each sphere
 * 
 *     cdef   int _bytes_to_target_components(self, data, Non_bonded_target_component** target_pointer):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_pointer[0] =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)
 */

static int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__bytes_to_target_components(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_data, struct __pyx_t_17shift_calculators_Non_bonded_target_component **__pyx_v_target_pointer) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_target_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1435")'> 1435: </pre>
<pre id='line1435' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1436")'> 1436:         target_pointer[0] =  &lt;Non_bonded_target_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1436' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1436
 *     cdef   int _bytes_to_target_components(self, data, Non_bonded_target_component** target_pointer):
 * 
 *         target_pointer[0] =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return len(data)/ sizeof(Non_bonded_target_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  (__pyx_v_target_pointer[0]) = ((struct __pyx_t_17shift_calculators_Non_bonded_target_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1437")'> 1437:         return len(data)/ sizeof(Non_bonded_target_component)</pre>
<pre id='line1437' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1437
 * 
 *         target_pointer[0] =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)
 *         return len(data)/ sizeof(Non_bonded_target_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef   int _bytes_to_remote_components(self, data, Non_bonded_remote_atom_component** remote_pointer):
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1437; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Non_bonded_target_component)));
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_non_bonded_calculator._bytes_to_target_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1438")'> 1438: </pre>
<pre id='line1438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1439")'> 1439:     cdef   int _bytes_to_remote_components(self, data, Non_bonded_remote_atom_component** remote_pointer):</pre>
<pre id='line1439' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1439
 *         return len(data)/ sizeof(Non_bonded_target_component)
 * 
 *     cdef   int _bytes_to_remote_components(self, data, Non_bonded_remote_atom_component** remote_pointer):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         remote_pointer[0] =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)
 */

static int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__bytes_to_remote_components(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_data, struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component **__pyx_v_remote_pointer) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_remote_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1440")'> 1440: </pre>
<pre id='line1440' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1441")'> 1441:         remote_pointer[0] =  &lt;Non_bonded_remote_atom_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1441' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1441
 *     cdef   int _bytes_to_remote_components(self, data, Non_bonded_remote_atom_component** remote_pointer):
 * 
 *         remote_pointer[0] =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return len(data)/ sizeof(Non_bonded_remote_atom_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  (__pyx_v_remote_pointer[0]) = ((struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line1442")'> 1442:         return len(data)/ sizeof(Non_bonded_remote_atom_component)</pre>
<pre id='line1442' class='code' style='background-color: #FFFF27'>
  /* "Cython_shift_calculator.pyx":1442
 * 
 *         remote_pointer[0] =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)
 *         return len(data)/ sizeof(Non_bonded_remote_atom_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component)));
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_non_bonded_calculator._bytes_to_remote_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_atom_list_1 = 0;
  PyObject *__pyx_v_atom_list_2 = 0;
  struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_non_bonded_lists = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__atom_list_1,&__pyx_n_s__atom_list_2,&__pyx_n_s__non_bonded_lists,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_list_1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_list_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__non_bonded_lists)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_atom_list_1 = values[0];
    __pyx_v_atom_list_2 = values[1];
    __pyx_v_non_bonded_lists = ((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_non_bonded_lists), __pyx_ptype_17shift_calculators_Non_bonded_interaction_list, 1, "non_bonded_lists", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_4__call__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), __pyx_v_atom_list_1, __pyx_v_atom_list_2, __pyx_v_non_bonded_lists);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1443")'> 1443: </pre>
<pre id='line1443' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1444")'> 1444:     @cython.profile(True)</pre>
<pre id='line1444' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1445")'> 1445:     def __call__(self, atom_list_1, atom_list_2,  Non_bonded_interaction_list non_bonded_lists):</pre>
<pre id='line1445' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1445
 * 
 *     @cython.profile(True)
 *     def __call__(self, atom_list_1, atom_list_2,  Non_bonded_interaction_list non_bonded_lists):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_4__call__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_atom_list_1, PyObject *__pyx_v_atom_list_2, struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *__pyx_v_non_bonded_lists) {
  struct __pyx_t_17shift_calculators_Non_bonded_target_component *__pyx_v_target_components;
  int __pyx_v_num_target_components;
  struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component *__pyx_v_remote_components;
  int __pyx_v_num_remote_components;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  int __pyx_v_i;
  int __pyx_v_atom_id_1;
  int __pyx_v_atom_id_2;
  int __pyx_v_j;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1445);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1446")'> 1446: </pre>
<pre id='line1446' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1447")'> 1447:         if self._verbose:</pre>
<pre id='line1447' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1447
 *     def __call__(self, atom_list_1, atom_list_2,  Non_bonded_interaction_list non_bonded_lists):
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '***** BUILD NON BONDED ******'
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1448")'> 1448:             print '***** BUILD NON BONDED ******'</pre>
<pre id='line1448' class='code' style='background-color: #FFFFd4'>
    /* "Cython_shift_calculator.pyx":1448
 * 
 *         if self._verbose:
 *             print '***** BUILD NON BONDED ******'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef  Non_bonded_target_component* target_components
 */
    if (<span class='pyx_c_api'>__Pyx_PrintOne</span>(0, ((PyObject *)__pyx_kp_s_33)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1449")'> 1449: </pre>
<pre id='line1449' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1450")'> 1450:         cdef  Non_bonded_target_component* target_components</pre>
<pre id='line1450' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1451")'> 1451:         cdef int num_target_components = self._bytes_to_target_components(atom_list_1,&amp;target_components)</pre>
<pre id='line1451' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1451
 * 
 *         cdef  Non_bonded_target_component* target_components
 *         cdef int num_target_components = self._bytes_to_target_components(atom_list_1,&target_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Non_bonded_remote_atom_component* remote_components
 */
  __pyx_v_num_target_components = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self->__pyx_vtab)->_bytes_to_target_components(__pyx_v_self, __pyx_v_atom_list_1, (&__pyx_v_target_components));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1452")'> 1452: </pre>
<pre id='line1452' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1453")'> 1453:         cdef Non_bonded_remote_atom_component* remote_components</pre>
<pre id='line1453' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1454")'> 1454:         cdef int num_remote_components = self._bytes_to_remote_components(atom_list_2,&amp;remote_components)</pre>
<pre id='line1454' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1454
 * 
 *         cdef Non_bonded_remote_atom_component* remote_components
 *         cdef int num_remote_components = self._bytes_to_remote_components(atom_list_2,&remote_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time = 0.0
 */
  __pyx_v_num_remote_components = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self->__pyx_vtab)->_bytes_to_remote_components(__pyx_v_self, __pyx_v_atom_list_2, (&__pyx_v_remote_components));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1455")'> 1455: </pre>
<pre id='line1455' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1456")'> 1456:         cdef double start_time = 0.0</pre>
<pre id='line1456' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1456
 *         cdef int num_remote_components = self._bytes_to_remote_components(atom_list_2,&remote_components)
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1457")'> 1457:         cdef double end_time = 0.0</pre>
<pre id='line1457' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1457
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1458")'> 1458:         if self._verbose:</pre>
<pre id='line1458' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1458
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1459")'> 1459:             start_time = time()</pre>
<pre id='line1459' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1459
 *         cdef double end_time = 0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1459; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1459; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1459; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1460")'> 1460: </pre>
<pre id='line1460' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1461")'> 1461: </pre>
<pre id='line1461' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1462")'> 1462:         cdef int i, atom_id_1, atom_id_2</pre>
<pre id='line1462' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1463")'> 1463: </pre>
<pre id='line1463' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1464")'> 1464:         non_bonded_lists.clear()</pre>
<pre id='line1464' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1464
 *         cdef int i, atom_id_1, atom_id_2
 * 
 *         non_bonded_lists.clear()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for i in range(num_target_components):
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_non_bonded_lists), __pyx_n_s__clear);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1465")'> 1465: </pre>
<pre id='line1465' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1466")'> 1466:         for i in range(num_target_components):</pre>
<pre id='line1466' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1466
 *         non_bonded_lists.clear()
 * 
 *         for i in range(num_target_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             atom_id_1 = target_components[i].target_atom_id
 * 
 */
  __pyx_t_4 = __pyx_v_num_target_components;
  for (__pyx_t_5 = 0; __pyx_t_5 <code><</code> __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1467")'> 1467:             atom_id_1 = target_components[i].target_atom_id</pre>
<pre id='line1467' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1467
 * 
 *         for i in range(num_target_components):
 *             atom_id_1 = target_components[i].target_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for j in range(num_remote_components):
 */
    __pyx_t_6 = (__pyx_v_target_components[__pyx_v_i]).target_atom_id;
    __pyx_v_atom_id_1 = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1468")'> 1468: </pre>
<pre id='line1468' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1469")'> 1469:             for j in range(num_remote_components):</pre>
<pre id='line1469' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1469
 *             atom_id_1 = target_components[i].target_atom_id
 * 
 *             for j in range(num_remote_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 atom_id_2  = remote_components[j].remote_atom_id
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 */
    __pyx_t_6 = __pyx_v_num_remote_components;
    for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_j = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1470")'> 1470:                 atom_id_2  = remote_components[j].remote_atom_id</pre>
<pre id='line1470' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1470
 * 
 *             for j in range(num_remote_components):
 *                 atom_id_2  = remote_components[j].remote_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_lists.append(atom_id_1, i,j,i)
 */
      __pyx_t_8 = (__pyx_v_remote_components[__pyx_v_j]).remote_atom_id;
      __pyx_v_atom_id_2 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1471")'> 1471:                 if self._is_non_bonded(atom_id_1, atom_id_2):</pre>
<pre id='line1471' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1471
 *             for j in range(num_remote_components):
 *                 atom_id_2  = remote_components[j].remote_atom_id
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     non_bonded_lists.append(atom_id_1, i,j,i)
 *         if self._verbose:
 */
      __pyx_t_9 = __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(__pyx_v_self, __pyx_v_atom_id_1, __pyx_v_atom_id_2);
      if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1472")'> 1472:                     non_bonded_lists.append(atom_id_1, i,j,i)</pre>
<pre id='line1472' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1472
 *                 atom_id_2  = remote_components[j].remote_atom_id
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_lists.append(atom_id_1, i,j,i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             end_time = time()
 */
        __pyx_f_17shift_calculators_27Non_bonded_interaction_list_append(__pyx_v_non_bonded_lists, __pyx_v_atom_id_1, __pyx_v_i, __pyx_v_j, __pyx_v_i);
        goto __pyx_L9;
      }
      __pyx_L9:;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1473")'> 1473:         if self._verbose:</pre>
<pre id='line1473' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1473
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_lists.append(atom_id_1, i,j,i)
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1474")'> 1474:             end_time = time()</pre>
<pre id='line1474' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1474
 *                     non_bonded_lists.append(atom_id_1, i,j,i)
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line1475")'> 1475:             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1475' class='code' style='background-color: #FFFF1f'>
    /* "Cython_shift_calculator.pyx":1475
 *         if self._verbose:
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_list_1);<span class='error_goto'> if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_list_2);<span class='error_goto'> if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
    __pyx_t_12 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_12));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_34));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, ((PyObject *)__pyx_kp_s_34));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_34));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_35));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 2, ((PyObject *)__pyx_kp_s_35));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_35));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 3, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 4, ((PyObject *)__pyx_kp_s_36));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 5, ((PyObject *)__pyx_t_12));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_12));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_2 = 0;
    __pyx_t_1 = 0;
    __pyx_t_12 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_11), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_11)); __pyx_t_11 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_22Fast_energy_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_22Fast_energy_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1476")'> 1476: </pre>
<pre id='line1476' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1477")'> 1477: </pre>
<pre id='line1477' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1478")'> 1478: cdef class Fast_energy_calculator:</pre>
<pre id='line1478' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1478
 * 
 * 
 * cdef class Fast_energy_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator {
  struct __pyx_t_17shift_calculators_Constant_cache *(*_get_energy_terms)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_calculated_atom_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_observed_atom_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_shift_difference)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int, int);
  float (*_adjust_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, float, float);
  float (*_calc_one_energy)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *__pyx_vtabptr_17shift_calculators_Fast_energy_calculator;
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, float, float);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__calc_one_energy(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1479")'> 1479: </pre>
<pre id='line1479' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1480")'> 1480: </pre>
<pre id='line1480' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1481")'> 1481:     def __init__(self):</pre>
<pre id='line1481' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1481
 * 
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._energy_term_cache =  NULL
 *         self._theory_shifts =   NULL
 */

static int __pyx_pf_17shift_calculators_22Fast_energy_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1482")'> 1482:         self._energy_term_cache =  NULL</pre>
<pre id='line1482' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1482
 * 
 *     def __init__(self):
 *         self._energy_term_cache =  NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._theory_shifts =   NULL
 *         self._observed_shifts =  None
 */
  __pyx_v_self->_energy_term_cache = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1483")'> 1483:         self._theory_shifts =   NULL</pre>
<pre id='line1483' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1483
 *     def __init__(self):
 *         self._energy_term_cache =  NULL
 *         self._theory_shifts =   NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._observed_shifts =  None
 *         self._verbose = False
 */
  __pyx_v_self->_theory_shifts = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1484")'> 1484:         self._observed_shifts =  None</pre>
<pre id='line1484' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1484
 *         self._energy_term_cache =  NULL
 *         self._theory_shifts =   NULL
 *         self._observed_shifts =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self.calls = 0
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_float</span>(Py_None);
  if (unlikely(!__pyx_t_1.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __PYX_XDEC_MEMVIEW(&__pyx_v_self->_observed_shifts, 0);
  __pyx_v_self->_observed_shifts = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1485")'> 1485:         self._verbose = False</pre>
<pre id='line1485' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1485
 *         self._theory_shifts =   NULL
 *         self._observed_shifts =  None
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.calls = 0
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1486")'> 1486:         self.calls = 0</pre>
<pre id='line1486' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":1486
 *         self._observed_shifts =  None
 *         self._verbose = False
 *         self.calls = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->calls = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1487")'> 1487: </pre>
<pre id='line1487' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1488")'> 1488: </pre>
<pre id='line1488' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1489")'> 1489:     def set_verbose(self,on):</pre>
<pre id='line1489' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1489
 * 
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line1490")'> 1490:         self._verbose = on</pre>
<pre id='line1490' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":1490
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_observed_shifts(self, float[:] observed_shifts):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_5set_observed_shifts(PyObject *__pyx_v_self, PyObject *__pyx_arg_observed_shifts); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_5set_observed_shifts(PyObject *__pyx_v_self, PyObject *__pyx_arg_observed_shifts) {
  __Pyx_memviewslice __pyx_v_observed_shifts = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_observed_shifts (wrapper)", 0);
  assert(__pyx_arg_observed_shifts); {
    __pyx_v_observed_shifts = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_float</span>(__pyx_arg_observed_shifts);<span class='error_goto'> if (unlikely(!__pyx_v_observed_shifts.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.set_observed_shifts", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_4set_observed_shifts(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_observed_shifts);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1491")'> 1491: </pre>
<pre id='line1491' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1492")'> 1492:     def set_observed_shifts(self, float[:] observed_shifts):</pre>
<pre id='line1492' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1492
 *         self._verbose = on
 * 
 *     def set_observed_shifts(self, float[:] observed_shifts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._observed_shifts =  observed_shifts
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_4set_observed_shifts(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_observed_shifts) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_observed_shifts", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1493")'> 1493:         self._observed_shifts =  observed_shifts</pre>
<pre id='line1493' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1493
 * 
 *     def set_observed_shifts(self, float[:] observed_shifts):
 *         self._observed_shifts =  observed_shifts             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_calculated_shifts(self, CDSSharedVectorFloat calculated_shifts):
 */
  __PYX_XDEC_MEMVIEW(&__pyx_v_self->_observed_shifts, 0);
  __PYX_INC_MEMVIEW(&__pyx_v_observed_shifts, 0);
  __pyx_v_self->_observed_shifts = __pyx_v_observed_shifts;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  __PYX_XDEC_MEMVIEW(&__pyx_v_observed_shifts, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_7set_calculated_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_calculated_shifts); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_7set_calculated_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_calculated_shifts) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_calculated_shifts (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_calculated_shifts), __pyx_ptype_17shift_calculators_CDSSharedVectorFloat, 1, "calculated_shifts", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_6set_calculated_shifts(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_calculated_shifts));
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1494")'> 1494: </pre>
<pre id='line1494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1495")'> 1495:     def set_calculated_shifts(self, CDSSharedVectorFloat calculated_shifts):</pre>
<pre id='line1495' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1495
 *         self._observed_shifts =  observed_shifts
 * 
 *     def set_calculated_shifts(self, CDSSharedVectorFloat calculated_shifts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._theory_shifts = calculated_shifts.get_data()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_6set_calculated_shifts(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_calculated_shifts) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_calculated_shifts", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1496")'> 1496:         self._theory_shifts = calculated_shifts.get_data()</pre>
<pre id='line1496' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":1496
 * 
 *     def set_calculated_shifts(self, CDSSharedVectorFloat calculated_shifts):
 *         self._theory_shifts = calculated_shifts.get_data()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):
 */
  __pyx_v_self->_theory_shifts = ((struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_calculated_shifts->__pyx_vtab)->get_data(__pyx_v_calculated_shifts);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_9set_energy_term_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_energy_term_cache); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_9set_energy_term_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_energy_term_cache) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_energy_term_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_8set_energy_term_cache(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_energy_term_cache));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1497")'> 1497: </pre>
<pre id='line1497' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1498")'> 1498:     def set_energy_term_cache(self, energy_term_cache ):</pre>
<pre id='line1498' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1498
 *         self._theory_shifts = calculated_shifts.get_data()
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._energy_term_cache =  <code><</code>Constant_cache*> <code><</code>size_t> ctypes.addressof(energy_term_cache)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_8set_energy_term_cache(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_energy_term_cache) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_energy_term_cache", 0);
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line1499")'> 1499:         self._energy_term_cache =  &lt;Constant_cache*&gt; &lt;size_t&gt; ctypes.addressof(energy_term_cache)</pre>
<pre id='line1499' class='code' style='background-color: #FFFF33'>
  /* "Cython_shift_calculator.pyx":1499
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):
 *         self._energy_term_cache =  <code><</code>Constant_cache*> <code><</code>size_t> ctypes.addressof(energy_term_cache)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Constant_cache* _get_energy_terms(self, int target_atom_index) nogil:
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_energy_term_cache);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_energy_term_cache);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_energy_term_cache);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_energy_term_cache = ((struct __pyx_t_17shift_calculators_Constant_cache *)((size_t)__pyx_t_4));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.set_energy_term_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1500")'> 1500: </pre>
<pre id='line1500' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1501")'> 1501:     cdef Constant_cache* _get_energy_terms(self, int target_atom_index) nogil:</pre>
<pre id='line1501' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1501
 *         self._energy_term_cache =  <code><</code>Constant_cache*> <code><</code>size_t> ctypes.addressof(energy_term_cache)
 * 
 *     cdef Constant_cache* _get_energy_terms(self, int target_atom_index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return &self._energy_term_cache[target_atom_index]
 * 
 */

static struct __pyx_t_17shift_calculators_Constant_cache *__pyx_f_17shift_calculators_22Fast_energy_calculator__get_energy_terms(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  struct __pyx_t_17shift_calculators_Constant_cache *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1502")'> 1502:         return &amp;self._energy_term_cache[target_atom_index]</pre>
<pre id='line1502' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1502
 * 
 *     cdef Constant_cache* _get_energy_terms(self, int target_atom_index) nogil:
 *         return &self._energy_term_cache[target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int index) nogil:
 */
  __pyx_r = (&(__pyx_v_self->_energy_term_cache[__pyx_v_target_atom_index]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1503")'> 1503: </pre>
<pre id='line1503' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1504")'> 1504:     cdef inline float  _get_calculated_atom_shift(self, int index) nogil:</pre>
<pre id='line1504' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1504
 *         return &self._energy_term_cache[target_atom_index]
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._theory_shifts[0][index]
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_index) {
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1505")'> 1505:         return self._theory_shifts[0][index]</pre>
<pre id='line1505' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1505
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int index) nogil:
 *         return self._theory_shifts[0][index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float _get_observed_atom_shift(self, int index) nogil:
 */
  __pyx_r = ((__pyx_v_self->_theory_shifts[0])[__pyx_v_index]);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1506")'> 1506: </pre>
<pre id='line1506' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1507")'> 1507:     cdef inline float _get_observed_atom_shift(self, int index) nogil:</pre>
<pre id='line1507' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1507
 *         return self._theory_shifts[0][index]
 * 
 *     cdef inline float _get_observed_atom_shift(self, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._observed_shifts[index]
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_index) {
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1508")'> 1508:         return self._observed_shifts[index]</pre>
<pre id='line1508' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1508
 * 
 *     cdef inline float _get_observed_atom_shift(self, int index) nogil:
 *         return self._observed_shifts[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float  _get_shift_difference(self, int target_atom_index, int index) nogil:
 */
  if (unlikely(!__pyx_v_self->_observed_shifts.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
  __pyx_t_1 = __pyx_v_index;
  __pyx_r = (*((float *) ( /* dim=0 */ (__pyx_v_self->_observed_shifts.data + __pyx_t_1 * __pyx_v_self->_observed_shifts.strides[0]) )));
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_energy_calculator._get_observed_atom_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1509")'> 1509: </pre>
<pre id='line1509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1510")'> 1510:     cdef inline float  _get_shift_difference(self, int target_atom_index, int index) nogil:</pre>
<pre id='line1510' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1510
 *         return self._observed_shifts[index]
 * 
 *     cdef inline float  _get_shift_difference(self, int target_atom_index, int index) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float theory_shift
 *         cdef float observed_shift
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, CYTHON_UNUSED int __pyx_v_target_atom_index, int __pyx_v_index) {
  float __pyx_v_theory_shift;
  float __pyx_v_observed_shift;
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1511")'> 1511:         cdef float theory_shift</pre>
<pre id='line1511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1512")'> 1512:         cdef float observed_shift</pre>
<pre id='line1512' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1513")'> 1513:         theory_shift = self._get_calculated_atom_shift(index)</pre>
<pre id='line1513' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1513
 *         cdef float theory_shift
 *         cdef float observed_shift
 *         theory_shift = self._get_calculated_atom_shift(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         observed_shift = self._get_observed_atom_shift(index)
 */
  __pyx_v_theory_shift = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1514")'> 1514: </pre>
<pre id='line1514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1515")'> 1515:         observed_shift = self._get_observed_atom_shift(index)</pre>
<pre id='line1515' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1515
 *         theory_shift = self._get_calculated_atom_shift(index)
 * 
 *         observed_shift = self._get_observed_atom_shift(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return observed_shift - theory_shift
 */
  __pyx_v_observed_shift = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1516")'> 1516: </pre>
<pre id='line1516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1517")'> 1517:         return observed_shift - theory_shift</pre>
<pre id='line1517' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1517
 *         observed_shift = self._get_observed_atom_shift(index)
 * 
 *         return observed_shift - theory_shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit) nogil:
 */
  __pyx_r = (__pyx_v_observed_shift - __pyx_v_theory_shift);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1518")'> 1518: </pre>
<pre id='line1518' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1519")'> 1519:     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit) nogil:</pre>
<pre id='line1519' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1519
 *         return observed_shift - theory_shift
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = 0.0
 *         if (shift_diff > 0.0):
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, float __pyx_v_shift_diff, float __pyx_v_flat_bottom_shift_limit) {
  double __pyx_v_result;
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1520")'> 1520:         result  = 0.0</pre>
<pre id='line1520' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1520
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit) nogil:
 *         result  = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if (shift_diff > 0.0):
 *             result = shift_diff-flat_bottom_shift_limit
 */
  __pyx_v_result = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1521")'> 1521:         if (shift_diff &gt; 0.0):</pre>
<pre id='line1521' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1521
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit) nogil:
 *         result  = 0.0
 *         if (shift_diff > 0.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = shift_diff-flat_bottom_shift_limit
 *         else:
 */
  __pyx_t_1 = (__pyx_v_shift_diff > 0.0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1522")'> 1522:             result = shift_diff-flat_bottom_shift_limit</pre>
<pre id='line1522' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1522
 *         result  = 0.0
 *         if (shift_diff > 0.0):
 *             result = shift_diff-flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit
 */
    __pyx_v_result = (__pyx_v_shift_diff - __pyx_v_flat_bottom_shift_limit);
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1523")'> 1523:         else:</pre>
<pre id='line1523' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1524")'> 1524:             result = shift_diff + flat_bottom_shift_limit</pre>
<pre id='line1524' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1524
 *             result = shift_diff-flat_bottom_shift_limit
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
    __pyx_v_result = (__pyx_v_shift_diff + __pyx_v_flat_bottom_shift_limit);
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1525")'> 1525:         return result</pre>
<pre id='line1525' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":1525
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_target_atom_ids = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_active_atom_ids = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,&__pyx_n_s__active_atom_ids,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_atom_ids);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1528; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_target_atom_ids = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_target_atom_ids.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1528; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    if (values[1]) {
      __pyx_v_active_atom_ids = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_active_atom_ids.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1528; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_active_atom_ids = __pyx_k_37;
      __PYX_INC_MEMVIEW(&__pyx_v_active_atom_ids, 1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1528; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_10__call__(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_target_atom_ids, __pyx_v_active_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1526")'> 1526: </pre>
<pre id='line1526' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1527")'> 1527:     @cython.profile(True)</pre>
<pre id='line1527' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1528")'> 1528:     def __call__(self,int[:] target_atom_ids, int[:] active_atom_ids=None):</pre>
<pre id='line1528' class='code' style='background-color: #FFFFb6'>
/* "Cython_shift_calculator.pyx":1528
 * 
 *     @cython.profile(True)
 *     def __call__(self,int[:] target_atom_ids, int[:] active_atom_ids=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time = 0.0
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_10__call__(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_target_atom_ids, __Pyx_memviewslice __pyx_v_active_atom_ids) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  float __pyx_v_energy;
  int __pyx_v_active_atom_id;
  int __pyx_v_target_atom_id;
  Py_ssize_t __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1528);

  /* "Cython_shift_calculator.pyx":1528
 * 
 *     @cython.profile(True)
 *     def __call__(self,int[:] target_atom_ids, int[:] active_atom_ids=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time = 0.0
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(Py_None);
  if (unlikely(!__pyx_t_3.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_k_37 = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1529")'> 1529: </pre>
<pre id='line1529' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1530")'> 1530:         cdef double start_time = 0.0</pre>
<pre id='line1530' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1530
 *     def __call__(self,int[:] target_atom_ids, int[:] active_atom_ids=None):
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         cdef float energy
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1531")'> 1531:         cdef double end_time = 0.0</pre>
<pre id='line1531' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1531
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float energy
 *         cdef int active_atom_id
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1532")'> 1532:         cdef float energy</pre>
<pre id='line1532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1533")'> 1533:         cdef int active_atom_id</pre>
<pre id='line1533' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1534")'> 1534:         cdef int target_atom_id</pre>
<pre id='line1534' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1535")'> 1535: </pre>
<pre id='line1535' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1536")'> 1536:         if self._verbose:</pre>
<pre id='line1536' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1536
 *         cdef int target_atom_id
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1537")'> 1537:             start_time = time()</pre>
<pre id='line1537' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1537
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         energy = 0.0
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1538")'> 1538: </pre>
<pre id='line1538' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1539")'> 1539:         energy = 0.0</pre>
<pre id='line1539' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1539
 *             start_time = time()
 * 
 *         energy = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if active_atom_ids == None:
 */
  __pyx_v_energy = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1540")'> 1540: </pre>
<pre id='line1540' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1541")'> 1541:         if active_atom_ids == None:</pre>
<pre id='line1541' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1541
 *         energy = 0.0
 * 
 *         if active_atom_ids == None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i in range(target_atom_ids.shape[0]):
 *                 target_atom_id = target_atom_ids[i]
 */
  __pyx_t_4 = (((PyObject *) __pyx_v_active_atom_ids.memview) == Py_None);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1542")'> 1542:             for i in range(target_atom_ids.shape[0]):</pre>
<pre id='line1542' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1542
 * 
 *         if active_atom_ids == None:
 *             for i in range(target_atom_ids.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 target_atom_id = target_atom_ids[i]
 * 
 */
    __pyx_t_5 = (__pyx_v_target_atom_ids.shape[0]);
    for (__pyx_t_6 = 0; __pyx_t_6 <code><</code> __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_i = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1543")'> 1543:                 target_atom_id = target_atom_ids[i]</pre>
<pre id='line1543' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1543
 *         if active_atom_ids == None:
 *             for i in range(target_atom_ids.shape[0]):
 *                 target_atom_id = target_atom_ids[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 energy += self._calc_one_energy(target_atom_id, i)
 */
      __pyx_t_7 = __pyx_v_i;
      __pyx_v_target_atom_id = (*((int *) ( /* dim=0 */ (__pyx_v_target_atom_ids.data + __pyx_t_7 * __pyx_v_target_atom_ids.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1544")'> 1544: </pre>
<pre id='line1544' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1545")'> 1545:                 energy += self._calc_one_energy(target_atom_id, i)</pre>
<pre id='line1545' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1545
 *                 target_atom_id = target_atom_ids[i]
 * 
 *                 energy += self._calc_one_energy(target_atom_id, i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             for i in  range(active_atom_ids.shape[0]):
 */
      __pyx_v_energy = (__pyx_v_energy + __pyx_f_17shift_calculators_22Fast_energy_calculator__calc_one_energy(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_i));
    }
    goto __pyx_L4;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1546")'> 1546:         else:</pre>
<pre id='line1546' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1547")'> 1547:             for i in  range(active_atom_ids.shape[0]):</pre>
<pre id='line1547' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1547
 *                 energy += self._calc_one_energy(target_atom_id, i)
 *         else:
 *             for i in  range(active_atom_ids.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 active_atom_id = active_atom_ids[i]
 *                 target_atom_id = target_atom_ids[active_atom_id]
 */
    __pyx_t_5 = (__pyx_v_active_atom_ids.shape[0]);
    for (__pyx_t_6 = 0; __pyx_t_6 <code><</code> __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_i = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1548")'> 1548:                 active_atom_id = active_atom_ids[i]</pre>
<pre id='line1548' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1548
 *         else:
 *             for i in  range(active_atom_ids.shape[0]):
 *                 active_atom_id = active_atom_ids[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 target_atom_id = target_atom_ids[active_atom_id]
 * 
 */
      __pyx_t_8 = __pyx_v_i;
      __pyx_v_active_atom_id = (*((int *) ( /* dim=0 */ (__pyx_v_active_atom_ids.data + __pyx_t_8 * __pyx_v_active_atom_ids.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1549")'> 1549:                 target_atom_id = target_atom_ids[active_atom_id]</pre>
<pre id='line1549' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1549
 *             for i in  range(active_atom_ids.shape[0]):
 *                 active_atom_id = active_atom_ids[i]
 *                 target_atom_id = target_atom_ids[active_atom_id]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 energy += self._calc_one_energy(target_atom_id, active_atom_id)
 */
      __pyx_t_9 = __pyx_v_active_atom_id;
      __pyx_v_target_atom_id = (*((int *) ( /* dim=0 */ (__pyx_v_target_atom_ids.data + __pyx_t_9 * __pyx_v_target_atom_ids.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1550")'> 1550: </pre>
<pre id='line1550' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1551")'> 1551:                 energy += self._calc_one_energy(target_atom_id, active_atom_id)</pre>
<pre id='line1551' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1551
 *                 target_atom_id = target_atom_ids[active_atom_id]
 * 
 *                 energy += self._calc_one_energy(target_atom_id, active_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
      __pyx_v_energy = (__pyx_v_energy + __pyx_f_17shift_calculators_22Fast_energy_calculator__calc_one_energy(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_active_atom_id));
    }
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1552")'> 1552: </pre>
<pre id='line1552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1553")'> 1553:         if self._verbose:</pre>
<pre id='line1553' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1553
 *                 energy += self._calc_one_energy(target_atom_id, active_atom_id)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1554")'> 1554:             end_time = time()</pre>
<pre id='line1554' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1554
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line1555")'> 1555:             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1555' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":1555
 *         if self._verbose:
 *             end_time = time()
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_target_atom_ids, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_38));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_38));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_38));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_kp_s_36));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_10 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_2), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    goto __pyx_L9;
  }
  __pyx_L9:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1556")'> 1556: </pre>
<pre id='line1556' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1557")'> 1557: </pre>
<pre id='line1557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1558")'> 1558:         self.calls += 1</pre>
<pre id='line1558' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1558
 * 
 * 
 *         self.calls += 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return energy
 * 
 */
  __pyx_v_self->calls = (__pyx_v_self->calls + 1);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1559")'> 1559:         return energy</pre>
<pre id='line1559' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1559
 * 
 *         self.calls += 1
 *         return energy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float _calc_one_energy(self, int target_atom_index, int index):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_energy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_target_atom_ids, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_atom_ids, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1560")'> 1560: </pre>
<pre id='line1560' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1561")'> 1561:     cdef inline float _calc_one_energy(self, int target_atom_index, int index):</pre>
<pre id='line1561' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1561
 *         return energy
 * 
 *     cdef inline float _calc_one_energy(self, int target_atom_index, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float flat_bottom_shift_limit
 *         cdef float adjusted_shift_diff
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__calc_one_energy(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index, int __pyx_v_index) {
  float __pyx_v_flat_bottom_shift_limit;
  float __pyx_v_adjusted_shift_diff;
  float __pyx_v_end_harmonic;
  float __pyx_v_scale_harmonic;
  float __pyx_v_tanh_amplitude;
  float __pyx_v_tanh_elongation;
  float __pyx_v_tanh_y_offset;
  float __pyx_v_tanh_argument;
  float __pyx_v_energy;
  float __pyx_v_shift_diff;
  struct __pyx_t_17shift_calculators_Constant_cache *__pyx_v_energy_terms;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_one_energy", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1562")'> 1562:         cdef float flat_bottom_shift_limit</pre>
<pre id='line1562' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1563")'> 1563:         cdef float adjusted_shift_diff</pre>
<pre id='line1563' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1564")'> 1564:         cdef float end_harmonic</pre>
<pre id='line1564' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1565")'> 1565:         cdef float scale_harmonic</pre>
<pre id='line1565' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1566")'> 1566:         cdef float tanh_amplitude</pre>
<pre id='line1566' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1567")'> 1567:         cdef float tanh_elongation</pre>
<pre id='line1567' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1568")'> 1568:         cdef float tanh_y_offset</pre>
<pre id='line1568' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1569")'> 1569:         cdef float tanh_argument</pre>
<pre id='line1569' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1570")'> 1570:         cdef float energy</pre>
<pre id='line1570' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1571")'> 1571:         cdef float shift_diff</pre>
<pre id='line1571' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1572")'> 1572: </pre>
<pre id='line1572' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1573")'> 1573: </pre>
<pre id='line1573' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1574")'> 1574: </pre>
<pre id='line1574' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1575")'> 1575: </pre>
<pre id='line1575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1576")'> 1576: </pre>
<pre id='line1576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1577")'> 1577:         cdef float shift_diffs</pre>
<pre id='line1577' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1578")'> 1578:         cdef Constant_cache* energy_terms</pre>
<pre id='line1578' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1579")'> 1579: </pre>
<pre id='line1579' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1580")'> 1580:         shift_diff = self._get_shift_difference(target_atom_index, index)</pre>
<pre id='line1580' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1580
 *         cdef Constant_cache* energy_terms
 * 
 *         shift_diff = self._get_shift_difference(target_atom_index, index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         energy_terms = self._get_energy_terms(index)
 * 
 */
  __pyx_v_shift_diff = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(__pyx_v_self, __pyx_v_target_atom_index, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1581")'> 1581:         energy_terms = self._get_energy_terms(index)</pre>
<pre id='line1581' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1581
 * 
 *         shift_diff = self._get_shift_difference(target_atom_index, index)
 *         energy_terms = self._get_energy_terms(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         flat_bottom_shift_limit = energy_terms[0].flat_bottom_shift_limit
 */
  __pyx_v_energy_terms = ((struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *)__pyx_v_self->__pyx_vtab)->_get_energy_terms(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1582")'> 1582: </pre>
<pre id='line1582' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1583")'> 1583:         flat_bottom_shift_limit = energy_terms[0].flat_bottom_shift_limit</pre>
<pre id='line1583' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1583
 *         energy_terms = self._get_energy_terms(index)
 * 
 *         flat_bottom_shift_limit = energy_terms[0].flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         energy = 0.0
 */
  __pyx_t_1 = (__pyx_v_energy_terms[0]).flat_bottom_shift_limit;
  __pyx_v_flat_bottom_shift_limit = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1584")'> 1584: </pre>
<pre id='line1584' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1585")'> 1585:         energy = 0.0</pre>
<pre id='line1585' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1585
 *         flat_bottom_shift_limit = energy_terms[0].flat_bottom_shift_limit
 * 
 *         energy = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if fabs(shift_diff) > flat_bottom_shift_limit:
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 */
  __pyx_v_energy = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1586")'> 1586:         if fabs(shift_diff) &gt; flat_bottom_shift_limit:</pre>
<pre id='line1586' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1586
 * 
 *         energy = 0.0
 *         if fabs(shift_diff) > flat_bottom_shift_limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 * 
 */
  __pyx_t_2 = (fabs(__pyx_v_shift_diff) > __pyx_v_flat_bottom_shift_limit);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1587")'> 1587:             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)</pre>
<pre id='line1587' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1587
 *         energy = 0.0
 *         if fabs(shift_diff) > flat_bottom_shift_limit:
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             end_harmonic = energy_terms[0].end_harmonic
 */
    __pyx_v_adjusted_shift_diff = __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(__pyx_v_self, __pyx_v_shift_diff, __pyx_v_flat_bottom_shift_limit);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1588")'> 1588: </pre>
<pre id='line1588' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1589")'> 1589:             end_harmonic = energy_terms[0].end_harmonic</pre>
<pre id='line1589' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1589
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 * 
 *             end_harmonic = energy_terms[0].end_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             scale_harmonic = energy_terms[0].scale_harmonic
 * 
 */
    __pyx_t_1 = (__pyx_v_energy_terms[0]).end_harmonic;
    __pyx_v_end_harmonic = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1590")'> 1590:             scale_harmonic = energy_terms[0].scale_harmonic</pre>
<pre id='line1590' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1590
 * 
 *             end_harmonic = energy_terms[0].end_harmonic
 *             scale_harmonic = energy_terms[0].scale_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = (__pyx_v_energy_terms[0]).scale_harmonic;
    __pyx_v_scale_harmonic = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1591")'> 1591: </pre>
<pre id='line1591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1592")'> 1592: </pre>
<pre id='line1592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1593")'> 1593:             if adjusted_shift_diff &lt; end_harmonic:</pre>
<pre id='line1593' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1593
 * 
 * 
 *             if adjusted_shift_diff <code><</code> end_harmonic:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 energy += (adjusted_shift_diff/scale_harmonic)**2
 *             else:
 */
    __pyx_t_2 = (__pyx_v_adjusted_shift_diff <code><</code> __pyx_v_end_harmonic);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1594")'> 1594:                 energy += (adjusted_shift_diff/scale_harmonic)**2</pre>
<pre id='line1594' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1594
 * 
 *             if adjusted_shift_diff <code><</code> end_harmonic:
 *                 energy += (adjusted_shift_diff/scale_harmonic)**2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 tanh_amplitude = energy_terms[0].tanh_amplitude
 */
      __pyx_v_energy = (__pyx_v_energy + powf((__pyx_v_adjusted_shift_diff / __pyx_v_scale_harmonic), 2.0));
      goto __pyx_L4;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1595")'> 1595:             else:</pre>
<pre id='line1595' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1596")'> 1596:                 tanh_amplitude = energy_terms[0].tanh_amplitude</pre>
<pre id='line1596' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1596
 *                 energy += (adjusted_shift_diff/scale_harmonic)**2
 *             else:
 *                 tanh_amplitude = energy_terms[0].tanh_amplitude             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 tanh_elongation = energy_terms[0].tanh_elongation
 *                 tanh_y_offset = energy_terms[0].tanh_y_offset
 */
      __pyx_t_1 = (__pyx_v_energy_terms[0]).tanh_amplitude;
      __pyx_v_tanh_amplitude = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1597")'> 1597:                 tanh_elongation = energy_terms[0].tanh_elongation</pre>
<pre id='line1597' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1597
 *             else:
 *                 tanh_amplitude = energy_terms[0].tanh_amplitude
 *                 tanh_elongation = energy_terms[0].tanh_elongation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 tanh_y_offset = energy_terms[0].tanh_y_offset
 * 
 */
      __pyx_t_1 = (__pyx_v_energy_terms[0]).tanh_elongation;
      __pyx_v_tanh_elongation = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1598")'> 1598:                 tanh_y_offset = energy_terms[0].tanh_y_offset</pre>
<pre id='line1598' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1598
 *                 tanh_amplitude = energy_terms[0].tanh_amplitude
 *                 tanh_elongation = energy_terms[0].tanh_elongation
 *                 tanh_y_offset = energy_terms[0].tanh_y_offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)
 */
      __pyx_t_1 = (__pyx_v_energy_terms[0]).tanh_y_offset;
      __pyx_v_tanh_y_offset = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1599")'> 1599: </pre>
<pre id='line1599' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1600")'> 1600:                 tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)</pre>
<pre id='line1600' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1600
 *                 tanh_y_offset = energy_terms[0].tanh_y_offset
 * 
 *                 tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 energy += tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;
 * 
 */
      __pyx_v_tanh_argument = (__pyx_v_tanh_elongation * (__pyx_v_adjusted_shift_diff - __pyx_v_end_harmonic));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1601")'> 1601:                 energy += tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;</pre>
<pre id='line1601' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1601
 * 
 *                 tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)
 *                 energy += tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_v_energy = (__pyx_v_energy + ((__pyx_v_tanh_amplitude * tanh(__pyx_v_tanh_argument)) + __pyx_v_tanh_y_offset));
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1602")'> 1602: </pre>
<pre id='line1602' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1603")'> 1603: </pre>
<pre id='line1603' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line1604")'> 1604:         return energy</pre>
<pre id='line1604' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":1604
 * 
 * 
 *         return energy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):
 */
  __pyx_r = __pyx_v_energy;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_28Fast_force_factor_calculator_1__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_28Fast_force_factor_calculator_1__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_target_atom_ids = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_result = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_active_atom_ids = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,&__pyx_n_s__result,&__pyx_n_s__active_atom_ids,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__result)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_atom_ids)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_target_atom_ids = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_target_atom_ids.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_result = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_float</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_result.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_active_atom_ids = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_active_atom_ids.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_force_factor_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_28Fast_force_factor_calculator___call__(((struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self), __pyx_v_target_atom_ids, __pyx_v_result, __pyx_v_active_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1605")'> 1605: </pre>
<pre id='line1605' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1606")'> 1606: cdef class Fast_force_factor_calculator(Fast_energy_calculator):</pre>
<pre id='line1606' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1606
 *         return energy
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator __pyx_base;
  void (*calc)(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice);
  float (*_calc_one_force_factor)(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *, int, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *__pyx_vtabptr_17shift_calculators_Fast_force_factor_calculator;
static CYTHON_INLINE float __pyx_f_17shift_calculators_28Fast_force_factor_calculator__calc_one_force_factor(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *, int, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1607")'> 1607: </pre>
<pre id='line1607' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1608")'> 1608:     @cython.profile(True)</pre>
<pre id='line1608' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1609")'> 1609:     def __call__(self, int[:] target_atom_ids, float[:] result, int[:] active_atom_ids):</pre>
<pre id='line1609' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1609
 * 
 *     @cython.profile(True)
 *     def __call__(self, int[:] target_atom_ids, float[:] result, int[:] active_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 */

static PyObject *__pyx_pf_17shift_calculators_28Fast_force_factor_calculator___call__(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_target_atom_ids, __Pyx_memviewslice __pyx_v_result, __Pyx_memviewslice __pyx_v_active_atom_ids) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1609);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1610")'> 1610:         cdef double start_time =0.0</pre>
<pre id='line1610' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1610
 *     @cython.profile(True)
 *     def __call__(self, int[:] target_atom_ids, float[:] result, int[:] active_atom_ids):
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1611")'> 1611:         cdef double end_time =0.0</pre>
<pre id='line1611' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1611
 *     def __call__(self, int[:] target_atom_ids, float[:] result, int[:] active_atom_ids):
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1612")'> 1612: </pre>
<pre id='line1612' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1613")'> 1613:         if self._verbose:</pre>
<pre id='line1613' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1613
 *         cdef double end_time =0.0
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1614")'> 1614:             start_time = time()</pre>
<pre id='line1614' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1614
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.calc( target_atom_ids, result,  active_atom_ids)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1615")'> 1615: </pre>
<pre id='line1615' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1616")'> 1616:         self.calc( target_atom_ids, result,  active_atom_ids)</pre>
<pre id='line1616' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1616
 *             start_time = time()
 * 
 *         self.calc( target_atom_ids, result,  active_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->calc(__pyx_v_self, __pyx_v_target_atom_ids, __pyx_v_result, __pyx_v_active_atom_ids);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1617")'> 1617: </pre>
<pre id='line1617' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1618")'> 1618:         if self._verbose:</pre>
<pre id='line1618' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1618
 *         self.calc( target_atom_ids, result,  active_atom_ids)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1619")'> 1619:             end_time = time()</pre>
<pre id='line1619' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1619
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2c' onclick='toggleDiv("line1620")'> 1620:             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1620' class='code' style='background-color: #FFFF2c'>
    /* "Cython_shift_calculator.pyx":1620
 *         if self._verbose:
 *             end_time = time()
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void calc(self, int[:] target_atom_ids, float[:] result, int[:] active_atom_ids) nogil:
 */
    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_target_atom_ids, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_39));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_kp_s_36));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_t_5));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_5 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_2), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_force_factor_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_target_atom_ids, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_result, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_atom_ids, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1621")'> 1621: </pre>
<pre id='line1621' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1622")'> 1622:     cdef void calc(self, int[:] target_atom_ids, float[:] result, int[:] active_atom_ids) nogil:</pre>
<pre id='line1622' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1622
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 *     cdef void calc(self, int[:] target_atom_ids, float[:] result, int[:] active_atom_ids) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *        #TODO: shouldn't be allocated each time
 *         cdef int target_atom_id
 */

static void __pyx_f_17shift_calculators_28Fast_force_factor_calculator_calc(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_target_atom_ids, __Pyx_memviewslice __pyx_v_result, __Pyx_memviewslice __pyx_v_active_atom_ids) {
  int __pyx_v_target_atom_id;
  int __pyx_v_active_atom_id;
  int __pyx_v_i;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1623")'> 1623:        #TODO: shouldn't be allocated each time</pre>
<pre id='line1623' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1624")'> 1624:         cdef int target_atom_id</pre>
<pre id='line1624' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1625")'> 1625:         cdef int active_atom_id</pre>
<pre id='line1625' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1626")'> 1626:         cdef int i</pre>
<pre id='line1626' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1627")'> 1627: </pre>
<pre id='line1627' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1628")'> 1628:         if active_atom_ids == None:</pre>
<pre id='line1628' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1628
 *         cdef int i
 * 
 *         if active_atom_ids == None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i in range(target_atom_ids.shape[0]):
 *                 target_atom_id = target_atom_ids[i]
 */
  __pyx_t_1 = (((PyObject *) __pyx_v_active_atom_ids.memview) == Py_None);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1629")'> 1629:             for i in range(target_atom_ids.shape[0]):</pre>
<pre id='line1629' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1629
 * 
 *         if active_atom_ids == None:
 *             for i in range(target_atom_ids.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 target_atom_id = target_atom_ids[i]
 *                 result[i] = self._calc_one_force_factor(target_atom_id, i)
 */
    __pyx_t_2 = (__pyx_v_target_atom_ids.shape[0]);
    for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1630")'> 1630:                 target_atom_id = target_atom_ids[i]</pre>
<pre id='line1630' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1630
 *         if active_atom_ids == None:
 *             for i in range(target_atom_ids.shape[0]):
 *                 target_atom_id = target_atom_ids[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i] = self._calc_one_force_factor(target_atom_id, i)
 *         else:
 */
      __pyx_t_4 = __pyx_v_i;
      __pyx_v_target_atom_id = (*((int *) ( /* dim=0 */ (__pyx_v_target_atom_ids.data + __pyx_t_4 * __pyx_v_target_atom_ids.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1631")'> 1631:                 result[i] = self._calc_one_force_factor(target_atom_id, i)</pre>
<pre id='line1631' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1631
 *             for i in range(target_atom_ids.shape[0]):
 *                 target_atom_id = target_atom_ids[i]
 *                 result[i] = self._calc_one_force_factor(target_atom_id, i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             for i in  range(active_atom_ids.shape[0]):
 */
      __pyx_t_5 = __pyx_v_i;
      *((float *) ( /* dim=0 */ (__pyx_v_result.data + __pyx_t_5 * __pyx_v_result.strides[0]) )) = __pyx_f_17shift_calculators_28Fast_force_factor_calculator__calc_one_force_factor(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_i);
    }
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1632")'> 1632:         else:</pre>
<pre id='line1632' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1633")'> 1633:             for i in  range(active_atom_ids.shape[0]):</pre>
<pre id='line1633' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1633
 *                 result[i] = self._calc_one_force_factor(target_atom_id, i)
 *         else:
 *             for i in  range(active_atom_ids.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 active_atom_id = active_atom_ids[i]
 *                 target_atom_id = target_atom_ids[active_atom_id]
 */
    __pyx_t_2 = (__pyx_v_active_atom_ids.shape[0]);
    for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1634")'> 1634:                 active_atom_id = active_atom_ids[i]</pre>
<pre id='line1634' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1634
 *         else:
 *             for i in  range(active_atom_ids.shape[0]):
 *                 active_atom_id = active_atom_ids[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 target_atom_id = target_atom_ids[active_atom_id]
 * 
 */
      __pyx_t_6 = __pyx_v_i;
      __pyx_v_active_atom_id = (*((int *) ( /* dim=0 */ (__pyx_v_active_atom_ids.data + __pyx_t_6 * __pyx_v_active_atom_ids.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1635")'> 1635:                 target_atom_id = target_atom_ids[active_atom_id]</pre>
<pre id='line1635' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1635
 *             for i in  range(active_atom_ids.shape[0]):
 *                 active_atom_id = active_atom_ids[i]
 *                 target_atom_id = target_atom_ids[active_atom_id]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 result[i] = self._calc_one_force_factor(target_atom_id, active_atom_id)
 */
      __pyx_t_7 = __pyx_v_active_atom_id;
      __pyx_v_target_atom_id = (*((int *) ( /* dim=0 */ (__pyx_v_target_atom_ids.data + __pyx_t_7 * __pyx_v_target_atom_ids.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1636")'> 1636: </pre>
<pre id='line1636' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1637")'> 1637:                 result[i] = self._calc_one_force_factor(target_atom_id, active_atom_id)</pre>
<pre id='line1637' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1637
 *                 target_atom_id = target_atom_ids[active_atom_id]
 * 
 *                 result[i] = self._calc_one_force_factor(target_atom_id, active_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_8 = __pyx_v_i;
      *((float *) ( /* dim=0 */ (__pyx_v_result.data + __pyx_t_8 * __pyx_v_result.strides[0]) )) = __pyx_f_17shift_calculators_28Fast_force_factor_calculator__calc_one_force_factor(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_active_atom_id);
    }
  }
  __pyx_L3:;

}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1638")'> 1638: </pre>
<pre id='line1638' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1639")'> 1639: </pre>
<pre id='line1639' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1640")'> 1640: </pre>
<pre id='line1640' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1641")'> 1641:     cdef inline float _calc_one_force_factor(self, int target_atom_id, int i) nogil:</pre>
<pre id='line1641' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1641
 * 
 * 
 *     cdef inline float _calc_one_force_factor(self, int target_atom_id, int i) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float factor
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_28Fast_force_factor_calculator__calc_one_force_factor(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_i) {
  float __pyx_v_factor;
  float __pyx_v_shift_diff;
  float __pyx_v_flat_bottom_shift_limit;
  struct __pyx_t_17shift_calculators_Constant_cache *__pyx_v_energy_terms;
  float __pyx_v_adjusted_shift_diff;
  float __pyx_v_end_harmonic;
  float __pyx_v_scale_harmonic;
  float __pyx_v_sqr_scale_harmonic;
  float __pyx_v_weight;
  float __pyx_v_tanh_amplitude;
  float __pyx_v_tanh_elongation;
  double __pyx_v_fact;
  float __pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1642")'> 1642: </pre>
<pre id='line1642' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1643")'> 1643:         cdef float factor</pre>
<pre id='line1643' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1644")'> 1644:         cdef float shift_diff</pre>
<pre id='line1644' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1645")'> 1645:         cdef float flat_bottom_shift_limit</pre>
<pre id='line1645' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1646")'> 1646:         cdef Constant_cache* energy_terms</pre>
<pre id='line1646' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1647")'> 1647:         cdef float adjusted_shift_diff</pre>
<pre id='line1647' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1648")'> 1648:         cdef float end_harmonic</pre>
<pre id='line1648' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1649")'> 1649:         cdef float scale_harmonic</pre>
<pre id='line1649' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1650")'> 1650:         cdef float sqr_scale_harmonic</pre>
<pre id='line1650' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1651")'> 1651:         cdef float weight</pre>
<pre id='line1651' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1652")'> 1652:         cdef float tanh_amplitude</pre>
<pre id='line1652' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1653")'> 1653:         cdef float tanh_elongation</pre>
<pre id='line1653' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1654")'> 1654: </pre>
<pre id='line1654' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1655")'> 1655:         factor = 0.0</pre>
<pre id='line1655' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1655
 *         cdef float tanh_elongation
 * 
 *         factor = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_factor = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1656")'> 1656: </pre>
<pre id='line1656' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1657")'> 1657: </pre>
<pre id='line1657' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1658")'> 1658:         shift_diff = self._get_shift_difference(target_atom_id, i)</pre>
<pre id='line1658' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1658
 * 
 * 
 *         shift_diff = self._get_shift_difference(target_atom_id, i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         energy_terms = self._get_energy_terms(i)
 * 
 */
  __pyx_v_shift_diff = ((struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base._get_shift_difference(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_i);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1659")'> 1659:         energy_terms = self._get_energy_terms(i)</pre>
<pre id='line1659' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1659
 * 
 *         shift_diff = self._get_shift_difference(target_atom_id, i)
 *         energy_terms = self._get_energy_terms(i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_energy_terms = ((struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base._get_energy_terms(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_i);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1660")'> 1660: </pre>
<pre id='line1660' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1661")'> 1661: </pre>
<pre id='line1661' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1662")'> 1662:         flat_bottom_shift_limit = energy_terms[0].flat_bottom_shift_limit</pre>
<pre id='line1662' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1662
 * 
 * 
 *         flat_bottom_shift_limit = energy_terms[0].flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if fabs(shift_diff) > flat_bottom_shift_limit:
 */
  __pyx_t_1 = (__pyx_v_energy_terms[0]).flat_bottom_shift_limit;
  __pyx_v_flat_bottom_shift_limit = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1663")'> 1663: </pre>
<pre id='line1663' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1664")'> 1664:         if fabs(shift_diff) &gt; flat_bottom_shift_limit:</pre>
<pre id='line1664' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1664
 *         flat_bottom_shift_limit = energy_terms[0].flat_bottom_shift_limit
 * 
 *         if fabs(shift_diff) > flat_bottom_shift_limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *             end_harmonic = energy_terms[0].end_harmonic
 */
  __pyx_t_2 = (fabs(__pyx_v_shift_diff) > __pyx_v_flat_bottom_shift_limit);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1665")'> 1665:             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)</pre>
<pre id='line1665' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1665
 * 
 *         if fabs(shift_diff) > flat_bottom_shift_limit:
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_harmonic = energy_terms[0].end_harmonic
 *             scale_harmonic = energy_terms[0].scale_harmonic
 */
    __pyx_v_adjusted_shift_diff = ((struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base._adjust_shift(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_shift_diff, __pyx_v_flat_bottom_shift_limit);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1666")'> 1666:             end_harmonic = energy_terms[0].end_harmonic</pre>
<pre id='line1666' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1666
 *         if fabs(shift_diff) > flat_bottom_shift_limit:
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *             end_harmonic = energy_terms[0].end_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             scale_harmonic = energy_terms[0].scale_harmonic
 *             sqr_scale_harmonic = scale_harmonic**2
 */
    __pyx_t_1 = (__pyx_v_energy_terms[0]).end_harmonic;
    __pyx_v_end_harmonic = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1667")'> 1667:             scale_harmonic = energy_terms[0].scale_harmonic</pre>
<pre id='line1667' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1667
 *             adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *             end_harmonic = energy_terms[0].end_harmonic
 *             scale_harmonic = energy_terms[0].scale_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             sqr_scale_harmonic = scale_harmonic**2
 * 
 */
    __pyx_t_1 = (__pyx_v_energy_terms[0]).scale_harmonic;
    __pyx_v_scale_harmonic = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1668")'> 1668:             sqr_scale_harmonic = scale_harmonic**2</pre>
<pre id='line1668' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1668
 *             end_harmonic = energy_terms[0].end_harmonic
 *             scale_harmonic = energy_terms[0].scale_harmonic
 *             sqr_scale_harmonic = scale_harmonic**2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             weight = energy_terms[0].weight
 */
    __pyx_v_sqr_scale_harmonic = powf(__pyx_v_scale_harmonic, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1669")'> 1669: </pre>
<pre id='line1669' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1670")'> 1670:             weight = energy_terms[0].weight</pre>
<pre id='line1670' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1670
 *             sqr_scale_harmonic = scale_harmonic**2
 * 
 *             weight = energy_terms[0].weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             tanh_amplitude = energy_terms[0].tanh_amplitude
 */
    __pyx_t_1 = (__pyx_v_energy_terms[0]).weight;
    __pyx_v_weight = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1671")'> 1671: </pre>
<pre id='line1671' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1672")'> 1672:             tanh_amplitude = energy_terms[0].tanh_amplitude</pre>
<pre id='line1672' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1672
 *             weight = energy_terms[0].weight
 * 
 *             tanh_amplitude = energy_terms[0].tanh_amplitude             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             tanh_elongation = energy_terms[0].tanh_elongation
 * 
 */
    __pyx_t_1 = (__pyx_v_energy_terms[0]).tanh_amplitude;
    __pyx_v_tanh_amplitude = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1673")'> 1673:             tanh_elongation = energy_terms[0].tanh_elongation</pre>
<pre id='line1673' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1673
 * 
 *             tanh_amplitude = energy_terms[0].tanh_amplitude
 *             tanh_elongation = energy_terms[0].tanh_elongation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # TODO: add factor and lambda to give fact
 */
    __pyx_t_1 = (__pyx_v_energy_terms[0]).tanh_elongation;
    __pyx_v_tanh_elongation = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1674")'> 1674: </pre>
<pre id='line1674' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1675")'> 1675:             # TODO: add factor and lambda to give fact</pre>
<pre id='line1675' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1676")'> 1676:             fact =1.0</pre>
<pre id='line1676' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1676
 * 
 *             # TODO: add factor and lambda to give fact
 *             fact =1.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if adjusted_shift_diff <code><</code> end_harmonic:
 *                 factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 */
    __pyx_v_fact = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1677")'> 1677:             if adjusted_shift_diff &lt; end_harmonic:</pre>
<pre id='line1677' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1677
 *             # TODO: add factor and lambda to give fact
 *             fact =1.0
 *             if adjusted_shift_diff <code><</code> end_harmonic:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 *             else:
 */
    __pyx_t_2 = (__pyx_v_adjusted_shift_diff <code><</code> __pyx_v_end_harmonic);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1678")'> 1678:                 factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;</pre>
<pre id='line1678' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1678
 *             fact =1.0
 *             if adjusted_shift_diff <code><</code> end_harmonic:
 *                 factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;
 */
      __pyx_v_factor = ((((2.0 * __pyx_v_weight) * __pyx_v_adjusted_shift_diff) * __pyx_v_fact) / __pyx_v_sqr_scale_harmonic);
      goto __pyx_L4;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1679")'> 1679:             else:</pre>
<pre id='line1679' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1680")'> 1680:                 factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;</pre>
<pre id='line1680' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1680
 *                 factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 *             else:
 *                 factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return factor
 * 
 */
      __pyx_v_factor = ((((__pyx_v_weight * __pyx_v_tanh_amplitude) * __pyx_v_tanh_elongation) / pow(cosh((__pyx_v_tanh_elongation * (__pyx_v_adjusted_shift_diff - __pyx_v_end_harmonic))), 2.0)) * __pyx_v_fact);
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1681")'> 1681:         return factor</pre>
<pre id='line1681' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1681
 *             else:
 *                 factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;
 *         return factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_factor;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_21Base_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_21Base_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_potential = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__potential,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1682")'> 1682: </pre>
<pre id='line1682' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1683")'> 1683: </pre>
<pre id='line1683' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1684")'> 1684: cdef class Base_force_calculator:</pre>
<pre id='line1684' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1684
 * 
 * 
 * cdef class Base_force_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef bint _verbose
 */
struct __pyx_obj_17shift_calculators_Base_force_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *__pyx_vtab;
  int _verbose;
  Simulation *_simulation;
  PyObject *_name;
  __Pyx_memviewslice _active_components;
};


/* "Cython_shift_calculator.pyx":1684
 * 
 * 
 * cdef class Base_force_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef bint _verbose
 */

struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator {
  void (*_do_calc_components)(struct __pyx_obj_17shift_calculators_Base_force_calculator *, __Pyx_memviewslice, __Pyx_memviewslice, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *__pyx_vtabptr_17shift_calculators_Base_force_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1685")'> 1685: </pre>
<pre id='line1685' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1686")'> 1686:     cdef bint _verbose</pre>
<pre id='line1686' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1687")'> 1687:     cdef Simulation* _simulation</pre>
<pre id='line1687' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1688")'> 1688:     cdef str _name</pre>
<pre id='line1688' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1689")'> 1689:     cdef int[:] _active_components</pre>
<pre id='line1689' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1690")'> 1690: </pre>
<pre id='line1690' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line1691")'> 1691:     def __init__(self,potential=None, name= "not set"):</pre>
<pre id='line1691' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":1691
 *     cdef int[:] _active_components
 * 
 *     def __init__(self,potential=None, name= "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 * 
 */
    values[0] = ((PyObject *)Py_None);
    values[1] = ((PyObject *)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__potential);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_potential = values[0];
    __pyx_v_name = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_potential, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static int __pyx_pf_17shift_calculators_21Base_force_calculator___init__(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_potential, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1692")'> 1692:         self._verbose = False</pre>
<pre id='line1692' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1692
 * 
 *     def __init__(self,potential=None, name= "not set"):
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1693")'> 1693: </pre>
<pre id='line1693' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1694")'> 1694: </pre>
<pre id='line1694' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1695")'> 1695:         self._name = name</pre>
<pre id='line1695' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1695
 * 
 * 
 *         self._name = name             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  if (!(likely(<span class='py_c_api'>PyString_CheckExact</span>(__pyx_v_name))||((__pyx_v_name) == Py_None)||(<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected str, got %.200s", Py_TYPE(__pyx_v_name)->tp_name), 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_name);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_name);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_name);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_name));
  __pyx_v_self->_name = ((PyObject*)__pyx_v_name);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1696")'> 1696: </pre>
<pre id='line1696' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1697")'> 1697: </pre>
<pre id='line1697' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1698")'> 1698:     def set_verbose(self,on):</pre>
<pre id='line1698' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1698
 * 
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1699")'> 1699:         self._verbose = on</pre>
<pre id='line1699' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1699
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_4_set_components(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1700")'> 1700: </pre>
<pre id='line1700' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1701")'> 1701: </pre>
<pre id='line1701' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1702")'> 1702: </pre>
<pre id='line1702' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1703")'> 1703:     def _set_components(self,components):</pre>
<pre id='line1703' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1703
 * 
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_components(components['ATOM'])
 *         self._simulation = <code><</code>Simulation*><code><</code>size_t>int(components['SIMU'].this)
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_4_set_components(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line1704")'> 1704:         self._bytes_to_components(components['ATOM'])</pre>
<pre id='line1704' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":1704
 * 
 *     def _set_components(self,components):
 *         self._bytes_to_components(components['ATOM'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = <code><</code>Simulation*><code><</code>size_t>int(components['SIMU'].this)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_22);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__ATOM));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF15' onclick='toggleDiv("line1705")'> 1705:         self._simulation = &lt;Simulation*&gt;&lt;size_t&gt;int(components['SIMU'].this)</pre>
<pre id='line1705' class='code' style='background-color: #FFFF15'>
  /* "Cython_shift_calculator.pyx":1705
 *     def _set_components(self,components):
 *         self._bytes_to_components(components['ATOM'])
 *         self._simulation = <code><</code>Simulation*><code><</code>size_t>int(components['SIMU'].this)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__SIMU));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__this);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_simulation = ((Simulation *)((size_t)__pyx_t_4));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  __Pyx_memviewslice __pyx_v_component_to_result = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_force_factors = { 0, 0, { 0 }, { 0 }, { 0 } };
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  __Pyx_memviewslice __pyx_v_active_components = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__component_to_result,&__pyx_n_s__force_factors,&__pyx_n_s__forces,&__pyx_n_s__active_components,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_result)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 0, 4, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factors)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 0, 4, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 0, 4, 5, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_components);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_components = values[0];
    __pyx_v_component_to_result = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_result.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factors = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_float</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_force_factors.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[3]);
    if (values[4]) {
      __pyx_v_active_components = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[4]);<span class='error_goto'> if (unlikely(!__pyx_v_active_components.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_active_components = __pyx_k_40;
      __PYX_INC_MEMVIEW(&__pyx_v_active_components, 1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 0, 4, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_forces, __pyx_v_active_components);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1706")'> 1706: </pre>
<pre id='line1706' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1707")'> 1707: </pre>
<pre id='line1707' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1708")'> 1708: #    TODO should most probably be a fixed array</pre>
<pre id='line1708' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1709")'> 1709:     @cython.profile(True)</pre>
<pre id='line1709' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1710")'> 1710:     def __call__(self, object components, int[:] component_to_result, float[:] force_factors, Out_array forces, int[:] active_components=None):</pre>
<pre id='line1710' class='code' style='background-color: #FFFFb6'>
/* "Cython_shift_calculator.pyx":1710
 * #    TODO should most probably be a fixed array
 *     @cython.profile(True)
 *     def __call__(self, object components, int[:] component_to_result, float[:] force_factors, Out_array forces, int[:] active_components=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time =0.0
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_6__call__(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_components, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces, __Pyx_memviewslice __pyx_v_active_components) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1710);

  /* "Cython_shift_calculator.pyx":1710
 * #    TODO should most probably be a fixed array
 *     @cython.profile(True)
 *     def __call__(self, object components, int[:] component_to_result, float[:] force_factors, Out_array forces, int[:] active_components=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time =0.0
 */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(Py_None);
  if (unlikely(!__pyx_t_4.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1710; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_k_40 = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1711")'> 1711: </pre>
<pre id='line1711' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1712")'> 1712:         cdef double start_time =0.0</pre>
<pre id='line1712' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1712
 *     def __call__(self, object components, int[:] component_to_result, float[:] force_factors, Out_array forces, int[:] active_components=None):
 * 
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1713")'> 1713:         cdef double end_time =0.0</pre>
<pre id='line1713' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1713
 * 
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1714")'> 1714:         if self._verbose:</pre>
<pre id='line1714' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1714
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1715")'> 1715:             start_time = time()</pre>
<pre id='line1715' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1715
 *         cdef double end_time =0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1716")'> 1716: </pre>
<pre id='line1716' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line1717")'> 1717:         self._set_components(components)</pre>
<pre id='line1717' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":1717
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        TODO rename component to result to something better
 *         self._active_components = active_components
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1718")'> 1718: #        TODO rename component to result to something better</pre>
<pre id='line1718' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1719")'> 1719:         self._active_components = active_components</pre>
<pre id='line1719' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1719
 *         self._set_components(components)
 * #        TODO rename component to result to something better
 *         self._active_components = active_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._do_calc_components(component_to_result, force_factors, forces)
 * 
 */
  __PYX_XDEC_MEMVIEW(&__pyx_v_self->_active_components, 0);
  __PYX_INC_MEMVIEW(&__pyx_v_active_components, 0);
  __pyx_v_self->_active_components = __pyx_v_active_components;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1720")'> 1720:         self._do_calc_components(component_to_result, force_factors, forces)</pre>
<pre id='line1720' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1720
 * #        TODO rename component to result to something better
 *         self._active_components = active_components
 *         self._do_calc_components(component_to_result, force_factors, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        component_target_atom_ids = components.get_component_atom_ids()
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *)__pyx_v_self->__pyx_vtab)->_do_calc_components(__pyx_v_self, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1721")'> 1721: </pre>
<pre id='line1721' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1722")'> 1722: #        component_target_atom_ids = components.get_component_atom_ids()</pre>
<pre id='line1722' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1723")'> 1723: #        for i,target_atom_id in enumerate(target_atom_ids):</pre>
<pre id='line1723' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1724")'> 1724: #            if target_atom_id in component_target_atom_ids:</pre>
<pre id='line1724' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1725")'> 1725: #                try:</pre>
<pre id='line1725' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1726")'> 1726: #                    index_range = components.get_component_range(target_atom_id)</pre>
<pre id='line1726' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1727")'> 1727: #                except ValueError:</pre>
<pre id='line1727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1728")'> 1728: #                    print "warning atom is not in list", target_atom_id, Atom_utils._get_atom_info_from_index(target_atom_id),self._name</pre>
<pre id='line1728' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1729")'> 1729: #                    index_range = []</pre>
<pre id='line1729' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1730")'> 1730: #                for index in range(*index_range):</pre>
<pre id='line1730' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1731")'> 1731: </pre>
<pre id='line1731' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1732")'> 1732:         if self._verbose:</pre>
<pre id='line1732' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1732
 * #                for index in range(*index_range):
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1733")'> 1733:             end_time = time()</pre>
<pre id='line1733' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1733
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1734")'> 1734:             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1734' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":1734
 *         if self._verbose:
 *             end_time = time()
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_41));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_41));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_41));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->_name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_self->_name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->_name));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_42));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, ((PyObject *)__pyx_kp_s_42));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_42));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, ((PyObject *)__pyx_kp_s_36));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 5, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_result, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_force_factors, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_components, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1735")'> 1735: </pre>
<pre id='line1735' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1736")'> 1736:     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):</pre>
<pre id='line1736' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1736
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise Exception("this should not be called!")
 * 
 */

static void __pyx_f_17shift_calculators_21Base_force_calculator__do_calc_components(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, CYTHON_UNUSED __Pyx_memviewslice __pyx_v_component_to_result, CYTHON_UNUSED __Pyx_memviewslice __pyx_v_force_factors, CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1737")'> 1737:         raise Exception("this should not be called!")</pre>
<pre id='line1737' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":1737
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):
 *         raise Exception("this should not be called!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_k_tuple_44), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
 <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Base_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":1737
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):
 *         raise Exception("this should not be called!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_k_tuple_44 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)__pyx_kp_s_43));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_44)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_44);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_44));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1738")'> 1738: </pre>
<pre id='line1738' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1739")'> 1739: </pre>
<pre id='line1739' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1740")'> 1740: </pre>
<pre id='line1740' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1741")'> 1741: </pre>
<pre id='line1741' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1742")'> 1742: cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):</pre>
<pre id='line1742' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1742
 * 
 * 
 * cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  int _target_atom_index;
  int _distance_atom_index_1;
  int _distance_atom_index_2;
  int _exponent_index;
  int _coefficient_index;
  int _smoothed;
  float _smoothing_factor;
  float _cutoff;
  struct __pyx_t_17shift_calculators_Distance_component *_compiled_components;
  int _num_components;
  PyObject *raw_data;
};


/* "Cython_shift_calculator.pyx":1742
 * 
 * 
 * cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  Vec3 (*_xyz_distances)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
  float (*_sum_xyz_distances_2)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
  float (*_cython_calc_single_force_factor)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float);
  void (*_distance_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_distance_based_potential_force_calculator;
static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float);
static CYTHON_INLINE void __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1743")'> 1743: </pre>
<pre id='line1743' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1744")'> 1744: </pre>
<pre id='line1744' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1745")'> 1745: </pre>
<pre id='line1745' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1746")'> 1746:     cdef int  _target_atom_index</pre>
<pre id='line1746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1747")'> 1747:     cdef int  _distance_atom_index_1</pre>
<pre id='line1747' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1748")'> 1748:     cdef int  _distance_atom_index_2</pre>
<pre id='line1748' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1749")'> 1749:     cdef int  _exponent_index</pre>
<pre id='line1749' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1750")'> 1750:     cdef int  _coefficient_index</pre>
<pre id='line1750' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1751")'> 1751:     cdef bint  _smoothed</pre>
<pre id='line1751' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1752")'> 1752:     cdef float _smoothing_factor</pre>
<pre id='line1752' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1753")'> 1753:     cdef float _cutoff</pre>
<pre id='line1753' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1754")'> 1754:     cdef Distance_component* _compiled_components</pre>
<pre id='line1754' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1755")'> 1755:     cdef int _num_components</pre>
<pre id='line1755' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1756")'> 1756:     cdef object raw_data</pre>
<pre id='line1756' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1757")'> 1757: </pre>
<pre id='line1757' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1758")'> 1758:     def __cinit__(self):</pre>
<pre id='line1758' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1758
 *     cdef object raw_data
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components  = NULL
 *         self._num_components =  0
 */

static int __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1759")'> 1759:         self._compiled_components  = NULL</pre>
<pre id='line1759' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1759
 * 
 *     def __cinit__(self):
 *         self._compiled_components  = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line1760")'> 1760:         self._num_components =  0</pre>
<pre id='line1760' class='code' style='background-color: #FFFF32'>
  /* "Cython_shift_calculator.pyx":1760
 *     def __cinit__(self):
 *         self._compiled_components  = NULL
 *         self._num_components =  0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, bint smoothed, name="Not set"):
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)__pyx_kp_s_45);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1762; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1762; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1762; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_smoothed, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1761")'> 1761: </pre>
<pre id='line1761' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1762")'> 1762:     def __init__(self, bint smoothed, name="Not set"):</pre>
<pre id='line1762' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1762
 *         self._num_components =  0
 * 
 *     def __init__(self, bint smoothed, name="Not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._smoothed =  smoothed
 */

static int __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line1763")'> 1763:         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)</pre>
<pre id='line1763' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":1763
 * 
 *     def __init__(self, bint smoothed, name="Not set"):
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1763; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1763; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1763; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1763; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1763; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1763; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1764")'> 1764:         self._smoothed =  smoothed</pre>
<pre id='line1764' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1764
 *     def __init__(self, bint smoothed, name="Not set"):
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._smoothed =  smoothed             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 *         self._cutoff =  DEFAULT_CUTOFF
 */
  __pyx_v_self->_smoothed = __pyx_v_smoothed;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1765")'> 1765:         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR</pre>
<pre id='line1765' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1765
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff =  DEFAULT_CUTOFF
 * 
 */
  __pyx_v_self->_smoothing_factor = __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1766")'> 1766:         self._cutoff =  DEFAULT_CUTOFF</pre>
<pre id='line1766' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1766
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 *         self._cutoff =  DEFAULT_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_cutoff(self, cutoff):
 */
  __pyx_v_self->_cutoff = __pyx_v_17shift_calculators_DEFAULT_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_5set_cutoff(PyObject *__pyx_v_self, PyObject *__pyx_v_cutoff); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_5set_cutoff(PyObject *__pyx_v_self, PyObject *__pyx_v_cutoff) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_cutoff (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_4set_cutoff(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_cutoff));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1767")'> 1767: </pre>
<pre id='line1767' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1768")'> 1768:     def set_cutoff(self, cutoff):</pre>
<pre id='line1768' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1768
 *         self._cutoff =  DEFAULT_CUTOFF
 * 
 *     def set_cutoff(self, cutoff):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff =  cutoff
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_4set_cutoff(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_cutoff) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_cutoff", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1769")'> 1769:         self._cutoff =  cutoff</pre>
<pre id='line1769' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1769
 * 
 *     def set_cutoff(self, cutoff):
 *         self._cutoff =  cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_smoothing_factor(self,smoothing_factor):
 */
  __pyx_t_1 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_cutoff);<span class='error_goto'> if (unlikely((__pyx_t_1 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_cutoff = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.set_cutoff", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_7set_smoothing_factor(PyObject *__pyx_v_self, PyObject *__pyx_v_smoothing_factor); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_7set_smoothing_factor(PyObject *__pyx_v_self, PyObject *__pyx_v_smoothing_factor) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_smoothing_factor (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_6set_smoothing_factor(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_smoothing_factor));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1770")'> 1770: </pre>
<pre id='line1770' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1771")'> 1771:     def set_smoothing_factor(self,smoothing_factor):</pre>
<pre id='line1771' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1771
 *         self._cutoff =  cutoff
 * 
 *     def set_smoothing_factor(self,smoothing_factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor = smoothing_factor
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_6set_smoothing_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_smoothing_factor) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_smoothing_factor", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1772")'> 1772:         self._smoothing_factor = smoothing_factor</pre>
<pre id='line1772' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1772
 * 
 *     def set_smoothing_factor(self,smoothing_factor):
 *         self._smoothing_factor = smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_smoothing_factor);<span class='error_goto'> if (unlikely((__pyx_t_1 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_smoothing_factor = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.set_smoothing_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_9_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_9_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_8_bytes_to_components(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1773")'> 1773: </pre>
<pre id='line1773' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1774")'> 1774: </pre>
<pre id='line1774' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1775")'> 1775: </pre>
<pre id='line1775' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1776")'> 1776: </pre>
<pre id='line1776' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1777")'> 1777:     def _bytes_to_components(self, data):</pre>
<pre id='line1777' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1777
 * 
 * 
 *     def _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.raw_data =  data
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_8_bytes_to_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1778")'> 1778: </pre>
<pre id='line1778' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1779")'> 1779:         self.raw_data =  data</pre>
<pre id='line1779' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1779
 *     def _bytes_to_components(self, data):
 * 
 *         self.raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components =  <code><</code>Distance_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Distance_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->raw_data);
  __pyx_v_self->raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1780")'> 1780:         self._compiled_components =  &lt;Distance_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1780' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1780
 * 
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Distance_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Distance_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Distance_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line1781")'> 1781:         self._num_components =  len(data)/ sizeof(Distance_component)</pre>
<pre id='line1781' class='code' style='background-color: #FFFF1e'>
  /* "Cython_shift_calculator.pyx":1781
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Distance_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Distance_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Distance_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_11_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_11_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,&__pyx_n_s__forces,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_set") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_10_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1782")'> 1782: </pre>
<pre id='line1782' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1783")'> 1783: </pre>
<pre id='line1783' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1784")'> 1784: #   TODO: generalise this based on compiled components</pre>
<pre id='line1784' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1785")'> 1785:     def _calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1785' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1785
 * 
 * #   TODO: generalise this based on compiled components
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO tidy this up a hack for the test suite
 *         cdef Distance_component* saved_component_list = self._compiled_components
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_10_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Distance_component *__pyx_v_saved_component_list;
  int __pyx_v_saved_num_components;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1786")'> 1786:         #TODO tidy this up a hack for the test suite</pre>
<pre id='line1786' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1787")'> 1787:         cdef Distance_component* saved_component_list = self._compiled_components</pre>
<pre id='line1787' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1787
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 *         #TODO tidy this up a hack for the test suite
 *         cdef Distance_component* saved_component_list = self._compiled_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int saved_num_components = self._num_components
 * 
 */
  __pyx_t_1 = __pyx_v_self->_compiled_components;
  __pyx_v_saved_component_list = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1788")'> 1788:         cdef int saved_num_components = self._num_components</pre>
<pre id='line1788' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1788
 *         #TODO tidy this up a hack for the test suite
 *         cdef Distance_component* saved_component_list = self._compiled_components
 *         cdef int saved_num_components = self._num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._num_components  = 1
 */
  __pyx_t_2 = __pyx_v_self->_num_components;
  __pyx_v_saved_num_components = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1789")'> 1789: </pre>
<pre id='line1789' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1790")'> 1790:         self._num_components  = 1</pre>
<pre id='line1790' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1790
 *         cdef int saved_num_components = self._num_components
 * 
 *         self._num_components  = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = &saved_component_list[index]
 * 
 */
  __pyx_v_self->_num_components = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1791")'> 1791:         self._compiled_components = &amp;saved_component_list[index]</pre>
<pre id='line1791' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1791
 * 
 *         self._num_components  = 1
 *         self._compiled_components = &saved_component_list[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._distance_calc_single_force_set(0,factor,forces)
 */
  __pyx_v_self->_compiled_components = (&(__pyx_v_saved_component_list[__pyx_v_index]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1792")'> 1792: </pre>
<pre id='line1792' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1793")'> 1793:         self._distance_calc_single_force_set(0,factor,forces)</pre>
<pre id='line1793' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1793
 *         self._compiled_components = &saved_component_list[index]
 * 
 *         self._distance_calc_single_force_set(0,factor,forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_components = saved_component_list
 */
  __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(__pyx_v_self, 0, __pyx_v_factor, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1794")'> 1794: </pre>
<pre id='line1794' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1795")'> 1795:         self._compiled_components = saved_component_list</pre>
<pre id='line1795' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1795
 *         self._distance_calc_single_force_set(0,factor,forces)
 * 
 *         self._compiled_components = saved_component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = saved_num_components
 * 
 */
  __pyx_v_self->_compiled_components = __pyx_v_saved_component_list;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1796")'> 1796:         self._num_components = saved_num_components</pre>
<pre id='line1796' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1796
 * 
 *         self._compiled_components = saved_component_list
 *         self._num_components = saved_num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_num_components = __pyx_v_saved_num_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1797")'> 1797: </pre>
<pre id='line1797' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1798")'> 1798: </pre>
<pre id='line1798' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1799")'> 1799:     @cython.profile(False)</pre>
<pre id='line1799' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1800")'> 1800:     cdef inline Vec3 _xyz_distances(self, int target_atom, int distance_atom):</pre>
<pre id='line1800' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1800
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3 _xyz_distances(self, int target_atom, int distance_atom):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_pos, distant_pos
 * 
 */

static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_target_atom, int __pyx_v_distance_atom) {
  Vec3 __pyx_v_target_pos;
  Vec3 __pyx_v_distant_pos;
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_xyz_distances", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1801")'> 1801:         cdef Vec3 target_pos, distant_pos</pre>
<pre id='line1801' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1802")'> 1802: </pre>
<pre id='line1802' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1803")'> 1803: </pre>
<pre id='line1803' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1804")'> 1804:         target_pos = self._simulation[0].atomPos(target_atom)</pre>
<pre id='line1804' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1804
 * 
 * 
 *         target_pos = self._simulation[0].atomPos(target_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)
 * 
 */
  __pyx_v_target_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1805")'> 1805:         distant_pos =   self._simulation[0].atomPos(distance_atom)</pre>
<pre id='line1805' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1805
 * 
 *         target_pos = self._simulation[0].atomPos(target_atom)
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return target_pos - distant_pos
 */
  __pyx_v_distant_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_distance_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1806")'> 1806: </pre>
<pre id='line1806' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1807")'> 1807:         return target_pos - distant_pos</pre>
<pre id='line1807' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1807
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)
 * 
 *         return target_pos - distant_pos             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = (__pyx_v_target_pos - __pyx_v_distant_pos);
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1808")'> 1808: </pre>
<pre id='line1808' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1809")'> 1809:     @cython.profile(False)</pre>
<pre id='line1809' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1810")'> 1810:     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):</pre>
<pre id='line1810' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1810
 * 
 *     @cython.profile(False)
 *     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_pos, distant_pos, distance
 *         cdef float result =0.0
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_target_atom, int __pyx_v_distance_atom) {
  Vec3 __pyx_v_target_pos;
  Vec3 __pyx_v_distant_pos;
  Vec3 __pyx_v_distance;
  float __pyx_v_result;
  int __pyx_v_i;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_sum_xyz_distances_2", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1811")'> 1811:         cdef Vec3 target_pos, distant_pos, distance</pre>
<pre id='line1811' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1812")'> 1812:         cdef float result =0.0</pre>
<pre id='line1812' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1812
 *     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):
 *         cdef Vec3 target_pos, distant_pos, distance
 *         cdef float result =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int i
 * 
 */
  __pyx_v_result = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1813")'> 1813:         cdef int i</pre>
<pre id='line1813' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1814")'> 1814: </pre>
<pre id='line1814' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1815")'> 1815:         target_pos =   self._simulation[0].atomPos(target_atom)</pre>
<pre id='line1815' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1815
 *         cdef int i
 * 
 *         target_pos =   self._simulation[0].atomPos(target_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)
 * 
 */
  __pyx_v_target_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1816")'> 1816:         distant_pos =  self._simulation[0].atomPos(distance_atom)</pre>
<pre id='line1816' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1816
 * 
 *         target_pos =   self._simulation[0].atomPos(target_atom)
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         distance = Vec3(target_pos - distant_pos)
 */
  __pyx_v_distant_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_distance_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1817")'> 1817: </pre>
<pre id='line1817' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1818")'> 1818:         distance = Vec3(target_pos - distant_pos)</pre>
<pre id='line1818' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1818
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)
 * 
 *         distance = Vec3(target_pos - distant_pos)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for i in range(3):
 */
  __pyx_v_distance = Vec3((__pyx_v_target_pos - __pyx_v_distant_pos));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1819")'> 1819: </pre>
<pre id='line1819' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1820")'> 1820:         for i in range(3):</pre>
<pre id='line1820' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1820
 *         distance = Vec3(target_pos - distant_pos)
 * 
 *         for i in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result += distance[i] * distance[i]
 * 
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1821")'> 1821:             result += distance[i] * distance[i]</pre>
<pre id='line1821' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1821
 * 
 *         for i in range(3):
 *             result += distance[i] * distance[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
    __pyx_v_result = (__pyx_v_result + ((__pyx_v_distance[__pyx_v_i]) * (__pyx_v_distance[__pyx_v_i])));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1822")'> 1822: </pre>
<pre id='line1822' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line1823")'> 1823:         return result</pre>
<pre id='line1823' class='code' style='background-color: #FFFF28'>
  /* "Cython_shift_calculator.pyx":1823
 *             result += distance[i] * distance[i]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calc_single_force_factor(self, int index, float factor):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_13_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_13_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_factor", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_factor") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_factor", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_12_calc_single_force_factor(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1824")'> 1824: </pre>
<pre id='line1824' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1825")'> 1825:     def _calc_single_force_factor(self, int index, float factor):</pre>
<pre id='line1825' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1825
 *         return result
 * 
 *     def _calc_single_force_factor(self, int index, float factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._cython_calc_single_force_factor(index, factor)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_12_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1826")'> 1826:         return self._cython_calc_single_force_factor(index, factor)</pre>
<pre id='line1826' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1826
 * 
 *     def _calc_single_force_factor(self, int index, float factor):
 *         return self._cython_calc_single_force_factor(index, factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index, __pyx_v_factor));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1827")'> 1827: </pre>
<pre id='line1827' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1828")'> 1828:     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line1828' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1828
 *         return self._cython_calc_single_force_factor(index, factor)
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int factor_index
 *         cdef int component_index
 */

static void __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_factor_index;
  int __pyx_v_component_index;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1829")'> 1829:         cdef int factor_index</pre>
<pre id='line1829' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1830")'> 1830:         cdef int component_index</pre>
<pre id='line1830' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1831")'> 1831: </pre>
<pre id='line1831' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1832")'> 1832:         for factor_index in range(len(self._active_components)):</pre>
<pre id='line1832' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1832
 *         cdef int component_index
 * 
 *         for factor_index in range(len(self._active_components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component_index = self._active_components[factor_index]
 *             self._distance_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)
 */
  if (unlikely(!__pyx_v_self->__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self->__pyx_base._active_components, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_factor_index = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1833")'> 1833:             component_index = self._active_components[factor_index]</pre>
<pre id='line1833' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1833
 * 
 *         for factor_index in range(len(self._active_components)):
 *             component_index = self._active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._distance_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)
 * 
 */
    if (unlikely(!__pyx_v_self->__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1833; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
    __pyx_t_4 = __pyx_v_factor_index;
    __pyx_v_component_index = (*((int *) ( /* dim=0 */ (__pyx_v_self->__pyx_base._active_components.data + __pyx_t_4 * __pyx_v_self->__pyx_base._active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1834")'> 1834:             self._distance_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)</pre>
<pre id='line1834' class='code' style='background-color: #FFFFb6'>
    /* "Cython_shift_calculator.pyx":1834
 *         for factor_index in range(len(self._active_components)):
 *             component_index = self._active_components[factor_index]
 *             self._distance_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #         for i in range(self._num_components):
 */
    __pyx_t_5 = __pyx_v_factor_index;
    __pyx_t_6 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_result.data + __pyx_t_5 * __pyx_v_component_to_result.strides[0]) )));
    __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(__pyx_v_self, __pyx_v_component_index, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_6 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
  }

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_distance_based_potential_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1835")'> 1835: </pre>
<pre id='line1835' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1836")'> 1836: #         for i in range(self._num_components):</pre>
<pre id='line1836' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1837")'> 1837: #             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1837' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1838")'> 1838: </pre>
<pre id='line1838' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1839")'> 1839: </pre>
<pre id='line1839' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1840")'> 1840:     @cython.profile(False)</pre>
<pre id='line1840' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1841")'> 1841:     cdef inline float _cython_calc_single_force_factor(self, int index, float factor):</pre>
<pre id='line1841' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1841
 * 
 *     @cython.profile(False)
 *     cdef inline float _cython_calc_single_force_factor(self, int index, float factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef target_distant_atom atom_ids
 * #        cdef coefficient_exponent coef_exp
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor) {
  float __pyx_v_exponent;
  float __pyx_v_full_factor;
  float __pyx_v_force_factor;
  float __pyx_v_ratio;
  float __pyx_v_pre_exponent;
  float __pyx_v_reduced_exponent;
  float __pyx_v_sum_xyz_distances_2;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1842")'> 1842:         cdef target_distant_atom atom_ids</pre>
<pre id='line1842' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1843")'> 1843: #        cdef coefficient_exponent coef_exp</pre>
<pre id='line1843' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1844")'> 1844:         cdef float exponent</pre>
<pre id='line1844' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1845")'> 1845: </pre>
<pre id='line1845' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1846")'> 1846:         cdef float full_factor, force_factor</pre>
<pre id='line1846' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1847")'> 1847:         cdef float ratio, pre_exponent, reduced_exponent, sum_xyz_distances_2</pre>
<pre id='line1847' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1848")'> 1848: </pre>
<pre id='line1848' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1849")'> 1849: #        atom_ids = self._get_target_and_distant_atom_ids(index)</pre>
<pre id='line1849' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1850")'> 1850: </pre>
<pre id='line1850' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1851")'> 1851:         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)</pre>
<pre id='line1851' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1851
 * #        atom_ids = self._get_target_and_distant_atom_ids(index)
 * 
 *         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         full_factor= factor *  self._compiled_components[index].coefficient
 */
  __pyx_v_sum_xyz_distances_2 = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1852")'> 1852: #</pre>
<pre id='line1852' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1853")'> 1853:         full_factor= factor *  self._compiled_components[index].coefficient</pre>
<pre id='line1853' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1853
 *         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)
 * #
 *         full_factor= factor *  self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         exponent =  self._compiled_components[index].exponent
 */
  __pyx_v_full_factor = (__pyx_v_factor * (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1854")'> 1854: </pre>
<pre id='line1854' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1855")'> 1855:         exponent =  self._compiled_components[index].exponent</pre>
<pre id='line1855' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1855
 *         full_factor= factor *  self._compiled_components[index].coefficient
 * 
 *         exponent =  self._compiled_components[index].exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).exponent;
  __pyx_v_exponent = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1856")'> 1856:         if self._smoothed:</pre>
<pre id='line1856' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1856
 * 
 *         exponent =  self._compiled_components[index].exponent
 *         if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4
 */
  if (__pyx_v_self->_smoothed) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1857")'> 1857:             ratio = sum_xyz_distances_2 / (self._cutoff**2)</pre>
<pre id='line1857' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1857
 *         exponent =  self._compiled_components[index].exponent
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ratio =  ratio**4
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 */
    __pyx_v_ratio = (__pyx_v_sum_xyz_distances_2 / powf(__pyx_v_self->_cutoff, 2.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1858")'> 1858:             ratio =  ratio**4</pre>
<pre id='line1858' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1858
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 *         else:
 */
    __pyx_v_ratio = powf(__pyx_v_ratio, 4.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1859")'> 1859:             pre_exponent = exponent - (exponent + 8.0) * ratio</pre>
<pre id='line1859' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1859
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4
 *             pre_exponent = exponent - (exponent + 8.0) * ratio             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             pre_exponent = exponent
 */
    __pyx_v_pre_exponent = (__pyx_v_exponent - ((__pyx_v_exponent + 8.0) * __pyx_v_ratio));
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1860")'> 1860:         else:</pre>
<pre id='line1860' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1861")'> 1861:             pre_exponent = exponent</pre>
<pre id='line1861' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1861
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 *         else:
 *             pre_exponent = exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         reduced_exponent = (exponent - 2.0) / 2.0
 */
    __pyx_v_pre_exponent = __pyx_v_exponent;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1862")'> 1862: </pre>
<pre id='line1862' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1863")'> 1863:         reduced_exponent = (exponent - 2.0) / 2.0</pre>
<pre id='line1863' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1863
 *             pre_exponent = exponent
 * 
 *         reduced_exponent = (exponent - 2.0) / 2.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent
 */
  __pyx_v_reduced_exponent = ((__pyx_v_exponent - 2.0) / 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1864")'> 1864: </pre>
<pre id='line1864' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1865")'> 1865:         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent</pre>
<pre id='line1865' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1865
 *         reduced_exponent = (exponent - 2.0) / 2.0
 * 
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return force_factor
 */
  __pyx_v_force_factor = ((__pyx_v_full_factor * __pyx_v_pre_exponent) * powf(__pyx_v_sum_xyz_distances_2, __pyx_v_reduced_exponent));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1866")'> 1866: </pre>
<pre id='line1866' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1867")'> 1867:         return force_factor</pre>
<pre id='line1867' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1867
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent
 * 
 *         return force_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_force_factor;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1868")'> 1868: </pre>
<pre id='line1868' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1869")'> 1869: </pre>
<pre id='line1869' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1870")'> 1870: </pre>
<pre id='line1870' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1871")'> 1871: </pre>
<pre id='line1871' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1872")'> 1872: </pre>
<pre id='line1872' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1873")'> 1873: #    def _calc_single_force_set(self, int index, float factor, object forces):</pre>
<pre id='line1873' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1874")'> 1874: #        self._cython_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1874' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1875")'> 1875: </pre>
<pre id='line1875' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1876")'> 1876:     @cython.profile(False)</pre>
<pre id='line1876' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1877")'> 1877:     cdef inline void _distance_calc_single_force_set(self,int index, float factor, Out_array forces):</pre>
<pre id='line1877' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1877
 * 
 *     @cython.profile(False)
 *     cdef inline void _distance_calc_single_force_set(self,int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        cdef target_distant_atom atom_ids
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_xyz_distances;
  float __pyx_v_force_factor;
  Vec3 __pyx_v_target_forces;
  Vec3 __pyx_v_distant_forces;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_distance_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1878")'> 1878: </pre>
<pre id='line1878' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1879")'> 1879: #        cdef target_distant_atom atom_ids</pre>
<pre id='line1879' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1880")'> 1880:         cdef Vec3 xyz_distances</pre>
<pre id='line1880' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1881")'> 1881:         cdef float force_factor, distance</pre>
<pre id='line1881' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1882")'> 1882:         cdef Vec3 result</pre>
<pre id='line1882' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1883")'> 1883: </pre>
<pre id='line1883' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1884")'> 1884: #        atom_ids =  self._get_target_and_distant_atom_ids(index)</pre>
<pre id='line1884' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1885")'> 1885: #</pre>
<pre id='line1885' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1886")'> 1886: ##        print atom_ids.target_atom_id,atom_ids.distant_atom_id</pre>
<pre id='line1886' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1887")'> 1887:         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)</pre>
<pre id='line1887' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1887
 * #
 * ##        print atom_ids.target_atom_id,atom_ids.distant_atom_id
 *         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)
 */
  __pyx_v_xyz_distances = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1888")'> 1888: </pre>
<pre id='line1888' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1889")'> 1889:         force_factor  = self._cython_calc_single_force_factor(index, factor)</pre>
<pre id='line1889' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1889
 *         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)
 * 
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_forces = xyz_distances
 */
  __pyx_v_force_factor = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index, __pyx_v_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1890")'> 1890: </pre>
<pre id='line1890' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1891")'> 1891:         cdef Vec3 target_forces = xyz_distances</pre>
<pre id='line1891' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1891
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)
 * 
 *         cdef Vec3 target_forces = xyz_distances             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(target_forces, -force_factor)
 * 
 */
  __pyx_v_target_forces = __pyx_v_xyz_distances;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1892")'> 1892:         operator_times(target_forces, -force_factor)</pre>
<pre id='line1892' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1892
 * 
 *         cdef Vec3 target_forces = xyz_distances
 *         operator_times(target_forces, -force_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 distant_forces = xyz_distances
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_target_forces, (-__pyx_v_force_factor));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1893")'> 1893: </pre>
<pre id='line1893' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1894")'> 1894:         cdef Vec3 distant_forces = xyz_distances</pre>
<pre id='line1894' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1894
 *         operator_times(target_forces, -force_factor)
 * 
 *         cdef Vec3 distant_forces = xyz_distances             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(distant_forces, force_factor)
 * #
 */
  __pyx_v_distant_forces = __pyx_v_xyz_distances;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1895")'> 1895:         operator_times(distant_forces, force_factor)</pre>
<pre id='line1895' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1895
 * 
 *         cdef Vec3 distant_forces = xyz_distances
 *         operator_times(distant_forces, force_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_distant_forces, __pyx_v_force_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1896")'> 1896: #</pre>
<pre id='line1896' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1897")'> 1897:         forces.add(self._compiled_components[index].remote_atom_1,target_forces)</pre>
<pre id='line1897' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1897
 *         operator_times(distant_forces, force_factor)
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, __pyx_v_target_forces);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1898")'> 1898:         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)</pre>
<pre id='line1898' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1898
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)
 *         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2, __pyx_v_distant_forces);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1899")'> 1899: </pre>
<pre id='line1899' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1900")'> 1900: </pre>
<pre id='line1900' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1901")'> 1901: </pre>
<pre id='line1901' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1902")'> 1902: </pre>
<pre id='line1902' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1903")'> 1903: </pre>
<pre id='line1903' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1904")'> 1904: cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):</pre>
<pre id='line1904' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1904
 * 
 * 
 * cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator {
  struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator __pyx_base;
  float _nb_cutoff;
  struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *_non_bonded_list;
  PyObject *_raw_target_data;
  struct __pyx_t_17shift_calculators_Non_bonded_target_component *_compiled_target_components;
  int _num_target_components;
  PyObject *_raw_remote_data;
  struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component *_compiled_remote_components;
  int _num_remote_components;
  PyObject *_raw_coefficient_data;
  struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component *_compiled_coefficient_components;
  int _num_coefficient_components;
  int _component_offset;
};


/* "Cython_shift_calculator.pyx":1904
 * 
 * 
 * cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator __pyx_base;
  PyObject *(*_bytes_to_target_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, PyObject *);
  PyObject *(*_bytes_to_remote_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, PyObject *);
  PyObject *(*_bytes_to_nonbonded_coefficient_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, PyObject *);
  void (*_set_the_component)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, int, float, float);
  void (*_calc_one_component)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, int, __Pyx_memviewslice, __Pyx_memviewslice, struct __pyx_obj_17shift_calculators_Out_array *);
  void (*_cython_build_component)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_force_calculator;
static CYTHON_INLINE void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__set_the_component(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, int, float, float);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1905")'> 1905: </pre>
<pre id='line1905' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1906")'> 1906:     cdef float _nb_cutoff</pre>
<pre id='line1906' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1907")'> 1907: </pre>
<pre id='line1907' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1908")'> 1908:     cdef Non_bonded_interaction_list _non_bonded_list</pre>
<pre id='line1908' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1909")'> 1909: </pre>
<pre id='line1909' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1910")'> 1910: </pre>
<pre id='line1910' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1911")'> 1911:     #TODO: can we use memory views here...</pre>
<pre id='line1911' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1912")'> 1912:     cdef object _raw_target_data</pre>
<pre id='line1912' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1913")'> 1913:     cdef Non_bonded_target_component* _compiled_target_components</pre>
<pre id='line1913' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1914")'> 1914:     cdef int _num_target_components</pre>
<pre id='line1914' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1915")'> 1915: </pre>
<pre id='line1915' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1916")'> 1916: </pre>
<pre id='line1916' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1917")'> 1917:     #TODO: can we use memory views here...</pre>
<pre id='line1917' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1918")'> 1918:     cdef object _raw_remote_data</pre>
<pre id='line1918' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1919")'> 1919:     cdef Non_bonded_remote_atom_component* _compiled_remote_components</pre>
<pre id='line1919' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1920")'> 1920:     cdef int _num_remote_components</pre>
<pre id='line1920' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1921")'> 1921: </pre>
<pre id='line1921' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1922")'> 1922:     cdef object _raw_coefficient_data</pre>
<pre id='line1922' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1923")'> 1923:     cdef Nonbonded_coefficient_component* _compiled_coefficient_components</pre>
<pre id='line1923' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1924")'> 1924:     cdef int _num_coefficient_components</pre>
<pre id='line1924' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1925")'> 1925: </pre>
<pre id='line1925' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1926")'> 1926:     cdef int _component_offset</pre>
<pre id='line1926' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1927")'> 1927: </pre>
<pre id='line1927' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1928")'> 1928:     def __cinit__(self):</pre>
<pre id='line1928' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1928
 *     cdef int _component_offset
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._non_bonded_list = None
 *         self._compiled_target_components =  NULL
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1929")'> 1929:         self._non_bonded_list = None</pre>
<pre id='line1929' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1929
 * 
 *     def __cinit__(self):
 *         self._non_bonded_list = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_target_components =  NULL
 *         self._compiled_remote_components = NULL
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_non_bonded_list);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_non_bonded_list));
  __pyx_v_self->_non_bonded_list = ((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)Py_None);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1930")'> 1930:         self._compiled_target_components =  NULL</pre>
<pre id='line1930' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1930
 *     def __cinit__(self):
 *         self._non_bonded_list = None
 *         self._compiled_target_components =  NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_remote_components = NULL
 *         self._compiled_coefficient_components = NULL
 */
  __pyx_v_self->_compiled_target_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1931")'> 1931:         self._compiled_remote_components = NULL</pre>
<pre id='line1931' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1931
 *         self._non_bonded_list = None
 *         self._compiled_target_components =  NULL
 *         self._compiled_remote_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coefficient_components = NULL
 *         self._component_offset = 0
 */
  __pyx_v_self->_compiled_remote_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1932")'> 1932:         self._compiled_coefficient_components = NULL</pre>
<pre id='line1932' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1932
 *         self._compiled_target_components =  NULL
 *         self._compiled_remote_components = NULL
 *         self._compiled_coefficient_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._component_offset = 0
 * 
 */
  __pyx_v_self->_compiled_coefficient_components = NULL;
</pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line1933")'> 1933:         self._component_offset = 0</pre>
<pre id='line1933' class='code' style='background-color: #FFFF2e'>
  /* "Cython_shift_calculator.pyx":1933
 *         self._compiled_remote_components = NULL
 *         self._compiled_coefficient_components = NULL
 *         self._component_offset = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, bint smoothed, str name):
 */
  __pyx_v_self->_component_offset = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self), __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1934")'> 1934: </pre>
<pre id='line1934' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1935")'> 1935:     def __init__(self, bint smoothed, str name):</pre>
<pre id='line1935' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1935
 *         self._component_offset = 0
 * 
 *     def __init__(self, bint smoothed, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_non_bonded_force_calculator, self).__init__(smoothed,name)
 *         global DEFAULT_NB_CUTOFF
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line1936")'> 1936:         super(Fast_non_bonded_force_calculator, self).__init__(smoothed,name)</pre>
<pre id='line1936' class='code' style='background-color: #FFFF31'>
  /* "Cython_shift_calculator.pyx":1936
 * 
 *     def __init__(self, bint smoothed, str name):
 *         super(Fast_non_bonded_force_calculator, self).__init__(smoothed,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1937")'> 1937:         global DEFAULT_NB_CUTOFF</pre>
<pre id='line1937' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1938")'> 1938:         self._nb_cutoff = DEFAULT_NB_CUTOFF</pre>
<pre id='line1938' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1938
 *         super(Fast_non_bonded_force_calculator, self).__init__(smoothed,name)
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components =  <code><</code>Distance_component*>malloc(sizeof(Distance_component))
 * 
 */
  __pyx_v_self->_nb_cutoff = __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1939")'> 1939:         self._compiled_components =  &lt;Distance_component*&gt;malloc(sizeof(Distance_component))</pre>
<pre id='line1939' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1939
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 *         self._compiled_components =  <code><</code>Distance_component*>malloc(sizeof(Distance_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #     todo free!!
 */
  __pyx_v_self->__pyx_base._compiled_components = ((struct __pyx_t_17shift_calculators_Distance_component *)malloc((sizeof(struct __pyx_t_17shift_calculators_Distance_component))));

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1940")'> 1940: </pre>
<pre id='line1940' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1941")'> 1941: #     todo free!!</pre>
<pre id='line1941' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1942")'> 1942:     def set_verbose(self,on):</pre>
<pre id='line1942' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1942
 * 
 * #     todo free!!
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line1943")'> 1943:         self._verbose = on</pre>
<pre id='line1943' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":1943
 * #     todo free!!
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: use global version
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1943; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->__pyx_base.__pyx_base._verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1944")'> 1944: </pre>
<pre id='line1944' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1945")'> 1945:     #TODO: use global version</pre>
<pre id='line1945' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1946")'> 1946:     cdef _bytes_to_target_components(self,data):</pre>
<pre id='line1946' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1946
 * 
 *     #TODO: use global version
 *     cdef _bytes_to_target_components(self,data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_target_data =  data
 * 
 */

static PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__bytes_to_target_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_target_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1947")'> 1947:         self._raw_target_data =  data</pre>
<pre id='line1947' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1947
 *     #TODO: use global version
 *     cdef _bytes_to_target_components(self,data):
 *         self._raw_target_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_target_components =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_target_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_target_data);
  __pyx_v_self->_raw_target_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1948")'> 1948: </pre>
<pre id='line1948' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1949")'> 1949:         self._compiled_target_components =  &lt;Non_bonded_target_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1949' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1949
 *         self._raw_target_data =  data
 * 
 *         self._compiled_target_components =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_target_components =  len(data)/ sizeof(Non_bonded_target_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_target_components = ((struct __pyx_t_17shift_calculators_Non_bonded_target_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1950")'> 1950:         self._num_target_components =  len(data)/ sizeof(Non_bonded_target_component)</pre>
<pre id='line1950' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1950
 * 
 *         self._compiled_target_components =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_target_components =  len(data)/ sizeof(Non_bonded_target_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: use global version
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_target_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Non_bonded_target_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._bytes_to_target_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1951")'> 1951: </pre>
<pre id='line1951' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1952")'> 1952:     #TODO: use global version</pre>
<pre id='line1952' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1953")'> 1953:     cdef _bytes_to_remote_components(self,data):</pre>
<pre id='line1953' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1953
 * 
 *     #TODO: use global version
 *     cdef _bytes_to_remote_components(self,data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_remote_data =  data
 * 
 */

static PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__bytes_to_remote_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_remote_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1954")'> 1954:         self._raw_remote_data =  data</pre>
<pre id='line1954' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1954
 *     #TODO: use global version
 *     cdef _bytes_to_remote_components(self,data):
 *         self._raw_remote_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_remote_components =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_remote_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_remote_data);
  __pyx_v_self->_raw_remote_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1955")'> 1955: </pre>
<pre id='line1955' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1956")'> 1956:         self._compiled_remote_components =  &lt;Non_bonded_remote_atom_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1956' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1956
 *         self._raw_remote_data =  data
 * 
 *         self._compiled_remote_components =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_remote_components = ((struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1957")'> 1957:         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)</pre>
<pre id='line1957' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1957
 * 
 *         self._compiled_remote_components =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _bytes_to_nonbonded_coefficient_components(self,data):
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_remote_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._bytes_to_remote_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1958")'> 1958: </pre>
<pre id='line1958' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1959")'> 1959:     cdef _bytes_to_nonbonded_coefficient_components(self,data):</pre>
<pre id='line1959' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1959
 *         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)
 * 
 *     cdef _bytes_to_nonbonded_coefficient_components(self,data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_coefficient_data =  data
 * 
 */

static PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__bytes_to_nonbonded_coefficient_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_nonbonded_coefficient_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1960")'> 1960:         self._raw_coefficient_data =  data</pre>
<pre id='line1960' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1960
 * 
 *     cdef _bytes_to_nonbonded_coefficient_components(self,data):
 *         self._raw_coefficient_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_coefficient_components =  <code><</code>Nonbonded_coefficient_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_coefficient_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_coefficient_data);
  __pyx_v_self->_raw_coefficient_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1961")'> 1961: </pre>
<pre id='line1961' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1962")'> 1962:         self._compiled_coefficient_components =  &lt;Nonbonded_coefficient_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line1962' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1962
 *         self._raw_coefficient_data =  data
 * 
 *         self._compiled_coefficient_components =  <code><</code>Nonbonded_coefficient_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_coefficient_components =  len(data)/ sizeof(Nonbonded_coefficient_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1962; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1962; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1962; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1962; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1962; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_coefficient_components = ((struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1963")'> 1963:         self._num_coefficient_components =  len(data)/ sizeof(Nonbonded_coefficient_component)</pre>
<pre id='line1963' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1963
 * 
 *         self._compiled_coefficient_components =  <code><</code>Nonbonded_coefficient_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_coefficient_components =  len(data)/ sizeof(Nonbonded_coefficient_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: call super?
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_coefficient_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._bytes_to_nonbonded_coefficient_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_6_set_components(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1964")'> 1964: </pre>
<pre id='line1964' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1965")'> 1965:     #TODO: call super?</pre>
<pre id='line1965' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1966")'> 1966:     def _set_components(self, components):</pre>
<pre id='line1966' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1966
 * 
 *     #TODO: call super?
 *     def _set_components(self, components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = <code><</code>Simulation*><code><</code>size_t>int(components['SIMU'].this)
 *         self._non_bonded_list =  components['NBLT']
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_6_set_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1967")'> 1967:         self._simulation = &lt;Simulation*&gt;&lt;size_t&gt;int(components['SIMU'].this)</pre>
<pre id='line1967' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":1967
 *     #TODO: call super?
 *     def _set_components(self, components):
 *         self._simulation = <code><</code>Simulation*><code><</code>size_t>int(components['SIMU'].this)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._non_bonded_list =  components['NBLT']
 *         self._bytes_to_target_components(components['ATOM'])
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__SIMU));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1967; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__this);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1967; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1967; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1967; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1967; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_self->__pyx_base.__pyx_base._simulation = ((Simulation *)((size_t)__pyx_t_3));
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1968")'> 1968:         self._non_bonded_list =  components['NBLT']</pre>
<pre id='line1968' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":1968
 *     def _set_components(self, components):
 *         self._simulation = <code><</code>Simulation*><code><</code>size_t>int(components['SIMU'].this)
 *         self._non_bonded_list =  components['NBLT']             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_target_components(components['ATOM'])
 *         self._bytes_to_remote_components(components['NBRM'])
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__NBLT));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1968; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_17shift_calculators_Non_bonded_interaction_list)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1968; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_non_bonded_list);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_non_bonded_list));
  __pyx_v_self->_non_bonded_list = ((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1969")'> 1969:         self._bytes_to_target_components(components['ATOM'])</pre>
<pre id='line1969' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1969
 *         self._simulation = <code><</code>Simulation*><code><</code>size_t>int(components['SIMU'].this)
 *         self._non_bonded_list =  components['NBLT']
 *         self._bytes_to_target_components(components['ATOM'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_remote_components(components['NBRM'])
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__ATOM));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_bytes_to_target_components(__pyx_v_self, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1970")'> 1970:         self._bytes_to_remote_components(components['NBRM'])</pre>
<pre id='line1970' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1970
 *         self._non_bonded_list =  components['NBLT']
 *         self._bytes_to_target_components(components['ATOM'])
 *         self._bytes_to_remote_components(components['NBRM'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])
 *         if 'ACTI' in components:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__NBRM));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_bytes_to_remote_components(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1971")'> 1971:         self._bytes_to_nonbonded_coefficient_components(components['COEF'])</pre>
<pre id='line1971' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1971
 *         self._bytes_to_target_components(components['ATOM'])
 *         self._bytes_to_remote_components(components['NBRM'])
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if 'ACTI' in components:
 *             self._active_components = components['ACTI']
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__COEF));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1971; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_bytes_to_nonbonded_coefficient_components(__pyx_v_self, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1971; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1972")'> 1972:         if 'ACTI' in components:</pre>
<pre id='line1972' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1972
 *         self._bytes_to_remote_components(components['NBRM'])
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])
 *         if 'ACTI' in components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._active_components = components['ACTI']
 *         self._component_offset = components['OFFS']
 */
  __pyx_t_4 = (__Pyx_<span class='py_c_api'>PySequence_Contains</span>(((PyObject *)__pyx_n_s__ACTI), __pyx_v_components, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1973")'> 1973:             self._active_components = components['ACTI']</pre>
<pre id='line1973' class='code' style='background-color: #FFFF8d'>
    /* "Cython_shift_calculator.pyx":1973
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])
 *         if 'ACTI' in components:
 *             self._active_components = components['ACTI']             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._component_offset = components['OFFS']
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__ACTI));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_1);
    if (unlikely(!__pyx_t_5.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_XDEC_MEMVIEW(&__pyx_v_self->__pyx_base.__pyx_base._active_components, 0);
    __pyx_v_self->__pyx_base.__pyx_base._active_components = __pyx_t_5;
    __pyx_t_5.memview = NULL;
    __pyx_t_5.data = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1974")'> 1974:         self._component_offset = components['OFFS']</pre>
<pre id='line1974' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":1974
 *         if 'ACTI' in components:
 *             self._active_components = components['ACTI']
 *         self._component_offset = components['OFFS']             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _set_the_component(self, int target_atom_index,int remote_atom_index, float coefficient,float exponent):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__OFFS));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->_component_offset = __pyx_t_6;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&__pyx_t_5, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1975")'> 1975: </pre>
<pre id='line1975' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1976")'> 1976:     cdef inline void _set_the_component(self, int target_atom_index,int remote_atom_index, float coefficient,float exponent):</pre>
<pre id='line1976' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1976
 *         self._component_offset = components['OFFS']
 * 
 *     cdef inline void _set_the_component(self, int target_atom_index,int remote_atom_index, float coefficient,float exponent):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components[0].target_atom =target_atom_index
 *         self._compiled_components[0].remote_atom_1 =target_atom_index
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__set_the_component(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, int __pyx_v_target_atom_index, int __pyx_v_remote_atom_index, float __pyx_v_coefficient, float __pyx_v_exponent) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_the_component", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1977")'> 1977:         self._compiled_components[0].target_atom =target_atom_index</pre>
<pre id='line1977' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1977
 * 
 *     cdef inline void _set_the_component(self, int target_atom_index,int remote_atom_index, float coefficient,float exponent):
 *         self._compiled_components[0].target_atom =target_atom_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components[0].remote_atom_1 =target_atom_index
 *         self._compiled_components[0].remote_atom_2 =remote_atom_index
 */
  (__pyx_v_self->__pyx_base._compiled_components[0]).target_atom = __pyx_v_target_atom_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1978")'> 1978:         self._compiled_components[0].remote_atom_1 =target_atom_index</pre>
<pre id='line1978' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1978
 *     cdef inline void _set_the_component(self, int target_atom_index,int remote_atom_index, float coefficient,float exponent):
 *         self._compiled_components[0].target_atom =target_atom_index
 *         self._compiled_components[0].remote_atom_1 =target_atom_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components[0].remote_atom_2 =remote_atom_index
 *         self._compiled_components[0].coefficient =coefficient
 */
  (__pyx_v_self->__pyx_base._compiled_components[0]).remote_atom_1 = __pyx_v_target_atom_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1979")'> 1979:         self._compiled_components[0].remote_atom_2 =remote_atom_index</pre>
<pre id='line1979' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1979
 *         self._compiled_components[0].target_atom =target_atom_index
 *         self._compiled_components[0].remote_atom_1 =target_atom_index
 *         self._compiled_components[0].remote_atom_2 =remote_atom_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components[0].coefficient =coefficient
 *         self._compiled_components[0].exponent =exponent
 */
  (__pyx_v_self->__pyx_base._compiled_components[0]).remote_atom_2 = __pyx_v_remote_atom_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1980")'> 1980:         self._compiled_components[0].coefficient =coefficient</pre>
<pre id='line1980' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1980
 *         self._compiled_components[0].remote_atom_1 =target_atom_index
 *         self._compiled_components[0].remote_atom_2 =remote_atom_index
 *         self._compiled_components[0].coefficient =coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components[0].exponent =exponent
 * 
 */
  (__pyx_v_self->__pyx_base._compiled_components[0]).coefficient = __pyx_v_coefficient;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1981")'> 1981:         self._compiled_components[0].exponent =exponent</pre>
<pre id='line1981' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1981
 *         self._compiled_components[0].remote_atom_2 =remote_atom_index
 *         self._compiled_components[0].coefficient =coefficient
 *         self._compiled_components[0].exponent =exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  (__pyx_v_self->__pyx_base._compiled_components[0]).exponent = __pyx_v_exponent;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1982")'> 1982: </pre>
<pre id='line1982' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1983")'> 1983: </pre>
<pre id='line1983' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1984")'> 1984: </pre>
<pre id='line1984' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1985")'> 1985:     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line1985' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1985
 * 
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

static void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_factor_index;
  PyObject *__pyx_v_non_bonded_index = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1986")'> 1986: </pre>
<pre id='line1986' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1987")'> 1987: </pre>
<pre id='line1987' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1988")'> 1988:         cdef int factor_index</pre>
<pre id='line1988' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1989")'> 1989: </pre>
<pre id='line1989' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1990")'> 1990:         if self._active_components ==  None:</pre>
<pre id='line1990' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1990
 *         cdef int factor_index
 * 
 *         if self._active_components ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for factor_index  in range(self._non_bonded_list.get_length()):
 *                 non_bonded_index  = factor_index
 */
  if (unlikely(!__pyx_v_self->__pyx_base.__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1990; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
  __pyx_t_1 = (((PyObject *) __pyx_v_self->__pyx_base.__pyx_base._active_components.memview) == Py_None);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1991")'> 1991:             for factor_index  in range(self._non_bonded_list.get_length()):</pre>
<pre id='line1991' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1991
 * 
 *         if self._active_components ==  None:
 *             for factor_index  in range(self._non_bonded_list.get_length()):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 non_bonded_index  = factor_index
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)
 */
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self->_non_bonded_list->__pyx_vtab)->get_length(__pyx_v_self->_non_bonded_list);
    for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
      __pyx_v_factor_index = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1992")'> 1992:                 non_bonded_index  = factor_index</pre>
<pre id='line1992' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1992
 *         if self._active_components ==  None:
 *             for factor_index  in range(self._non_bonded_list.get_length()):
 *                 non_bonded_index  = factor_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)
 *         else:
 */
      __pyx_t_4 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_factor_index);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_non_bonded_index);
      __pyx_v_non_bonded_index = __pyx_t_4;
      __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1993")'> 1993:                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)</pre>
<pre id='line1993' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":1993
 *             for factor_index  in range(self._non_bonded_list.get_length()):
 *                 non_bonded_index  = factor_index
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             for factor_index  in range(self._active_components.shape[0]):
 */
      __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_non_bonded_index);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1993; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_calc_one_component(__pyx_v_self, __pyx_v_factor_index, __pyx_t_5, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_force);
    }
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1994")'> 1994:         else:</pre>
<pre id='line1994' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1995")'> 1995:             for factor_index  in range(self._active_components.shape[0]):</pre>
<pre id='line1995' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1995
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)
 *         else:
 *             for factor_index  in range(self._active_components.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 non_bonded_index = self._active_components[factor_index]
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)
 */
    if (unlikely(!__pyx_v_self->__pyx_base.__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
    __pyx_t_6 = (__pyx_v_self->__pyx_base.__pyx_base._active_components.shape[0]);
    for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_6; __pyx_t_2+=1) {
      __pyx_v_factor_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1996")'> 1996:                 non_bonded_index = self._active_components[factor_index]</pre>
<pre id='line1996' class='code' style='background-color: #FFFF79'>
      /* "Cython_shift_calculator.pyx":1996
 *         else:
 *             for factor_index  in range(self._active_components.shape[0]):
 *                 non_bonded_index = self._active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)
 * 
 */
      if (unlikely(!__pyx_v_self->__pyx_base.__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
      __pyx_t_3 = __pyx_v_factor_index;
      __pyx_t_4 = <span class='py_c_api'>PyInt_FromLong</span>((*((int *) ( /* dim=0 */ (__pyx_v_self->__pyx_base.__pyx_base._active_components.data + __pyx_t_3 * __pyx_v_self->__pyx_base.__pyx_base._active_components.strides[0]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_non_bonded_index);
      __pyx_v_non_bonded_index = __pyx_t_4;
      __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1997")'> 1997:                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)</pre>
<pre id='line1997' class='code' style='background-color: #FFFF66'>
      /* "Cython_shift_calculator.pyx":1997
 *             for factor_index  in range(self._active_components.shape[0]):
 *                 non_bonded_index = self._active_components[factor_index]
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _calc_one_component(self, int factor_index, int non_bonded_index, int[:] component_to_result, float[:] force_factors, Out_array force):
 */
      __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_non_bonded_index);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1997; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_calc_one_component(__pyx_v_self, __pyx_v_factor_index, __pyx_t_5, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_force);
    }
  }
  __pyx_L3:;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_non_bonded_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_non_bonded_index);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1998")'> 1998: </pre>
<pre id='line1998' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1999")'> 1999:     cdef void _calc_one_component(self, int factor_index, int non_bonded_index, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line1999' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1999
 *                 self._calc_one_component(factor_index, non_bonded_index, component_to_result, force_factors, force)
 * 
 *     cdef void _calc_one_component(self, int factor_index, int non_bonded_index, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 */

static void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__calc_one_component(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, CYTHON_UNUSED int __pyx_v_factor_index, int __pyx_v_non_bonded_index, CYTHON_UNUSED __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  CYTHON_UNUSED double __pyx_v_start_time;
  CYTHON_UNUSED double __pyx_v_end_time;
  struct __pyx_t_17shift_calculators_Component_index_pair *__pyx_v_non_bonded_pair;
  int __pyx_v_target_component_index;
  int __pyx_v_remote_component_index;
  int __pyx_v_target_index;
  int __pyx_v_remote_index;
  float __pyx_v_distance;
  int __pyx_v_component_offset;
  long __pyx_v_i;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_one_component", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2000")'> 2000:         cdef double start_time = 0.0</pre>
<pre id='line2000' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2000
 * 
 *     cdef void _calc_one_component(self, int factor_index, int non_bonded_index, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2001")'> 2001:         cdef double end_time = 0.0</pre>
<pre id='line2001' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2001
 *     cdef void _calc_one_component(self, int factor_index, int non_bonded_index, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Component_index_pair* non_bonded_pair
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2002")'> 2002: </pre>
<pre id='line2002' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2003")'> 2003:         cdef Component_index_pair* non_bonded_pair</pre>
<pre id='line2003' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2004")'> 2004: </pre>
<pre id='line2004' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2005")'> 2005:         cdef int target_component_index</pre>
<pre id='line2005' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2006")'> 2006:         cdef int remote_component_index</pre>
<pre id='line2006' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2007")'> 2007: </pre>
<pre id='line2007' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2008")'> 2008:         cdef int target_index</pre>
<pre id='line2008' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2009")'> 2009:         cdef int remote_index</pre>
<pre id='line2009' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2010")'> 2010: </pre>
<pre id='line2010' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2011")'> 2011:         cdef float distance</pre>
<pre id='line2011' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2012")'> 2012:         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)</pre>
<pre id='line2012' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2012
 * 
 *         cdef float distance
 *         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_component_index = non_bonded_pair[0].target_index
 */
  __pyx_v_non_bonded_pair = __pyx_f_17shift_calculators_27Non_bonded_interaction_list_get(__pyx_v_self->_non_bonded_list, __pyx_v_non_bonded_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2013")'> 2013: </pre>
<pre id='line2013' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2014")'> 2014:         target_component_index = non_bonded_pair[0].target_index</pre>
<pre id='line2014' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2014
 *         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)
 * 
 *         target_component_index = non_bonded_pair[0].target_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         remote_component_index = non_bonded_pair[0].remote_index
 *         component_offset = self._component_offset + non_bonded_pair[0].component_index
 */
  __pyx_t_1 = (__pyx_v_non_bonded_pair[0]).target_index;
  __pyx_v_target_component_index = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2015")'> 2015:         remote_component_index = non_bonded_pair[0].remote_index</pre>
<pre id='line2015' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2015
 * 
 *         target_component_index = non_bonded_pair[0].target_index
 *         remote_component_index = non_bonded_pair[0].remote_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component_offset = self._component_offset + non_bonded_pair[0].component_index
 * 
 */
  __pyx_t_1 = (__pyx_v_non_bonded_pair[0]).remote_index;
  __pyx_v_remote_component_index = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2016")'> 2016:         component_offset = self._component_offset + non_bonded_pair[0].component_index</pre>
<pre id='line2016' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2016
 *         target_component_index = non_bonded_pair[0].target_index
 *         remote_component_index = non_bonded_pair[0].remote_index
 *         component_offset = self._component_offset + non_bonded_pair[0].component_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 */
  __pyx_v_component_offset = (__pyx_v_self->_component_offset + (__pyx_v_non_bonded_pair[0]).component_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2017")'> 2017: </pre>
<pre id='line2017' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2018")'> 2018:         target_index  = self._compiled_target_components[target_component_index].target_atom_id</pre>
<pre id='line2018' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2018
 *         component_offset = self._component_offset + non_bonded_pair[0].component_index
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_target_components[__pyx_v_target_component_index]).target_atom_id;
  __pyx_v_target_index = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2019")'> 2019:         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id</pre>
<pre id='line2019' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2019
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)
 *         if distance <code><</code> self._nb_cutoff:
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_remote_components[__pyx_v_remote_component_index]).remote_atom_id;
  __pyx_v_remote_index = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2020")'> 2020:         distance = calc_distance_simulation(self._simulation, target_index, remote_index)</pre>
<pre id='line2020' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2020
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if distance <code><</code> self._nb_cutoff:
 *             for i in range(2):
 */
  __pyx_v_distance = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base.__pyx_base._simulation, __pyx_v_target_index, __pyx_v_remote_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2021")'> 2021:         if distance &lt; self._nb_cutoff:</pre>
<pre id='line2021' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2021
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)
 *         if distance <code><</code> self._nb_cutoff:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i in range(2):
 *                     self._cython_build_component(non_bonded_index, i)
 */
  __pyx_t_2 = (__pyx_v_distance <code><</code> __pyx_v_self->_nb_cutoff);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2022")'> 2022:             for i in range(2):</pre>
<pre id='line2022' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2022
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)
 *         if distance <code><</code> self._nb_cutoff:
 *             for i in range(2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     self._cython_build_component(non_bonded_index, i)
 *                     self._distance_calc_single_force_set(0, force_factors[component_offset] , force)
 */
    for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> 2; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2023")'> 2023:                     self._cython_build_component(non_bonded_index, i)</pre>
<pre id='line2023' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2023
 *         if distance <code><</code> self._nb_cutoff:
 *             for i in range(2):
 *                     self._cython_build_component(non_bonded_index, i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     self._distance_calc_single_force_set(0, force_factors[component_offset] , force)
 * 
 */
      ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_cython_build_component(__pyx_v_self, __pyx_v_non_bonded_index, __pyx_v_i);
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line2024")'> 2024:                     self._distance_calc_single_force_set(0, force_factors[component_offset] , force)</pre>
<pre id='line2024' class='code' style='background-color: #FFFF3b'>
      /* "Cython_shift_calculator.pyx":2024
 *             for i in range(2):
 *                     self._cython_build_component(non_bonded_index, i)
 *                     self._distance_calc_single_force_set(0, force_factors[component_offset] , force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def  _build_component(self, non_bonded_index, i):
 */
      __pyx_t_1 = __pyx_v_component_offset;
      __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), 0, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_1 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
    }
    goto __pyx_L3;
  }
  __pyx_L3:;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_9_build_component(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_9_build_component(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_non_bonded_index = 0;
  PyObject *__pyx_v_i = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_component (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__non_bonded_index,&__pyx_n_s__i,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__non_bonded_index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__i)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_component", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2026; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_build_component") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2026; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_non_bonded_index = values[0];
    __pyx_v_i = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_component", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2026; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._build_component", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_8_build_component(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self), __pyx_v_non_bonded_index, __pyx_v_i);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2025")'> 2025: </pre>
<pre id='line2025' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2026")'> 2026:     def  _build_component(self, non_bonded_index, i):</pre>
<pre id='line2026' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2026
 *                     self._distance_calc_single_force_set(0, force_factors[component_offset] , force)
 * 
 *     def  _build_component(self, non_bonded_index, i):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cython_build_component(non_bonded_index, i)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator_8_build_component(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_non_bonded_index, PyObject *__pyx_v_i) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_component", 0);
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line2027")'> 2027:         self._cython_build_component(non_bonded_index, i)</pre>
<pre id='line2027' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":2027
 * 
 *     def  _build_component(self, non_bonded_index, i):
 *         self._cython_build_component(non_bonded_index, i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void  _cython_build_component(self, int non_bonded_index, int i):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_non_bonded_index);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2027; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2027; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_cython_build_component(__pyx_v_self, __pyx_t_1, __pyx_t_2);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._build_component", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2028")'> 2028: </pre>
<pre id='line2028' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2029")'> 2029:     cdef void  _cython_build_component(self, int non_bonded_index, int i):</pre>
<pre id='line2029' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2029
 *         self._cython_build_component(non_bonded_index, i)
 * 
 *     cdef void  _cython_build_component(self, int non_bonded_index, int i):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Component_index_pair* non_bonded_pair
 * 
 */

static void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__cython_build_component(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, int __pyx_v_non_bonded_index, int __pyx_v_i) {
  struct __pyx_t_17shift_calculators_Component_index_pair *__pyx_v_non_bonded_pair;
  int __pyx_v_target_component_index;
  int __pyx_v_remote_component_index;
  int __pyx_v_target_index;
  int __pyx_v_remote_index;
  int __pyx_v_chem_type_id;
  CYTHON_UNUSED float __pyx_v_default_smoothing_factor;
  int __pyx_v_atom_1_coefficent_offset;
  float __pyx_v_coefficient;
  float __pyx_v_exponent;
  struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component *__pyx_v_coefficient_component;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_build_component", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2030")'> 2030:         cdef Component_index_pair* non_bonded_pair</pre>
<pre id='line2030' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2031")'> 2031: </pre>
<pre id='line2031' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2032")'> 2032:         cdef int target_component_index</pre>
<pre id='line2032' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2033")'> 2033:         cdef int remote_component_index</pre>
<pre id='line2033' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2034")'> 2034: </pre>
<pre id='line2034' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2035")'> 2035:         cdef int target_index</pre>
<pre id='line2035' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2036")'> 2036:         cdef int remote_index</pre>
<pre id='line2036' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2037")'> 2037: </pre>
<pre id='line2037' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2038")'> 2038:         cdef float distance</pre>
<pre id='line2038' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2039")'> 2039: </pre>
<pre id='line2039' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2040")'> 2040:         cdef int chem_type_id</pre>
<pre id='line2040' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2041")'> 2041: </pre>
<pre id='line2041' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2042")'> 2042:         cdef float default_smoothing_factor = self._smoothing_factor</pre>
<pre id='line2042' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2042
 *         cdef int chem_type_id
 * 
 *         cdef float default_smoothing_factor = self._smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float smoothing_factor
 * 
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base._smoothing_factor;
  __pyx_v_default_smoothing_factor = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2043")'> 2043:         cdef float smoothing_factor</pre>
<pre id='line2043' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2044")'> 2044: </pre>
<pre id='line2044' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2045")'> 2045:         cdef float ratio</pre>
<pre id='line2045' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2046")'> 2046: </pre>
<pre id='line2046' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2047")'> 2047: </pre>
<pre id='line2047' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2048")'> 2048:         cdef int atom_1_coefficent_offset</pre>
<pre id='line2048' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2049")'> 2049: </pre>
<pre id='line2049' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2050")'> 2050:         cdef float coefficient,exponent</pre>
<pre id='line2050' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2051")'> 2051: </pre>
<pre id='line2051' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2052")'> 2052:         cdef Nonbonded_coefficient_component* coefficent_component</pre>
<pre id='line2052' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2053")'> 2053:         cdef bint result</pre>
<pre id='line2053' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2054")'> 2054: </pre>
<pre id='line2054' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2055")'> 2055:         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)</pre>
<pre id='line2055' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2055
 *         cdef bint result
 * 
 *         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_component_index = non_bonded_pair[0].target_index
 */
  __pyx_v_non_bonded_pair = __pyx_f_17shift_calculators_27Non_bonded_interaction_list_get(__pyx_v_self->_non_bonded_list, __pyx_v_non_bonded_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2056")'> 2056: </pre>
<pre id='line2056' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2057")'> 2057:         target_component_index = non_bonded_pair[0].target_index</pre>
<pre id='line2057' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2057
 *         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)
 * 
 *         target_component_index = non_bonded_pair[0].target_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         remote_component_index = non_bonded_pair[0].remote_index
 * 
 */
  __pyx_t_2 = (__pyx_v_non_bonded_pair[0]).target_index;
  __pyx_v_target_component_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2058")'> 2058:         remote_component_index = non_bonded_pair[0].remote_index</pre>
<pre id='line2058' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2058
 * 
 *         target_component_index = non_bonded_pair[0].target_index
 *         remote_component_index = non_bonded_pair[0].remote_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 */
  __pyx_t_2 = (__pyx_v_non_bonded_pair[0]).remote_index;
  __pyx_v_remote_component_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2059")'> 2059: </pre>
<pre id='line2059' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2060")'> 2060:         target_index  = self._compiled_target_components[target_component_index].target_atom_id</pre>
<pre id='line2060' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2060
 *         remote_component_index = non_bonded_pair[0].remote_index
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id
 *         atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id
 */
  __pyx_t_2 = (__pyx_v_self->_compiled_target_components[__pyx_v_target_component_index]).target_atom_id;
  __pyx_v_target_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2061")'> 2061:         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id</pre>
<pre id='line2061' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2061
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id
 * 
 */
  __pyx_t_2 = (__pyx_v_self->_compiled_remote_components[__pyx_v_remote_component_index]).remote_atom_id;
  __pyx_v_remote_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2062")'> 2062:         atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id</pre>
<pre id='line2062' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2062
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id
 *         atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]
 */
  __pyx_t_2 = (__pyx_v_self->_compiled_target_components[__pyx_v_target_component_index]).atom_type_id;
  __pyx_v_atom_1_coefficent_offset = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2063")'> 2063: </pre>
<pre id='line2063' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2064")'> 2064:         chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]</pre>
<pre id='line2064' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2064
 *         atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id
 * 
 *         chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         coefficient_component = &self._compiled_coefficient_components[chem_type_id]
 */
  __pyx_v_chem_type_id = ((__pyx_v_self->_compiled_remote_components[__pyx_v_remote_component_index]).chem_type[__pyx_v_i]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2065")'> 2065: </pre>
<pre id='line2065' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2066")'> 2066:         coefficient_component = &amp;self._compiled_coefficient_components[chem_type_id]</pre>
<pre id='line2066' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2066
 *         chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]
 * 
 *         coefficient_component = &self._compiled_coefficient_components[chem_type_id]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         exponent = coefficient_component[0].exponent
 */
  __pyx_v_coefficient_component = (&(__pyx_v_self->_compiled_coefficient_components[__pyx_v_chem_type_id]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2067")'> 2067: </pre>
<pre id='line2067' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2068")'> 2068:         exponent = coefficient_component[0].exponent</pre>
<pre id='line2068' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2068
 *         coefficient_component = &self._compiled_coefficient_components[chem_type_id]
 * 
 *         exponent = coefficient_component[0].exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]
 */
  __pyx_t_1 = (__pyx_v_coefficient_component[0]).exponent;
  __pyx_v_exponent = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2069")'> 2069: </pre>
<pre id='line2069' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2070")'> 2070:         coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]</pre>
<pre id='line2070' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2070
 *         exponent = coefficient_component[0].exponent
 * 
 *         coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_the_component(target_index,remote_index,coefficient,exponent)
 */
  __pyx_v_coefficient = ((__pyx_v_coefficient_component[0]).coefficients[__pyx_v_atom_1_coefficent_offset]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2071")'> 2071: </pre>
<pre id='line2071' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2072")'> 2072:         self._set_the_component(target_index,remote_index,coefficient,exponent)</pre>
<pre id='line2072' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2072
 *         coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]
 * 
 *         self._set_the_component(target_index,remote_index,coefficient,exponent)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__set_the_component(__pyx_v_self, __pyx_v_target_index, __pyx_v_remote_index, __pyx_v_coefficient, __pyx_v_exponent);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_1_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_1_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator__bytes_to_components(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2073")'> 2073: </pre>
<pre id='line2073' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2074")'> 2074: </pre>
<pre id='line2074' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2075")'> 2075: </pre>
<pre id='line2075' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2076")'> 2076: cdef class Fast_dihedral_force_calculator(Base_force_calculator):</pre>
<pre id='line2076' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2076
 * 
 * 
 * cdef class Fast_dihedral_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component* _compiled_components
 */
struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_Dihedral_component *_compiled_components;
  int _num_components;
  PyObject *raw_data;
};


/* "Cython_shift_calculator.pyx":2076
 * 
 * 
 * cdef class Fast_dihedral_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component* _compiled_components
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_dihedral_ids (*_get_dihedral_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_parameters (*_get_parameters)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  float (*_get_coefficient)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  float (*_cython_calc_single_force_factor)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  void (*_dihedral_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_dihedral_force_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE void __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2077")'> 2077: </pre>
<pre id='line2077' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2078")'> 2078:     cdef Dihedral_component* _compiled_components</pre>
<pre id='line2078' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2079")'> 2079:     cdef int _num_components</pre>
<pre id='line2079' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2080")'> 2080:     cdef object raw_data</pre>
<pre id='line2080' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2081")'> 2081: </pre>
<pre id='line2081' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2082")'> 2082:     def _bytes_to_components(self, data):</pre>
<pre id='line2082' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2082
 *     cdef object raw_data
 * 
 *     def _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.raw_data =  data
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator__bytes_to_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2083")'> 2083:         self.raw_data =  data</pre>
<pre id='line2083' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2083
 * 
 *     def _bytes_to_components(self, data):
 *         self.raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->raw_data);
  __pyx_v_self->raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2084")'> 2084: </pre>
<pre id='line2084' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line2085")'> 2085:         self._compiled_components =  &lt;Dihedral_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line2085' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":2085
 *         self.raw_data =  data
 * 
 *         self._compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Dihedral_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Dihedral_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line2086")'> 2086:         self._num_components =  len(data)/ sizeof(Dihedral_component)</pre>
<pre id='line2086' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":2086
 * 
 *         self._compiled_components =  <code><</code>Dihedral_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Dihedral_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2086; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Dihedral_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_2__cinit__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2087")'> 2087: </pre>
<pre id='line2087' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2088")'> 2088: </pre>
<pre id='line2088' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2089")'> 2089:     def __cinit__(self):</pre>
<pre id='line2089' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2089
 * 
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_2__cinit__(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2090")'> 2090:         self._compiled_components = NULL</pre>
<pre id='line2090' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2090
 * 
 *     def __cinit__(self):
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line2091")'> 2091:         self._num_components = 0</pre>
<pre id='line2091' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":2091
 *     def __cinit__(self):
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self,name="not set"):
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2093; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2093; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_4__init__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2092")'> 2092: </pre>
<pre id='line2092' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2093")'> 2093:     def __init__(self,name="not set"):</pre>
<pre id='line2093' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2093
 *         self._num_components = 0
 * 
 *     def __init__(self,name="not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_force_calculator.__init__(self,name=name)
 *         self.raw_data =  None
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_4__init__(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line2094")'> 2094:         Base_force_calculator.__init__(self,name=name)</pre>
<pre id='line2094' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":2094
 * 
 *     def __init__(self,name="not set"):
 *         Base_force_calculator.__init__(self,name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.raw_data =  None
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_force_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line2095")'> 2095:         self.raw_data =  None</pre>
<pre id='line2095' class='code' style='background-color: #FFFF86'>
  /* "Cython_shift_calculator.pyx":2095
 *     def __init__(self,name="not set"):
 *         Base_force_calculator.__init__(self,name=name)
 *         self.raw_data =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->raw_data);
  __pyx_v_self->raw_data = Py_None;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2096")'> 2096: </pre>
<pre id='line2096' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2097")'> 2097: </pre>
<pre id='line2097' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2098")'> 2098: </pre>
<pre id='line2098' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2099")'> 2099: #     TODO: remove this is no longer needed</pre>
<pre id='line2099' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2100")'> 2100:     @cython.profile(False)</pre>
<pre id='line2100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2101")'> 2101:     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):</pre>
<pre id='line2101' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2101
 * #     TODO: remove this is no longer needed
 *     @cython.profile(False)
 *     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_dihedral_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2102")'> 2102:         cdef dihedral_ids result</pre>
<pre id='line2102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2103")'> 2103: </pre>
<pre id='line2103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2104")'> 2104:         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]</pre>
<pre id='line2104' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2104
 *         cdef dihedral_ids result
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 */
  __pyx_v_result.atom_id_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2105")'> 2105:         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]</pre>
<pre id='line2105' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2105
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 */
  __pyx_v_result.atom_id_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2106")'> 2106:         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]</pre>
<pre id='line2106' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2106
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 */
  __pyx_v_result.atom_id_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2107")'> 2107:         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]</pre>
<pre id='line2107' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2107
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_v_result.atom_id_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2108")'> 2108: </pre>
<pre id='line2108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line2109")'> 2109:         return result</pre>
<pre id='line2109' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":2109
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: remove this an correct order of parameters!
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2110")'> 2110: </pre>
<pre id='line2110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2111")'> 2111:     #TODO: remove this an correct order of parameters!</pre>
<pre id='line2111' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2112")'> 2112:     @cython.profile(False)</pre>
<pre id='line2112' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2113")'> 2113:     cdef inline dihedral_parameters _get_parameters(self, int index):</pre>
<pre id='line2113' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2113
 *     #TODO: remove this an correct order of parameters!
 *     @cython.profile(False)
 *     cdef inline dihedral_parameters _get_parameters(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_parameters result
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_parameters", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2114")'> 2114: </pre>
<pre id='line2114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2115")'> 2115:         cdef dihedral_parameters result</pre>
<pre id='line2115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2116")'> 2116: </pre>
<pre id='line2116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2117")'> 2117:         result.param_0 = self._compiled_components[index].parameters[0]</pre>
<pre id='line2117' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2117
 *         cdef dihedral_parameters result
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 */
  __pyx_v_result.param_0 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2118")'> 2118:         result.param_1 = self._compiled_components[index].parameters[3]</pre>
<pre id='line2118' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2118
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 */
  __pyx_v_result.param_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2119")'> 2119:         result.param_2 = self._compiled_components[index].parameters[1]</pre>
<pre id='line2119' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2119
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]
 */
  __pyx_v_result.param_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2120")'> 2120:         result.param_3 = self._compiled_components[index].parameters[4]</pre>
<pre id='line2120' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2120
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_4 = self._compiled_components[index].parameters[2]
 * 
 */
  __pyx_v_result.param_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[4]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2121")'> 2121:         result.param_4 = self._compiled_components[index].parameters[2]</pre>
<pre id='line2121' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2121
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_result.param_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2122")'> 2122: </pre>
<pre id='line2122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2123")'> 2123: </pre>
<pre id='line2123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2124")'> 2124: </pre>
<pre id='line2124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2125")'> 2125: </pre>
<pre id='line2125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line2126")'> 2126:         return result</pre>
<pre id='line2126' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":2126
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2127")'> 2127: </pre>
<pre id='line2127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2128")'> 2128:     @cython.profile(False)</pre>
<pre id='line2128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2129")'> 2129:     cdef inline float _get_coefficient(self, int index):</pre>
<pre id='line2129' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2129
 * 
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._compiled_components[index].coefficient
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coefficient", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line2130")'> 2130:         return self._compiled_components[index].coefficient</pre>
<pre id='line2130' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":2130
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):
 *         return self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    TODO make this consistent with the distance forces factor
 */
  __pyx_r = (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_7_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_arg_index); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_7_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_arg_index) {
  int __pyx_v_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor (wrapper)", 0);
  assert(__pyx_arg_index); {
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_arg_index);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2133; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_6_calc_single_force_factor(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), ((int)__pyx_v_index));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2131")'> 2131: </pre>
<pre id='line2131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2132")'> 2132: #    TODO make this consistent with the distance forces factor</pre>
<pre id='line2132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2133")'> 2133:     def _calc_single_force_factor(self, int index):</pre>
<pre id='line2133' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2133
 * 
 * #    TODO make this consistent with the distance forces factor
 *     def _calc_single_force_factor(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._cython_calc_single_force_factor(index)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_6_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line2134")'> 2134:         return self._cython_calc_single_force_factor(index)</pre>
<pre id='line2134' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":2134
 * #    TODO make this consistent with the distance forces factor
 *     def _calc_single_force_factor(self, int index):
 *         return self._cython_calc_single_force_factor(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2135")'> 2135: </pre>
<pre id='line2135' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2136")'> 2136:     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line2136' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2136
 *         return self._cython_calc_single_force_factor(index)
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int factor_index
 *         cdef int component_index
 */

static void __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_factor_index;
  int __pyx_v_component_index;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2137")'> 2137:         cdef int factor_index</pre>
<pre id='line2137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2138")'> 2138:         cdef int component_index</pre>
<pre id='line2138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2139")'> 2139: </pre>
<pre id='line2139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line2140")'> 2140:         for factor_index in range(len(self._active_components)):</pre>
<pre id='line2140' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":2140
 *         cdef int component_index
 * 
 *         for factor_index in range(len(self._active_components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component_index = self._active_components[factor_index]
 *             self._dihedral_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)
 */
  if (unlikely(!__pyx_v_self->__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 2140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self->__pyx_base._active_components, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_factor_index = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line2141")'> 2141:             component_index = self._active_components[factor_index]</pre>
<pre id='line2141' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":2141
 * 
 *         for factor_index in range(len(self._active_components)):
 *             component_index = self._active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._dihedral_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)
 * 
 */
    if (unlikely(!__pyx_v_self->__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 2141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
    __pyx_t_4 = __pyx_v_factor_index;
    __pyx_v_component_index = (*((int *) ( /* dim=0 */ (__pyx_v_self->__pyx_base._active_components.data + __pyx_t_4 * __pyx_v_self->__pyx_base._active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line2142")'> 2142:             self._dihedral_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)</pre>
<pre id='line2142' class='code' style='background-color: #FFFFb6'>
    /* "Cython_shift_calculator.pyx":2142
 *         for factor_index in range(len(self._active_components)):
 *             component_index = self._active_components[factor_index]
 *             self._dihedral_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = __pyx_v_factor_index;
    __pyx_t_6 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_result.data + __pyx_t_5 * __pyx_v_component_to_result.strides[0]) )));
    __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(__pyx_v_self, __pyx_v_component_index, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_6 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
  }

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_dihedral_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2143")'> 2143: </pre>
<pre id='line2143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2144")'> 2144: </pre>
<pre id='line2144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2145")'> 2145: </pre>
<pre id='line2145' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2146")'> 2146:     cdef inline float _cython_calc_single_force_factor(self, int index):</pre>
<pre id='line2146' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2146
 * 
 * 
 *     cdef inline float _cython_calc_single_force_factor(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_ids dihedral_atom_ids
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_params;
  float __pyx_v_angle;
  float __pyx_v_result;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2147")'> 2147: </pre>
<pre id='line2147' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2148")'> 2148:         cdef dihedral_ids dihedral_atom_ids</pre>
<pre id='line2148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2149")'> 2149:         cdef dihedral_parameters params</pre>
<pre id='line2149' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2150")'> 2150: </pre>
<pre id='line2150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2151")'> 2151:         cdef float angle,result</pre>
<pre id='line2151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2152")'> 2152: </pre>
<pre id='line2152' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2153")'> 2153: </pre>
<pre id='line2153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2154")'> 2154:         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)</pre>
<pre id='line2154' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2154
 * 
 * 
 *         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         params = self._get_parameters(index)
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_index);
  __pyx_v_dihedral_atom_ids = __pyx_t_1;
  __pyx_v_dihedral_atom_ids = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2155")'> 2155: </pre>
<pre id='line2155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2156")'> 2156:         params = self._get_parameters(index)</pre>
<pre id='line2156' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2156
 *         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)
 * 
 *         params = self._get_parameters(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)
 */
  __pyx_v_params = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2157")'> 2157: </pre>
<pre id='line2157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2158")'> 2158:         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)</pre>
<pre id='line2158' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2158
 *         params = self._get_parameters(index)
 * 
 *         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 */
  __pyx_v_angle = __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_dihedral_atom_ids);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2159")'> 2159: </pre>
<pre id='line2159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2160")'> 2160:         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \</pre>
<pre id='line2160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2161")'> 2161:                         params.param_2 * sin(angle + params.param_3)</pre>
<pre id='line2161' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2161
 * 
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 *                         params.param_2 * sin(angle + params.param_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_v_result = (((-3.0 * __pyx_v_params.param_0) * sin(((3.0 * __pyx_v_angle) + __pyx_v_params.param_1))) - (__pyx_v_params.param_2 * sin((__pyx_v_angle + __pyx_v_params.param_3))));
</pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line2162")'> 2162:         return result</pre>
<pre id='line2162' class='code' style='background-color: #FFFF22'>
  /* "Cython_shift_calculator.pyx":2162
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 *                         params.param_2 * sin(angle + params.param_3)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_9_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_9_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,&__pyx_n_s__forces,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_set") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_8_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2163")'> 2163: </pre>
<pre id='line2163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2164")'> 2164: </pre>
<pre id='line2164' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2165")'> 2165: </pre>
<pre id='line2165' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2166")'> 2166:     def _calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line2166' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2166
 * 
 * 
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO tidy this up a hack for the test suite
 *         cdef Dihedral_component* saved_component_list = self._compiled_components
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_8_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Dihedral_component *__pyx_v_saved_component_list;
  int __pyx_v_saved_num_components;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2167")'> 2167:         #TODO tidy this up a hack for the test suite</pre>
<pre id='line2167' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2168")'> 2168:         cdef Dihedral_component* saved_component_list = self._compiled_components</pre>
<pre id='line2168' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2168
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 *         #TODO tidy this up a hack for the test suite
 *         cdef Dihedral_component* saved_component_list = self._compiled_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int saved_num_components = self._num_components
 * 
 */
  __pyx_t_1 = __pyx_v_self->_compiled_components;
  __pyx_v_saved_component_list = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2169")'> 2169:         cdef int saved_num_components = self._num_components</pre>
<pre id='line2169' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2169
 *         #TODO tidy this up a hack for the test suite
 *         cdef Dihedral_component* saved_component_list = self._compiled_components
 *         cdef int saved_num_components = self._num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._num_components  = 1
 */
  __pyx_t_2 = __pyx_v_self->_num_components;
  __pyx_v_saved_num_components = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2170")'> 2170: </pre>
<pre id='line2170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2171")'> 2171:         self._num_components  = 1</pre>
<pre id='line2171' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2171
 *         cdef int saved_num_components = self._num_components
 * 
 *         self._num_components  = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = &saved_component_list[index]
 * 
 */
  __pyx_v_self->_num_components = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2172")'> 2172:         self._compiled_components = &amp;saved_component_list[index]</pre>
<pre id='line2172' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2172
 * 
 *         self._num_components  = 1
 *         self._compiled_components = &saved_component_list[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._dihedral_calc_single_force_set(0,factor,forces)
 */
  __pyx_v_self->_compiled_components = (&(__pyx_v_saved_component_list[__pyx_v_index]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2173")'> 2173: </pre>
<pre id='line2173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2174")'> 2174:         self._dihedral_calc_single_force_set(0,factor,forces)</pre>
<pre id='line2174' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2174
 *         self._compiled_components = &saved_component_list[index]
 * 
 *         self._dihedral_calc_single_force_set(0,factor,forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_components = saved_component_list
 */
  __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(__pyx_v_self, 0, __pyx_v_factor, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2175")'> 2175: </pre>
<pre id='line2175' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2176")'> 2176:         self._compiled_components = saved_component_list</pre>
<pre id='line2176' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2176
 *         self._dihedral_calc_single_force_set(0,factor,forces)
 * 
 *         self._compiled_components = saved_component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = saved_num_components
 * 
 */
  __pyx_v_self->_compiled_components = __pyx_v_saved_component_list;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2177")'> 2177:         self._num_components = saved_num_components</pre>
<pre id='line2177' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2177
 * 
 *         self._compiled_components = saved_component_list
 *         self._num_components = saved_num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_num_components = __pyx_v_saved_num_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2178")'> 2178: </pre>
<pre id='line2178' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2179")'> 2179: </pre>
<pre id='line2179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2180")'> 2180:     cdef inline void _dihedral_calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line2180' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2180
 * 
 * 
 *     cdef inline void _dihedral_calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 r1, r2, r4, temp
 *         cdef Vec3 n1, n2
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_r1;
  Vec3 __pyx_v_r2;
  Vec3 __pyx_v_r4;
  Vec3 __pyx_v_n1;
  Vec3 __pyx_v_n2;
  float __pyx_v_weight;
  float __pyx_v_factor_1;
  float __pyx_v_factor_2;
  float __pyx_v_factor_3;
  Vec3 __pyx_v_F2;
  Vec3 __pyx_v_F3;
  float __pyx_v_dihedral_factor;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_atom_ids;
  float __pyx_v_r2_length;
  float __pyx_v_r2_length_2;
  Vec3 __pyx_v_v1;
  Vec3 __pyx_v_v2;
  Vec3 __pyx_v_v3;
  Vec3 __pyx_v_v4;
  Vec3 __pyx_v_r3;
  Vec3 __pyx_v_F1;
  Vec3 __pyx_v_F4;
  Vec3 __pyx_v_T1;
  Vec3 __pyx_v_T2;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_dihedral_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2181")'> 2181:         cdef Vec3 r1, r2, r4, temp</pre>
<pre id='line2181' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2182")'> 2182:         cdef Vec3 n1, n2</pre>
<pre id='line2182' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2183")'> 2183:         cdef float weight</pre>
<pre id='line2183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2184")'> 2184:         cdef float factor_1, factor_2, factor_3</pre>
<pre id='line2184' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2185")'> 2185:         cdef Vec3 F2, F3,</pre>
<pre id='line2185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2186")'> 2186:         cdef Vec3 T3, T4</pre>
<pre id='line2186' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2187")'> 2187: </pre>
<pre id='line2187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2188")'> 2188:         cdef float dihedral_factor = self._cython_calc_single_force_factor(index)</pre>
<pre id='line2188' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2188
 *         cdef Vec3 T3, T4
 * 
 *         cdef float dihedral_factor = self._cython_calc_single_force_factor(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)
 * 
 */
  __pyx_v_dihedral_factor = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2189")'> 2189:         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)</pre>
<pre id='line2189' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2189
 * 
 *         cdef float dihedral_factor = self._cython_calc_single_force_factor(index)
 *         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float r2_length, r2_length_2
 */
  __pyx_v_atom_ids = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2190")'> 2190: </pre>
<pre id='line2190' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2191")'> 2191:         cdef float r2_length, r2_length_2</pre>
<pre id='line2191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2192")'> 2192: </pre>
<pre id='line2192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2193")'> 2193:         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)</pre>
<pre id='line2193' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2193
 *         cdef float r2_length, r2_length_2
 * 
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 */
  __pyx_v_v1 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2194")'> 2194:         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)</pre>
<pre id='line2194' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2194
 * 
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 */
  __pyx_v_v2 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2195")'> 2195:         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)</pre>
<pre id='line2195' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2195
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 * 
 */
  __pyx_v_v3 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2196")'> 2196:         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)</pre>
<pre id='line2196' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2196
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r1 = v1 - v2
 */
  __pyx_v_v4 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2197")'> 2197: </pre>
<pre id='line2197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2198")'> 2198:         r1 = v1 - v2</pre>
<pre id='line2198' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2198
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 * 
 *         r1 = v1 - v2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         r2 = v3 - v2
 * 
 */
  __pyx_v_r1 = (__pyx_v_v1 - __pyx_v_v2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2199")'> 2199:         r2 = v3 - v2</pre>
<pre id='line2199' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2199
 * 
 *         r1 = v1 - v2
 *         r2 = v3 - v2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 r3 = r2
 */
  __pyx_v_r2 = (__pyx_v_v3 - __pyx_v_v2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2200")'> 2200: </pre>
<pre id='line2200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2201")'> 2201:         cdef Vec3 r3 = r2</pre>
<pre id='line2201' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2201
 *         r2 = v3 - v2
 * 
 *         cdef Vec3 r3 = r2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(r3, -1)
 * 
 */
  __pyx_v_r3 = __pyx_v_r2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2202")'> 2202:         operator_times(r3, -1)</pre>
<pre id='line2202' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2202
 * 
 *         cdef Vec3 r3 = r2
 *         operator_times(r3, -1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r4 = v4 - v3
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_r3, -1.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2203")'> 2203: </pre>
<pre id='line2203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2204")'> 2204:         r4 = v4 - v3</pre>
<pre id='line2204' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2204
 *         operator_times(r3, -1)
 * 
 *         r4 = v4 - v3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        print vec3_as_tuple(r1), vec3_as_tuple(r2), vec3_as_tuple(r3), vec3_as_tuple(r4)
 */
  __pyx_v_r4 = (__pyx_v_v4 - __pyx_v_v3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2205")'> 2205: </pre>
<pre id='line2205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2206")'> 2206: #        print vec3_as_tuple(r1), vec3_as_tuple(r2), vec3_as_tuple(r3), vec3_as_tuple(r4)</pre>
<pre id='line2206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2207")'> 2207: </pre>
<pre id='line2207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2208")'> 2208:         # compute normal vector to plane containing v1, v2, and v3</pre>
<pre id='line2208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2209")'> 2209:         n1 = cross(r1, r2)</pre>
<pre id='line2209' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2209
 * 
 *         # compute normal vector to plane containing v1, v2, and v3
 *         n1 = cross(r1, r2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # compute normal vector to plane containing v2, v3, and v4
 *         n2 = cross(r3, r4)
 */
  __pyx_v_n1 = cross(__pyx_v_r1, __pyx_v_r2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2210")'> 2210:         # compute normal vector to plane containing v2, v3, and v4</pre>
<pre id='line2210' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2211")'> 2211:         n2 = cross(r3, r4)</pre>
<pre id='line2211' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2211
 *         n1 = cross(r1, r2)
 *         # compute normal vector to plane containing v2, v3, and v4
 *         n2 = cross(r3, r4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)
 */
  __pyx_v_n2 = cross(__pyx_v_r3, __pyx_v_r4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2212")'> 2212: </pre>
<pre id='line2212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2213")'> 2213:         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)</pre>
<pre id='line2213' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2213
 *         n2 = cross(r3, r4)
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         r2_length_2 = r2_length*r2_length
 * 
 */
  __pyx_v_r2_length = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_atom_ids.atom_id_2, __pyx_v_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2214")'> 2214:         r2_length_2 = r2_length*r2_length</pre>
<pre id='line2214' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2214
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)
 *         r2_length_2 = r2_length*r2_length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_r2_length_2 = (__pyx_v_r2_length * __pyx_v_r2_length);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2215")'> 2215: </pre>
<pre id='line2215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2216")'> 2216: </pre>
<pre id='line2216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2217")'> 2217:         weight = factor * self._get_coefficient(index)</pre>
<pre id='line2217' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2217
 * 
 * 
 *         weight = factor * self._get_coefficient(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_weight = (__pyx_v_factor * __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(__pyx_v_self, __pyx_v_index));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2218")'> 2218: </pre>
<pre id='line2218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2219")'> 2219: </pre>
<pre id='line2219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2220")'> 2220: </pre>
<pre id='line2220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2221")'> 2221: #        // force calculation according to Bekker, Berendsen and van Gunsteren (1995),</pre>
<pre id='line2221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2222")'> 2222: #        // Journal of Computational Chemistry 16, pp. 527-533:</pre>
<pre id='line2222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2223")'> 2223: ##        // Force and virial of torsional-angle-dependent potentials.</pre>
<pre id='line2223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2224")'> 2224:         factor_1 = dihedral_factor * r2_length</pre>
<pre id='line2224' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2224
 * #        // Journal of Computational Chemistry 16, pp. 527-533:
 * ##        // Force and virial of torsional-angle-dependent potentials.
 *         factor_1 = dihedral_factor * r2_length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 F1 = n1
 */
  __pyx_v_factor_1 = (__pyx_v_dihedral_factor * __pyx_v_r2_length);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2225")'> 2225: </pre>
<pre id='line2225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2226")'> 2226:         cdef Vec3 F1 = n1</pre>
<pre id='line2226' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2226
 *         factor_1 = dihedral_factor * r2_length
 * 
 *         cdef Vec3 F1 = n1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F1, (-factor_1 / norm(n1)**2))
 * 
 */
  __pyx_v_F1 = __pyx_v_n1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2227")'> 2227:         operator_times(F1, (-factor_1 / norm(n1)**2))</pre>
<pre id='line2227' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2227
 * 
 *         cdef Vec3 F1 = n1
 *         operator_times(F1, (-factor_1 / norm(n1)**2))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 F4 = n2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F1, ((-__pyx_v_factor_1) / powf(norm(__pyx_v_n1), 2.0)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2228")'> 2228: </pre>
<pre id='line2228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2229")'> 2229:         cdef Vec3 F4 = n2</pre>
<pre id='line2229' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2229
 *         operator_times(F1, (-factor_1 / norm(n1)**2))
 * 
 *         cdef Vec3 F4 = n2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F4, ( factor_1 / norm(n2)**2))
 * 
 */
  __pyx_v_F4 = __pyx_v_n2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2230")'> 2230:         operator_times(F4, ( factor_1 / norm(n2)**2))</pre>
<pre id='line2230' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2230
 * 
 *         cdef Vec3 F4 = n2
 *         operator_times(F4, ( factor_1 / norm(n2)**2))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F4, (__pyx_v_factor_1 / powf(norm(__pyx_v_n2), 2.0)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2231")'> 2231: </pre>
<pre id='line2231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2232")'> 2232:         factor_2 = dot(r1, r2) / r2_length_2</pre>
<pre id='line2232' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2232
 *         operator_times(F4, ( factor_1 / norm(n2)**2))
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         factor_3 = dot(r3, r4) / r2_length_2
 * 
 */
  __pyx_v_factor_2 = (dot(__pyx_v_r1, __pyx_v_r2) / __pyx_v_r2_length_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2233")'> 2233:         factor_3 = dot(r3, r4) / r2_length_2</pre>
<pre id='line2233' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2233
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2
 *         factor_3 = dot(r3, r4) / r2_length_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 T1 = F1
 */
  __pyx_v_factor_3 = (dot(__pyx_v_r3, __pyx_v_r4) / __pyx_v_r2_length_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2234")'> 2234: </pre>
<pre id='line2234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2235")'> 2235:         cdef Vec3 T1 = F1</pre>
<pre id='line2235' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2235
 *         factor_3 = dot(r3, r4) / r2_length_2
 * 
 *         cdef Vec3 T1 = F1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T1,  (factor_2-1))
 * 
 */
  __pyx_v_T1 = __pyx_v_F1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2236")'> 2236:         operator_times(T1,  (factor_2-1))</pre>
<pre id='line2236' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2236
 * 
 *         cdef Vec3 T1 = F1
 *         operator_times(T1,  (factor_2-1))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 T2 = F4
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T1, (__pyx_v_factor_2 - 1.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2237")'> 2237: </pre>
<pre id='line2237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2238")'> 2238:         cdef Vec3 T2 = F4</pre>
<pre id='line2238' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2238
 *         operator_times(T1,  (factor_2-1))
 * 
 *         cdef Vec3 T2 = F4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T2,  -factor_3)
 * 
 */
  __pyx_v_T2 = __pyx_v_F4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2239")'> 2239:         operator_times(T2,  -factor_3)</pre>
<pre id='line2239' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2239
 * 
 *         cdef Vec3 T2 = F4
 *         operator_times(T2,  -factor_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         F2 = T1 + T2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T2, (-__pyx_v_factor_3));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2240")'> 2240: </pre>
<pre id='line2240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2241")'> 2241:         F2 = T1 + T2</pre>
<pre id='line2241' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2241
 *         operator_times(T2,  -factor_3)
 * 
 *         F2 = T1 + T2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         T1 = F1
 */
  __pyx_v_F2 = (__pyx_v_T1 + __pyx_v_T2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2242")'> 2242: </pre>
<pre id='line2242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2243")'> 2243:         T1 = F1</pre>
<pre id='line2243' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2243
 *         F2 = T1 + T2
 * 
 *         T1 = F1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T1,  -factor_2)
 * 
 */
  __pyx_v_T1 = __pyx_v_F1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2244")'> 2244:         operator_times(T1,  -factor_2)</pre>
<pre id='line2244' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2244
 * 
 *         T1 = F1
 *         operator_times(T1,  -factor_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         T2 = F4
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T1, (-__pyx_v_factor_2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2245")'> 2245: </pre>
<pre id='line2245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2246")'> 2246:         T2 = F4</pre>
<pre id='line2246' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2246
 *         operator_times(T1,  -factor_2)
 * 
 *         T2 = F4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T2, (factor_3 -1))
 * 
 */
  __pyx_v_T2 = __pyx_v_F4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2247")'> 2247:         operator_times(T2, (factor_3 -1))</pre>
<pre id='line2247' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2247
 * 
 *         T2 = F4
 *         operator_times(T2, (factor_3 -1))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         F3 = T1 + T2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T2, (__pyx_v_factor_3 - 1.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2248")'> 2248: </pre>
<pre id='line2248' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2249")'> 2249:         F3 = T1 + T2</pre>
<pre id='line2249' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2249
 *         operator_times(T2, (factor_3 -1))
 * 
 *         F3 = T1 + T2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        print vec3_as_tuple(F1), vec3_as_tuple(F2), vec3_as_tuple(F3), vec3_as_tuple(F4)
 */
  __pyx_v_F3 = (__pyx_v_T1 + __pyx_v_T2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2250")'> 2250: </pre>
<pre id='line2250' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2251")'> 2251: #        print vec3_as_tuple(F1), vec3_as_tuple(F2), vec3_as_tuple(F3), vec3_as_tuple(F4)</pre>
<pre id='line2251' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2252")'> 2252: #        // assign forces</pre>
<pre id='line2252' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2253")'> 2253: #        force_triplet_1 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_1)</pre>
<pre id='line2253' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2254")'> 2254: #        force_triplet_2 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_2)</pre>
<pre id='line2254' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2255")'> 2255: #        force_triplet_3 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_3)</pre>
<pre id='line2255' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2256")'> 2256: #        force_triplet_4 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_4)</pre>
<pre id='line2256' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2257")'> 2257: </pre>
<pre id='line2257' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2258")'> 2258:         operator_times(F1, weight)</pre>
<pre id='line2258' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2258
 * #        force_triplet_4 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_4)
 * 
 *         operator_times(F1, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F1, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2259")'> 2259:         operator_times(F2, weight)</pre>
<pre id='line2259' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2259
 * 
 *         operator_times(F1, weight)
 *         operator_times(F2, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F3, weight)
 *         operator_times(F4, weight)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F2, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2260")'> 2260:         operator_times(F3, weight)</pre>
<pre id='line2260' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2260
 *         operator_times(F1, weight)
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F4, weight)
 * 
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F3, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2261")'> 2261:         operator_times(F4, weight)</pre>
<pre id='line2261' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2261
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)
 *         operator_times(F4, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         forces.add(atom_ids.atom_id_1,F1)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F4, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2262")'> 2262: </pre>
<pre id='line2262' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2263")'> 2263:         forces.add(atom_ids.atom_id_1,F1)</pre>
<pre id='line2263' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2263
 *         operator_times(F4, weight)
 * 
 *         forces.add(atom_ids.atom_id_1,F1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_1, __pyx_v_F1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2264")'> 2264:         forces.add(atom_ids.atom_id_2,F2)</pre>
<pre id='line2264' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2264
 * 
 *         forces.add(atom_ids.atom_id_1,F1)
 *         forces.add(atom_ids.atom_id_2,F2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_3,F3)
 *         forces.add(atom_ids.atom_id_4,F4)
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_2, __pyx_v_F2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2265")'> 2265:         forces.add(atom_ids.atom_id_3,F3)</pre>
<pre id='line2265' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2265
 *         forces.add(atom_ids.atom_id_1,F1)
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_4,F4)
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_3, __pyx_v_F3);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line2266")'> 2266:         forces.add(atom_ids.atom_id_4,F4)</pre>
<pre id='line2266' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":2266
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)
 *         forces.add(atom_ids.atom_id_4,F4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_4, __pyx_v_F4);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2267")'> 2267: </pre>
<pre id='line2267' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2268")'> 2268: </pre>
<pre id='line2268' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2269")'> 2269: cdef struct Ring_target_component:</pre>
<pre id='line2269' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2269
 * 
 * 
 * cdef struct Ring_target_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom_id
 *       int atom_type_id
 */
struct __pyx_t_17shift_calculators_Ring_target_component {
  int target_atom_id;
  int atom_type_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2270")'> 2270:       int target_atom_id</pre>
<pre id='line2270' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2271")'> 2271:       int atom_type_id</pre>
<pre id='line2271' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2272")'> 2272: </pre>
<pre id='line2272' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2273")'> 2273: cdef struct Ring_component:</pre>
<pre id='line2273' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2273
 *       int atom_type_id
 * 
 * cdef struct Ring_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int ring_id
 *     int num_atoms
 */
struct __pyx_t_17shift_calculators_Ring_component {
  int ring_id;
  int num_atoms;
  int atom_ids[6];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2274")'> 2274:     int ring_id</pre>
<pre id='line2274' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2275")'> 2275:     int num_atoms</pre>
<pre id='line2275' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2276")'> 2276:     int[6] atom_ids</pre>
<pre id='line2276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2277")'> 2277: </pre>
<pre id='line2277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2278")'> 2278: #cdef int RING_ATOM_IDS = 1</pre>
<pre id='line2278' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2279")'> 2279: cdef class Fast_ring_force_calculator(Base_force_calculator):</pre>
<pre id='line2279' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2279
 * 
 * #cdef int RING_ATOM_IDS = 1
 * cdef class Fast_ring_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  struct __pyx_obj_17shift_calculators_Vec3_list *_centre_cache;
  struct __pyx_obj_17shift_calculators_Vec3_list *_normal_cache;
  struct __pyx_t_17shift_calculators_Ring_target_component *_compiled_components;
  int _num_components;
  struct __pyx_t_17shift_calculators_Ring_component *_compiled_ring_components;
  int _num_ring_components;
  PyObject *_raw_ring_component_data;
  PyObject *raw_data;
  struct __pyx_obj_17shift_calculators_Coef_components *_compiled_coef_components;
};


/* "Cython_shift_calculator.pyx":2279
 * 
 * #cdef int RING_ATOM_IDS = 1
 * cdef class Fast_ring_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  void (*_bytes_to_ring_components)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, PyObject *);
  Vec3 *(*_get_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
  Vec3 *(*_get_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
  void (*_ring_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
  void (*_calculate_single_ring_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, struct __pyx_t_17shift_calculators_Coef_component *, float, struct __pyx_obj_17shift_calculators_Out_array *);
  void (*_build_cython_force_terms)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &);
  void (*_cython_calc_target_atom_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &, struct __pyx_obj_17shift_calculators_Out_array *);
  void (*_cython_calculate_ring_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_force_calculator;
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &, struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2280")'> 2280: </pre>
<pre id='line2280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2281")'> 2281: </pre>
<pre id='line2281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2282")'> 2282:     cdef Vec3_list _centre_cache</pre>
<pre id='line2282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2283")'> 2283:     cdef Vec3_list _normal_cache</pre>
<pre id='line2283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2284")'> 2284: </pre>
<pre id='line2284' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2285")'> 2285:     cdef Ring_target_component* _compiled_components</pre>
<pre id='line2285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2286")'> 2286:     cdef int _num_components</pre>
<pre id='line2286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2287")'> 2287: </pre>
<pre id='line2287' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2288")'> 2288:     cdef Ring_component* _compiled_ring_components</pre>
<pre id='line2288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2289")'> 2289:     cdef int _num_ring_components</pre>
<pre id='line2289' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2290")'> 2290:     cdef object _raw_ring_component_data</pre>
<pre id='line2290' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2291")'> 2291: </pre>
<pre id='line2291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2292")'> 2292:     cdef object raw_data</pre>
<pre id='line2292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2293")'> 2293: </pre>
<pre id='line2293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2294")'> 2294:     cdef Coef_components _compiled_coef_components</pre>
<pre id='line2294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2295")'> 2295: </pre>
<pre id='line2295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2296")'> 2296: </pre>
<pre id='line2296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2297")'> 2297:     def __cinit__(self):</pre>
<pre id='line2297' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2297
 * 
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.raw_data =  None
 *         self._compiled_components = NULL
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_force_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2298")'> 2298:         self.raw_data =  None</pre>
<pre id='line2298' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2298
 * 
 *     def __cinit__(self):
 *         self.raw_data =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->raw_data);
  __pyx_v_self->raw_data = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2299")'> 2299:         self._compiled_components = NULL</pre>
<pre id='line2299' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2299
 *     def __cinit__(self):
 *         self.raw_data =  None
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2300")'> 2300:         self._num_components = 0</pre>
<pre id='line2300' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2300
 *         self.raw_data =  None
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._raw_ring_component_data = None
 */
  __pyx_v_self->_num_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2301")'> 2301: </pre>
<pre id='line2301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2302")'> 2302:         self._raw_ring_component_data = None</pre>
<pre id='line2302' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2302
 *         self._num_components = 0
 * 
 *         self._raw_ring_component_data = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_ring_components = NULL
 *         self._num_ring_components = 0
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_ring_component_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_ring_component_data);
  __pyx_v_self->_raw_ring_component_data = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2303")'> 2303:         self._compiled_ring_components = NULL</pre>
<pre id='line2303' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2303
 * 
 *         self._raw_ring_component_data = None
 *         self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = 0
 * 
 */
  __pyx_v_self->_compiled_ring_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2304")'> 2304:         self._num_ring_components = 0</pre>
<pre id='line2304' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2304
 *         self._raw_ring_component_data = None
 *         self._compiled_ring_components = NULL
 *         self._num_ring_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 */
  __pyx_v_self->_num_ring_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2305")'> 2305: </pre>
<pre id='line2305' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2306")'> 2306:         #note this is not a raw array of structs it's a compiled python class</pre>
<pre id='line2306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2307")'> 2307:         self._compiled_coef_components = None</pre>
<pre id='line2307' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2307
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 *         self._compiled_coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._centre_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)Py_None);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2308")'> 2308: </pre>
<pre id='line2308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2309")'> 2309:         self._centre_cache = None</pre>
<pre id='line2309' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2309
 *         self._compiled_coef_components = None
 * 
 *         self._centre_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = None
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line2310")'> 2310:         self._normal_cache = None</pre>
<pre id='line2310' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":2310
 * 
 *         self._centre_cache = None
 *         self._normal_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self,name="not set"):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_23);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2312; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2312; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2311")'> 2311: </pre>
<pre id='line2311' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2312")'> 2312:     def __init__(self,name="not set"):</pre>
<pre id='line2312' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2312
 *         self._normal_cache = None
 * 
 *     def __init__(self,name="not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_ring_force_calculator, self).__init__(name=name)
 * 
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line2313")'> 2313:         super(Fast_ring_force_calculator, self).__init__(name=name)</pre>
<pre id='line2313' class='code' style='background-color: #FFFF2d'>
  /* "Cython_shift_calculator.pyx":2313
 * 
 *     def __init__(self,name="not set"):
 *         super(Fast_ring_force_calculator, self).__init__(name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _bytes_to_components(self, data):
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_5_bytes_to_components(PyObject *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_4_bytes_to_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2314")'> 2314: </pre>
<pre id='line2314' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2315")'> 2315:     def _bytes_to_components(self, data):</pre>
<pre id='line2315' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2315
 *         super(Fast_ring_force_calculator, self).__init__(name=name)
 * 
 *     def _bytes_to_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_4_bytes_to_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2316")'> 2316:         self.raw_data =  data</pre>
<pre id='line2316' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2316
 * 
 *     def _bytes_to_components(self, data):
 *         self.raw_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Ring_target_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->raw_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->raw_data);
  __pyx_v_self->raw_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line2317")'> 2317:         self._compiled_components =  &lt;Ring_target_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line2317' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":2317
 *     def _bytes_to_components(self, data):
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  len(data)/ sizeof(Ring_target_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Ring_target_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line2318")'> 2318:         self._num_components =  len(data)/ sizeof(Ring_target_component)</pre>
<pre id='line2318' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":2318
 *         self.raw_data =  data
 *         self._compiled_components =  <code><</code>Ring_target_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_components =  len(data)/ sizeof(Ring_target_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _bytes_to_ring_components(self, data):
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Ring_target_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._bytes_to_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2319")'> 2319: </pre>
<pre id='line2319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2320")'> 2320:     cdef void _bytes_to_ring_components(self, data):</pre>
<pre id='line2320' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2320
 *         self._num_components =  len(data)/ sizeof(Ring_target_component)
 * 
 *     cdef void _bytes_to_ring_components(self, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_ring_component_data =  data
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)
 */

static void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__bytes_to_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2321")'> 2321:         self._raw_ring_component_data =  data</pre>
<pre id='line2321' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2321
 * 
 *     cdef void _bytes_to_ring_components(self, data):
 *         self._raw_ring_component_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_ring_components =  len(data)/ sizeof(Ring_component)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_ring_component_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_ring_component_data);
  __pyx_v_self->_raw_ring_component_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line2322")'> 2322:         self._compiled_ring_components =  &lt;Ring_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line2322' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":2322
 *     cdef void _bytes_to_ring_components(self, data):
 *         self._raw_ring_component_data =  data
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components =  len(data)/ sizeof(Ring_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_ring_components = ((struct __pyx_t_17shift_calculators_Ring_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line2323")'> 2323:         self._num_ring_components =  len(data)/ sizeof(Ring_component)</pre>
<pre id='line2323' class='code' style='background-color: #FFFF30'>
  /* "Cython_shift_calculator.pyx":2323
 *         self._raw_ring_component_data =  data
 *         self._compiled_ring_components =  <code><</code>Ring_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_ring_components =  len(data)/ sizeof(Ring_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_ring_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Ring_component)));

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_force_calculator._bytes_to_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_7_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_7_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_coef_components = 0;
  PyObject *__pyx_v_components = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__coef_components,&__pyx_n_s__components,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coef_components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_set_coef_components", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_set_coef_components") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_coef_components = values[0];
    __pyx_v_components = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_set_coef_components", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._set_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_6_set_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_coef_components, __pyx_v_components);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2324")'> 2324: </pre>
<pre id='line2324' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2325")'> 2325: </pre>
<pre id='line2325' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2326")'> 2326:     def _set_coef_components(self,coef_components, components):</pre>
<pre id='line2326' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2326
 * 
 * 
 *     def _set_coef_components(self,coef_components, components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coef_components = Coef_components(coef_components, components)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_6_set_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_coef_components, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line2327")'> 2327:         self._compiled_coef_components = Coef_components(coef_components, components)</pre>
<pre id='line2327' class='code' style='background-color: #FFFF4d'>
  /* "Cython_shift_calculator.pyx":2327
 * 
 *     def _set_coef_components(self,coef_components, components):
 *         self._compiled_coef_components = Coef_components(coef_components, components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_ring_components(self,ring_components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Coef_components)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_t_2);
  __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._set_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_9_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_9_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_8_set_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2328")'> 2328: </pre>
<pre id='line2328' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2329")'> 2329:     def _set_ring_components(self,ring_components):</pre>
<pre id='line2329' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2329
 *         self._compiled_coef_components = Coef_components(coef_components, components)
 * 
 *     def _set_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self. _bytes_to_ring_components(ring_components)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_8_set_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line2330")'> 2330:         self. _bytes_to_ring_components(ring_components)</pre>
<pre id='line2330' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":2330
 * 
 *     def _set_ring_components(self,ring_components):
 *         self. _bytes_to_ring_components(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_bytes_to_ring_components(__pyx_v_self, __pyx_v_ring_components);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_11_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_11_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_10_set_normal_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_normals));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2331")'> 2331: </pre>
<pre id='line2331' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2332")'> 2332: </pre>
<pre id='line2332' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2333")'> 2333: </pre>
<pre id='line2333' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2334")'> 2334:     def _set_normal_cache(self,normals):</pre>
<pre id='line2334' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2334
 * 
 * 
 *     def _set_normal_cache(self,normals):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_10_set_normal_cache(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line2335")'> 2335:         self._normal_cache = &lt;Vec3_list&gt; normals</pre>
<pre id='line2335' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":2335
 * 
 *     def _set_normal_cache(self,normals):
 *         self._normal_cache = <code><</code>Vec3_list> normals             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_centre_cache(self,centres):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_13_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_13_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_12_set_centre_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_centres));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2336")'> 2336: </pre>
<pre id='line2336' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2337")'> 2337:     def _set_centre_cache(self,centres):</pre>
<pre id='line2337' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2337
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 *     def _set_centre_cache(self,centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = <code><</code>Vec3_list> centres
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_12_set_centre_cache(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache", 0);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line2338")'> 2338:         self._centre_cache = &lt;Vec3_list&gt; centres</pre>
<pre id='line2338' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":2338
 * 
 *     def _set_centre_cache(self,centres):
 *         self._centre_cache = <code><</code>Vec3_list> centres             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2339")'> 2339: </pre>
<pre id='line2339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2340")'> 2340: </pre>
<pre id='line2340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2341")'> 2341:     @cython.profile(False)</pre>
<pre id='line2341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2342")'> 2342:     cdef inline Vec3* _get_ring_normal(self, int ring_id) nogil:</pre>
<pre id='line2342' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2342
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._normal_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2343")'> 2343:         return  self._normal_cache.get(ring_id)</pre>
<pre id='line2343' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2343
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id) nogil:
 *         return  self._normal_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_normal_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2344")'> 2344: </pre>
<pre id='line2344' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2345")'> 2345:     @cython.profile(False)</pre>
<pre id='line2345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2346")'> 2346:     cdef inline Vec3* _get_ring_centre(self, int ring_id) nogil:</pre>
<pre id='line2346' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2346
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._centre_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2347")'> 2347:         return  self._centre_cache.get(ring_id)</pre>
<pre id='line2347' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2347
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id) nogil:
 *         return  self._centre_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_centre_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2348")'> 2348: </pre>
<pre id='line2348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2349")'> 2349: </pre>
<pre id='line2349' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2350")'> 2350: #    @cython.profile(False)</pre>
<pre id='line2350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2351")'> 2351: #    cdef inline target_type _get_target_and_type(self,int index):</pre>
<pre id='line2351' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2352")'> 2352: #        component = self._get_component(index)</pre>
<pre id='line2352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2353")'> 2353: ##        TODO: this needs to contain better names a union?</pre>
<pre id='line2353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2354")'> 2354: #        cdef target_type result</pre>
<pre id='line2354' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2355")'> 2355: #        result.target_atom_id = component[0]</pre>
<pre id='line2355' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2356")'> 2356: #        result.atom_type_id = component[1]</pre>
<pre id='line2356' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2357")'> 2357: #</pre>
<pre id='line2357' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2358")'> 2358: #        return result#</pre>
<pre id='line2358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2359")'> 2359: </pre>
<pre id='line2359' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2360")'> 2360: </pre>
<pre id='line2360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2361")'> 2361:     cdef inline void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line2361' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2361
 * 
 * 
 *     cdef inline void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int factor_index
 *         cdef int component_index
 */

static void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_factor_index;
  int __pyx_v_component_index;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2362")'> 2362:         cdef int factor_index</pre>
<pre id='line2362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2363")'> 2363:         cdef int component_index</pre>
<pre id='line2363' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2364")'> 2364: </pre>
<pre id='line2364' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line2365")'> 2365:         for factor_index in range(len(self._active_components)):</pre>
<pre id='line2365' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":2365
 *         cdef int component_index
 * 
 *         for factor_index in range(len(self._active_components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component_index = self._active_components[factor_index]
 *             self._ring_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)
 */
  if (unlikely(!__pyx_v_self->__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 2365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self->__pyx_base._active_components, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_factor_index = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line2366")'> 2366:             component_index = self._active_components[factor_index]</pre>
<pre id='line2366' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":2366
 * 
 *         for factor_index in range(len(self._active_components)):
 *             component_index = self._active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._ring_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)
 * 
 */
    if (unlikely(!__pyx_v_self->__pyx_base._active_components.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");{__pyx_filename = __pyx_f[0]; __pyx_lineno = 2366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}}
    __pyx_t_4 = __pyx_v_factor_index;
    __pyx_v_component_index = (*((int *) ( /* dim=0 */ (__pyx_v_self->__pyx_base._active_components.data + __pyx_t_4 * __pyx_v_self->__pyx_base._active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line2367")'> 2367:             self._ring_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)</pre>
<pre id='line2367' class='code' style='background-color: #FFFFb6'>
    /* "Cython_shift_calculator.pyx":2367
 *         for factor_index in range(len(self._active_components)):
 *             component_index = self._active_components[factor_index]
 *             self._ring_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):
 */
    __pyx_t_5 = __pyx_v_factor_index;
    __pyx_t_6 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_result.data + __pyx_t_5 * __pyx_v_component_to_result.strides[0]) )));
    __pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(__pyx_v_self, __pyx_v_component_index, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_6 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
  }

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2368")'> 2368: </pre>
<pre id='line2368' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2369")'> 2369:     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):</pre>
<pre id='line2369' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2369
 *             self._ring_calc_single_force_set(component_index,force_factors[component_to_result[factor_index]],force)
 * 
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int atom_type_id  = self._compiled_components[index].atom_type_id
 *         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  int __pyx_v_atom_type_id;
  struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_v_coeff_offset;
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component;
  int __pyx_v_coef_offset;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_ring_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2370")'> 2370:         cdef int atom_type_id  = self._compiled_components[index].atom_type_id</pre>
<pre id='line2370' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2370
 * 
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):
 *         cdef int atom_type_id  = self._compiled_components[index].atom_type_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 *         cdef Coef_component* coef_component
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).atom_type_id;
  __pyx_v_atom_type_id = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2371")'> 2371:         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)</pre>
<pre id='line2371' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2371
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):
 *         cdef int atom_type_id  = self._compiled_components[index].atom_type_id
 *         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Coef_component* coef_component
 * 
 */
  __pyx_v_coeff_offset = __pyx_f_17shift_calculators_15Coef_components_get_id_offsets(__pyx_v_self->_compiled_coef_components, __pyx_v_atom_type_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2372")'> 2372:         cdef Coef_component* coef_component</pre>
<pre id='line2372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2373")'> 2373: </pre>
<pre id='line2373' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2374")'> 2374:         for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):</pre>
<pre id='line2374' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2374
 *         cdef Coef_component* coef_component
 * 
 *         for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #           TODO: remove magic numbers or add structs
 *             coef_component = self._compiled_coef_components.get_component(coef_offset)
 */
  __pyx_t_1 = ((__pyx_v_coeff_offset[0]).offset + (__pyx_v_coeff_offset[0]).length);
  for (__pyx_t_2 = (__pyx_v_coeff_offset[0]).offset; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_coef_offset = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2375")'> 2375: #           TODO: remove magic numbers or add structs</pre>
<pre id='line2375' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2376")'> 2376:             coef_component = self._compiled_coef_components.get_component(coef_offset)</pre>
<pre id='line2376' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2376
 *         for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):
 * #           TODO: remove magic numbers or add structs
 *             coef_component = self._compiled_coef_components.get_component(coef_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)
 * 
 */
    __pyx_v_coef_component = __pyx_f_17shift_calculators_15Coef_components_get_component(__pyx_v_self->_compiled_coef_components, __pyx_v_coef_offset);
</pre><pre class='line' style='background-color: #FFFF18' onclick='toggleDiv("line2377")'> 2377:             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)</pre>
<pre id='line2377' class='code' style='background-color: #FFFF18'>
    /* "Cython_shift_calculator.pyx":2377
 * #           TODO: remove magic numbers or add structs
 *             coef_component = self._compiled_coef_components.get_component(coef_offset)
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):
 */
    ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calculate_single_ring_forces(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).target_atom_id, (__pyx_v_self->_compiled_components[__pyx_v_index]).atom_type_id, __pyx_v_coef_component, __pyx_v_force_factor, __pyx_v_forces);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_15_calculate_ring_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_15_calculate_ring_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_atom_type_id;
  int __pyx_v_ring_id;
  float __pyx_v_force_factor;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms = 0;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_ring_forces (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__atom_type_id,&__pyx_n_s__ring_id,&__pyx_n_s__force_factor,&__pyx_n_s__python_sub_terms,&__pyx_n_s__forces,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_type_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__python_sub_terms)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calculate_ring_forces") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_atom_type_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_atom_type_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_force_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_python_sub_terms = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)values[3]);
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[4]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calculate_ring_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_python_sub_terms), __pyx_ptype_17shift_calculators_Python_ring_force_sub_terms, 1, "python_sub_terms", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_14_calculate_ring_forces(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_atom_type_id, __pyx_v_ring_id, __pyx_v_force_factor, __pyx_v_python_sub_terms, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2378")'> 2378: </pre>
<pre id='line2378' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2379")'> 2379:     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):</pre>
<pre id='line2379' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2379
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_14_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_atom_type_id, int __pyx_v_ring_id, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_ring_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2380")'> 2380:         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()</pre>
<pre id='line2380' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2380
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 * 
 */
  __pyx_v_terms = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_python_sub_terms->__pyx_vtab)->get_terms(__pyx_v_python_sub_terms);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2381")'> 2381:         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)</pre>
<pre id='line2381' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2381
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor,Out_array forces):
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(__pyx_v_self, __pyx_v_atom_type_id, __pyx_v_ring_id, __pyx_v_force_factor, __pyx_v_terms, __pyx_v_forces);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2382")'> 2382: </pre>
<pre id='line2382' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2383")'> 2383:     cdef void _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor,Out_array forces):</pre>
<pre id='line2383' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2383
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 * 
 *     cdef void _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor,Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Ring_force_sub_terms force_terms
 */

static void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__calculate_single_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_atom_type_id, struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_force_terms;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_single_ring_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2384")'> 2384: </pre>
<pre id='line2384' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2385")'> 2385:         cdef Ring_force_sub_terms force_terms</pre>
<pre id='line2385' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2386")'> 2386:         self._build_cython_force_terms(target_atom_id, coef_component.ring_id, force_terms)</pre>
<pre id='line2386' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2386
 * 
 *         cdef Ring_force_sub_terms force_terms
 *         self._build_cython_force_terms(target_atom_id, coef_component.ring_id, force_terms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_coef_component->ring_id, __pyx_v_force_terms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2387")'> 2387: </pre>
<pre id='line2387' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2388")'> 2388:         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)</pre>
<pre id='line2388' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2388
 *         self._build_cython_force_terms(target_atom_id, coef_component.ring_id, force_terms)
 * 
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(__pyx_v_self, __pyx_v_target_atom_id, (__pyx_v_force_factor * __pyx_v_coef_component->coefficient), __pyx_v_force_terms, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2389")'> 2389: </pre>
<pre id='line2389' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2390")'> 2390: #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals</pre>
<pre id='line2390' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line2391")'> 2391:         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)</pre>
<pre id='line2391' class='code' style='background-color: #FFFF28'>
  /* "Cython_shift_calculator.pyx":2391
 * 
 * #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals
 *         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _build_force_terms(self, int target_atom_id, int ring_id):
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(__pyx_v_self, __pyx_v_atom_type_id, __pyx_v_coef_component->ring_id, (__pyx_v_force_factor * __pyx_v_coef_component->coefficient), __pyx_v_force_terms, __pyx_v_forces);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_17_build_force_terms(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_17_build_force_terms(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  int __pyx_v_ring_id;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_force_terms (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__ring_id,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_force_terms", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_build_force_terms") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_force_terms", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._build_force_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_16_build_force_terms(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_ring_id);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2392")'> 2392: </pre>
<pre id='line2392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2393")'> 2393:     def _build_force_terms(self, int target_atom_id, int ring_id):</pre>
<pre id='line2393' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2393
 *         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)
 * 
 *     def _build_force_terms(self, int target_atom_id, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms terms
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_16_build_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_result = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_force_terms", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2394")'> 2394:         cdef Ring_force_sub_terms terms</pre>
<pre id='line2394' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2395")'> 2395:         self._build_cython_force_terms(target_atom_id, ring_id, terms)</pre>
<pre id='line2395' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2395
 *     def _build_force_terms(self, int target_atom_id, int ring_id):
 *         cdef Ring_force_sub_terms terms
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_terms);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line2396")'> 2396:         result  = Python_ring_force_sub_terms()</pre>
<pre id='line2396' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":2396
 *         cdef Ring_force_sub_terms terms
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)
 *         result  = Python_ring_force_sub_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.setup(terms)
 *         return result
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Python_ring_force_sub_terms)), ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line2397")'> 2397:         result.setup(terms)</pre>
<pre id='line2397' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":2397
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_result->__pyx_vtab)->setup(__pyx_v_result, __pyx_v_terms);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line2398")'> 2398:         return result</pre>
<pre id='line2398' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":2398
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms& result):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._build_force_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2399")'> 2399: </pre>
<pre id='line2399' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2400")'> 2400:     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms&amp; result):</pre>
<pre id='line2400' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2400
 *         return result
 * 
 *     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms& result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)
 * 
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_result) {
  Vec3 __pyx_v_target_atom_pos;
  Vec3 __pyx_v_ring_centre;
  Vec3 *__pyx_v_ring_normal;
  Vec3 __pyx_v_d;
  float __pyx_v_dL;
  float __pyx_v_dL2;
  float __pyx_v_dL4;
  float __pyx_v_dL3;
  float __pyx_v_dL6;
  float __pyx_v_nL;
  float __pyx_v_nL2;
  float __pyx_v_dLnL;
  float __pyx_v_dL3nL3;
  float __pyx_v_dn;
  float __pyx_v_dn2;
  float __pyx_v_u;
  float __pyx_v_gradUQ_factor;
  Vec3 __pyx_v_scaled_d;
  Vec3 __pyx_v_scaled_normal;
  Vec3 __pyx_v_gradUQ;
  float __pyx_v_gradVQ_factor;
  Vec3 __pyx_v_gradVQ;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_cython_force_terms", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2401")'> 2401:         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)</pre>
<pre id='line2401' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2401
 * 
 *     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms& result):
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]
 */
  __pyx_v_target_atom_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2402")'> 2402: </pre>
<pre id='line2402' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2403")'> 2403:         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]</pre>
<pre id='line2403' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2403
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3* ring_normal = self._get_ring_normal(ring_id)
 * 
 */
  __pyx_v_ring_centre = (__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_centre(__pyx_v_self, __pyx_v_ring_id)[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2404")'> 2404:         cdef Vec3* ring_normal = self._get_ring_normal(ring_id)</pre>
<pre id='line2404' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2404
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]
 *         cdef Vec3* ring_normal = self._get_ring_normal(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # distance vector between atom of interest and ring center
 */
  __pyx_v_ring_normal = __pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_normal(__pyx_v_self, __pyx_v_ring_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2405")'> 2405: </pre>
<pre id='line2405' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2406")'> 2406:         # distance vector between atom of interest and ring center</pre>
<pre id='line2406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2407")'> 2407:         cdef Vec3 d = target_atom_pos - ring_centre</pre>
<pre id='line2407' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2407
 * 
 *         # distance vector between atom of interest and ring center
 *         cdef Vec3 d = target_atom_pos - ring_centre             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL = norm(d)
 * 
 */
  __pyx_v_d = (__pyx_v_target_atom_pos - __pyx_v_ring_centre);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2408")'> 2408:         cdef float dL = norm(d)</pre>
<pre id='line2408' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2408
 *         # distance vector between atom of interest and ring center
 *         cdef Vec3 d = target_atom_pos - ring_centre
 *         cdef float dL = norm(d)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # squared distance of atom of interest from ring center
 */
  __pyx_v_dL = norm(__pyx_v_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2409")'> 2409: </pre>
<pre id='line2409' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2410")'> 2410:         # squared distance of atom of interest from ring center</pre>
<pre id='line2410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2411")'> 2411:         cdef float dL2 = dot(d, d) #            if (dL2 &lt; 0.5) cout &lt;&lt; "CAMSHIFT WARNING: Distance between atom and center of ring alarmingly small at " &lt;&lt; sqrt(dL2) &lt;&lt; " Angstrom!" &lt;&lt; endl;</pre>
<pre id='line2411' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2411
 * 
 *         # squared distance of atom of interest from ring center
 *         cdef float dL2 = dot(d, d) #            if (dL2 <code><</code> 0.5) cout <code><</code><code><</code> "CAMSHIFT WARNING: Distance between atom and center of ring alarmingly small at " <code><</code><code><</code> sqrt(dL2) <code><</code><code><</code> " Angstrom!" <code><</code><code><</code> endl;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 */
  __pyx_v_dL2 = dot(__pyx_v_d, __pyx_v_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2412")'> 2412: </pre>
<pre id='line2412' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2413")'> 2413:         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates</pre>
<pre id='line2413' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2414")'> 2414:         cdef float dL4 = dL ** 4</pre>
<pre id='line2414' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2414
 * 
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 *         cdef float dL4 = dL ** 4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL3 = dL ** 3
 *         cdef float dL6 = dL3 ** 2
 */
  __pyx_v_dL4 = powf(__pyx_v_dL, 4.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2415")'> 2415:         cdef float dL3 = dL ** 3</pre>
<pre id='line2415' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2415
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 *         cdef float dL4 = dL ** 4
 *         cdef float dL3 = dL ** 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL6 = dL3 ** 2
 * 
 */
  __pyx_v_dL3 = powf(__pyx_v_dL, 3.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2416")'> 2416:         cdef float dL6 = dL3 ** 2</pre>
<pre id='line2416' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2416
 *         cdef float dL4 = dL ** 4
 *         cdef float dL3 = dL ** 3
 *         cdef float dL6 = dL3 ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float nL = norm(ring_normal[0])
 */
  __pyx_v_dL6 = powf(__pyx_v_dL3, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2417")'> 2417: </pre>
<pre id='line2417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2418")'> 2418:         cdef float nL = norm(ring_normal[0])</pre>
<pre id='line2418' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2418
 *         cdef float dL6 = dL3 ** 2
 * 
 *         cdef float nL = norm(ring_normal[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL
 */
  __pyx_v_nL = norm((__pyx_v_ring_normal[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2419")'> 2419:         cdef float nL2 = nL ** 2</pre>
<pre id='line2419' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2419
 * 
 *         cdef float nL = norm(ring_normal[0])
 *         cdef float nL2 = nL ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dLnL = dL * nL
 *         cdef float dL3nL3 = dL3 * nL2 * nL
 */
  __pyx_v_nL2 = powf(__pyx_v_nL, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2420")'> 2420:         cdef float dLnL = dL * nL</pre>
<pre id='line2420' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2420
 *         cdef float nL = norm(ring_normal[0])
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL3nL3 = dL3 * nL2 * nL
 * 
 */
  __pyx_v_dLnL = (__pyx_v_dL * __pyx_v_nL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2421")'> 2421:         cdef float dL3nL3 = dL3 * nL2 * nL</pre>
<pre id='line2421' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2421
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL
 *         cdef float dL3nL3 = dL3 * nL2 * nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float dn = dot(d, ring_normal[0])
 */
  __pyx_v_dL3nL3 = ((__pyx_v_dL3 * __pyx_v_nL2) * __pyx_v_nL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2422")'> 2422: </pre>
<pre id='line2422' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2423")'> 2423:         cdef float dn = dot(d, ring_normal[0])</pre>
<pre id='line2423' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2423
 *         cdef float dL3nL3 = dL3 * nL2 * nL
 * 
 *         cdef float dn = dot(d, ring_normal[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dn2 = dn ** 2
 * 
 */
  __pyx_v_dn = dot(__pyx_v_d, (__pyx_v_ring_normal[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2424")'> 2424:         cdef float dn2 = dn ** 2</pre>
<pre id='line2424' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2424
 * 
 *         cdef float dn = dot(d, ring_normal[0])
 *         cdef float dn2 = dn ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)
 */
  __pyx_v_dn2 = powf(__pyx_v_dn, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2425")'> 2425: </pre>
<pre id='line2425' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2426")'> 2426:         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)</pre>
<pre id='line2426' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2426
 *         cdef float dn2 = dn ** 2
 * 
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)
 */
  __pyx_v_u = (1.0 - ((3.0 * __pyx_v_dn2) / (__pyx_v_dL2 * __pyx_v_nL2)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2427")'> 2427: </pre>
<pre id='line2427' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2428")'> 2428:         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)</pre>
<pre id='line2428' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2428
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)
 * 
 *         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #TODO: remove temporarys and operator_mu;t#
 */
  __pyx_v_gradUQ_factor = ((-6.0 * __pyx_v_dn) / (__pyx_v_dL4 * __pyx_v_nL2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2429")'> 2429: </pre>
<pre id='line2429' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2430")'> 2430:         #TODO: remove temporarys and operator_mu;t#</pre>
<pre id='line2430' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2431")'> 2431:         cdef Vec3 scaled_d =  d</pre>
<pre id='line2431' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2431
 * 
 *         #TODO: remove temporarys and operator_mu;t#
 *         cdef Vec3 scaled_d =  d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal[0]
 */
  __pyx_v_scaled_d = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2432")'> 2432:         operator_times(scaled_d,dn)</pre>
<pre id='line2432' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2432
 *         #TODO: remove temporarys and operator_mu;t#
 *         cdef Vec3 scaled_d =  d
 *         operator_times(scaled_d,dn)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 scaled_normal = ring_normal[0]
 *         operator_times(scaled_normal,dL2)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_scaled_d, __pyx_v_dn);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2433")'> 2433:         cdef Vec3 scaled_normal = ring_normal[0]</pre>
<pre id='line2433' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2433
 *         cdef Vec3 scaled_d =  d
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(scaled_normal,dL2)
 * 
 */
  __pyx_v_scaled_normal = (__pyx_v_ring_normal[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2434")'> 2434:         operator_times(scaled_normal,dL2)</pre>
<pre id='line2434' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2434
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal[0]
 *         operator_times(scaled_normal,dL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_scaled_normal, __pyx_v_dL2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2435")'> 2435: </pre>
<pre id='line2435' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2436")'> 2436:         cdef Vec3 gradUQ = scaled_normal - scaled_d</pre>
<pre id='line2436' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2436
 *         operator_times(scaled_normal,dL2)
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(gradUQ,gradUQ_factor)
 * 
 */
  __pyx_v_gradUQ = (__pyx_v_scaled_normal - __pyx_v_scaled_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2437")'> 2437:         operator_times(gradUQ,gradUQ_factor)</pre>
<pre id='line2437' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2437
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d
 *         operator_times(gradUQ,gradUQ_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_gradUQ, __pyx_v_gradUQ_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2438")'> 2438: </pre>
<pre id='line2438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2439")'> 2439: </pre>
<pre id='line2439' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2440")'> 2440:         cdef float gradVQ_factor = 3.0 * dL</pre>
<pre id='line2440' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2440
 * 
 * 
 *         cdef float gradVQ_factor = 3.0 * dL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 gradVQ = d
 *         operator_times(gradVQ,gradVQ_factor)
 */
  __pyx_v_gradVQ_factor = (3.0 * __pyx_v_dL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2441")'> 2441:         cdef Vec3 gradVQ = d</pre>
<pre id='line2441' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2441
 * 
 *         cdef float gradVQ_factor = 3.0 * dL
 *         cdef Vec3 gradVQ = d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(gradVQ,gradVQ_factor)
 * 
 */
  __pyx_v_gradVQ = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2442")'> 2442:         operator_times(gradVQ,gradVQ_factor)</pre>
<pre id='line2442' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2442
 *         cdef float gradVQ_factor = 3.0 * dL
 *         cdef Vec3 gradVQ = d
 *         operator_times(gradVQ,gradVQ_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.dL3nL3 = dL3nL3
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_gradVQ, __pyx_v_gradVQ_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2443")'> 2443: </pre>
<pre id='line2443' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2444")'> 2444:         result.dL3nL3 = dL3nL3</pre>
<pre id='line2444' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2444
 *         operator_times(gradVQ,gradVQ_factor)
 * 
 *         result.dL3nL3 = dL3nL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dLnL =dLnL
 *         result.dn = dn
 */
  __pyx_v_result.dL3nL3 = __pyx_v_dL3nL3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2445")'> 2445:         result.dLnL =dLnL</pre>
<pre id='line2445' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2445
 * 
 *         result.dL3nL3 = dL3nL3
 *         result.dLnL =dLnL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dn = dn
 *         result.dL = dL
 */
  __pyx_v_result.dLnL = __pyx_v_dLnL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2446")'> 2446:         result.dn = dn</pre>
<pre id='line2446' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2446
 *         result.dL3nL3 = dL3nL3
 *         result.dLnL =dLnL
 *         result.dn = dn             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL = dL
 *         result.nL = nL
 */
  __pyx_v_result.dn = __pyx_v_dn;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2447")'> 2447:         result.dL = dL</pre>
<pre id='line2447' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2447
 *         result.dLnL =dLnL
 *         result.dn = dn
 *         result.dL = dL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.nL = nL
 *         result.d = d
 */
  __pyx_v_result.dL = __pyx_v_dL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2448")'> 2448:         result.nL = nL</pre>
<pre id='line2448' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2448
 *         result.dn = dn
 *         result.dL = dL
 *         result.nL = nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.d = d
 *         result.gradUQ = gradUQ
 */
  __pyx_v_result.nL = __pyx_v_nL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2449")'> 2449:         result.d = d</pre>
<pre id='line2449' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2449
 *         result.dL = dL
 *         result.nL = nL
 *         result.d = d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3
 */
  __pyx_v_result.d = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2450")'> 2450:         result.gradUQ = gradUQ</pre>
<pre id='line2450' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2450
 *         result.nL = nL
 *         result.d = d
 *         result.gradUQ = gradUQ             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL3 =dL3
 *         result.u  = u
 */
  __pyx_v_result.gradUQ = __pyx_v_gradUQ;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2451")'> 2451:         result.dL3 =dL3</pre>
<pre id='line2451' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2451
 *         result.d = d
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.u  = u
 *         result.gradVQ = gradVQ
 */
  __pyx_v_result.dL3 = __pyx_v_dL3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2452")'> 2452:         result.u  = u</pre>
<pre id='line2452' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2452
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3
 *         result.u  = u             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6
 */
  __pyx_v_result.u = __pyx_v_u;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2453")'> 2453:         result.gradVQ = gradVQ</pre>
<pre id='line2453' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2453
 *         result.dL3 =dL3
 *         result.u  = u
 *         result.gradVQ = gradVQ             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL6 = dL6
 *         result.ring_normal =  ring_normal[0]
 */
  __pyx_v_result.gradVQ = __pyx_v_gradVQ;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2454")'> 2454:         result.dL6 = dL6</pre>
<pre id='line2454' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2454
 *         result.u  = u
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.ring_normal =  ring_normal[0]
 * 
 */
  __pyx_v_result.dL6 = __pyx_v_dL6;
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line2455")'> 2455:         result.ring_normal =  ring_normal[0]</pre>
<pre id='line2455' class='code' style='background-color: #FFFF1e'>
  /* "Cython_shift_calculator.pyx":2455
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6
 *         result.ring_normal =  ring_normal[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        return  dL3, u, dL6, ring_normal,  atom_type_id, coefficient, d, factor, dn, dL3nL3, dL, nL, dLnL
 */
  __pyx_v_result.ring_normal = (__pyx_v_ring_normal[0]);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_19_calc_target_atom_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_19_calc_target_atom_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  float __pyx_v_force_factor;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms = 0;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_target_atom_forces (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__force_factor,&__pyx_n_s__python_sub_terms,&__pyx_n_s__forces,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__python_sub_terms)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_target_atom_forces") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_force_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_python_sub_terms = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)values[2]);
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calc_target_atom_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_python_sub_terms), __pyx_ptype_17shift_calculators_Python_ring_force_sub_terms, 1, "python_sub_terms", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_18_calc_target_atom_forces(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_force_factor, __pyx_v_python_sub_terms, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2456")'> 2456: </pre>
<pre id='line2456' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2457")'> 2457: #        return  dL3, u, dL6, ring_normal,  atom_type_id, coefficient, d, factor, dn, dL3nL3, dL, nL, dLnL</pre>
<pre id='line2457' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2458")'> 2458: ##    ---</pre>
<pre id='line2458' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2459")'> 2459: #</pre>
<pre id='line2459' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2460")'> 2460:     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):</pre>
<pre id='line2460' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2460
 * ##    ---
 * #
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_18_calc_target_atom_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_target_atom_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2461")'> 2461:         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()</pre>
<pre id='line2461' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2461
 * #
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 * 
 */
  __pyx_v_terms = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_python_sub_terms->__pyx_vtab)->get_terms(__pyx_v_python_sub_terms);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2462")'> 2462:         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)</pre>
<pre id='line2462' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2462
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms& sub_terms, Out_array forces):
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_force_factor, __pyx_v_terms, __pyx_v_forces);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2463")'> 2463: </pre>
<pre id='line2463' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2464")'> 2464:     cdef inline void _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms&amp; sub_terms, Out_array forces):</pre>
<pre id='line2464' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2464
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 * 
 *     cdef inline void _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms& sub_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef object target_force_triplet
 *         cdef int axis
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, float __pyx_v_force_factor, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  int __pyx_v_axis;
  float __pyx_v_term1;
  Vec3 __pyx_v_result;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_target_atom_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2465")'> 2465:         cdef object target_force_triplet</pre>
<pre id='line2465' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2466")'> 2466:         cdef int axis</pre>
<pre id='line2466' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2467")'> 2467: #        target_force_triplet = self._get_or_make_target_force_triplet(forces, target_atom_id)</pre>
<pre id='line2467' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2468")'> 2468: #</pre>
<pre id='line2468' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2469")'> 2469: #        # update forces on query atom</pre>
<pre id='line2469' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2470")'> 2470:         cdef float term1</pre>
<pre id='line2470' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2471")'> 2471:         cdef Vec3 result</pre>
<pre id='line2471' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2472")'> 2472:         for axis in range(3):</pre>
<pre id='line2472' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2472
 *         cdef float term1
 *         cdef Vec3 result
 *         for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_axis = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2473")'> 2473:             #TODO: report this as a bug it produces an un initialized reference</pre>
<pre id='line2473' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2474")'> 2474:             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])</pre>
<pre id='line2474' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2474
 *         for axis in range(3):
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[axis] = -force_factor * term1 / sub_terms.dL6
 * 
 */
    __pyx_v_term1 = (((__pyx_v_sub_terms.gradUQ[__pyx_v_axis]) * __pyx_v_sub_terms.dL3) - (__pyx_v_sub_terms.u * (__pyx_v_sub_terms.gradVQ[__pyx_v_axis])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2475")'> 2475:             result[axis] = -force_factor * term1 / sub_terms.dL6</pre>
<pre id='line2475' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2475
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])
 *             result[axis] = -force_factor * term1 / sub_terms.dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         forces.add(target_atom_id, result)
 */
    (__pyx_v_result[__pyx_v_axis]) = (((-__pyx_v_force_factor) * __pyx_v_term1) / __pyx_v_sub_terms.dL6);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2476")'> 2476: </pre>
<pre id='line2476' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line2477")'> 2477:         forces.add(target_atom_id, result)</pre>
<pre id='line2477' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":2477
 *             result[axis] = -force_factor * term1 / sub_terms.dL6
 * 
 *         forces.add(target_atom_id, result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #             *  / sub_terms.dL6
 * #
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_target_atom_id, __pyx_v_result);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2478")'> 2478: #             *  / sub_terms.dL6</pre>
<pre id='line2478' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2479")'> 2479: #</pre>
<pre id='line2479' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2480")'> 2480: #    #TODO: calculation of GradU and gradV are not consistent with force_terms for target atom correct</pre>
<pre id='line2480' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2481")'> 2481: #    #TODO: reduce number of parameters to method</pre>
<pre id='line2481' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2482")'> 2482: </pre>
<pre id='line2482' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2483")'> 2483:     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):</pre>
<pre id='line2483' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2483
 * #    #TODO: reduce number of parameters to method
 * 
 *     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, CYTHON_UNUSED int __pyx_v_atom_type_id, int __pyx_v_ring_id, float __pyx_v_force_factor, struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_force_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_temp_normal;
  Vec3 __pyx_v_nSum;
  int __pyx_v_num_ring_atoms;
  int __pyx_v_limit;
  Vec3 __pyx_v_g;
  int __pyx_v_ring_atom_id;
  int __pyx_v_ring_atom_index;
  int __pyx_v_index_1;
  int __pyx_v_index_2;
  float __pyx_v_pos_1;
  float __pyx_v_pos_2;
  float __pyx_v_pos_3;
  float __pyx_v_pos_4;
  int __pyx_v_offset;
  int __pyx_v_indices_1[3];
  int __pyx_v_indices_2[3];
  float __pyx_v_ab[3];
  float __pyx_v_c[3];
  float __pyx_v_factor;
  float __pyx_v_factor2;
  float __pyx_v_one_over_num_ring_atoms;
  float __pyx_v_factor3;
  Vec3 __pyx_v_gradU;
  Vec3 __pyx_v_gradV;
  Vec3 __pyx_v_result;
  int __pyx_v_axis;
  float __pyx_v_sub_term;
  float __pyx_v_sub_force;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calculate_ring_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2484")'> 2484:         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)</pre>
<pre id='line2484' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2484
 * 
 *     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 nSum = temp_normal
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 */
  __pyx_v_temp_normal = Vec3(__pyx_v_force_terms.ring_normal);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2485")'> 2485:         cdef Vec3 nSum = temp_normal</pre>
<pre id='line2485' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2485
 *     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 */
  __pyx_v_nSum = __pyx_v_temp_normal;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2486")'> 2486:         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]</pre>
<pre id='line2486' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2486
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_nSum, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2487")'> 2487:     #// 2 for a 5-membered ring, 3 for a 6-membered ring</pre>
<pre id='line2487' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2488")'> 2488:         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms</pre>
<pre id='line2488' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2488
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int limit = num_ring_atoms - 3
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).num_atoms;
  __pyx_v_num_ring_atoms = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2489")'> 2489:         cdef int limit = num_ring_atoms - 3</pre>
<pre id='line2489' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2489
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms
 *         cdef int limit = num_ring_atoms - 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        for atom_type_id, ring_id, coefficient in coef_components:
 */
  __pyx_v_limit = (__pyx_v_num_ring_atoms - 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2490")'> 2490: </pre>
<pre id='line2490' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2491")'> 2491: #        for atom_type_id, ring_id, coefficient in coef_components:</pre>
<pre id='line2491' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2492")'> 2492:         cdef Vec3 g = Vec3()</pre>
<pre id='line2492' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2492
 * 
 * #        for atom_type_id, ring_id, coefficient in coef_components:
 *         cdef Vec3 g = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int ring_atom_id
 *         cdef int ring_atom_index
 */
  __pyx_v_g = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2493")'> 2493:         cdef int ring_atom_id</pre>
<pre id='line2493' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2494")'> 2494:         cdef int ring_atom_index</pre>
<pre id='line2494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2495")'> 2495:         cdef int index_1</pre>
<pre id='line2495' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2496")'> 2496:         cdef int index_2</pre>
<pre id='line2496' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2497")'> 2497:         cdef float pos_1</pre>
<pre id='line2497' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2498")'> 2498:         cdef float pos_2</pre>
<pre id='line2498' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2499")'> 2499:         cdef float pos_3</pre>
<pre id='line2499' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2500")'> 2500:         cdef float pos_4</pre>
<pre id='line2500' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2501")'> 2501:         cdef int offset</pre>
<pre id='line2501' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2502")'> 2502: </pre>
<pre id='line2502' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2503")'> 2503:         cdef int[3] indices_1</pre>
<pre id='line2503' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2504")'> 2504:         cdef int[3] indices_2</pre>
<pre id='line2504' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2505")'> 2505: </pre>
<pre id='line2505' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2506")'> 2506:         cdef float[3] ab</pre>
<pre id='line2506' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2507")'> 2507:         cdef float[3] c</pre>
<pre id='line2507' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2508")'> 2508: </pre>
<pre id='line2508' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2509")'> 2509:         cdef float factor</pre>
<pre id='line2509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2510")'> 2510:         cdef float factor2</pre>
<pre id='line2510' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2511")'> 2511:         cdef float one_over_num_ring_atoms</pre>
<pre id='line2511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2512")'> 2512:         cdef float factor3</pre>
<pre id='line2512' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2513")'> 2513: </pre>
<pre id='line2513' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2514")'> 2514:         cdef Vec3 gradU</pre>
<pre id='line2514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2515")'> 2515:         cdef Vec3 gradV</pre>
<pre id='line2515' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2516")'> 2516:         cdef Vec3 result</pre>
<pre id='line2516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2517")'> 2517: </pre>
<pre id='line2517' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2518")'> 2518:         cdef int axis</pre>
<pre id='line2518' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2519")'> 2519:         cdef float sub_term</pre>
<pre id='line2519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2520")'> 2520:         cdef float sub_force</pre>
<pre id='line2520' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2521")'> 2521: </pre>
<pre id='line2521' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2522")'> 2522:         for ring_atom_index in range(num_ring_atoms):</pre>
<pre id='line2522' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2522
 *         cdef float sub_force
 * 
 *         for ring_atom_index in range(num_ring_atoms):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:
 */
  __pyx_t_1 = __pyx_v_num_ring_atoms;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_ring_atom_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2523")'> 2523:             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]</pre>
<pre id='line2523' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2523
 * 
 *         for ring_atom_index in range(num_ring_atoms):
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):
 */
    __pyx_v_ring_atom_id = ((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_ring_atom_index]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2524")'> 2524:             if ring_atom_index &lt; limit:</pre>
<pre id='line2524' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2524
 *         for ring_atom_index in range(num_ring_atoms):
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3
 */
    __pyx_t_3 = (__pyx_v_ring_atom_index <code><</code> __pyx_v_limit);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2525")'> 2525:                 for axis in range(3):</pre>
<pre id='line2525' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2525
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3
 */
      for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
        __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2526")'> 2526:                     index_1 = (ring_atom_index + 1) % 3</pre>
<pre id='line2526' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2526
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 */
        __pyx_v_index_1 = ((__pyx_v_ring_atom_index + 1) % 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2527")'> 2527:                     index_2 = (ring_atom_index + 2) % 3</pre>
<pre id='line2527' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2527
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 */
        __pyx_v_index_2 = ((__pyx_v_ring_atom_index + 2) % 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2528")'> 2528:                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]</pre>
<pre id='line2528' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2528
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)
 */
        __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2529")'> 2529:                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]</pre>
<pre id='line2529' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2529
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)
 * 
 */
        __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_2]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2530")'> 2530:                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)</pre>
<pre id='line2530' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2530
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             else:
 */
        (__pyx_v_g[__pyx_v_axis]) = (__pyx_v_pos_1 - __pyx_v_pos_2);
      }
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2531")'> 2531: </pre>
<pre id='line2531' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2532")'> 2532:             else:</pre>
<pre id='line2532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2533")'> 2533:                 if  ring_atom_index &gt;= num_ring_atoms - limit:</pre>
<pre id='line2533' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2533
 * 
 *             else:
 *                 if  ring_atom_index >= num_ring_atoms - limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):
 */
      __pyx_t_3 = (__pyx_v_ring_atom_index >= (__pyx_v_num_ring_atoms - __pyx_v_limit));
      if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2534")'> 2534:                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring</pre>
<pre id='line2534' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2534
 *             else:
 *                 if  ring_atom_index >= num_ring_atoms - limit:
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 */
        __pyx_v_offset = (__pyx_v_num_ring_atoms - 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2535")'> 2535:                     for axis in range(3):</pre>
<pre id='line2535' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2535
 *                 if  ring_atom_index >= num_ring_atoms - limit:
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 */
        for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
          __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2536")'> 2536:                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset</pre>
<pre id='line2536' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2536
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 */
          __pyx_v_index_1 = ((((__pyx_v_ring_atom_index + 1) - __pyx_v_offset) % 3) + __pyx_v_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2537")'> 2537:                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset</pre>
<pre id='line2537' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2537
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 */
          __pyx_v_index_2 = ((((__pyx_v_ring_atom_index + 2) - __pyx_v_offset) % 3) + __pyx_v_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2538")'> 2538:                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]</pre>
<pre id='line2538' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2538
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                         g[axis] = pos_1 - pos_2
 */
          __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2539")'> 2539:                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]</pre>
<pre id='line2539' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2539
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         g[axis] = pos_1 - pos_2
 *                 else:
 */
          __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_2]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2540")'> 2540:                         g[axis] = pos_1 - pos_2</pre>
<pre id='line2540' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2540
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                         g[axis] = pos_1 - pos_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 * 
 */
          (__pyx_v_g[__pyx_v_axis]) = (__pyx_v_pos_1 - __pyx_v_pos_2);
        }
        goto __pyx_L8;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2541")'> 2541:                 else:</pre>
<pre id='line2541' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2542")'> 2542: </pre>
<pre id='line2542' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2543")'> 2543:                     for axis in range(3):</pre>
<pre id='line2543' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2543
 *                 else:
 * 
 *                     for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 */
        for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
          __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2544")'> 2544:                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]</pre>
<pre id='line2544' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2544
 * 
 *                     for axis in range(3):
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 */
          __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[0]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2545")'> 2545:                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]</pre>
<pre id='line2545' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2545
 *                     for axis in range(3):
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]
 */
          __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2546")'> 2546:                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]</pre>
<pre id='line2546' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2546
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4
 */
          __pyx_v_pos_3 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[3]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2547")'> 2547:                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]</pre>
<pre id='line2547' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2547
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4
 * 
 */
          __pyx_v_pos_4 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[4]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2548")'> 2548:                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4</pre>
<pre id='line2548' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2548
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # 0 1 2 2 1   (0+1) %3 (0+2) %3
 */
          (__pyx_v_g[__pyx_v_axis]) = (((__pyx_v_pos_1 - __pyx_v_pos_2) + __pyx_v_pos_3) - __pyx_v_pos_4);
        }
      }
      __pyx_L8:;
    }
    __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2549")'> 2549: </pre>
<pre id='line2549' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2550")'> 2550:             # 0 1 2 2 1   (0+1) %3 (0+2) %3</pre>
<pre id='line2550' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2551")'> 2551:             # 1 2 0 0 2</pre>
<pre id='line2551' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2552")'> 2552:             # 2 0 1 10</pre>
<pre id='line2552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2553")'> 2553:             #atom 2 (5-membered rings)</pre>
<pre id='line2553' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2554")'> 2554:             for axis in range(3):</pre>
<pre id='line2554' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2554
 *             # 2 0 1 10
 *             #atom 2 (5-membered rings)
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 indices_1[axis] = (axis + 1) % 3
 *                 indices_2[axis] = (axis + 2) % 3
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2555")'> 2555:                 indices_1[axis] = (axis + 1) % 3</pre>
<pre id='line2555' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2555
 *             #atom 2 (5-membered rings)
 *             for axis in range(3):
 *                 indices_1[axis] = (axis + 1) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 indices_2[axis] = (axis + 2) % 3
 * 
 */
      (__pyx_v_indices_1[__pyx_v_axis]) = ((__pyx_v_axis + 1) % 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2556")'> 2556:                 indices_2[axis] = (axis + 2) % 3</pre>
<pre id='line2556' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2556
 *             for axis in range(3):
 *                 indices_1[axis] = (axis + 1) % 3
 *                 indices_2[axis] = (axis + 2) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for axis in range(3):
 */
      (__pyx_v_indices_2[__pyx_v_axis]) = ((__pyx_v_axis + 2) % 3);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2557")'> 2557: </pre>
<pre id='line2557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2558")'> 2558:             for axis in range(3):</pre>
<pre id='line2558' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2558
 *                 indices_2[axis] = (axis + 2) % 3
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2559")'> 2559:                 index_1 = indices_1[axis]</pre>
<pre id='line2559' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2559
 * 
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_2 = indices_2[axis]
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 */
      __pyx_v_index_1 = (__pyx_v_indices_1[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2560")'> 2560:                 index_2 = indices_2[axis]</pre>
<pre id='line2560' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2560
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 * 
 */
      __pyx_v_index_2 = (__pyx_v_indices_2[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2561")'> 2561:                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]</pre>
<pre id='line2561' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2561
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for axis in range(3):
 */
      (__pyx_v_ab[__pyx_v_axis]) = (((__pyx_v_force_terms.d[__pyx_v_index_1]) * (__pyx_v_g[__pyx_v_index_2])) - ((__pyx_v_force_terms.d[__pyx_v_index_2]) * (__pyx_v_g[__pyx_v_index_1])));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2562")'> 2562: </pre>
<pre id='line2562' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2563")'> 2563:             for axis in range(3):</pre>
<pre id='line2563' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2563
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2564")'> 2564:                 index_1 = indices_1[axis]</pre>
<pre id='line2564' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2564
 * 
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_2 = indices_2[axis]
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 */
      __pyx_v_index_1 = (__pyx_v_indices_1[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2565")'> 2565:                 index_2 = indices_2[axis]</pre>
<pre id='line2565' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2565
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 * 
 */
      __pyx_v_index_2 = (__pyx_v_indices_2[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2566")'> 2566:                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]</pre>
<pre id='line2566' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2566
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 */
      (__pyx_v_c[__pyx_v_axis]) = (((__pyx_v_nSum[__pyx_v_index_1]) * (__pyx_v_g[__pyx_v_index_2])) - ((__pyx_v_nSum[__pyx_v_index_2]) * (__pyx_v_g[__pyx_v_index_1])));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2567")'> 2567: </pre>
<pre id='line2567' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2568")'> 2568:             factor = -6.0 * force_terms.dn / force_terms.dL3nL3</pre>
<pre id='line2568' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2568
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 */
    __pyx_v_factor = ((-6.0 * __pyx_v_force_terms.dn) / __pyx_v_force_terms.dL3nL3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2569")'> 2569:             factor2 = 0.25 * force_terms.dL / force_terms.nL</pre>
<pre id='line2569' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2569
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 */
    __pyx_v_factor2 = ((0.25 * __pyx_v_force_terms.dL) / __pyx_v_force_terms.nL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2570")'> 2570:             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)</pre>
<pre id='line2570' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2570
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 * 
 */
    __pyx_v_one_over_num_ring_atoms = (1.0 / ((double)__pyx_v_num_ring_atoms));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2571")'> 2571:             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms</pre>
<pre id='line2571' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2571
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             gradU = Vec3()
 */
    __pyx_v_factor3 = ((__pyx_v_force_terms.nL / __pyx_v_force_terms.dL) * __pyx_v_one_over_num_ring_atoms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2572")'> 2572: </pre>
<pre id='line2572' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2573")'> 2573:             gradU = Vec3()</pre>
<pre id='line2573' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2573
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 * 
 *             gradU = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for axis in range(3):
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 */
    __pyx_v_gradU = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2574")'> 2574:             for axis in range(3):</pre>
<pre id='line2574' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2574
 * 
 *             gradU = Vec3()
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 * 
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2575")'> 2575:                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))</pre>
<pre id='line2575' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2575
 *             gradU = Vec3()
 *             for axis in range(3):
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             gradV = Vec3()
 */
      (__pyx_v_gradU[__pyx_v_axis]) = (__pyx_v_factor * ((((0.5 * (__pyx_v_ab[__pyx_v_axis])) - ((__pyx_v_force_terms.ring_normal[__pyx_v_axis]) * __pyx_v_one_over_num_ring_atoms)) * __pyx_v_force_terms.dLnL) - (__pyx_v_force_terms.dn * ((__pyx_v_factor2 * (__pyx_v_c[__pyx_v_axis])) - (__pyx_v_factor3 * (__pyx_v_force_terms.d[__pyx_v_axis]))))));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2576")'> 2576: </pre>
<pre id='line2576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2577")'> 2577:             gradV = Vec3()</pre>
<pre id='line2577' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2577
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 * 
 *             gradV = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):
 */
    __pyx_v_gradV = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2578")'> 2578:             factor = -3 * force_terms.dL * one_over_num_ring_atoms</pre>
<pre id='line2578' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2578
 * 
 *             gradV = Vec3()
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for axis in range(3):
 *                 gradV[axis] = factor * force_terms.d[axis]
 */
    __pyx_v_factor = ((-3.0 * __pyx_v_force_terms.dL) * __pyx_v_one_over_num_ring_atoms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2579")'> 2579:             for axis in range(3):</pre>
<pre id='line2579' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2579
 *             gradV = Vec3()
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 gradV[axis] = factor * force_terms.d[axis]
 * 
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2580")'> 2580:                 gradV[axis] = factor * force_terms.d[axis]</pre>
<pre id='line2580' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2580
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):
 *                 gradV[axis] = factor * force_terms.d[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #TODO: rename force terms  sub_terms or vice versa
 */
      (__pyx_v_gradV[__pyx_v_axis]) = (__pyx_v_factor * (__pyx_v_force_terms.d[__pyx_v_axis]));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2581")'> 2581: </pre>
<pre id='line2581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2582")'> 2582: #TODO: rename force terms  sub_terms or vice versa</pre>
<pre id='line2582' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2583")'> 2583: </pre>
<pre id='line2583' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2584")'> 2584: #            ring_target_force_triplet = self._get_or_make_target_force_triplet(forces, ring_atom_id)</pre>
<pre id='line2584' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2585")'> 2585: </pre>
<pre id='line2585' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2586")'> 2586:             for axis in range(3):</pre>
<pre id='line2586' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2586
 * #            ring_target_force_triplet = self._get_or_make_target_force_triplet(forces, ring_atom_id)
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2587")'> 2587:                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])</pre>
<pre id='line2587' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2587
 * 
 *             for axis in range(3):
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force
 */
      __pyx_v_sub_term = (((__pyx_v_gradU[__pyx_v_axis]) * __pyx_v_force_terms.dL3) - (__pyx_v_force_terms.u * (__pyx_v_gradV[__pyx_v_axis])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2588")'> 2588:                 sub_force = -force_factor * sub_term / force_terms.dL6</pre>
<pre id='line2588' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2588
 *             for axis in range(3):
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[axis] = sub_force
 *             forces.add(ring_atom_id,result)
 */
      __pyx_v_sub_force = (((-__pyx_v_force_factor) * __pyx_v_sub_term) / __pyx_v_force_terms.dL6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2589")'> 2589:                 result[axis] = sub_force</pre>
<pre id='line2589' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2589
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             forces.add(ring_atom_id,result)
 * 
 */
      (__pyx_v_result[__pyx_v_axis]) = __pyx_v_sub_force;
    }
</pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line2590")'> 2590:             forces.add(ring_atom_id,result)</pre>
<pre id='line2590' class='code' style='background-color: #FFFF27'>
    /* "Cython_shift_calculator.pyx":2590
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force
 *             forces.add(ring_atom_id,result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_ring_atom_id, __pyx_v_result);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_simulation = 0;
  CYTHON_UNUSED int __pyx_v_smoothed;
  CYTHON_UNUSED PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2620; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2620; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2620; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_simulation = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2620; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2620; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2591")'> 2591: </pre>
<pre id='line2591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2592")'> 2592: </pre>
<pre id='line2592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2593")'> 2593: cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):</pre>
<pre id='line2593' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2593
 * 
 * 
 * cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator {
  struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator __pyx_base;
  float _nb_cutoff;
  struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *_non_bonded_list;
  PyObject *_raw_target_data;
  struct __pyx_t_17shift_calculators_Non_bonded_target_component *_compiled_target_components;
  int _num_target_components;
  PyObject *_raw_remote_data;
  struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component *_compiled_remote_components;
  int _num_remote_components;
  PyObject *_raw_coefficient_data;
  struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component *_compiled_coefficient_components;
  int _num_coefficient_components;
  int _component_offset;
};



/* "Cython_shift_calculator.pyx":2593
 * 
 * 
 * cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator __pyx_base;
  PyObject *(*_bytes_to_target_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *, PyObject *);
  PyObject *(*_bytes_to_remote_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *, PyObject *);
  PyObject *(*_bytes_to_nonbonded_coefficient_components)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *, PyObject *);
  void (*_calc_single_component_shift)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *, int, int, CDSVector<code><</code>double> *, __Pyx_memviewslice);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_shift_calculator;
static CYTHON_INLINE void __pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator__calc_single_component_shift(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *, int, int, CDSVector<code><</code>double> *, __Pyx_memviewslice);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2594")'> 2594: </pre>
<pre id='line2594' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2595")'> 2595:     cdef float _nb_cutoff</pre>
<pre id='line2595' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2596")'> 2596: </pre>
<pre id='line2596' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2597")'> 2597:     cdef Non_bonded_interaction_list _non_bonded_list</pre>
<pre id='line2597' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2598")'> 2598: </pre>
<pre id='line2598' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2599")'> 2599: </pre>
<pre id='line2599' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2600")'> 2600:     #TODO: can we use memory views here...</pre>
<pre id='line2600' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2601")'> 2601:     cdef object _raw_target_data</pre>
<pre id='line2601' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2602")'> 2602:     cdef Non_bonded_target_component* _compiled_target_components</pre>
<pre id='line2602' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2603")'> 2603:     cdef int _num_target_components</pre>
<pre id='line2603' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2604")'> 2604: </pre>
<pre id='line2604' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2605")'> 2605: </pre>
<pre id='line2605' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2606")'> 2606:     #TODO: can we use memory views here...</pre>
<pre id='line2606' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2607")'> 2607:     cdef object _raw_remote_data</pre>
<pre id='line2607' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2608")'> 2608:     cdef Non_bonded_remote_atom_component* _compiled_remote_components</pre>
<pre id='line2608' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2609")'> 2609:     cdef int _num_remote_components</pre>
<pre id='line2609' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2610")'> 2610: </pre>
<pre id='line2610' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2611")'> 2611:     cdef object _raw_coefficient_data</pre>
<pre id='line2611' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2612")'> 2612:     cdef Nonbonded_coefficient_component* _compiled_coefficient_components</pre>
<pre id='line2612' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2613")'> 2613:     cdef int _num_coefficient_components</pre>
<pre id='line2613' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2614")'> 2614: </pre>
<pre id='line2614' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2615")'> 2615:     cdef int _component_offset</pre>
<pre id='line2615' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2616")'> 2616: </pre>
<pre id='line2616' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2617")'> 2617: </pre>
<pre id='line2617' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2618")'> 2618: </pre>
<pre id='line2618' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2619")'> 2619: </pre>
<pre id='line2619' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2620")'> 2620:     def __cinit__(self, simulation, bint smoothed, str name):</pre>
<pre id='line2620' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2620
 * 
 * 
 *     def __cinit__(self, simulation, bint smoothed, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._non_bonded_list = None
 *         self._compiled_target_components =  NULL
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_simulation, CYTHON_UNUSED int __pyx_v_smoothed, CYTHON_UNUSED PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2621")'> 2621:         self._non_bonded_list = None</pre>
<pre id='line2621' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2621
 * 
 *     def __cinit__(self, simulation, bint smoothed, str name):
 *         self._non_bonded_list = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_target_components =  NULL
 *         self._compiled_remote_components = NULL
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_non_bonded_list);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_non_bonded_list));
  __pyx_v_self->_non_bonded_list = ((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)Py_None);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2622")'> 2622:         self._compiled_target_components =  NULL</pre>
<pre id='line2622' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2622
 *     def __cinit__(self, simulation, bint smoothed, str name):
 *         self._non_bonded_list = None
 *         self._compiled_target_components =  NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_remote_components = NULL
 *         self._compiled_coefficient_components = NULL
 */
  __pyx_v_self->_compiled_target_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2623")'> 2623:         self._compiled_remote_components = NULL</pre>
<pre id='line2623' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2623
 *         self._non_bonded_list = None
 *         self._compiled_target_components =  NULL
 *         self._compiled_remote_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coefficient_components = NULL
 *         self. _component_offset = 0
 */
  __pyx_v_self->_compiled_remote_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2624")'> 2624:         self._compiled_coefficient_components = NULL</pre>
<pre id='line2624' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2624
 *         self._compiled_target_components =  NULL
 *         self._compiled_remote_components = NULL
 *         self._compiled_coefficient_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self. _component_offset = 0
 * 
 */
  __pyx_v_self->_compiled_coefficient_components = NULL;
</pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line2625")'> 2625:         self. _component_offset = 0</pre>
<pre id='line2625' class='code' style='background-color: #FFFF27'>
  /* "Cython_shift_calculator.pyx":2625
 *         self._compiled_remote_components = NULL
 *         self._compiled_coefficient_components = NULL
 *         self. _component_offset = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, simulation, bint smoothed, str name):
 */
  __pyx_v_self->_component_offset = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_simulation = 0;
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__simulation,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__simulation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_simulation = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), __pyx_v_simulation, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2626")'> 2626: </pre>
<pre id='line2626' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2627")'> 2627:     def __init__(self, simulation, bint smoothed, str name):</pre>
<pre id='line2627' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2627
 *         self. _component_offset = 0
 * 
 *     def __init__(self, simulation, bint smoothed, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_non_bonded_shift_calculator, self).__init__(simulation, smoothed,name)
 *         self._simulation = simulationAsNative(simulation)
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_simulation, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line2628")'> 2628:         super(Fast_non_bonded_shift_calculator, self).__init__(simulation, smoothed,name)</pre>
<pre id='line2628' class='code' style='background-color: #FFFF2f'>
  /* "Cython_shift_calculator.pyx":2628
 * 
 *     def __init__(self, simulation, bint smoothed, str name):
 *         super(Fast_non_bonded_shift_calculator, self).__init__(simulation, smoothed,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = simulationAsNative(simulation)
 *         global DEFAULT_NB_CUTOFF
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_simulation);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_simulation);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_simulation);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2629")'> 2629:         self._simulation = simulationAsNative(simulation)</pre>
<pre id='line2629' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2629
 *     def __init__(self, simulation, bint smoothed, str name):
 *         super(Fast_non_bonded_shift_calculator, self).__init__(simulation, smoothed,name)
 *         self._simulation = simulationAsNative(simulation)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 */
  __pyx_t_4 = __pyx_f_17shift_calculators_simulationAsNative(__pyx_v_simulation);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2629; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->__pyx_base.__pyx_base._simulation = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2630")'> 2630:         global DEFAULT_NB_CUTOFF</pre>
<pre id='line2630' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line2631")'> 2631:         self._nb_cutoff = DEFAULT_NB_CUTOFF</pre>
<pre id='line2631' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":2631
 *         self._simulation = simulationAsNative(simulation)
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_nb_cutoff = __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2632")'> 2632: </pre>
<pre id='line2632' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2633")'> 2633:     def set_verbose(self,on):</pre>
<pre id='line2633' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2633
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line2634")'> 2634:         self._verbose = on</pre>
<pre id='line2634' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":2634
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: use global version
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->__pyx_base.__pyx_base._verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2635")'> 2635: </pre>
<pre id='line2635' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2636")'> 2636:     #TODO: use global version</pre>
<pre id='line2636' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2637")'> 2637:     cdef _bytes_to_target_components(self,data):</pre>
<pre id='line2637' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2637
 * 
 *     #TODO: use global version
 *     cdef _bytes_to_target_components(self,data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_target_data =  data
 * 
 */

static PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator__bytes_to_target_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_target_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2638")'> 2638:         self._raw_target_data =  data</pre>
<pre id='line2638' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2638
 *     #TODO: use global version
 *     cdef _bytes_to_target_components(self,data):
 *         self._raw_target_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_target_components =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_target_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_target_data);
  __pyx_v_self->_raw_target_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2639")'> 2639: </pre>
<pre id='line2639' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line2640")'> 2640:         self._compiled_target_components =  &lt;Non_bonded_target_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line2640' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":2640
 *         self._raw_target_data =  data
 * 
 *         self._compiled_target_components =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_target_components =  len(data)/ sizeof(Non_bonded_target_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_target_components = ((struct __pyx_t_17shift_calculators_Non_bonded_target_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line2641")'> 2641:         self._num_target_components =  len(data)/ sizeof(Non_bonded_target_component)</pre>
<pre id='line2641' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":2641
 * 
 *         self._compiled_target_components =  <code><</code>Non_bonded_target_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_target_components =  len(data)/ sizeof(Non_bonded_target_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: use global version
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_target_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Non_bonded_target_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator._bytes_to_target_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2642")'> 2642: </pre>
<pre id='line2642' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2643")'> 2643:     #TODO: use global version</pre>
<pre id='line2643' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2644")'> 2644:     cdef _bytes_to_remote_components(self,data):</pre>
<pre id='line2644' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2644
 * 
 *     #TODO: use global version
 *     cdef _bytes_to_remote_components(self,data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_remote_data =  data
 * 
 */

static PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator__bytes_to_remote_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_remote_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2645")'> 2645:         self._raw_remote_data =  data</pre>
<pre id='line2645' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2645
 *     #TODO: use global version
 *     cdef _bytes_to_remote_components(self,data):
 *         self._raw_remote_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_remote_components =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_remote_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_remote_data);
  __pyx_v_self->_raw_remote_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2646")'> 2646: </pre>
<pre id='line2646' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line2647")'> 2647:         self._compiled_remote_components =  &lt;Non_bonded_remote_atom_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line2647' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":2647
 *         self._raw_remote_data =  data
 * 
 *         self._compiled_remote_components =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_remote_components = ((struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line2648")'> 2648:         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)</pre>
<pre id='line2648' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":2648
 * 
 *         self._compiled_remote_components =  <code><</code>Non_bonded_remote_atom_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _bytes_to_nonbonded_coefficient_components(self,data):
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_remote_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Non_bonded_remote_atom_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator._bytes_to_remote_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2649")'> 2649: </pre>
<pre id='line2649' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2650")'> 2650:     cdef _bytes_to_nonbonded_coefficient_components(self,data):</pre>
<pre id='line2650' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2650
 *         self._num_remote_components =  len(data)/ sizeof(Non_bonded_remote_atom_component)
 * 
 *     cdef _bytes_to_nonbonded_coefficient_components(self,data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._raw_coefficient_data =  data
 * 
 */

static PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator__bytes_to_nonbonded_coefficient_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_bytes_to_nonbonded_coefficient_components", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2651")'> 2651:         self._raw_coefficient_data =  data</pre>
<pre id='line2651' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2651
 * 
 *     cdef _bytes_to_nonbonded_coefficient_components(self,data):
 *         self._raw_coefficient_data =  data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_coefficient_components =  <code><</code>Nonbonded_coefficient_component*> <code><</code>size_t> ctypes.addressof(data)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_raw_coefficient_data);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_raw_coefficient_data);
  __pyx_v_self->_raw_coefficient_data = __pyx_v_data;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2652")'> 2652: </pre>
<pre id='line2652' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line2653")'> 2653:         self._compiled_coefficient_components =  &lt;Nonbonded_coefficient_component*&gt; &lt;size_t&gt; ctypes.addressof(data)</pre>
<pre id='line2653' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":2653
 *         self._raw_coefficient_data =  data
 * 
 *         self._compiled_coefficient_components =  <code><</code>Nonbonded_coefficient_component*> <code><</code>size_t> ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_coefficient_components =  len(data)/ sizeof(Nonbonded_coefficient_component)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_compiled_coefficient_components = ((struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component *)((size_t)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line2654")'> 2654:         self._num_coefficient_components =  len(data)/ sizeof(Nonbonded_coefficient_component)</pre>
<pre id='line2654' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":2654
 * 
 *         self._compiled_coefficient_components =  <code><</code>Nonbonded_coefficient_component*> <code><</code>size_t> ctypes.addressof(data)
 *         self._num_coefficient_components =  len(data)/ sizeof(Nonbonded_coefficient_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_components(self, components):
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_coefficient_components = (__pyx_t_5 / (sizeof(struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component)));

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator._bytes_to_nonbonded_coefficient_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_6_set_components(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2655")'> 2655: </pre>
<pre id='line2655' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2656")'> 2656:     def _set_components(self, components):</pre>
<pre id='line2656' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2656
 *         self._num_coefficient_components =  len(data)/ sizeof(Nonbonded_coefficient_component)
 * 
 *     def _set_components(self, components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = <code><</code>EnsembleSimulation*><code><</code>size_t>int(components['SIMU'].this)
 *         self._non_bonded_list =  components['NBLT']
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_6_set_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line2657")'> 2657:         self._simulation = &lt;EnsembleSimulation*&gt;&lt;size_t&gt;int(components['SIMU'].this)</pre>
<pre id='line2657' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":2657
 * 
 *     def _set_components(self, components):
 *         self._simulation = <code><</code>EnsembleSimulation*><code><</code>size_t>int(components['SIMU'].this)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._non_bonded_list =  components['NBLT']
 *         self._bytes_to_target_components(components['ATOM'])
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__SIMU));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__this);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_self->__pyx_base.__pyx_base._simulation = ((EnsembleSimulation *)((size_t)__pyx_t_3));
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line2658")'> 2658:         self._non_bonded_list =  components['NBLT']</pre>
<pre id='line2658' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":2658
 *     def _set_components(self, components):
 *         self._simulation = <code><</code>EnsembleSimulation*><code><</code>size_t>int(components['SIMU'].this)
 *         self._non_bonded_list =  components['NBLT']             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_target_components(components['ATOM'])
 *         self._bytes_to_remote_components(components['NBRM'])
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__NBLT));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_17shift_calculators_Non_bonded_interaction_list)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_non_bonded_list);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_non_bonded_list));
  __pyx_v_self->_non_bonded_list = ((struct __pyx_obj_17shift_calculators_Non_bonded_interaction_list *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line2659")'> 2659:         self._bytes_to_target_components(components['ATOM'])</pre>
<pre id='line2659' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":2659
 *         self._simulation = <code><</code>EnsembleSimulation*><code><</code>size_t>int(components['SIMU'].this)
 *         self._non_bonded_list =  components['NBLT']
 *         self._bytes_to_target_components(components['ATOM'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_remote_components(components['NBRM'])
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__ATOM));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_bytes_to_target_components(__pyx_v_self, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line2660")'> 2660:         self._bytes_to_remote_components(components['NBRM'])</pre>
<pre id='line2660' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":2660
 *         self._non_bonded_list =  components['NBLT']
 *         self._bytes_to_target_components(components['ATOM'])
 *         self._bytes_to_remote_components(components['NBRM'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])
 *         self._component_offset = components['OFFS']
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__NBRM));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2660; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_bytes_to_remote_components(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2660; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line2661")'> 2661:         self._bytes_to_nonbonded_coefficient_components(components['COEF'])</pre>
<pre id='line2661' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":2661
 *         self._bytes_to_target_components(components['ATOM'])
 *         self._bytes_to_remote_components(components['NBRM'])
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._component_offset = components['OFFS']
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__COEF));<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->_bytes_to_nonbonded_coefficient_components(__pyx_v_self, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line2662")'> 2662:         self._component_offset = components['OFFS']</pre>
<pre id='line2662' class='code' style='background-color: #FFFF1c'>
  /* "Cython_shift_calculator.pyx":2662
 *         self._bytes_to_remote_components(components['NBRM'])
 *         self._bytes_to_nonbonded_coefficient_components(components['COEF'])
 *         self._component_offset = components['OFFS']             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, ((PyObject *)__pyx_n_s__OFFS));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self->_component_offset = __pyx_t_4;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_9__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_9__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache = 0;
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_active_components = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__shift_cache,&__pyx_n_s__component_to_target,&__pyx_n_s__active_components,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__shift_cache)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__active_components)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_components = values[0];
    __pyx_v_shift_cache = ((struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *)values[1]);
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_active_components = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[3]);<span class='error_goto'> if (unlikely(!__pyx_v_active_components.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_shift_cache), __pyx_ptype_17shift_calculators_CDSSharedVectorFloat, 1, "shift_cache", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_8__call__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2663")'> 2663: </pre>
<pre id='line2663' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2664")'> 2664: </pre>
<pre id='line2664' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2665")'> 2665: </pre>
<pre id='line2665' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2666")'> 2666:     @cython.profile(True)</pre>
<pre id='line2666' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2667")'> 2667:     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):</pre>
<pre id='line2667' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":2667
 * 
 *     @cython.profile(True)
 *     def __call__(self, object components, CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_8__call__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 2667);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2668")'> 2668: </pre>
<pre id='line2668' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2669")'> 2669:         cdef double start_time</pre>
<pre id='line2669' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2670")'> 2670:         cdef double end_time</pre>
<pre id='line2670' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2671")'> 2671: </pre>
<pre id='line2671' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2672")'> 2672:         if self._verbose:</pre>
<pre id='line2672' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2672
 *         cdef double end_time
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base.__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line2673")'> 2673:             start_time = time()</pre>
<pre id='line2673' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":2673
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2674")'> 2674: </pre>
<pre id='line2674' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line2675")'> 2675:         self._set_components(components)</pre>
<pre id='line2675' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":2675
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.calc(shift_cache, component_to_target, active_components)
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2676")'> 2676: </pre>
<pre id='line2676' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2677")'> 2677:         self.calc(shift_cache, component_to_target, active_components)</pre>
<pre id='line2677' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2677
 *         self._set_components(components)
 * 
 *         self.calc(shift_cache, component_to_target, active_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.calc(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_shift_cache, __pyx_v_component_to_target, __pyx_v_active_components);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2678")'> 2678: </pre>
<pre id='line2678' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2679")'> 2679:         if self._verbose:</pre>
<pre id='line2679' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2679
 *         self.calc(shift_cache, component_to_target, active_components)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(self._non_bonded_list), 'in', "%.17g" % (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base.__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line2680")'> 2680:             end_time = time()</pre>
<pre id='line2680' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":2680
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   distance shift components ' ,self._name,len(self._non_bonded_list), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line2681")'> 2681:             print '   distance shift components ' ,self._name,len(self._non_bonded_list), 'in', "%.17g" % (end_time-start_time), "seconds"</pre>
<pre id='line2681' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":2681
 *         if self._verbose:
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(self._non_bonded_list), 'in', "%.17g" % (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void calc(self,CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:
 */
    __pyx_t_1 = ((PyObject *)__pyx_v_self->_non_bonded_list);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_25), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_24));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_24));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_24));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_active_components, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2682")'> 2682: </pre>
<pre id='line2682' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2683")'> 2683:     cdef void calc(self,CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:</pre>
<pre id='line2683' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2683
 *             print '   distance shift components ' ,self._name,len(self._non_bonded_list), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 *     cdef void calc(self,CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef CDSVector[double]  *results = shift_cache.get_data()
 */

static void __pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator_calc(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, struct __pyx_obj_17shift_calculators_CDSSharedVectorFloat *__pyx_v_shift_cache, __Pyx_memviewslice __pyx_v_component_to_target, __Pyx_memviewslice __pyx_v_active_components) {
  CDSVector<code><</code>double> *__pyx_v_results;
  int __pyx_v_non_bonded_index;
  Py_ssize_t __pyx_v_factor_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2684")'> 2684: </pre>
<pre id='line2684' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2685")'> 2685:         cdef CDSVector[double]  *results = shift_cache.get_data()</pre>
<pre id='line2685' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2685
 *     cdef void calc(self,CDSSharedVectorFloat shift_cache, int[:] component_to_target, int[:] active_components) nogil:
 * 
 *         cdef CDSVector[double]  *results = shift_cache.get_data()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int non_bonded_index
 * 
 */
  __pyx_v_results = ((struct __pyx_vtabstruct_17shift_calculators_CDSSharedVectorFloat *)__pyx_v_shift_cache->__pyx_vtab)->get_data(__pyx_v_shift_cache);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2686")'> 2686:         cdef int non_bonded_index</pre>
<pre id='line2686' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2687")'> 2687: </pre>
<pre id='line2687' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2688")'> 2688:         if active_components == None:</pre>
<pre id='line2688' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2688
 *         cdef int non_bonded_index
 * 
 *         if active_components == None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for non_bonded_index in range(self._non_bonded_list.get_length()):
 * #                 print non_bonded_index
 */
  __pyx_t_1 = (((PyObject *) __pyx_v_active_components.memview) == Py_None);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2689")'> 2689:             for non_bonded_index in range(self._non_bonded_list.get_length()):</pre>
<pre id='line2689' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2689
 * 
 *         if active_components == None:
 *             for non_bonded_index in range(self._non_bonded_list.get_length()):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #                 print non_bonded_index
 *                 self._calc_single_component_shift(non_bonded_index, non_bonded_index, results, component_to_target)
 */
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Non_bonded_interaction_list *)__pyx_v_self->_non_bonded_list->__pyx_vtab)->get_length(__pyx_v_self->_non_bonded_list);
    for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
      __pyx_v_non_bonded_index = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2690")'> 2690: #                 print non_bonded_index</pre>
<pre id='line2690' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2691")'> 2691:                 self._calc_single_component_shift(non_bonded_index, non_bonded_index, results, component_to_target)</pre>
<pre id='line2691' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2691
 *             for non_bonded_index in range(self._non_bonded_list.get_length()):
 * #                 print non_bonded_index
 *                 self._calc_single_component_shift(non_bonded_index, non_bonded_index, results, component_to_target)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             for factor_index  in range(active_components.shape[0]):
 */
      __pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator__calc_single_component_shift(__pyx_v_self, __pyx_v_non_bonded_index, __pyx_v_non_bonded_index, __pyx_v_results, __pyx_v_component_to_target);
    }
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2692")'> 2692:         else:</pre>
<pre id='line2692' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2693")'> 2693:             for factor_index  in range(active_components.shape[0]):</pre>
<pre id='line2693' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2693
 *                 self._calc_single_component_shift(non_bonded_index, non_bonded_index, results, component_to_target)
 *         else:
 *             for factor_index  in range(active_components.shape[0]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 non_bonded_index = active_components[factor_index]
 * #                 print factor_index, non_bonded_index
 */
    __pyx_t_4 = (__pyx_v_active_components.shape[0]);
    for (__pyx_t_5 = 0; __pyx_t_5 <code><</code> __pyx_t_4; __pyx_t_5+=1) {
      __pyx_v_factor_index = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2694")'> 2694:                 non_bonded_index = active_components[factor_index]</pre>
<pre id='line2694' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2694
 *         else:
 *             for factor_index  in range(active_components.shape[0]):
 *                 non_bonded_index = active_components[factor_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #                 print factor_index, non_bonded_index
 *                 self._calc_single_component_shift(factor_index, non_bonded_index, results, component_to_target)
 */
      __pyx_t_6 = __pyx_v_factor_index;
      __pyx_v_non_bonded_index = (*((int *) ( /* dim=0 */ (__pyx_v_active_components.data + __pyx_t_6 * __pyx_v_active_components.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2695")'> 2695: #                 print factor_index, non_bonded_index</pre>
<pre id='line2695' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2696")'> 2696:                 self._calc_single_component_shift(factor_index, non_bonded_index, results, component_to_target)</pre>
<pre id='line2696' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2696
 *                 non_bonded_index = active_components[factor_index]
 * #                 print factor_index, non_bonded_index
 *                 self._calc_single_component_shift(factor_index, non_bonded_index, results, component_to_target)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator__calc_single_component_shift(__pyx_v_self, __pyx_v_factor_index, __pyx_v_non_bonded_index, __pyx_v_results, __pyx_v_component_to_target);
    }
  }
  __pyx_L3:;

}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2697")'> 2697: </pre>
<pre id='line2697' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2698")'> 2698: </pre>
<pre id='line2698' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2699")'> 2699:     cdef inline void  _calc_single_component_shift(self,int factor_index, int non_bonded_index, CDSVector[double]*  results, int[:] component_to_target) nogil:</pre>
<pre id='line2699' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2699
 * 
 * 
 *     cdef inline void  _calc_single_component_shift(self,int factor_index, int non_bonded_index, CDSVector[double]*  results, int[:] component_to_target) nogil:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Component_index_pair* non_bonded_pair
 * 
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_32Fast_non_bonded_shift_calculator__calc_single_component_shift(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, CYTHON_UNUSED int __pyx_v_factor_index, int __pyx_v_non_bonded_index, CDSVector<code><</code>double> *__pyx_v_results, __Pyx_memviewslice __pyx_v_component_to_target) {
  struct __pyx_t_17shift_calculators_Component_index_pair *__pyx_v_non_bonded_pair;
  int __pyx_v_target_component_index;
  int __pyx_v_remote_component_index;
  int __pyx_v_target_index;
  int __pyx_v_remote_index;
  float __pyx_v_distance;
  int __pyx_v_chem_type_id;
  float __pyx_v_default_smoothing_factor;
  float __pyx_v_smoothing_factor;
  float __pyx_v_ratio;
  int __pyx_v_atom_1_coefficent_offset;
  float __pyx_v_coefficient;
  float __pyx_v_exponent;
  int __pyx_v_component_offset;
  int __pyx_v_offset;
  long __pyx_v_i;
  struct __pyx_t_17shift_calculators_Nonbonded_coefficient_component *__pyx_v_coefficient_component;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2700")'> 2700:         cdef Component_index_pair* non_bonded_pair</pre>
<pre id='line2700' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2701")'> 2701: </pre>
<pre id='line2701' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2702")'> 2702:         cdef int target_component_index</pre>
<pre id='line2702' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2703")'> 2703:         cdef int remote_component_index</pre>
<pre id='line2703' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2704")'> 2704: </pre>
<pre id='line2704' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2705")'> 2705:         cdef int target_index</pre>
<pre id='line2705' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2706")'> 2706:         cdef int remote_index</pre>
<pre id='line2706' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2707")'> 2707: </pre>
<pre id='line2707' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2708")'> 2708:         cdef float distance</pre>
<pre id='line2708' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2709")'> 2709: </pre>
<pre id='line2709' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2710")'> 2710:         cdef int chem_type_id</pre>
<pre id='line2710' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2711")'> 2711: </pre>
<pre id='line2711' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2712")'> 2712:         cdef float default_smoothing_factor = self._smoothing_factor</pre>
<pre id='line2712' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2712
 *         cdef int chem_type_id
 * 
 *         cdef float default_smoothing_factor = self._smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float smoothing_factor
 * 
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base._smoothing_factor;
  __pyx_v_default_smoothing_factor = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2713")'> 2713:         cdef float smoothing_factor</pre>
<pre id='line2713' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2714")'> 2714: </pre>
<pre id='line2714' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2715")'> 2715:         cdef float ratio</pre>
<pre id='line2715' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2716")'> 2716: </pre>
<pre id='line2716' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2717")'> 2717:         cdef int atom_1_coefficent_offset</pre>
<pre id='line2717' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2718")'> 2718: </pre>
<pre id='line2718' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2719")'> 2719:         cdef float coefficient,exponent</pre>
<pre id='line2719' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2720")'> 2720: </pre>
<pre id='line2720' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2721")'> 2721:         cdef Nonbonded_coefficient_component* coefficent_component</pre>
<pre id='line2721' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2722")'> 2722:         cdef int component_offset</pre>
<pre id='line2722' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2723")'> 2723:         cdef int offset</pre>
<pre id='line2723' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2724")'> 2724: </pre>
<pre id='line2724' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2725")'> 2725: </pre>
<pre id='line2725' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2726")'> 2726:         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)</pre>
<pre id='line2726' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2726
 * 
 * 
 *         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_component_index = non_bonded_pair[0].target_index
 */
  __pyx_v_non_bonded_pair = __pyx_f_17shift_calculators_27Non_bonded_interaction_list_get(__pyx_v_self->_non_bonded_list, __pyx_v_non_bonded_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2727")'> 2727: </pre>
<pre id='line2727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2728")'> 2728:         target_component_index = non_bonded_pair[0].target_index</pre>
<pre id='line2728' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2728
 *         non_bonded_pair  =  self._non_bonded_list.get(non_bonded_index)
 * 
 *         target_component_index = non_bonded_pair[0].target_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         remote_component_index = non_bonded_pair[0].remote_index
 * 
 */
  __pyx_t_2 = (__pyx_v_non_bonded_pair[0]).target_index;
  __pyx_v_target_component_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2729")'> 2729:         remote_component_index = non_bonded_pair[0].remote_index</pre>
<pre id='line2729' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2729
 * 
 *         target_component_index = non_bonded_pair[0].target_index
 *         remote_component_index = non_bonded_pair[0].remote_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 */
  __pyx_t_2 = (__pyx_v_non_bonded_pair[0]).remote_index;
  __pyx_v_remote_component_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2730")'> 2730: </pre>
<pre id='line2730' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2731")'> 2731:         target_index  = self._compiled_target_components[target_component_index].target_atom_id</pre>
<pre id='line2731' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2731
 *         remote_component_index = non_bonded_pair[0].remote_index
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id
 * 
 */
  __pyx_t_2 = (__pyx_v_self->_compiled_target_components[__pyx_v_target_component_index]).target_atom_id;
  __pyx_v_target_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2732")'> 2732:         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id</pre>
<pre id='line2732' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2732
 * 
 *         target_index  = self._compiled_target_components[target_component_index].target_atom_id
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)
 */
  __pyx_t_2 = (__pyx_v_self->_compiled_remote_components[__pyx_v_remote_component_index]).remote_atom_id;
  __pyx_v_remote_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2733")'> 2733: </pre>
<pre id='line2733' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2734")'> 2734:         distance = calc_distance_simulation(self._simulation, target_index, remote_index)</pre>
<pre id='line2734' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2734
 *         remote_index = self._compiled_remote_components[remote_component_index].remote_atom_id
 * 
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         component_offset = self._component_offset + non_bonded_pair[0].component_index
 */
  __pyx_v_distance = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base.__pyx_base._simulation, __pyx_v_target_index, __pyx_v_remote_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2735")'> 2735: </pre>
<pre id='line2735' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2736")'> 2736:         component_offset = self._component_offset + non_bonded_pair[0].component_index</pre>
<pre id='line2736' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2736
 *         distance = calc_distance_simulation(self._simulation, target_index, remote_index)
 * 
 *         component_offset = self._component_offset + non_bonded_pair[0].component_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if distance <code><</code> self._nb_cutoff:
 */
  __pyx_v_component_offset = (__pyx_v_self->_component_offset + (__pyx_v_non_bonded_pair[0]).component_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2737")'> 2737: </pre>
<pre id='line2737' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2738")'> 2738:         if distance &lt; self._nb_cutoff:</pre>
<pre id='line2738' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2738
 *         component_offset = self._component_offset + non_bonded_pair[0].component_index
 * 
 *         if distance <code><</code> self._nb_cutoff:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id
 */
  __pyx_t_3 = (__pyx_v_distance <code><</code> __pyx_v_self->_nb_cutoff);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2739")'> 2739: </pre>
<pre id='line2739' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2740")'> 2740:             atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id</pre>
<pre id='line2740' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2740
 *         if distance <code><</code> self._nb_cutoff:
 * 
 *             atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for i in range(2):
 */
    __pyx_t_2 = (__pyx_v_self->_compiled_target_components[__pyx_v_target_component_index]).atom_type_id;
    __pyx_v_atom_1_coefficent_offset = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2741")'> 2741: </pre>
<pre id='line2741' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2742")'> 2742:             for i in range(2):</pre>
<pre id='line2742' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2742
 *             atom_1_coefficent_offset = self._compiled_target_components[target_component_index].atom_type_id
 * 
 *             for i in range(2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]
 * 
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 2; __pyx_t_4+=1) {
      __pyx_v_i = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2743")'> 2743:                 chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]</pre>
<pre id='line2743' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2743
 * 
 *             for i in range(2):
 *                 chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 coefficient_component = &self._compiled_coefficient_components[chem_type_id]
 */
      __pyx_v_chem_type_id = ((__pyx_v_self->_compiled_remote_components[__pyx_v_remote_component_index]).chem_type[__pyx_v_i]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2744")'> 2744: </pre>
<pre id='line2744' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2745")'> 2745:                 coefficient_component = &amp;self._compiled_coefficient_components[chem_type_id]</pre>
<pre id='line2745' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2745
 *                 chem_type_id = self._compiled_remote_components[remote_component_index].chem_type[i]
 * 
 *                 coefficient_component = &self._compiled_coefficient_components[chem_type_id]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 exponent = coefficient_component[0].exponent
 */
      __pyx_v_coefficient_component = (&(__pyx_v_self->_compiled_coefficient_components[__pyx_v_chem_type_id]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2746")'> 2746: </pre>
<pre id='line2746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2747")'> 2747:                 exponent = coefficient_component[0].exponent</pre>
<pre id='line2747' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2747
 *                 coefficient_component = &self._compiled_coefficient_components[chem_type_id]
 * 
 *                 exponent = coefficient_component[0].exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]
 */
      __pyx_t_1 = (__pyx_v_coefficient_component[0]).exponent;
      __pyx_v_exponent = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2748")'> 2748: </pre>
<pre id='line2748' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2749")'> 2749:                 coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]</pre>
<pre id='line2749' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2749
 *                 exponent = coefficient_component[0].exponent
 * 
 *                 coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 smoothing_factor = default_smoothing_factor
 */
      __pyx_v_coefficient = ((__pyx_v_coefficient_component[0]).coefficients[__pyx_v_atom_1_coefficent_offset]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2750")'> 2750: </pre>
<pre id='line2750' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2751")'> 2751:                 smoothing_factor = default_smoothing_factor</pre>
<pre id='line2751' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2751
 *                 coefficient  = coefficient_component[0].coefficients[atom_1_coefficent_offset]
 * 
 *                 smoothing_factor = default_smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff
 */
      __pyx_v_smoothing_factor = __pyx_v_default_smoothing_factor;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2752")'> 2752:                 if self._smoothed:</pre>
<pre id='line2752' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2752
 * 
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8
 */
      if (__pyx_v_self->__pyx_base._smoothed) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2753")'> 2753:                     ratio = distance / self._cutoff</pre>
<pre id='line2753' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2753
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     smoothing_factor = 1.0 - ratio ** 8
 * 
 */
        __pyx_v_ratio = (__pyx_v_distance / __pyx_v_self->__pyx_base._cutoff);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2754")'> 2754:                     smoothing_factor = 1.0 - ratio ** 8</pre>
<pre id='line2754' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2754
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 offset = self.ensemble_array_offset(component_to_target[component_offset])
 */
        __pyx_v_smoothing_factor = (1.0 - powf(__pyx_v_ratio, 8.0));
        goto __pyx_L6;
      }
      __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2755")'> 2755: </pre>
<pre id='line2755' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2756")'> 2756:                 offset = self.ensemble_array_offset(component_to_target[component_offset])</pre>
<pre id='line2756' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2756
 *                     smoothing_factor = 1.0 - ratio ** 8
 * 
 *                 offset = self.ensemble_array_offset(component_to_target[component_offset])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 results[0][offset]  +=  smoothing_factor * pow(distance,  exponent) * coefficient
 * 
 */
      __pyx_t_2 = __pyx_v_component_offset;
      __pyx_v_offset = __pyx_f_17shift_calculators_21Base_shift_calculator_ensemble_array_offset(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_2 * __pyx_v_component_to_target.strides[0]) ))));
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line2757")'> 2757:                 results[0][offset]  +=  smoothing_factor * pow(distance,  exponent) * coefficient</pre>
<pre id='line2757' class='code' style='background-color: #FFFFe7'>
      /* "Cython_shift_calculator.pyx":2757
 * 
 *                 offset = self.ensemble_array_offset(component_to_target[component_offset])
 *                 results[0][offset]  +=  smoothing_factor * pow(distance,  exponent) * coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_5 = 0;
      __pyx_t_6 = __pyx_v_offset;
      ((__pyx_v_results[__pyx_t_5])[__pyx_t_6]) = (((__pyx_v_results[__pyx_t_5])[__pyx_t_6]) + ((__pyx_v_smoothing_factor * pow(__pyx_v_distance, __pyx_v_exponent)) * __pyx_v_coefficient));
    }
    goto __pyx_L3;
  }
  __pyx_L3:;

}

/* Python wrapper */
static CYTHON_UNUSED int __pyx_pw_7cpython_5array_5array_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
static CYTHON_UNUSED int __pyx_pw_7cpython_5array_5array_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getbuffer__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7cpython_5array_5array___getbuffer__(((arrayobject *)__pyx_v_self), ((Py_buffer *)__pyx_v_info), ((int)__pyx_v_flags));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2758")'> 2758: </pre>
<pre id='line2758' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2759")'> 2759: </pre>
<pre id='line2759' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2760")'> 2760: </pre>
<pre id='line2760' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2761")'> 2761: </pre>
<pre id='line2761' class='code' style='background-color: #FFFFff'></pre></body></html>
