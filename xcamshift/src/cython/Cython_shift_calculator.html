<!-- Generated by Cython 0.18 on Mon Apr 15 10:01:58 2013 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.18 on Mon Apr 15 10:01:58 2013
<p>Raw output: <a href="Cython_shift_calculator.cpp">Cython_shift_calculator.cpp</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: #-------------------------------------------------------------------------------</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1
 * #-------------------------------------------------------------------------------             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * # Copyright (c) 2013 Gary Thompson & The University of Leeds.
 * # All rights reserved. This program and the accompanying materials
 */
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s____test__, ((PyObject *)__pyx_t_1)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # Copyright (c) 2013 Gary Thompson &amp; The University of Leeds.</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: # All rights reserved. This program and the accompanying materials</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: # are made available under the terms of the GNU Lesser Public License v3.0</pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: # which accompanies this distribution, and is available at</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: # http://www.gnu.org/licenses/lgpl-3.0.html</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: #</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # Contributors:</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: #     gary thompson - initial API and implementation</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: #-------------------------------------------------------------------------------</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: # cython: profile=False</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: # cython: boundscheck=False</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: # cython: wraparound=False</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: # cython: cdivision=True</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line15")'> 15: import numpy as np</pre>
<pre id='line15' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":15
 * # cython: wraparound=False
 * # cython: cdivision=True
 * import numpy as np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * '''
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__numpy), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__np, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: </pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: '''</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: Created on 31 Jul 2012</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: </pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: @author: garyt</pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: </pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: '''</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: </pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: cimport cython</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line25")'> 25: from vec3 import Vec3 as python_vec3</pre>
<pre id='line25' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":25
 * 
 * cimport cython
 * from vec3 import Vec3 as python_vec3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from common_constants import TARGET_ATOM_IDS_CHANGED, STRUCTURE_CHANGED
 * from  xplor_access cimport norm,Vec3,currentSimulation, Dihedral, Atom,  dot,  cross,  Simulation, CDSVector
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Vec3));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__Vec3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Vec3));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__vec3), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__Vec3);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Vec3);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__python_vec3, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line26")'> 26: from common_constants import TARGET_ATOM_IDS_CHANGED, STRUCTURE_CHANGED</pre>
<pre id='line26' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":26
 * cimport cython
 * from vec3 import Vec3 as python_vec3
 * from common_constants import TARGET_ATOM_IDS_CHANGED, STRUCTURE_CHANGED             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from  xplor_access cimport norm,Vec3,currentSimulation, Dihedral, Atom,  dot,  cross,  Simulation, CDSVector
 * from libc.math cimport cos,sin,  fabs, tanh, pow, cosh
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s_15));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s_15));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s_15));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__STRUCTURE_CHANGED));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__STRUCTURE_CHANGED));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__STRUCTURE_CHANGED));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__common_constants), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s_15);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s_15);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_15, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__STRUCTURE_CHANGED);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__STRUCTURE_CHANGED);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27: from  xplor_access cimport norm,Vec3,currentSimulation, Dihedral, Atom,  dot,  cross,  Simulation, CDSVector</pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: from libc.math cimport cos,sin,  fabs, tanh, pow, cosh</pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29: from libc.stdlib cimport malloc, free</pre>
<pre id='line29' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: from libc.string cimport strcmp</pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line31")'> 31: from time import time</pre>
<pre id='line31' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":31
 * from libc.stdlib cimport malloc, free
 * from libc.string cimport strcmp
 * from time import time             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from utils import Atom_utils
 * from cpython cimport array
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__time));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__time));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__time));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__time), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__time);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__time);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__time, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line32")'> 32: from utils import Atom_utils</pre>
<pre id='line32' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":32
 * from libc.string cimport strcmp
 * from time import time
 * from utils import Atom_utils             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from cpython cimport array
 * import ctypes
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Atom_utils));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__Atom_utils));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Atom_utils));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__utils), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__Atom_utils);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Atom_utils);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__Atom_utils, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33: from cpython cimport array</pre>
<pre id='line33' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line34")'> 34: import ctypes</pre>
<pre id='line34' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":34
 * from utils import Atom_utils
 * from cpython cimport array
 * import ctypes             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cpdef array.array allocate_array(int len, type='d'):
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__ctypes), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__ctypes, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35: </pre>
<pre id='line35' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line36")'> 36: cpdef array.array allocate_array(int len, type='d'):</pre>
<pre id='line36' class='code' style='background-color: #FFFF9f'>
/* "Cython_shift_calculator.pyx":36
 * import ctypes
 * 
 * cpdef array.array allocate_array(int len, type='d'):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 */

static PyObject *__pyx_pw_17shift_calculators_1allocate_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static arrayobject *__pyx_f_17shift_calculators_allocate_array(int __pyx_v_len, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_17shift_calculators_allocate_array *__pyx_optional_args) {
  PyObject *__pyx_v_type = ((PyObject *)__pyx_n_s__d);
  PyObject *__pyx_v_result = NULL;
  arrayobject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("allocate_array", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_type = __pyx_optional_args->type;
    }
  }

/* "Cython_shift_calculator.pyx":36
 * import ctypes
 * 
 * cpdef array.array allocate_array(int len, type='d'):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 */

static PyObject *__pyx_pf_17shift_calculators_allocate_array(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_len, PyObject *__pyx_v_type) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("allocate_array", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.type = __pyx_v_type;
  __pyx_t_1 = ((PyObject *)__pyx_f_17shift_calculators_allocate_array(__pyx_v_len, 0, &__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.allocate_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* "Cython_shift_calculator.pyx":36
 * import ctypes
 * 
 * cpdef array.array allocate_array(int len, type='d'):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 */
struct __pyx_opt_args_17shift_calculators_allocate_array {
  int __pyx_n;
  PyObject *type;
};
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line37")'> 37:     result = array.array(type,[0])</pre>
<pre id='line37' class='code' style='background-color: #FFFF52'>
  /* "Cython_shift_calculator.pyx":37
 * 
 * cpdef array.array allocate_array(int len, type='d'):
 *     result = array.array(type,[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     array.resize(result, len)
 *     array.zero(result)
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_int_0);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_0);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_type);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_type);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_type);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_t_1));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_1));
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_7cpython_5array_array)), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line38")'> 38:     array.resize(result, len)</pre>
<pre id='line38' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":38
 * cpdef array.array allocate_array(int len, type='d'):
 *     result = array.array(type,[0])
 *     array.resize(result, len)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     array.zero(result)
 *     return result
 */
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_result, __pyx_ptype_7cpython_5array_array))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  resize(((arrayobject *)__pyx_v_result), __pyx_v_len);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line39")'> 39:     array.zero(result)</pre>
<pre id='line39' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":39
 *     result = array.array(type,[0])
 *     array.resize(result, len)
 *     array.zero(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return result
 * 
 */
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_result, __pyx_ptype_7cpython_5array_array))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_f_7cpython_5array_zero(((arrayobject *)__pyx_v_result));
</pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line40")'> 40:     return result</pre>
<pre id='line40' class='code' style='background-color: #FFFF29'>
  /* "Cython_shift_calculator.pyx":40
 *     array.resize(result, len)
 *     array.zero(result)
 *     return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cpdef zero_array(array.array array):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_result, __pyx_ptype_7cpython_5array_array))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = ((arrayobject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = ((arrayobject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.allocate_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_1allocate_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_1allocate_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_len;
  PyObject *__pyx_v_type = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("allocate_array (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__len,&__pyx_n_s__type,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)__pyx_n_s__d);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__len)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__type);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "allocate_array") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_len = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_len == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_type = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("allocate_array", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.allocate_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_allocate_array(__pyx_self, __pyx_v_len, __pyx_v_type);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41: </pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line42")'> 42: cpdef zero_array(array.array array):</pre>
<pre id='line42' class='code' style='background-color: #FFFF86'>
/* "Cython_shift_calculator.pyx":42
 *     return result
 * 
 * cpdef zero_array(array.array array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      array.zero(array)
 * 
 */

static PyObject *__pyx_pw_17shift_calculators_3zero_array(PyObject *__pyx_self, PyObject *__pyx_v_array); /*proto*/
static PyObject *__pyx_f_17shift_calculators_zero_array(arrayobject *__pyx_v_array, CYTHON_UNUSED int __pyx_skip_dispatch) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("zero_array", 0);

/* "Cython_shift_calculator.pyx":42
 *     return result
 * 
 * cpdef zero_array(array.array array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      array.zero(array)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_2zero_array(CYTHON_UNUSED PyObject *__pyx_self, arrayobject *__pyx_v_array) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("zero_array", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_17shift_calculators_zero_array(__pyx_v_array, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.zero_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_5test_dump_dist_comp(PyObject *__pyx_self, PyObject *__pyx_v_data); /*proto*/
static PyMethodDef __pyx_mdef_17shift_calculators_5test_dump_dist_comp = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("test_dump_dist_comp"), (PyCFunction)__pyx_pw_17shift_calculators_5test_dump_dist_comp, METH_O, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_17shift_calculators_5test_dump_dist_comp(PyObject *__pyx_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_dist_comp (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_4test_dump_dist_comp(__pyx_self, ((PyObject *)__pyx_v_data));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line43")'> 43:      array.zero(array)</pre>
<pre id='line43' class='code' style='background-color: #FFFF3f'>
  /* "Cython_shift_calculator.pyx":43
 * 
 * cpdef zero_array(array.array array):
 *      array.zero(array)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef struct Distance_component:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_array), __pyx_n_s__zero);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_array));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_array));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_array));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.zero_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_3zero_array(PyObject *__pyx_self, PyObject *__pyx_v_array); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_3zero_array(PyObject *__pyx_self, PyObject *__pyx_v_array) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("zero_array (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_array), __pyx_ptype_7cpython_5array_array, 1, "array", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_2zero_array(__pyx_self, ((arrayobject *)__pyx_v_array));
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44: </pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45: cdef struct Distance_component:</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":45
 *      array.zero(array)
 * 
 * cdef struct Distance_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom
 *       int remote_atom_1
 */
struct __pyx_t_17shift_calculators_Distance_component {
  int target_atom;
  int remote_atom_1;
  int remote_atom_2;
  float coefficient;
  float exponent;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:       int target_atom</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:       int remote_atom_1</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48:       int remote_atom_2</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49:       float coefficient</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:       float exponent</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51: </pre>
<pre id='line51' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52: cdef struct Dihedral_component:</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":52
 *       float exponent
 * 
 * cdef struct Dihedral_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom
 *       int[4] dihedral_atoms
 */
struct __pyx_t_17shift_calculators_Dihedral_component {
  int target_atom;
  int dihedral_atoms[4];
  float coefficient;
  float parameters[5];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:       int target_atom</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54:       int[4] dihedral_atoms</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55:       float coefficient</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56:       float[5] parameters</pre>
<pre id='line56' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57: </pre>
<pre id='line57' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line58")'> 58: def test_dump_dist_comp(data):</pre>
<pre id='line58' class='code' style='background-color: #FFFF62'>
/* "Cython_shift_calculator.pyx":58
 *       float[5] parameters
 * 
 * def test_dump_dist_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 */

static PyObject *__pyx_pf_17shift_calculators_4test_dump_dist_comp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data) {
  size_t __pyx_v_test;
  struct __pyx_t_17shift_calculators_Distance_component *__pyx_v_test2;
  __Pyx_memviewslice __pyx_v_dummy_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("test_dump_dist_comp", 0);

  /* "Cython_shift_calculator.pyx":58
 *       float[5] parameters
 * 
 * def test_dump_dist_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 */
  __pyx_k_tuple_90 = <span class='py_c_api'>PyTuple_Pack</span>(6, ((PyObject *)__pyx_n_s__data), ((PyObject *)__pyx_n_s__test), ((PyObject *)__pyx_n_s__test2), ((PyObject *)__pyx_n_s__dummy_view), ((PyObject *)__pyx_n_s__result), ((PyObject *)__pyx_n_s__i));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_90)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_90);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_90));

  /* "Cython_shift_calculator.pyx":58
 *       float[5] parameters
 * 
 * def test_dump_dist_comp(data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_17shift_calculators_5test_dump_dist_comp, NULL, __pyx_n_s__shift_calculators);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__test_dump_dist_comp, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_k_codeobj_91 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(1, 0, 6, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_90, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_92, __pyx_n_s__test_dump_dist_comp, 58, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_91)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line59")'> 59:     cdef size_t  test  = ctypes.addressof(data)</pre>
<pre id='line59' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":59
 * 
 * def test_dump_dist_comp(data):
 *     cdef size_t  test  = ctypes.addressof(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 *     cdef Distance_component[:] dummy_view = <code><</code>Distance_component[:len(data)/ sizeof(Distance_component)]> &test2[0]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__ctypes);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__addressof);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_data);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_data);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsSize_t</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (size_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_test = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:     cdef Distance_component* test2 = &lt;Distance_component*&gt; test</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":60
 * def test_dump_dist_comp(data):
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Distance_component[:] dummy_view = <code><</code>Distance_component[:len(data)/ sizeof(Distance_component)]> &test2[0]
 * 
 */
  __pyx_v_test2 = ((struct __pyx_t_17shift_calculators_Distance_component *)__pyx_v_test);
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line61")'> 61:     cdef Distance_component[:] dummy_view = &lt;Distance_component[:len(data)/ sizeof(Distance_component)]&gt; &amp;test2[0]</pre>
<pre id='line61' class='code' style='background-color: #FFFF57'>
  /* "Cython_shift_calculator.pyx":61
 *     cdef size_t  test  = ctypes.addressof(data)
 *     cdef Distance_component* test2 = <code><</code>Distance_component*> test
 *     cdef Distance_component[:] dummy_view = <code><</code>Distance_component[:len(data)/ sizeof(Distance_component)]> &test2[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     result = []
 */
  __pyx_t_5 = (&(__pyx_v_test2[0]));
  __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!__pyx_t_5) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_1 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_nn_struct___pyx_t_17shift_calculators_Distance_component);
  __pyx_t_3 = Py_BuildValue("("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_t_6 / (sizeof(struct __pyx_t_17shift_calculators_Distance_component)))));
  if (unlikely(!__pyx_t_1 || !__pyx_t_3 || !<span class='py_c_api'>PyBytes_AsString</span>(__pyx_t_1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_7 = __pyx_array_new(__pyx_t_3, sizeof(struct __pyx_t_17shift_calculators_Distance_component), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_1), (char *) "c", (char *) __pyx_t_5);
  if (unlikely(!__pyx_t_7))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_struct___pyx_t_17shift_calculators_Distance_component(((PyObject *)__pyx_t_7));
  if (unlikely(!__pyx_t_8.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
  __pyx_v_dummy_view = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62: </pre>
<pre id='line62' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line63")'> 63:     result = []</pre>
<pre id='line63' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":63
 *     cdef Distance_component[:] dummy_view = <code><</code>Distance_component[:len(data)/ sizeof(Distance_component)]> &test2[0]
 * 
 *     result = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for i in range(len(data)/ sizeof(Distance_component)):
 *         result.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line64")'> 64:     for i in range(len(data)/ sizeof(Distance_component)):</pre>
<pre id='line64' class='code' style='background-color: #FFFF1e'>
  /* "Cython_shift_calculator.pyx":64
 * 
 *     result = []
 *     for i in range(len(data)/ sizeof(Distance_component)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))
 *     return tuple(result)
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_data);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_FromSize_t</span>((__pyx_t_6 / (sizeof(struct __pyx_t_17shift_calculators_Distance_component))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_9 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_6 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_6 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_9(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF19' onclick='toggleDiv("line65")'> 65:         result.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))</pre>
<pre id='line65' class='code' style='background-color: #FFFF19'>
    /* "Cython_shift_calculator.pyx":65
 *     result = []
 *     for i in range(len(data)/ sizeof(Distance_component)):
 *         result.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return tuple(result)
 * 
 */
    __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_11 = __pyx_t_10;
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_11 * __pyx_v_dummy_view.strides[0]) ))).target_atom);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_12 = __pyx_t_10;
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_12 * __pyx_v_dummy_view.strides[0]) ))).remote_atom_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = __pyx_t_10;
    __pyx_t_14 = <span class='py_c_api'>PyInt_FromLong</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_13 * __pyx_v_dummy_view.strides[0]) ))).remote_atom_2);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_14);
    __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_15 = __pyx_t_10;
    __pyx_t_16 = <span class='py_c_api'>PyFloat_FromDouble</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_15 * __pyx_v_dummy_view.strides[0]) ))).coefficient);<span class='error_goto'> if (unlikely(!__pyx_t_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_16);
    __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_17 = __pyx_t_10;
    __pyx_t_18 = <span class='py_c_api'>PyFloat_FromDouble</span>((*((struct __pyx_t_17shift_calculators_Distance_component *) ( /* dim=0 */ (__pyx_v_dummy_view.data + __pyx_t_17 * __pyx_v_dummy_view.strides[0]) ))).exponent);<span class='error_goto'> if (unlikely(!__pyx_t_18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_18);
    __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_19);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 2, __pyx_t_14);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_14);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 3, __pyx_t_16);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_16);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 4, __pyx_t_18);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_18);
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_14 = 0;
    __pyx_t_16 = 0;
    __pyx_t_18 = 0;
    __pyx_t_20 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_19));<span class='error_goto'> if (unlikely(__pyx_t_20 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_19)); __pyx_t_19 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line66")'> 66:     return tuple(result)</pre>
<pre id='line66' class='code' style='background-color: #FFFF3c'>
  /* "Cython_shift_calculator.pyx":66
 *     for i in range(len(data)/ sizeof(Distance_component)):
 *         result.append((dummy_view[i].target_atom,  dummy_view[i].remote_atom_1,  dummy_view[i].remote_atom_2,   dummy_view[i].coefficient, dummy_view[i].exponent))
 *     return tuple(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Vec3_list:
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_3 = ((PyObject *)<span class='py_c_api'>PyList_AsTuple</span>(__pyx_v_result));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  __pyx_r = ((PyObject *)__pyx_t_3);
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_7));
  __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.test_dump_dist_comp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_dummy_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_9Vec3_list_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_9Vec3_list_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_9Vec3_list___cinit__(((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67: </pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68: cdef class Vec3_list:</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":68
 *     return tuple(result)
 * 
 * cdef class Vec3_list:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[Vec3] *data
 * 
 */
struct __pyx_obj_17shift_calculators_Vec3_list {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Vec3_list *__pyx_vtab;
  CDSVector<code><</code>Vec3> *data;
};


/* "Cython_shift_calculator.pyx":68
 *     return tuple(result)
 * 
 * cdef class Vec3_list:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef CDSVector[Vec3] *data
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Vec3_list {
  PyObject *(*set_length)(struct __pyx_obj_17shift_calculators_Vec3_list *, int);
  Vec3 *(*get)(struct __pyx_obj_17shift_calculators_Vec3_list *, int);
  PyObject *(*set)(struct __pyx_obj_17shift_calculators_Vec3_list *, int, Vec3 &);
};
static struct __pyx_vtabstruct_17shift_calculators_Vec3_list *__pyx_vtabptr_17shift_calculators_Vec3_list;
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_9Vec3_list_get(struct __pyx_obj_17shift_calculators_Vec3_list *, int);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_9Vec3_list_set(struct __pyx_obj_17shift_calculators_Vec3_list *, int, Vec3 &);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69:     cdef CDSVector[Vec3] *data</pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70: </pre>
<pre id='line70' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71:     def __cinit__(self):</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":71
 *     cdef CDSVector[Vec3] *data
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *          self.data = new CDSVector[Vec3]()
 * 
 */

static int __pyx_pf_17shift_calculators_9Vec3_list___cinit__(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line72")'> 72:          self.data = new CDSVector[Vec3]()</pre>
<pre id='line72' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":72
 * 
 *     def __cinit__(self):
 *          self.data = new CDSVector[Vec3]()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  try {
    __pyx_t_1 = new CDSVector<code><</code>Vec3>();
  } catch(...) {
    __Pyx_CppExn2PyErr();
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_self->data = __pyx_t_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Vec3_list.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73: </pre>
<pre id='line73' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74: </pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75:     cdef set_length(self,int length):</pre>
<pre id='line75' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":75
 * 
 * 
 *     cdef set_length(self,int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data.resize(length)
 * 
 */

static PyObject *__pyx_f_17shift_calculators_9Vec3_list_set_length(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self, int __pyx_v_length) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_length", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line76")'> 76:         self.data.resize(length)</pre>
<pre id='line76' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":76
 * 
 *     cdef set_length(self,int length):
 *         self.data.resize(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_v_self->data->resize(__pyx_v_length);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77: </pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78:     @cython.profile(False)</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:     cdef inline Vec3*  get(self, int offset):</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":79
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3*  get(self, int offset):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return &self.data[0][offset]
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_9Vec3_list_get(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self, int __pyx_v_offset) {
  Vec3 *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get", 0);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line80")'> 80:         return &amp;self.data[0][offset]</pre>
<pre id='line80' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":80
 *     @cython.profile(False)
 *     cdef inline Vec3*  get(self, int offset):
 *         return &self.data[0][offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = (&((__pyx_v_self->data[0])[__pyx_v_offset]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81: </pre>
<pre id='line81' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:     @cython.profile(False)</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83:     cdef inline set(self, int x, Vec3&amp; y):</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":83
 * 
 *     @cython.profile(False)
 *     cdef inline set(self, int x, Vec3& y):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.data[0][x] =  y
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_9Vec3_list_set(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self, int __pyx_v_x, Vec3 &__pyx_v_y) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line84")'> 84:         self.data[0][x] =  y</pre>
<pre id='line84' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":84
 *     @cython.profile(False)
 *     cdef inline set(self, int x, Vec3& y):
 *         self.data[0][x] =  y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
  ((__pyx_v_self->data[0])[__pyx_v_x]) = __pyx_v_y;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_9Vec3_list_3__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_9Vec3_list_3__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_9Vec3_list_2__dealloc__(((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85: </pre>
<pre id='line85' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:     def __dealloc__(self):</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":86
 *         self.data[0][x] =  y
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self.data != NULL:
 */

static void __pyx_pf_17shift_calculators_9Vec3_list_2__dealloc__(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87: </pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88:         if self.data != NULL:</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":88
 *     def __dealloc__(self):
 * 
 *         if self.data != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             del self.data
 * 
 */
  __pyx_t_1 = (__pyx_v_self->data != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line89")'> 89:             del self.data</pre>
<pre id='line89' class='code' style='background-color: #FFFFd4'>
    /* "Cython_shift_calculator.pyx":89
 * 
 *         if self.data != NULL:
 *             del self.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    delete __pyx_v_self->data;
    goto __pyx_L3;
  }
  __pyx_L3:;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
static PyObject *__pyx_gb_17shift_calculators_9Vec3_list_6generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Vec3_list_5__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Vec3_list_5__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Vec3_list_4__iter__(((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: </pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91: </pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line92")'> 92:     def __iter__(self):</pre>
<pre id='line92' class='code' style='background-color: #FFFF79'>
/* "Cython_shift_calculator.pyx":92
 * 
 * 
 *     def __iter__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 vec3
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_9Vec3_list_4__iter__(struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self) {
  struct __pyx_obj_17shift_calculators___pyx_scope_struct____iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_17shift_calculators___pyx_scope_struct____iter__ *)__pyx_ptype_17shift_calculators___pyx_scope_struct____iter__->tp_new(__pyx_ptype_17shift_calculators___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
    return NULL;
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_cur_scope->__pyx_v_self);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = <span class='pyx_c_api'>__Pyx_Generator_New</span>((__pyx_generator_body_t) __pyx_gb_17shift_calculators_9Vec3_list_6generator, (PyObject *) __pyx_cur_scope);<span class='error_goto'> if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_cur_scope);
    <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Vec3_list.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_cur_scope));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

static PyObject *__pyx_gb_17shift_calculators_9Vec3_list_6generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("None", 0);
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

/* "Cython_shift_calculator.pyx":92
 * 
 * 
 *     def __iter__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 vec3
 * 
 */
struct __pyx_obj_17shift_calculators___pyx_scope_struct____iter__ {
  PyObject_HEAD
  int __pyx_v_i;
  struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_self;
  Vec3 __pyx_v_vec3;
  int __pyx_t_0;
  int __pyx_t_1;
};

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93:         cdef Vec3 vec3</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94: </pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95: </pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96: </pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97:         for i in range(self.data.size()):</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":97
 * 
 * 
 *         for i in range(self.data.size()):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             vec3 = self.get(i)[0]
 *             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))
 */
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->data->size();
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_cur_scope->__pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98:             vec3 = self.get(i)[0]</pre>
<pre id='line98' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":98
 * 
 *         for i in range(self.data.size()):
 *             vec3 = self.get(i)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))
 * 
 */
    __pyx_cur_scope->__pyx_v_vec3 = (__pyx_f_17shift_calculators_9Vec3_list_get(__pyx_cur_scope->__pyx_v_self, __pyx_cur_scope->__pyx_v_i)[0]);
</pre><pre class='line' style='background-color: #FFFF1a' onclick='toggleDiv("line99")'> 99:             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))</pre>
<pre id='line99' class='code' style='background-color: #FFFF1a'>
    /* "Cython_shift_calculator.pyx":99
 *         for i in range(self.data.size()):
 *             vec3 = self.get(i)[0]
 *             yield (i,python_vec3(vec3[0],vec3[1],vec3[2]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_cur_scope->__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__python_vec3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_cur_scope->__pyx_v_vec3[0]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_cur_scope->__pyx_v_vec3[1]));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_cur_scope->__pyx_v_vec3[2]));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_5);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_6);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2, __pyx_t_7);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_8), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_7);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
    __pyx_t_3 = 0;
    __pyx_t_7 = 0;
    __pyx_r = ((PyObject *)__pyx_t_8);
    __pyx_t_8 = 0;
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
    <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    if (unlikely(!__pyx_sent_value))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='py_c_api'>PyErr_SetNone</span>(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_generator->resume_label = -1;
  <span class='pyx_c_api'>__Pyx_Generator_clear</span>((PyObject*)__pyx_generator);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_9Out_array_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_9Out_array_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_length = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__length,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_length = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array___init__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_length);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100: </pre>
<pre id='line100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: </pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102: cdef class Out_array:</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":102
 * 
 * 
 * cdef class Out_array:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long _length
 *     cdef double[60000] _data
 */
struct __pyx_obj_17shift_calculators_Out_array {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Out_array *__pyx_vtab;
  long _length;
  double _data[60000];
  int _mask[60000];
};


/* "Cython_shift_calculator.pyx":102
 * 
 * 
 * cdef class Out_array:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long _length
 *     cdef double[60000] _data
 */

struct __pyx_vtabstruct_17shift_calculators_Out_array {
  PyObject *(*get_length)(struct __pyx_obj_17shift_calculators_Out_array *, int __pyx_skip_dispatch);
  PyObject *(*add_all)(struct __pyx_obj_17shift_calculators_Out_array *, struct __pyx_obj_17shift_calculators_Out_array *, int __pyx_skip_dispatch);
  int (*_check_clear_length)(struct __pyx_obj_17shift_calculators_Out_array *, long);
  int (*_check_offset)(struct __pyx_obj_17shift_calculators_Out_array *, long);
  int (*realloc)(struct __pyx_obj_17shift_calculators_Out_array *, long, int __pyx_skip_dispatch);
  int (*_check_state)(struct __pyx_obj_17shift_calculators_Out_array *);
  PyObject *(*_clear)(struct __pyx_obj_17shift_calculators_Out_array *, PyObject *);
  void (*add)(struct __pyx_obj_17shift_calculators_Out_array *, long, Vec3 &);
};
static struct __pyx_vtabstruct_17shift_calculators_Out_array *__pyx_vtabptr_17shift_calculators_Out_array;
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_clear_length(struct __pyx_obj_17shift_calculators_Out_array *, long);
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_offset(struct __pyx_obj_17shift_calculators_Out_array *, long);
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_state(struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_9Out_array_add(struct __pyx_obj_17shift_calculators_Out_array *, long, Vec3 &);


</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103:     cdef long _length</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104:     cdef double[60000] _data</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105:     cdef int[60000] _mask</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106: </pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:     def __init__ (self, length):</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":107
 *     cdef int[60000] _mask
 * 
 *     def __init__ (self, length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._length = length
 * 
 */

static int __pyx_pf_17shift_calculators_9Out_array___init__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line108")'> 108:         self._length = length</pre>
<pre id='line108' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":108
 * 
 *     def __init__ (self, length):
 *         self._length = length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely((__pyx_t_1 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_length = __pyx_t_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_9Out_array_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_9Out_array_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_length = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__length,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_length = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_2__cinit__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_length);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109: </pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line110")'> 110: </pre>
<pre id='line110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line111")'> 111:     def __cinit__(self,  length):</pre>
<pre id='line111' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":111
 * 
 * 
 *     def __cinit__(self,  length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._length =  60000
 * 
 */

static int __pyx_pf_17shift_calculators_9Out_array_2__cinit__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line112")'> 112:         self._length =  60000</pre>
<pre id='line112' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":112
 * 
 *     def __cinit__(self,  length):
 *         self._length =  60000             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if length > 60000:
 */
  __pyx_v_self->_length = 60000;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113: </pre>
<pre id='line113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line114")'> 114:         if length &gt; 60000:</pre>
<pre id='line114' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":114
 *         self._length =  60000
 * 
 *         if length > 60000:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError("couldn't allocate array beyond length %i" % 60000)
 * #        self._data = <code><</code>double *>malloc(length * sizeof(double))
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_length, __pyx_int_60000, Py_GT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line115")'> 115:             raise MemoryError("couldn't allocate array beyond length %i" % 60000)</pre>
<pre id='line115' class='code' style='background-color: #FFFF48'>
    /* "Cython_shift_calculator.pyx":115
 * 
 *         if length > 60000:
 *             raise MemoryError("couldn't allocate array beyond length %i" % 60000)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._data = <code><</code>double *>malloc(length * sizeof(double))
 * #        if not self._data:
 */
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_1), __pyx_int_60000);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_t_1));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_1));
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116: #        self._data = &lt;double *&gt;malloc(length * sizeof(double))</pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117: #        if not self._data:</pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118: #            raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119: #</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120: #        self._mask = &lt;long *&gt;malloc(length * sizeof(long))</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121: #        if not self._mask:</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122: #            raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123: #</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124: #        if  self._data  and self._mask:</pre>
<pre id='line124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125: #            self._clear(length)</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126: #        print 'allocated'</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127: </pre>
<pre id='line127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line128")'> 128:     cpdef get_length(self):</pre>
<pre id='line128' class='code' style='background-color: #FFFF57'>
/* "Cython_shift_calculator.pyx":128
 * #        print 'allocated'
 * 
 *     cpdef get_length(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._length
 * 
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_f_17shift_calculators_9Out_array_get_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, int __pyx_skip_dispatch) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__get_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_5get_length)) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":128
 * #        print 'allocated'
 * 
 *     cpdef get_length(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._length
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_4get_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->get_length(__pyx_v_self, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.get_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line129")'> 129:         return self._length</pre>
<pre id='line129' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":129
 * 
 *     cpdef get_length(self):
 *         return self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef add_all(self, Out_array target_array):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.get_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_4get_length(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130: </pre>
<pre id='line130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line131")'> 131:     cpdef add_all(self, Out_array target_array):</pre>
<pre id='line131' class='code' style='background-color: #FFFF43'>
/* "Cython_shift_calculator.pyx":131
 *         return self._length
 * 
 *     cpdef add_all(self, Out_array target_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array); /*proto*/
static PyObject *__pyx_f_17shift_calculators_9Out_array_add_all(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_target_array, int __pyx_skip_dispatch) {
  Vec3 __pyx_v_value;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__add_all);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_7add_all)) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_target_array));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_target_array));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_target_array));
      __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":131
 *         return self._length
 * 
 *     cpdef add_all(self, Out_array target_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_6add_all(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_target_array) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->add_all(__pyx_v_self, __pyx_v_target_array, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_all", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_9Out_array_9__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_9Out_array_9__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_9Out_array_8__dealloc__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132:         cdef Vec3 value</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line133")'> 133:         for i in range(target_array._length):</pre>
<pre id='line133' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":133
 *     cpdef add_all(self, Out_array target_array):
 *         cdef Vec3 value
 *         for i in range(target_array._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_target_array->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF44' onclick='toggleDiv("line134")'> 134:             if i &lt; self._length and target_array._mask[i]:</pre>
<pre id='line134' class='code' style='background-color: #FFFF44'>
    /* "Cython_shift_calculator.pyx":134
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 *             if i <code><</code> self._length and target_array._mask[i]:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 *                 self.add(i, value)
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_i, __pyx_t_1, Py_LT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_6 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_6) {
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_8 = (__pyx_v_target_array->_mask[__pyx_t_7]);
    } else {
      __pyx_t_8 = __pyx_t_6;
    }
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line135")'> 135:                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])</pre>
<pre id='line135' class='code' style='background-color: #FFFF21'>
      /* "Cython_shift_calculator.pyx":135
 *         for i in range(target_array._length):
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self.add(i, value)
 * 
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_value = Vec3((__pyx_v_target_array->_data[__pyx_t_7]), (__pyx_v_target_array->_data[__pyx_t_9]), (__pyx_v_target_array->_data[__pyx_t_10]));
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line136")'> 136:                 self.add(i, value)</pre>
<pre id='line136' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":136
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 *                 self.add(i, value)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_self, __pyx_t_11, __pyx_v_value);
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_all", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_target_array), __pyx_ptype_17shift_calculators_Out_array, 1, "target_array", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_6add_all(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_target_array));
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137: </pre>
<pre id='line137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line138")'> 138:     def __dealloc__(self):</pre>
<pre id='line138' class='code' style='background-color: #FFFFe7'>
/* "Cython_shift_calculator.pyx":138
 *                 self.add(i, value)
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * #        free(self._data)
 */

static void __pyx_pf_17shift_calculators_9Out_array_8__dealloc__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139:         pass</pre>
<pre id='line139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140: #        free(self._data)</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141: #        self._data = NULL</pre>
<pre id='line141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142: #        free(self._mask)</pre>
<pre id='line142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143: #        self._mask = NULL</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144: </pre>
<pre id='line144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145:     cdef inline bint _check_clear_length(self, long length) except -1:</pre>
<pre id='line145' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":145
 * #        self._mask = NULL
 * 
 *     cdef inline bint _check_clear_length(self, long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_clear_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_clear_length", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146:         if not length &lt;= self._length:</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":146
 * 
 *     cdef inline bint _check_clear_length(self, long length) except -1:
 *         if not length <code><</code>= self._length:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 */
  __pyx_t_1 = (!(__pyx_v_length <code><</code>= __pyx_v_self->_length));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line147")'> 147:             raise IndexError("tried to clear to %i length is %i" % (length,self._length))</pre>
<pre id='line147' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":147
 *     cdef inline bint _check_clear_length(self, long length) except -1:
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_2), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148:         if self._data is NULL:</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":148
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line149")'> 149:             raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line149' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":149
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_AttributeError, ((PyObject *)__pyx_k_tuple_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_clear_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":149
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 */
  __pyx_k_tuple_4 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)__pyx_kp_s_3));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_4));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150: </pre>
<pre id='line150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151:     cdef inline bint _check_offset(self, long offset) except -1:</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":151
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_offset(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_offset) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_offset", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line152")'> 152:         if not offset &lt; self._length:</pre>
<pre id='line152' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":152
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 *         if not offset <code><</code> self._length:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 */
  __pyx_t_1 = (!(__pyx_v_offset <code><</code> __pyx_v_self->_length));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line153")'> 153:             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))</pre>
<pre id='line153' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":153
 *     cdef inline bint _check_offset(self, long offset) except -1:
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_5), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154:         if self._data is NULL:</pre>
<pre id='line154' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":154
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line155")'> 155:             raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line155' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":155
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef bint realloc(self,long length) except -1:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_AttributeError, ((PyObject *)__pyx_k_tuple_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_offset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":155
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef bint realloc(self,long length) except -1:
 */
  __pyx_k_tuple_6 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)__pyx_kp_s_3));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_6));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156: </pre>
<pre id='line156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line157")'> 157:     cpdef bint realloc(self,long length) except -1:</pre>
<pre id='line157' class='code' style='background-color: #FFFF2d'>
/* "Cython_shift_calculator.pyx":157
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cpdef bint realloc(self,long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if length <code><</code>60000:
 * #            free(self._data)
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length); /*proto*/
static int __pyx_f_17shift_calculators_9Out_array_realloc(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length, int __pyx_skip_dispatch) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__realloc);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_11realloc)) {
      __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_4;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":157
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cpdef bint realloc(self,long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if length <code><</code>60000:
 * #            free(self._data)
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_10realloc(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->realloc(__pyx_v_self, __pyx_v_length, 1);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158:         if length &lt;60000:</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":158
 * 
 *     cpdef bint realloc(self,long length) except -1:
 *         if length <code><</code>60000:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #            free(self._data)
 * #            self._data = NULL
 */
  __pyx_t_4 = (__pyx_v_length <code><</code> 60000);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159: #            free(self._data)</pre>
<pre id='line159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160: #            self._data = NULL</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161: #            self._data = &lt;double *&gt;malloc(3 *(length+1) * sizeof(double))</pre>
<pre id='line161' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162: #            if not self._data:</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163: #                raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164: #            if  self._data:</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165: #                self._length =length</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line166")'> 166:             self._clear(length)</pre>
<pre id='line166' class='code' style='background-color: #FFFF96'>
    /* "Cython_shift_calculator.pyx":166
 * #            if  self._data:
 * #                self._length =length
 *             self._clear(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             raise MemoryError("couldn't beyond of length %i" % 60000)
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->_clear(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:         else:</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line168")'> 168:             raise MemoryError("couldn't beyond of length %i" % 60000)</pre>
<pre id='line168' class='code' style='background-color: #FFFF33'>
    /* "Cython_shift_calculator.pyx":168
 *             self._clear(length)
 *         else:
 *             raise MemoryError("couldn't beyond of length %i" % 60000)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 * #            free(self._mask)
 */
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_7), __pyx_int_60000);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length) {
  long __pyx_v_length;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc (wrapper)", 0);
  assert(__pyx_arg_length); {
    __pyx_v_length = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_arg_length);<span class='error_goto'> if (unlikely((__pyx_v_length == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_10realloc(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((long)__pyx_v_length));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169: #</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170: #            free(self._mask)</pre>
<pre id='line170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171: #            self._mask = NULL</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172: #            self._mask = &lt;int *&gt;malloc((length+1) * sizeof(int))</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173: #            if not self._mask:</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174: #                raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175: #            if  self._mask:</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176: #                self._clear_mask(length)</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177: </pre>
<pre id='line177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:     cdef inline bint _check_state(self) except -1:</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":178
 * #                self._clear_mask(length)
 * 
 *     cdef inline bint _check_state(self) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_state(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_state", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179:         if self._data is NULL:</pre>
<pre id='line179' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":179
 * 
 *     cdef inline bint _check_state(self) except -1:
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line180")'> 180:             raise MemoryError("couldn't reallocate array of length %i" % self._length)</pre>
<pre id='line180' class='code' style='background-color: #FFFF3e'>
    /* "Cython_shift_calculator.pyx":180
 *     cdef inline bint _check_state(self) except -1:
 *         if self._data is NULL:
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _clear(self, length):
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_8), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181: </pre>
<pre id='line181' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:     cdef _clear(self, length):</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":182
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 * 
 *     cdef _clear(self, length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._check_clear_length(length)
 *         for i in range(length*3):
 */

static PyObject *__pyx_f_17shift_calculators_9Out_array__clear(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_clear", 0);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line183")'> 183:         self._check_clear_length(length)</pre>
<pre id='line183' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":183
 * 
 *     cdef _clear(self, length):
 *         self._check_clear_length(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(length*3):
 *             self._data[i] = 0.0
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely((__pyx_t_1 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __pyx_f_17shift_calculators_9Out_array__check_clear_length(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line184")'> 184:         for i in range(length*3):</pre>
<pre id='line184' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":184
 *     cdef _clear(self, length):
 *         self._check_clear_length(length)
 *         for i in range(length*3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[i] = 0.0
 *         for i in range(length):
 */
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_length, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
    __pyx_t_4 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line185")'> 185:             self._data[i] = 0.0</pre>
<pre id='line185' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":185
 *         self._check_clear_length(length)
 *         for i in range(length*3):
 *             self._data[i] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(length):
 *             self._mask[i]=0
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_data[__pyx_t_7]) = 0.0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line186")'> 186:         for i in range(length):</pre>
<pre id='line186' class='code' style='background-color: #FFFF22'>
  /* "Cython_shift_calculator.pyx":186
 *         for i in range(length*3):
 *             self._data[i] = 0.0
 *         for i in range(length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._mask[i]=0
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_length);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_length);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_length);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
    __pyx_t_4 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line187")'> 187:             self._mask[i]=0</pre>
<pre id='line187' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":187
 *             self._data[i] = 0.0
 *         for i in range(length):
 *             self._mask[i]=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def padd(self,offset,value):
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_mask[__pyx_t_7]) = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._clear", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_13padd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_13padd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_value = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("padd (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__value,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__value)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("padd", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "padd") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_offset = values[0];
    __pyx_v_value = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("padd", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.padd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_12padd(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_offset, __pyx_v_value);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188: </pre>
<pre id='line188' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189:     def padd(self,offset,value):</pre>
<pre id='line189' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":189
 *             self._mask[i]=0
 * 
 *     def padd(self,offset,value):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])
 *         self.add(offset, cvalue)
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_12padd(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_value) {
  Vec3 __pyx_v_cvalue;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("padd", 0);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line190")'> 190:         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])</pre>
<pre id='line190' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":190
 * 
 *     def padd(self,offset,value):
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.add(offset, cvalue)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_cvalue = Vec3(__pyx_t_2, __pyx_t_3, __pyx_t_4);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line191")'> 191:         self.add(offset, cvalue)</pre>
<pre id='line191' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":191
 *     def padd(self,offset,value):
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])
 *         self.add(offset, cvalue)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_self, __pyx_t_5, __pyx_v_cvalue);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.padd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192: </pre>
<pre id='line192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193:     @cython.profile(False)</pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:     cdef inline void  add(self,long offset, Vec3&amp; value):</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":194
 * 
 *     @cython.profile(False)
 *     cdef inline void  add(self,long offset, Vec3& value):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_offset(offset)
 *         cdef long id3 = offset *3
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_9Out_array_add(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_offset, Vec3 &__pyx_v_value) {
  long __pyx_v_id3;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195: #        self._check_offset(offset)</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196:         cdef long id3 = offset *3</pre>
<pre id='line196' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":196
 *     cdef inline void  add(self,long offset, Vec3& value):
 * #        self._check_offset(offset)
 *         cdef long id3 = offset *3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._data[id3]   += value[0]
 */
  __pyx_v_id3 = (__pyx_v_offset * 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197: </pre>
<pre id='line197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198:         self._data[id3]   += value[0]</pre>
<pre id='line198' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":198
 *         cdef long id3 = offset *3
 * 
 *         self._data[id3]   += value[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._data[id3+1] += value[1]
 *         self._data[id3+2] += value[2]
 */
  __pyx_t_1 = __pyx_v_id3;
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:         self._data[id3+1] += value[1]</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":199
 * 
 *         self._data[id3]   += value[0]
 *         self._data[id3+1] += value[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._data[id3+2] += value[2]
 * 
 */
  __pyx_t_1 = (__pyx_v_id3 + 1);
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:         self._data[id3+2] += value[2]</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":200
 *         self._data[id3]   += value[0]
 *         self._data[id3+1] += value[1]
 *         self._data[id3+2] += value[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._mask[offset] = 1
 */
  __pyx_t_1 = (__pyx_v_id3 + 2);
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[2]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201: </pre>
<pre id='line201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line202")'> 202:         self._mask[offset] = 1</pre>
<pre id='line202' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":202
 *         self._data[id3+2] += value[2]
 * 
 *         self._mask[offset] = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def clear_by_id(self,target_ids):
 */
  (__pyx_v_self->_mask[__pyx_v_offset]) = 1;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_15clear_by_id(PyObject *__pyx_v_self, PyObject *__pyx_v_target_ids); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_15clear_by_id(PyObject *__pyx_v_self, PyObject *__pyx_v_target_ids) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear_by_id (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_14clear_by_id(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((PyObject *)__pyx_v_target_ids));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203: </pre>
<pre id='line203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204:     def clear_by_id(self,target_ids):</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":204
 *         self._mask[offset] = 1
 * 
 *     def clear_by_id(self,target_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3 = 0
 *         for target_id in target_ids:
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_14clear_by_id(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_target_ids) {
  long __pyx_v_id3;
  PyObject *__pyx_v_target_id = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear_by_id", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205:         cdef long id3 = 0</pre>
<pre id='line205' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":205
 * 
 *     def clear_by_id(self,target_ids):
 *         cdef long id3 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for target_id in target_ids:
 *             self._check_offset(target_id)
 */
  __pyx_v_id3 = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line206")'> 206:         for target_id in target_ids:</pre>
<pre id='line206' class='code' style='background-color: #FFFF2a'>
  /* "Cython_shift_calculator.pyx":206
 *     def clear_by_id(self,target_ids):
 *         cdef long id3 = 0
 *         for target_id in target_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._check_offset(target_id)
 *             id3 = target_id *3
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_target_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_target_ids)) {
    __pyx_t_1 = __pyx_v_target_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_target_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_3 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_3 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_id);
    __pyx_v_target_id = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line207")'> 207:             self._check_offset(target_id)</pre>
<pre id='line207' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":207
 *         cdef long id3 = 0
 *         for target_id in target_ids:
 *             self._check_offset(target_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             id3 = target_id *3
 * 
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_target_id);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = __pyx_f_17shift_calculators_9Out_array__check_offset(__pyx_v_self, __pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line208")'> 208:             id3 = target_id *3</pre>
<pre id='line208' class='code' style='background-color: #FFFF62'>
    /* "Cython_shift_calculator.pyx":208
 *         for target_id in target_ids:
 *             self._check_offset(target_id)
 *             id3 = target_id *3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._data[id3]   = 0.0
 */
    __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_target_id, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_id3 = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209: </pre>
<pre id='line209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210:             self._data[id3]   = 0.0</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":210
 *             id3 = target_id *3
 * 
 *             self._data[id3]   = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[id3+1] = 0.0
 *             self._data[id3+2] = 0.0
 */
    (__pyx_v_self->_data[__pyx_v_id3]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211:             self._data[id3+1] = 0.0</pre>
<pre id='line211' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":211
 * 
 *             self._data[id3]   = 0.0
 *             self._data[id3+1] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[id3+2] = 0.0
 * 
 */
    (__pyx_v_self->_data[(__pyx_v_id3 + 1)]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212:             self._data[id3+2] = 0.0</pre>
<pre id='line212' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":212
 *             self._data[id3]   = 0.0
 *             self._data[id3+1] = 0.0
 *             self._data[id3+2] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._mask[target_id] = 0
 */
    (__pyx_v_self->_data[(__pyx_v_id3 + 2)]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213: </pre>
<pre id='line213' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line214")'> 214:             self._mask[target_id] = 0</pre>
<pre id='line214' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":214
 *             self._data[id3+2] = 0.0
 * 
 *             self._mask[target_id] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_target_id);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_mask[__pyx_t_7]) = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.clear_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_id);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_17add_forces_to_result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_17add_forces_to_result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_result = 0;
  PyObject *__pyx_v_weight = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__result,&__pyx_n_s__weight,0};
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215: </pre>
<pre id='line215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line216")'> 216:     def add_forces_to_result(self, result=None, weight=1.0):</pre>
<pre id='line216' class='code' style='background-color: #FFFF37'>
    /* "Cython_shift_calculator.pyx":216
 *             self._mask[target_id] = 0
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if result ==  None:
 *             result = [None] * self._length
 */
    values[0] = ((PyObject *)Py_None);
    values[1] = __pyx_k_9;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__result);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__weight);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_forces_to_result") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_result = values[0];
    __pyx_v_weight = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_forces_to_result", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_16add_forces_to_result(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_result, __pyx_v_weight);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_17shift_calculators_9Out_array_16add_forces_to_result(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_result, PyObject *__pyx_v_weight) {
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  long __pyx_v_id3;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);

  /* "Cython_shift_calculator.pyx":216
 *             self._mask[target_id] = 0
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if result ==  None:
 *             result = [None] * self._length
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(1.0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_9 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line217")'> 217:         if result ==  None:</pre>
<pre id='line217' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":217
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):
 *         if result ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = [None] * self._length
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_result, Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line218")'> 218:             result = [None] * self._length</pre>
<pre id='line218' class='code' style='background-color: #FFFF8d'>
    /* "Cython_shift_calculator.pyx":218
 *     def add_forces_to_result(self, result=None, weight=1.0):
 *         if result ==  None:
 *             result = [None] * self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double x = 0.0
 */
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1 * ((__pyx_v_self->_length<code><</code>0) ? 0:__pyx_v_self->_length));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp <code><</code> __pyx_v_self->_length; __pyx_temp++) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, __pyx_temp, Py_None);
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_result);
    __pyx_v_result = ((PyObject *)__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219: </pre>
<pre id='line219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220:         cdef double x = 0.0</pre>
<pre id='line220' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":220
 *             result = [None] * self._length
 * 
 *         cdef double x = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double y = 0.0
 *         cdef double z = 0.0
 */
  __pyx_v_x = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221:         cdef double y = 0.0</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":221
 * 
 *         cdef double x = 0.0
 *         cdef double y = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double z = 0.0
 *         cdef long id3
 */
  __pyx_v_y = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222:         cdef double z = 0.0</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":222
 *         cdef double x = 0.0
 *         cdef double y = 0.0
 *         cdef double z = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3
 *         for i in range(self._length):
 */
  __pyx_v_z = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223:         cdef long id3</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line224")'> 224:         for i in range(self._length):</pre>
<pre id='line224' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":224
 *         cdef double z = 0.0
 *         cdef long id3
 *         for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line225")'> 225:             if self._mask[i] != 0:</pre>
<pre id='line225' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":225
 *         cdef long id3
 *         for i in range(self._length):
 *             if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_6]) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line226")'> 226:                 if result[i] ==  None:</pre>
<pre id='line226' class='code' style='background-color: #FFFF5e'>
      /* "Cython_shift_calculator.pyx":226
 *         for i in range(self._length):
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 */
      __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line227")'> 227:                     result[i] = [0.0]*3</pre>
<pre id='line227' class='code' style='background-color: #FFFF57'>
        /* "Cython_shift_calculator.pyx":227
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 id3 = i * 3
 *                 x  = self._data[id3] * weight
 */
        __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1 * 3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        { Py_ssize_t __pyx_temp;
          for (__pyx_temp=0; __pyx_temp <code><</code> 3; __pyx_temp++) {
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
            <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, __pyx_temp, __pyx_t_7);
            <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
          }
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_result, __pyx_v_i, ((PyObject *)__pyx_t_1)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line228")'> 228:                 id3 = i * 3</pre>
<pre id='line228' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":228
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 x  = self._data[id3] * weight
 *                 y  = self._data[id3+1] *weight
 */
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line229")'> 229:                 x  = self._data[id3] * weight</pre>
<pre id='line229' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":229
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 *                 x  = self._data[id3] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 y  = self._data[id3+1] *weight
 *                 z  = self._data[id3+2] * weight
 */
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_9 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_x = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line230")'> 230:                 y  = self._data[id3+1] *weight</pre>
<pre id='line230' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":230
 *                 id3 = i * 3
 *                 x  = self._data[id3] * weight
 *                 y  = self._data[id3+1] *weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 z  = self._data[id3+2] * weight
 *                 result[i][0] += x
 */
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_9 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_y = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line231")'> 231:                 z  = self._data[id3+2] * weight</pre>
<pre id='line231' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":231
 *                 x  = self._data[id3] * weight
 *                 y  = self._data[id3+1] *weight
 *                 z  = self._data[id3+2] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][0] += x
 *                 result[i][1] += y
 */
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_9 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_z = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line232")'> 232:                 result[i][0] += x</pre>
<pre id='line232' class='code' style='background-color: #FFFF4d'>
      /* "Cython_shift_calculator.pyx":232
 *                 y  = self._data[id3+1] *weight
 *                 z  = self._data[id3+2] * weight
 *                 result[i][0] += x             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][1] += y
 *                 result[i][2] += z
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_6 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_1, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_7, __pyx_t_6, __pyx_t_11, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line233")'> 233:                 result[i][1] += y</pre>
<pre id='line233' class='code' style='background-color: #FFFF4d'>
      /* "Cython_shift_calculator.pyx":233
 *                 z  = self._data[id3+2] * weight
 *                 result[i][0] += x
 *                 result[i][1] += y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][2] += z
 * 
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_6 = 1;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_7, __pyx_t_6, __pyx_t_1, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line234")'> 234:                 result[i][2] += z</pre>
<pre id='line234' class='code' style='background-color: #FFFF4b'>
      /* "Cython_shift_calculator.pyx":234
 *                 result[i][0] += x
 *                 result[i][1] += y
 *                 result[i][2] += z             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_6 = 2;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_1, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_7, __pyx_t_6, __pyx_t_11, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235: </pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236: </pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line237")'> 237:         return result</pre>
<pre id='line237' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":237
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_19add_forces_to_result_by_id(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_19add_forces_to_result_by_id(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_target_atom_ids = 0;
  PyObject *__pyx_v_result = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result_by_id (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,&__pyx_n_s__result,0};
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238: </pre>
<pre id='line238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line239")'> 239:     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):</pre>
<pre id='line239' class='code' style='background-color: #FFFF38'>
    /* "Cython_shift_calculator.pyx":239
 *         return result
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if result ==  None:
 *             result = [None] * self._length
 */
    values[1] = ((PyObject*)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__result);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_forces_to_result_by_id") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_target_atom_ids = ((PyObject*)values[0]);
    __pyx_v_result = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_forces_to_result_by_id", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_target_atom_ids), (&PyList_Type), 1, "target_atom_ids", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_result), (&PyList_Type), 1, "result", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_18add_forces_to_result_by_id(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_target_atom_ids, __pyx_v_result);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_17shift_calculators_9Out_array_18add_forces_to_result_by_id(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_target_atom_ids, PyObject *__pyx_v_result) {
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  long __pyx_v_id3;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result_by_id", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line240")'> 240:         if result ==  None:</pre>
<pre id='line240' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":240
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 *         if result ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = [None] * self._length
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_result), Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line241")'> 241:             result = [None] * self._length</pre>
<pre id='line241' class='code' style='background-color: #FFFF8d'>
    /* "Cython_shift_calculator.pyx":241
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 *         if result ==  None:
 *             result = [None] * self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double x = 0.0
 */
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1 * ((__pyx_v_self->_length<code><</code>0) ? 0:__pyx_v_self->_length));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp <code><</code> __pyx_v_self->_length; __pyx_temp++) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, __pyx_temp, Py_None);
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_result));
    __pyx_v_result = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242: </pre>
<pre id='line242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243:         cdef double x = 0.0</pre>
<pre id='line243' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":243
 *             result = [None] * self._length
 * 
 *         cdef double x = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double y = 0.0
 *         cdef double z = 0.0
 */
  __pyx_v_x = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:         cdef double y = 0.0</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":244
 * 
 *         cdef double x = 0.0
 *         cdef double y = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double z = 0.0
 *         cdef long id3
 */
  __pyx_v_y = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245:         cdef double z = 0.0</pre>
<pre id='line245' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":245
 *         cdef double x = 0.0
 *         cdef double y = 0.0
 *         cdef double z = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3
 *         for i in target_atom_ids:
 */
  __pyx_v_z = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246:         cdef long id3</pre>
<pre id='line246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line247")'> 247:         for i in target_atom_ids:</pre>
<pre id='line247' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":247
 *         cdef double z = 0.0
 *         cdef long id3
 *         for i in target_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 */
  if (unlikely(((PyObject *)__pyx_v_target_atom_ids) == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_1 = ((PyObject *)__pyx_v_target_atom_ids); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_3 = 0;
  for (;;) {
    if (__pyx_t_3 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    #else
    __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    #endif
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line248")'> 248:             if self._mask[i] != 0:</pre>
<pre id='line248' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":248
 *         cdef long id3
 *         for i in target_atom_ids:
 *             if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_5]) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line249")'> 249:                 if result[i] ==  None:</pre>
<pre id='line249' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":249
 *         for i in target_atom_ids:
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, Py_None, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line250")'> 250:                     result[i] = [0.0]*3</pre>
<pre id='line250' class='code' style='background-color: #FFFF4b'>
        /* "Cython_shift_calculator.pyx":250
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 id3 = i * 3
 *                 x  = self._data[id3]
 */
        __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
        __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(1 * 3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
        { Py_ssize_t __pyx_temp;
          for (__pyx_temp=0; __pyx_temp <code><</code> 3; __pyx_temp++) {
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
            <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, __pyx_temp, __pyx_t_6);
            <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
          }
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        if (<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i, ((PyObject *)__pyx_t_4)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line251")'> 251:                 id3 = i * 3</pre>
<pre id='line251' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":251
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]
 */
      __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_7 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_id3 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252:                 x  = self._data[id3]</pre>
<pre id='line252' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":252
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 *                 x  = self._data[id3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]
 */
      __pyx_v_x = (__pyx_v_self->_data[__pyx_v_id3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:                 y  = self._data[id3+1]</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":253
 *                 id3 = i * 3
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x
 */
      __pyx_v_y = (__pyx_v_self->_data[(__pyx_v_id3 + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254:                 z  = self._data[id3+2]</pre>
<pre id='line254' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":254
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][0] += x
 *                 result[i][1] += y
 */
      __pyx_v_z = (__pyx_v_self->_data[(__pyx_v_id3 + 2)]);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line255")'> 255:                 result[i][0] += x</pre>
<pre id='line255' class='code' style='background-color: #FFFF43'>
      /* "Cython_shift_calculator.pyx":255
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][1] += y
 *                 result[i][2] += z
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_9, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line256")'> 256:                 result[i][1] += y</pre>
<pre id='line256' class='code' style='background-color: #FFFF43'>
      /* "Cython_shift_calculator.pyx":256
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x
 *                 result[i][1] += y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][2] += z
 * 
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 1;
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_6 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_9, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line257")'> 257:                 result[i][2] += z</pre>
<pre id='line257' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":257
 *                 result[i][0] += x
 *                 result[i][1] += y
 *                 result[i][2] += z             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 2;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_9, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258: </pre>
<pre id='line258' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line259")'> 259: </pre>
<pre id='line259' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line260")'> 260:         return result</pre>
<pre id='line260' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":260
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __str__(self):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_21__str__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_21__str__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_20__str__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261: </pre>
<pre id='line261' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262:     def __str__(self):</pre>
<pre id='line262' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":262
 *         return result
 * 
 *     def __str__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef long id3 =0
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_20__str__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  long __pyx_v_id3;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__str__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line263")'> 263: </pre>
<pre id='line263' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264:         cdef long id3 =0</pre>
<pre id='line264' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":264
 *     def __str__(self):
 * 
 *         cdef long id3 =0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result =  []
 *         result.append('length = %i' % self._length)
 */
  __pyx_v_id3 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line265")'> 265:         result =  []</pre>
<pre id='line265' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":265
 * 
 *         cdef long id3 =0
 *         result =  []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line266")'> 266:         result.append('length = %i' % self._length)</pre>
<pre id='line266' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":266
 *         cdef long id3 =0
 *         result =  []
 *         result.append('length = %i' % self._length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._length):
 *             if self._mask[i] ==0:
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_10), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line267")'> 267:         for i in range(self._length):</pre>
<pre id='line267' class='code' style='background-color: #FFFF20'>
  /* "Cython_shift_calculator.pyx":267
 *         result =  []
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] ==0:
 *                 result.append("%5i ." % i)
 */
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line268")'> 268:             if self._mask[i] ==0:</pre>
<pre id='line268' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":268
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):
 *             if self._mask[i] ==0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result.append("%5i ." % i)
 *             else:
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((__pyx_v_self->_mask[__pyx_t_6]) == 0);
    if (__pyx_t_7) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line269")'> 269:                 result.append("%5i ." % i)</pre>
<pre id='line269' class='code' style='background-color: #FFFF79'>
      /* "Cython_shift_calculator.pyx":269
 *         for i in range(self._length):
 *             if self._mask[i] ==0:
 *                 result.append("%5i ." % i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 id3 = i * 3
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_11), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
      __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270:             else:</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line271")'> 271:                 id3 = i * 3</pre>
<pre id='line271' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":271
 *                 result.append("%5i ." % i)
 *             else:
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))
 *         return '\n'.join(result)
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line272")'> 272:                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))</pre>
<pre id='line272' class='code' style='background-color: #FFFF35'>
      /* "Cython_shift_calculator.pyx":272
 *             else:
 *                 id3 = i * 3
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return '\n'.join(result)
 * 
 */
      __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_v_i);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 2, __pyx_t_9);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 3, __pyx_t_10);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_10);
      __pyx_t_2 = 0;
      __pyx_t_9 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_12), ((PyObject *)__pyx_t_11));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_11)); __pyx_t_11 = 0;
      __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_10));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line273")'> 273:         return '\n'.join(result)</pre>
<pre id='line273' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":273
 *                 id3 = i * 3
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))
 *         return '\n'.join(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_kp_s_13), __pyx_n_s__join);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, ((PyObject *)__pyx_v_result));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_result));
  __pyx_t_11 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_10), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  __pyx_r = __pyx_t_11;
  __pyx_t_11 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274: </pre>
<pre id='line274' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275: </pre>
<pre id='line275' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276: #cdef float* out_array = null</pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277: #cdef long out_array_length = -1</pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278: #cdef bint allocate_out_array_for_forces(long length) except -1:</pre>
<pre id='line278' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line279")'> 279: #    global out_array</pre>
<pre id='line279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280: #    global out_array_length</pre>
<pre id='line280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281: #    cdef long required_length = length*3</pre>
<pre id='line281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282: #    cdef bint allocate =  False</pre>
<pre id='line282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283: #    if out_array ==  null:</pre>
<pre id='line283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284: #        out_array = &lt;float*&gt; malloc*(required_length *sizeof(float))</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285: #        if out_array  == null:</pre>
<pre id='line285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286: #            Raise</pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287: #        allocate=True</pre>
<pre id='line287' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288: #        out_array_length =</pre>
<pre id='line288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289: #        elif  len(out_array) &lt; required_length</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290: #    return allocate</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291: #</pre>
<pre id='line291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292: #def _clear_out_array_for_forces(self, length):</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293: #</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294: #</pre>
<pre id='line294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295: #    is_new  = self.allocate_out_array_for_forces(length)</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line296")'> 296: #</pre>
<pre id='line296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line297")'> 297: #    if not is_new:</pre>
<pre id='line297' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298: #        length = length*3</pre>
<pre id='line298' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299: #        for i in range(length):</pre>
<pre id='line299' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line300")'> 300: #            self._out_array[i] =0.0</pre>
<pre id='line300' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line301")'> 301: #    return self._out_array</pre>
<pre id='line301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302: #</pre>
<pre id='line302' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line303")'> 303: #def _copy_back_forces(self, data_dict, data_array, target_atom_ids):</pre>
<pre id='line303' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line304")'> 304: #    for id in target_atom_ids:</pre>
<pre id='line304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line305")'> 305: #        result =  dict.setdefault(id,[0.0,0.0,0.0])</pre>
<pre id='line305' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line306")'> 306: #        id3 = id*3</pre>
<pre id='line306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line307")'> 307: #        result[0] = data_array[id3]</pre>
<pre id='line307' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308: #        result[1] = data_array[id3+1]</pre>
<pre id='line308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line309")'> 309: #        result[2] = data_array[id3+2]</pre>
<pre id='line309' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line310")'> 310: </pre>
<pre id='line310' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line311")'> 311: </pre>
<pre id='line311' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line312")'> 312: </pre>
<pre id='line312' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line313")'> 313: cdef object vec3_as_tuple(Vec3&amp; vec_3):</pre>
<pre id='line313' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":313
 * 
 * 
 * cdef object vec3_as_tuple(Vec3& vec_3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 */

static PyObject *__pyx_f_17shift_calculators_vec3_as_tuple(Vec3 &__pyx_v_vec_3) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("vec3_as_tuple", 0);
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line314")'> 314:     return vec_3.x(), vec_3.y(), vec_3.z()</pre>
<pre id='line314' class='code' style='background-color: #FFFF3c'>
  /* "Cython_shift_calculator.pyx":314
 * 
 * cdef object vec3_as_tuple(Vec3& vec_3):
 *     return vec_3.x(), vec_3.y(), vec_3.z()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Vec3_container:
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.x());<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.y());<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.z());<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_r = ((PyObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.vec3_as_tuple", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line315")'> 315: </pre>
<pre id='line315' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line316")'> 316: cdef class Vec3_container:</pre>
<pre id='line316' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":316
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 * cdef class Vec3_container:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float[3] floats
 */
struct __pyx_obj_17shift_calculators_Vec3_container {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Vec3_container *__pyx_vtab;
  float floats[3];
};


/* "Cython_shift_calculator.pyx":316
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 * cdef class Vec3_container:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float[3] floats
 */

struct __pyx_vtabstruct_17shift_calculators_Vec3_container {
  PyObject *(*set_vec3)(struct __pyx_obj_17shift_calculators_Vec3_container *, Vec3 &);
  Vec3 (*get_vec3)(struct __pyx_obj_17shift_calculators_Vec3_container *);
};
static struct __pyx_vtabstruct_17shift_calculators_Vec3_container *__pyx_vtabptr_17shift_calculators_Vec3_container;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line317")'> 317: </pre>
<pre id='line317' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line318")'> 318:     cdef float[3] floats</pre>
<pre id='line318' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line319")'> 319: </pre>
<pre id='line319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line320")'> 320:     cdef set_vec3(self,Vec3&amp; vec3):</pre>
<pre id='line320' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":320
 *     cdef float[3] floats
 * 
 *     cdef set_vec3(self,Vec3& vec3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()
 */

static PyObject *__pyx_f_17shift_calculators_14Vec3_container_set_vec3(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self, Vec3 &__pyx_v_vec3) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_vec3", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line321")'> 321:         self.floats[0] =  vec3.x()</pre>
<pre id='line321' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":321
 * 
 *     cdef set_vec3(self,Vec3& vec3):
 *         self.floats[0] =  vec3.x()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[1] =  vec3.y()
 *         self.floats[2] =  vec3.z()
 */
  (__pyx_v_self->floats[0]) = __pyx_v_vec3.x();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line322")'> 322:         self.floats[1] =  vec3.y()</pre>
<pre id='line322' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":322
 *     cdef set_vec3(self,Vec3& vec3):
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[2] =  vec3.z()
 * 
 */
  (__pyx_v_self->floats[1]) = __pyx_v_vec3.y();
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line323")'> 323:         self.floats[2] =  vec3.z()</pre>
<pre id='line323' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":323
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()
 *         self.floats[2] =  vec3.z()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  (__pyx_v_self->floats[2]) = __pyx_v_vec3.z();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line324")'> 324: </pre>
<pre id='line324' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line325")'> 325:     @cython.profile(False)</pre>
<pre id='line325' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line326")'> 326:     cdef Vec3  get_vec3(self):</pre>
<pre id='line326' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":326
 * 
 *     @cython.profile(False)
 *     cdef Vec3  get_vec3(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])
 * 
 */

static Vec3 __pyx_f_17shift_calculators_14Vec3_container_get_vec3(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self) {
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_vec3", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line327")'> 327:         return Vec3(self.floats[0],self.floats[1],self.floats[2])</pre>
<pre id='line327' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":327
 *     @cython.profile(False)
 *     cdef Vec3  get_vec3(self):
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __getitem__(self, i):
 */
  __pyx_r = Vec3((__pyx_v_self->floats[0]), (__pyx_v_self->floats[1]), (__pyx_v_self->floats[2]));
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_14Vec3_container_1__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_14Vec3_container_1__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_14Vec3_container___getitem__(((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_v_self), ((PyObject *)__pyx_v_i));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line328")'> 328: </pre>
<pre id='line328' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line329")'> 329:     def __getitem__(self, i):</pre>
<pre id='line329' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":329
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])
 * 
 *     def __getitem__(self, i):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"
 */

static PyObject *__pyx_pf_17shift_calculators_14Vec3_container___getitem__(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self, PyObject *__pyx_v_i) {
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_v_values = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__", 0);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line330")'> 330:         if i &gt; 2:</pre>
<pre id='line330' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":330
 * 
 *     def __getitem__(self, i):
 *         if i > 2:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_i, __pyx_int_2, Py_GT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line331")'> 331:             msg = "tried to access object at %i length is %i"</pre>
<pre id='line331' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":331
 *     def __getitem__(self, i):
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             values = (i,3)
 *             raise IndexError(msg % values)
 */
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_5));
    __pyx_v_msg = ((PyObject *)__pyx_kp_s_5);
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line332")'> 332:             values = (i,3)</pre>
<pre id='line332' class='code' style='background-color: #FFFF86'>
    /* "Cython_shift_calculator.pyx":332
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError(msg % values)
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_i);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_int_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_3);
    __pyx_v_values = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line333")'> 333:             raise IndexError(msg % values)</pre>
<pre id='line333' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":333
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)
 *             raise IndexError(msg % values)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return self.floats[i]
 */
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Remainder</span>(__pyx_v_msg, ((PyObject *)__pyx_v_values));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line334")'> 334: </pre>
<pre id='line334' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line335")'> 335:         return self.floats[i]</pre>
<pre id='line335' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":335
 *             raise IndexError(msg % values)
 * 
 *         return self.floats[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_4 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->floats[__pyx_t_4]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Vec3_container.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_msg);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_values);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_27Python_ring_force_sub_terms_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_27Python_ring_force_sub_terms_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_27Python_ring_force_sub_terms___init__(((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line336")'> 336: </pre>
<pre id='line336' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line337")'> 337: </pre>
<pre id='line337' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line338")'> 338: cdef struct target_distant_atom:</pre>
<pre id='line338' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":338
 * 
 * 
 * cdef struct target_distant_atom:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int target_atom_id
 *     int distant_atom_id
 */
struct __pyx_t_17shift_calculators_target_distant_atom {
  int target_atom_id;
  int distant_atom_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line339")'> 339:     int target_atom_id</pre>
<pre id='line339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line340")'> 340:     int distant_atom_id</pre>
<pre id='line340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line341")'> 341: </pre>
<pre id='line341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line342")'> 342: cdef struct target_type:</pre>
<pre id='line342' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":342
 *     int distant_atom_id
 * 
 * cdef struct target_type:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int  target_atom_id
 *     int  atom_type_id
 */
struct __pyx_t_17shift_calculators_target_type {
  int target_atom_id;
  int atom_type_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343:     int  target_atom_id</pre>
<pre id='line343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line344")'> 344:     int  atom_type_id</pre>
<pre id='line344' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line345")'> 345: </pre>
<pre id='line345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line346")'> 346: cdef struct coefficient_exponent:</pre>
<pre id='line346' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":346
 *     int  atom_type_id
 * 
 * cdef struct coefficient_exponent:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     float coefficient
 *     float exponent
 */
struct __pyx_t_17shift_calculators_coefficient_exponent {
  float coefficient;
  float exponent;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line347")'> 347:     float coefficient</pre>
<pre id='line347' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line348")'> 348:     float exponent</pre>
<pre id='line348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line349")'> 349: </pre>
<pre id='line349' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line350")'> 350: cdef struct dihedral_ids:</pre>
<pre id='line350' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":350
 *     float exponent
 * 
 * cdef struct dihedral_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int atom_id_1
 *     int atom_id_2
 */
struct __pyx_t_17shift_calculators_dihedral_ids {
  int atom_id_1;
  int atom_id_2;
  int atom_id_3;
  int atom_id_4;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line351")'> 351:     int atom_id_1</pre>
<pre id='line351' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352:     int atom_id_2</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line353")'> 353:     int atom_id_3</pre>
<pre id='line353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line354")'> 354:     int atom_id_4</pre>
<pre id='line354' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line355")'> 355: </pre>
<pre id='line355' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line356")'> 356: cdef struct Coef_component:</pre>
<pre id='line356' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":356
 *     int atom_id_4
 * 
 * cdef struct Coef_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int atom_type_id
 *     int ring_id
 */
struct __pyx_t_17shift_calculators_Coef_component {
  int atom_type_id;
  int ring_id;
  float coefficient;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line357")'> 357:     int atom_type_id</pre>
<pre id='line357' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line358")'> 358:     int ring_id</pre>
<pre id='line358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line359")'> 359:     float coefficient</pre>
<pre id='line359' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line360")'> 360: </pre>
<pre id='line360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line361")'> 361: cdef struct Ring_force_sub_terms:</pre>
<pre id='line361' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":361
 *     float coefficient
 * 
 * cdef struct Ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     Vec3 d
 *     float dLnL
 */
struct __pyx_t_17shift_calculators_Ring_force_sub_terms {
  Vec3 d;
  float dLnL;
  float dL3nL3;
  float dn;
  float dL;
  float nL;
  Vec3 gradUQ;
  float dL3;
  float u;
  Vec3 gradVQ;
  float dL6;
  Vec3 ring_normal;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line362")'> 362:     Vec3 d</pre>
<pre id='line362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line363")'> 363:     float dLnL</pre>
<pre id='line363' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line364")'> 364:     float dL3nL3</pre>
<pre id='line364' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line365")'> 365:     float dn</pre>
<pre id='line365' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line366")'> 366:     float dL</pre>
<pre id='line366' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line367")'> 367:     float nL</pre>
<pre id='line367' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line368")'> 368:     Vec3 gradUQ</pre>
<pre id='line368' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line369")'> 369:     float dL3</pre>
<pre id='line369' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line370")'> 370:     float u</pre>
<pre id='line370' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line371")'> 371:     Vec3 gradVQ</pre>
<pre id='line371' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line372")'> 372:     float dL6</pre>
<pre id='line372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line373")'> 373:     Vec3 ring_normal</pre>
<pre id='line373' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line374")'> 374: </pre>
<pre id='line374' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line375")'> 375: cdef class Python_ring_force_sub_terms:</pre>
<pre id='line375' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":375
 *     Vec3 ring_normal
 * 
 * cdef class Python_ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Ring_force_sub_terms _terms
 * 
 */
struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *__pyx_vtab;
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms _terms;
};


/* "Cython_shift_calculator.pyx":375
 *     Vec3 ring_normal
 * 
 * cdef class Python_ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Ring_force_sub_terms _terms
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms {
  PyObject *(*setup)(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &);
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms (*get_terms)(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *);
};
static struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *__pyx_vtabptr_17shift_calculators_Python_ring_force_sub_terms;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line376")'> 376:     cdef Ring_force_sub_terms _terms</pre>
<pre id='line376' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line377")'> 377: </pre>
<pre id='line377' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line378")'> 378: #    def __cinit__(self):</pre>
<pre id='line378' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line379")'> 379: #        self._terms = NULL</pre>
<pre id='line379' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line380")'> 380: </pre>
<pre id='line380' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line381")'> 381:     def __init__(self):</pre>
<pre id='line381' class='code' style='background-color: #FFFFe7'>
/* "Cython_shift_calculator.pyx":381
 * #        self._terms = NULL
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static int __pyx_pf_17shift_calculators_27Python_ring_force_sub_terms___init__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line382")'> 382:         pass</pre>
<pre id='line382' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line383")'> 383: </pre>
<pre id='line383' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line384")'> 384:     cdef setup(self, Ring_force_sub_terms&amp; terms):</pre>
<pre id='line384' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":384
 *         pass
 * 
 *     cdef setup(self, Ring_force_sub_terms& terms):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._terms=terms
 * 
 */

static PyObject *__pyx_f_17shift_calculators_27Python_ring_force_sub_terms_setup(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_terms) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("setup", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line385")'> 385:         self._terms=terms</pre>
<pre id='line385' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":385
 * 
 *     cdef setup(self, Ring_force_sub_terms& terms):
 *         self._terms=terms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Ring_force_sub_terms get_terms(self):
 */
  __pyx_v_self->_terms = __pyx_v_terms;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line386")'> 386: </pre>
<pre id='line386' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line387")'> 387:     cdef Ring_force_sub_terms get_terms(self):</pre>
<pre id='line387' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":387
 *         self._terms=terms
 * 
 *     cdef Ring_force_sub_terms get_terms(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._terms
 * 
 */

static struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_f_17shift_calculators_27Python_ring_force_sub_terms_get_terms(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_terms", 0);
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line388")'> 388:         return self._terms</pre>
<pre id='line388' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":388
 * 
 *     cdef Ring_force_sub_terms get_terms(self):
 *         return self._terms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_self->_terms;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_15Coef_components_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_15Coef_components_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_components = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_15Coef_components___cinit__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self), __pyx_v_components);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line389")'> 389: </pre>
<pre id='line389' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line390")'> 390: </pre>
<pre id='line390' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line391")'> 391: cdef struct Component_Offsets:</pre>
<pre id='line391' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":391
 * 
 * 
 * cdef struct Component_Offsets:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int id
 *     int offset
 */
struct __pyx_t_17shift_calculators_Component_Offsets {
  int id;
  int offset;
  int length;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line392")'> 392:     int id</pre>
<pre id='line392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line393")'> 393:     int offset</pre>
<pre id='line393' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line394")'> 394:     int length</pre>
<pre id='line394' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line395")'> 395: </pre>
<pre id='line395' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line396")'> 396: </pre>
<pre id='line396' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line397")'> 397: cdef class Coef_components:</pre>
<pre id='line397' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":397
 * 
 * 
 * cdef class Coef_components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int num_components
 *     cdef Coef_component* _components
 */
struct __pyx_obj_17shift_calculators_Coef_components {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Coef_components *__pyx_vtab;
  int num_components;
  struct __pyx_t_17shift_calculators_Coef_component *_components;
  int num_ids;
  struct __pyx_t_17shift_calculators_Component_Offsets *_component_offsets;
};


/* "Cython_shift_calculator.pyx":397
 * 
 * 
 * cdef class Coef_components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int num_components
 *     cdef Coef_component* _components
 */

struct __pyx_vtabstruct_17shift_calculators_Coef_components {
  struct __pyx_t_17shift_calculators_Component_Offsets *(*get_id_offsets)(struct __pyx_obj_17shift_calculators_Coef_components *, int);
  struct __pyx_t_17shift_calculators_Coef_component *(*get_component)(struct __pyx_obj_17shift_calculators_Coef_components *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Coef_components *__pyx_vtabptr_17shift_calculators_Coef_components;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line398")'> 398:     cdef int num_components</pre>
<pre id='line398' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line399")'> 399:     cdef Coef_component* _components</pre>
<pre id='line399' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line400")'> 400:     cdef int num_ids</pre>
<pre id='line400' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line401")'> 401:     cdef Component_Offsets* _component_offsets</pre>
<pre id='line401' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line402")'> 402: </pre>
<pre id='line402' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line403")'> 403: </pre>
<pre id='line403' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line404")'> 404:     def __cinit__(self, object components):</pre>
<pre id='line404' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":404
 * 
 * 
 *     def __cinit__(self, object components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.num_components = len(components)
 *         self._components = <code><</code>Coef_component *>malloc( self.num_components * sizeof(Coef_component))
 */

static int __pyx_pf_17shift_calculators_15Coef_components___cinit__(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_v_ids = NULL;
  PyObject *__pyx_v_id = NULL;
  PyObject *__pyx_v_start = NULL;
  PyObject *__pyx_v_end = NULL;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line405")'> 405:         self.num_components = len(components)</pre>
<pre id='line405' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":405
 * 
 *     def __cinit__(self, object components):
 *         self.num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = <code><</code>Coef_component *>malloc( self.num_components * sizeof(Coef_component))
 *         if not self._components:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line406")'> 406:         self._components = &lt;Coef_component *&gt;malloc( self.num_components * sizeof(Coef_component))</pre>
<pre id='line406' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":406
 *     def __cinit__(self, object components):
 *         self.num_components = len(components)
 *         self._components = <code><</code>Coef_component *>malloc( self.num_components * sizeof(Coef_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not self._components:
 *             raise MemoryError()
 */
  __pyx_v_self->_components = ((struct __pyx_t_17shift_calculators_Coef_component *)malloc((__pyx_v_self->num_components * (sizeof(struct __pyx_t_17shift_calculators_Coef_component)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line407")'> 407:         if not self._components:</pre>
<pre id='line407' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":407
 *         self.num_components = len(components)
 *         self._components = <code><</code>Coef_component *>malloc( self.num_components * sizeof(Coef_component))
 *         if not self._components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError()
 * 
 */
  __pyx_t_2 = (!(__pyx_v_self->_components != 0));
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line408")'> 408:             raise MemoryError()</pre>
<pre id='line408' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":408
 *         self._components = <code><</code>Coef_component *>malloc( self.num_components * sizeof(Coef_component))
 *         if not self._components:
 *             raise MemoryError()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self. num_ids = len(components.get_component_atom_ids())
 */
    <span class='py_c_api'>PyErr_NoMemory</span>();<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line409")'> 409: </pre>
<pre id='line409' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line410")'> 410:         self. num_ids = len(components.get_component_atom_ids())</pre>
<pre id='line410' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":410
 *             raise MemoryError()
 * 
 *         self. num_ids = len(components.get_component_atom_ids())             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._component_offsets =  <code><</code>Component_Offsets*>malloc(self.num_ids * sizeof(Coef_component))
 *         if not self._component_offsets:
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_components, __pyx_n_s_14);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_self->num_ids = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line411")'> 411:         self._component_offsets =  &lt;Component_Offsets*&gt;malloc(self.num_ids * sizeof(Coef_component))</pre>
<pre id='line411' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":411
 * 
 *         self. num_ids = len(components.get_component_atom_ids())
 *         self._component_offsets =  <code><</code>Component_Offsets*>malloc(self.num_ids * sizeof(Coef_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not self._component_offsets:
 *             raise MemoryError()
 */
  __pyx_v_self->_component_offsets = ((struct __pyx_t_17shift_calculators_Component_Offsets *)malloc((__pyx_v_self->num_ids * (sizeof(struct __pyx_t_17shift_calculators_Coef_component)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line412")'> 412:         if not self._component_offsets:</pre>
<pre id='line412' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":412
 *         self. num_ids = len(components.get_component_atom_ids())
 *         self._component_offsets =  <code><</code>Component_Offsets*>malloc(self.num_ids * sizeof(Coef_component))
 *         if not self._component_offsets:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError()
 * 
 */
  __pyx_t_2 = (!(__pyx_v_self->_component_offsets != 0));
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line413")'> 413:             raise MemoryError()</pre>
<pre id='line413' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":413
 *         self._component_offsets =  <code><</code>Component_Offsets*>malloc(self.num_ids * sizeof(Coef_component))
 *         if not self._component_offsets:
 *             raise MemoryError()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.num_components = len(components)
 */
    <span class='py_c_api'>PyErr_NoMemory</span>();<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line414")'> 414: </pre>
<pre id='line414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line415")'> 415:         self.num_components = len(components)</pre>
<pre id='line415' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":415
 *             raise MemoryError()
 * 
 *         self.num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._components[i].atom_type_id = component[0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line416")'> 416:         for i,component in enumerate(components):</pre>
<pre id='line416' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":416
 * 
 *         self.num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._components[i].atom_type_id = component[0]
 *             self._components[i].ring_id = component[1]
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_4 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_6 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_6)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_6;
    __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_4;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_4, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4);
    __pyx_t_4 = __pyx_t_6;
    __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line417")'> 417:             self._components[i].atom_type_id = component[0]</pre>
<pre id='line417' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":417
 *         self.num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._components[i].atom_type_id = component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._components[i].ring_id = component[1]
 *             self._components[i].coefficient = component[2]
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_components[__pyx_t_8]).atom_type_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line418")'> 418:             self._components[i].ring_id = component[1]</pre>
<pre id='line418' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":418
 *         for i,component in enumerate(components):
 *             self._components[i].atom_type_id = component[0]
 *             self._components[i].ring_id = component[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._components[i].coefficient = component[2]
 * 
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_components[__pyx_t_8]).ring_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line419")'> 419:             self._components[i].coefficient = component[2]</pre>
<pre id='line419' class='code' style='background-color: #FFFF48'>
    /* "Cython_shift_calculator.pyx":419
 *             self._components[i].atom_type_id = component[0]
 *             self._components[i].ring_id = component[1]
 *             self._components[i].coefficient = component[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_9 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_components[__pyx_t_8]).coefficient = __pyx_t_9;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line420")'> 420: </pre>
<pre id='line420' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line421")'> 421: </pre>
<pre id='line421' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line422")'> 422:         ids =  components.get_component_atom_ids()</pre>
<pre id='line422' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":422
 * 
 * 
 *         ids =  components.get_component_atom_ids()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,id in enumerate(ids):
 *             start,end = components.get_component_range(id)
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_components, __pyx_n_s_14);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_ids = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line423")'> 423:         for i,id in enumerate(ids):</pre>
<pre id='line423' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":423
 * 
 *         ids =  components.get_component_atom_ids()
 *         for i,id in enumerate(ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start,end = components.get_component_range(id)
 *             self._component_offsets[i].id = id
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_3 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_ids)) {
    __pyx_t_4 = __pyx_v_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_ids);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_5 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_4, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_6 = __pyx_t_5(__pyx_t_4);
      if (unlikely(!__pyx_t_6)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_id);
    __pyx_v_id = __pyx_t_6;
    __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3);
    __pyx_t_3 = __pyx_t_6;
    __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line424")'> 424:             start,end = components.get_component_range(id)</pre>
<pre id='line424' class='code' style='background-color: #FFFF20'>
    /* "Cython_shift_calculator.pyx":424
 *         ids =  components.get_component_atom_ids()
 *         for i,id in enumerate(ids):
 *             start,end = components.get_component_range(id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._component_offsets[i].id = id
 *             self._component_offsets[i].offset = start
 */
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_components, __pyx_n_s__get_component_range);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_id);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_v_id);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_id);
    __pyx_t_11 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_10), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_11))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_11))) {
      PyObject* sequence = __pyx_t_11;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size > 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else if (size >= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
        __pyx_t_10 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
        __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
      } else {
        __pyx_t_10 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      #else
      __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    } else
    {
      Py_ssize_t index = -1;
      __pyx_t_12 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_13 = Py_TYPE(__pyx_t_12)->tp_iternext;
      index = 0; __pyx_t_10 = __pyx_t_13(__pyx_t_12); if (unlikely(!__pyx_t_10)) goto __pyx_L9_unpacking_failed;
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      index = 1; __pyx_t_6 = __pyx_t_13(__pyx_t_12); if (unlikely(!__pyx_t_6)) goto __pyx_L9_unpacking_failed;
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_13(__pyx_t_12), 2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_13 = NULL;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      goto __pyx_L10_unpacking_done;
      __pyx_L9_unpacking_failed:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_13 = NULL;
      if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_L10_unpacking_done:;
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_start);
    __pyx_v_start = __pyx_t_10;
    __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_end);
    __pyx_v_end = __pyx_t_6;
    __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line425")'> 425:             self._component_offsets[i].id = id</pre>
<pre id='line425' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":425
 *         for i,id in enumerate(ids):
 *             start,end = components.get_component_range(id)
 *             self._component_offsets[i].id = id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._component_offsets[i].offset = start
 *             self._component_offsets[i].length = end-start
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_id);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_component_offsets[__pyx_t_8]).id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line426")'> 426:             self._component_offsets[i].offset = start</pre>
<pre id='line426' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":426
 *             start,end = components.get_component_range(id)
 *             self._component_offsets[i].id = id
 *             self._component_offsets[i].offset = start             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._component_offsets[i].length = end-start
 * 
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_start);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_component_offsets[__pyx_t_8]).offset = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line427")'> 427:             self._component_offsets[i].length = end-start</pre>
<pre id='line427' class='code' style='background-color: #FFFF21'>
    /* "Cython_shift_calculator.pyx":427
 *             self._component_offsets[i].id = id
 *             self._component_offsets[i].offset = start
 *             self._component_offsets[i].length = end-start             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_end, __pyx_v_start);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_component_offsets[__pyx_t_8]).length = __pyx_t_7;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ids);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_id);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_start);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_end);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_15Coef_components_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_15Coef_components_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_components = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 430; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_components = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 430; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_15Coef_components_2__init__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self), __pyx_v_components);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line428")'> 428: </pre>
<pre id='line428' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line429")'> 429: </pre>
<pre id='line429' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line430")'> 430:     def __init__ (self, object components):</pre>
<pre id='line430' class='code' style='background-color: #FFFFe7'>
/* "Cython_shift_calculator.pyx":430
 * 
 * 
 *     def __init__ (self, object components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static int __pyx_pf_17shift_calculators_15Coef_components_2__init__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_components) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line431")'> 431:         pass</pre>
<pre id='line431' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line432")'> 432: </pre>
<pre id='line432' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line433")'> 433: </pre>
<pre id='line433' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line434")'> 434:     cdef inline Component_Offsets* get_id_offsets(self,int id):</pre>
<pre id='line434' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":434
 * 
 * 
 *     cdef inline Component_Offsets* get_id_offsets(self,int id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return &self._component_offsets[id]
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_f_17shift_calculators_15Coef_components_get_id_offsets(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, int __pyx_v_id) {
  struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_id_offsets", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line435")'> 435:         return &amp;self._component_offsets[id]</pre>
<pre id='line435' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":435
 * 
 *     cdef inline Component_Offsets* get_id_offsets(self,int id):
 *         return &self._component_offsets[id]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
  __pyx_r = (&(__pyx_v_self->_component_offsets[__pyx_v_id]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_15Coef_components_5__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_15Coef_components_5__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_15Coef_components_4__dealloc__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line436")'> 436: </pre>
<pre id='line436' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line437")'> 437:     def __dealloc__(self):</pre>
<pre id='line437' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":437
 *         return &self._component_offsets[id]
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

static void __pyx_pf_17shift_calculators_15Coef_components_4__dealloc__(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line438")'> 438: </pre>
<pre id='line438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line439")'> 439: </pre>
<pre id='line439' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line440")'> 440: </pre>
<pre id='line440' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line441")'> 441:         if self._components != NULL:</pre>
<pre id='line441' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":441
 * 
 * 
 *         if self._components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._components)
 *             self._components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line442")'> 442:             free(self._components)</pre>
<pre id='line442' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":442
 * 
 *         if self._components != NULL:
 *             free(self._components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._components = NULL
 *             self.num_components = 0
 */
    free(__pyx_v_self->_components);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line443")'> 443:             self._components = NULL</pre>
<pre id='line443' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":443
 *         if self._components != NULL:
 *             free(self._components)
 *             self._components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self.num_components = 0
 * 
 */
    __pyx_v_self->_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line444")'> 444:             self.num_components = 0</pre>
<pre id='line444' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":444
 *             free(self._components)
 *             self._components = NULL
 *             self.num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_v_self->num_components = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line445")'> 445: </pre>
<pre id='line445' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line446")'> 446: </pre>
<pre id='line446' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line447")'> 447:         if self._component_offsets != NULL:</pre>
<pre id='line447' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":447
 * 
 * 
 *         if self._component_offsets != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._component_offsets)
 *             self._component_offsets =  NULL
 */
  __pyx_t_1 = (__pyx_v_self->_component_offsets != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line448")'> 448:             free(self._component_offsets)</pre>
<pre id='line448' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":448
 * 
 *         if self._component_offsets != NULL:
 *             free(self._component_offsets)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._component_offsets =  NULL
 *             self.num_ids = 0
 */
    free(__pyx_v_self->_component_offsets);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line449")'> 449:             self._component_offsets =  NULL</pre>
<pre id='line449' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":449
 *         if self._component_offsets != NULL:
 *             free(self._component_offsets)
 *             self._component_offsets =  NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self.num_ids = 0
 * 
 */
    __pyx_v_self->_component_offsets = NULL;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line450")'> 450:             self.num_ids = 0</pre>
<pre id='line450' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":450
 *             free(self._component_offsets)
 *             self._component_offsets =  NULL
 *             self.num_ids = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_v_self->num_ids = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line451")'> 451: </pre>
<pre id='line451' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line452")'> 452: </pre>
<pre id='line452' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line453")'> 453: #    cdef int _check_offset(self, int offset) except -1:</pre>
<pre id='line453' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line454")'> 454: #</pre>
<pre id='line454' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line455")'> 455: #        if not offset &lt; self.num_components:</pre>
<pre id='line455' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line456")'> 456: #            raise IndexError("tried to access object at %i length is %i" % (offset,self._num_components))</pre>
<pre id='line456' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line457")'> 457: #        if self._components is NULL:</pre>
<pre id='line457' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line458")'> 458: #            raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line458' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line459")'> 459: #        return 0</pre>
<pre id='line459' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line460")'> 460: </pre>
<pre id='line460' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line461")'> 461: </pre>
<pre id='line461' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line462")'> 462: </pre>
<pre id='line462' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line463")'> 463:     @cython.profile(False)</pre>
<pre id='line463' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line464")'> 464:     cdef inline Coef_component* get_component(self,int offset):</pre>
<pre id='line464' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":464
 * 
 *     @cython.profile(False)
 *     cdef inline Coef_component* get_component(self,int offset):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_offset(offset)
 *         return &self._components[offset]
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_Coef_component *__pyx_f_17shift_calculators_15Coef_components_get_component(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, int __pyx_v_offset) {
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_component", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line465")'> 465: #        self._check_offset(offset)</pre>
<pre id='line465' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line466")'> 466:         return &amp;self._components[offset]</pre>
<pre id='line466' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":466
 *     cdef inline Coef_component* get_component(self,int offset):
 * #        self._check_offset(offset)
 *         return &self._components[offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef struct ring_atom_ids:
 */
  __pyx_r = (&(__pyx_v_self->_components[__pyx_v_offset]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line467")'> 467: </pre>
<pre id='line467' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line468")'> 468: cdef struct ring_atom_ids:</pre>
<pre id='line468' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":468
 *         return &self._components[offset]
 * 
 * cdef struct ring_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int num_atoms
 *     int[6] atom_ids
 */
struct __pyx_t_17shift_calculators_ring_atom_ids {
  int num_atoms;
  int atom_ids[6];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line469")'> 469:     int num_atoms</pre>
<pre id='line469' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line470")'> 470:     int[6] atom_ids</pre>
<pre id='line470' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line471")'> 471: </pre>
<pre id='line471' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line472")'> 472: </pre>
<pre id='line472' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line473")'> 473: </pre>
<pre id='line473' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line474")'> 474: </pre>
<pre id='line474' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line475")'> 475: </pre>
<pre id='line475' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line476")'> 476: </pre>
<pre id='line476' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line477")'> 477: cdef struct dihedral_parameters:</pre>
<pre id='line477' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":477
 * 
 * 
 * cdef struct dihedral_parameters:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     float param_0
 *     float param_1
 */
struct __pyx_t_17shift_calculators_dihedral_parameters {
  float param_0;
  float param_1;
  float param_2;
  float param_3;
  float param_4;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line478")'> 478:     float param_0</pre>
<pre id='line478' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line479")'> 479:     float param_1</pre>
<pre id='line479' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line480")'> 480:     float param_2</pre>
<pre id='line480' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line481")'> 481:     float param_3</pre>
<pre id='line481' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line482")'> 482:     float param_4</pre>
<pre id='line482' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line483")'> 483: </pre>
<pre id='line483' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line484")'> 484: </pre>
<pre id='line484' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line485")'> 485: #cdef float sum(Vec3 vec3):</pre>
<pre id='line485' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line486")'> 486: #    return vec3.x()+vec3.y()+vec3.z()</pre>
<pre id='line486' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line487")'> 487: </pre>
<pre id='line487' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line488")'> 488: </pre>
<pre id='line488' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line489")'> 489: @cython.profile(False)</pre>
<pre id='line489' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line490")'> 490: cdef inline void operator_times (Vec3&amp; vec3, float scale):</pre>
<pre id='line490' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":490
 * 
 * @cython.profile(False)
 * cdef inline void operator_times (Vec3& vec3, float scale):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_operator_times(Vec3 &__pyx_v_vec3, float __pyx_v_scale) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("operator_times", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line491")'> 491:      vec3[0] =  vec3[0] * scale</pre>
<pre id='line491' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":491
 * @cython.profile(False)
 * cdef inline void operator_times (Vec3& vec3, float scale):
 *      vec3[0] =  vec3[0] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[1] =  vec3[1] * scale
 *      vec3[2] =  vec3[2] * scale
 */
  (__pyx_v_vec3[0]) = ((__pyx_v_vec3[0]) * __pyx_v_scale);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line492")'> 492:      vec3[1] =  vec3[1] * scale</pre>
<pre id='line492' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":492
 * cdef inline void operator_times (Vec3& vec3, float scale):
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[2] =  vec3[2] * scale
 * 
 */
  (__pyx_v_vec3[1]) = ((__pyx_v_vec3[1]) * __pyx_v_scale);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line493")'> 493:      vec3[2] =  vec3[2] * scale</pre>
<pre id='line493' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":493
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale
 *      vec3[2] =  vec3[2] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * @cython.profile(False)
 */
  (__pyx_v_vec3[2]) = ((__pyx_v_vec3[2]) * __pyx_v_scale);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line494")'> 494: </pre>
<pre id='line494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line495")'> 495: @cython.profile(False)</pre>
<pre id='line495' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line496")'> 496: cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, int atom_index_2):</pre>
<pre id='line496' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":496
 * 
 * @cython.profile(False)
 * cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, int atom_index_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_calc_distance_simulation(Simulation *__pyx_v_sim, int __pyx_v_atom_index_1, int __pyx_v_atom_index_2) {
  Vec3 __pyx_v_vec1;
  Vec3 __pyx_v_vec2;
  Vec3 __pyx_v_result;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("calc_distance_simulation", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line497")'> 497: </pre>
<pre id='line497' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line498")'> 498:     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)</pre>
<pre id='line498' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":498
 * cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, int atom_index_2):
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1
 */
  __pyx_v_vec1 = (__pyx_v_sim[0]).atomPos(__pyx_v_atom_index_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line499")'> 499:     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)</pre>
<pre id='line499' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":499
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3 result =  vec2 - vec1
 *     return norm(result)
 */
  __pyx_v_vec2 = (__pyx_v_sim[0]).atomPos(__pyx_v_atom_index_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line500")'> 500:     cdef Vec3 result =  vec2 - vec1</pre>
<pre id='line500' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":500
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return norm(result)
 * 
 */
  __pyx_v_result = (__pyx_v_vec2 - __pyx_v_vec1);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line501")'> 501:     return norm(result)</pre>
<pre id='line501' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":501
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1
 *     return norm(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = norm(__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line502")'> 502: </pre>
<pre id='line502' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line503")'> 503: </pre>
<pre id='line503' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line504")'> 504: </pre>
<pre id='line504' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line505")'> 505: #</pre>
<pre id='line505' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line506")'> 506: #</pre>
<pre id='line506' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line507")'> 507: #cdef inline bint distance_less_than(int atom_index_1, atom_index_2, float target):</pre>
<pre id='line507' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line508")'> 508: #    cdef float total = 0.0</pre>
<pre id='line508' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line509")'> 509: #    cdef float diff</pre>
<pre id='line509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line510")'> 510: #    cdef float target2  = target*target</pre>
<pre id='line510' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line511")'> 511: #</pre>
<pre id='line511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line512")'> 512: #    cdef Vec3 vec1 = currentSimulation().atomPosArr().data(atom_index_1)</pre>
<pre id='line512' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line513")'> 513: #    cdef Vec3 vec2 = currentSimulation().atomPosArr().data(atom_index_2)</pre>
<pre id='line513' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line514")'> 514: #    cdef bint result  =  True</pre>
<pre id='line514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line515")'> 515: #    for i in range(3):</pre>
<pre id='line515' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line516")'> 516: #        diff = vec1[i] - vec2[i]</pre>
<pre id='line516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line517")'> 517: #        total += diff * diff</pre>
<pre id='line517' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line518")'> 518: #</pre>
<pre id='line518' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line519")'> 519: #        if total &gt; target2:</pre>
<pre id='line519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line520")'> 520: #            result = False</pre>
<pre id='line520' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line521")'> 521: #            break</pre>
<pre id='line521' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line522")'> 522: #    return result</pre>
<pre id='line522' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line523")'> 523: </pre>
<pre id='line523' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line524")'> 524: </pre>
<pre id='line524' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line525")'> 525: </pre>
<pre id='line525' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line526")'> 526: </pre>
<pre id='line526' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line527")'> 527: </pre>
<pre id='line527' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line528")'> 528: #TODO how does currentSimulation().atomByID work inside</pre>
<pre id='line528' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line529")'> 529: @cython.profile(False)</pre>
<pre id='line529' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line530")'> 530: cdef inline float calc_dihedral_angle_simulation(Simulation* simulation, dihedral_ids dihedral_atom_ids):</pre>
<pre id='line530' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":530
 * #TODO how does currentSimulation().atomByID work inside
 * @cython.profile(False)
 * cdef inline float calc_dihedral_angle_simulation(Simulation* simulation, dihedral_ids dihedral_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(Simulation *__pyx_v_simulation, struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids) {
  Atom __pyx_v_atom_1;
  Atom __pyx_v_atom_2;
  Atom __pyx_v_atom_3;
  Atom __pyx_v_atom_4;
  double __pyx_v_result;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("calc_dihedral_angle_simulation", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line531")'> 531: </pre>
<pre id='line531' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line532")'> 532: </pre>
<pre id='line532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line533")'> 533: </pre>
<pre id='line533' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line534")'> 534:     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)</pre>
<pre id='line534' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":534
 * 
 * 
 *     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 */
  __pyx_v_atom_1 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line535")'> 535:     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)</pre>
<pre id='line535' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":535
 * 
 *     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 */
  __pyx_v_atom_2 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line536")'> 536:     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)</pre>
<pre id='line536' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":536
 *     cdef Atom atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 * 
 */
  __pyx_v_atom_3 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line537")'> 537:     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)</pre>
<pre id='line537' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":537
 *     cdef Atom atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     cdef Atom atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()
 */
  __pyx_v_atom_4 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line538")'> 538: </pre>
<pre id='line538' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line539")'> 539:     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()</pre>
<pre id='line539' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":539
 *     cdef Atom atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 * 
 *     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return result
 * 
 */
  __pyx_v_result = Dihedral(__pyx_v_atom_1, __pyx_v_atom_2, __pyx_v_atom_3, __pyx_v_atom_4).value();
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line540")'> 540:     return result</pre>
<pre id='line540' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":540
 * 
 *     cdef double result = Dihedral(atom_1,atom_2,atom_3,atom_4).value()
 *     return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_21Base_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_21Base_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 553; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_name = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 553; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line541")'> 541: </pre>
<pre id='line541' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line542")'> 542: </pre>
<pre id='line542' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line543")'> 543: </pre>
<pre id='line543' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line544")'> 544: cdef float DEFAULT_CUTOFF = 5.0</pre>
<pre id='line544' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":544
 * 
 * 
 * cdef float DEFAULT_CUTOFF = 5.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 */
  __pyx_v_17shift_calculators_DEFAULT_CUTOFF = 5.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line545")'> 545: cdef float DEFAULT_SMOOTHING_FACTOR = 1.0</pre>
<pre id='line545' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":545
 * 
 * cdef float DEFAULT_CUTOFF = 5.0
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 */
  __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line546")'> 546: cdef float DEFAULT_NB_CUTOFF = 5.0</pre>
<pre id='line546' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":546
 * cdef float DEFAULT_CUTOFF = 5.0
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0
 * cdef float DEFAULT_NB_CUTOFF = 5.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Base_shift_calculator:
 */
  __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF = 5.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line547")'> 547: </pre>
<pre id='line547' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line548")'> 548: cdef class Base_shift_calculator:</pre>
<pre id='line548' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":548
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 * cdef class Base_shift_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef str _name
 */
struct __pyx_obj_17shift_calculators_Base_shift_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator *__pyx_vtab;
  int _verbose;
  PyObject *_name;
  Simulation *_simulation;
};


/* "Cython_shift_calculator.pyx":548
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 * cdef class Base_shift_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef str _name
 */

struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator {
  void (*set_simulation)(struct __pyx_obj_17shift_calculators_Base_shift_calculator *);
};
static struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator *__pyx_vtabptr_17shift_calculators_Base_shift_calculator;
static CYTHON_INLINE void __pyx_f_17shift_calculators_21Base_shift_calculator_set_simulation(struct __pyx_obj_17shift_calculators_Base_shift_calculator *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line549")'> 549:     cdef bint _verbose</pre>
<pre id='line549' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line550")'> 550:     cdef str _name</pre>
<pre id='line550' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line551")'> 551:     cdef Simulation* _simulation</pre>
<pre id='line551' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line552")'> 552: </pre>
<pre id='line552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line553")'> 553:     def __init__(self, str name):</pre>
<pre id='line553' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":553
 *     cdef Simulation* _simulation
 * 
 *     def __init__(self, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._verbose = False
 *             self._name = name
 */

static int __pyx_pf_17shift_calculators_21Base_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line554")'> 554:             self._verbose = False</pre>
<pre id='line554' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":554
 * 
 *     def __init__(self, str name):
 *             self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._name = name
 *             self._simulation =  currentSimulation()
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line555")'> 555:             self._name = name</pre>
<pre id='line555' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":555
 *     def __init__(self, str name):
 *             self._verbose = False
 *             self._name = name             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._simulation =  currentSimulation()
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_name);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_name));
  __pyx_v_self->_name = __pyx_v_name;
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line556")'> 556:             self._simulation =  currentSimulation()</pre>
<pre id='line556' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":556
 *             self._verbose = False
 *             self._name = name
 *             self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
  int __pyx_v_state;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  assert(__pyx_arg_state); {
    __pyx_v_state = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_arg_state);<span class='error_goto'> if (unlikely((__pyx_v_state == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), ((int)__pyx_v_state));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line557")'> 557: </pre>
<pre id='line557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line558")'> 558: </pre>
<pre id='line558' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line559")'> 559:     def set_verbose(self,bint state):</pre>
<pre id='line559' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":559
 * 
 * 
 *     def set_verbose(self,bint state):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  state
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_shift_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, int __pyx_v_state) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line560")'> 560:         self._verbose =  state</pre>
<pre id='line560' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":560
 * 
 *     def set_verbose(self,bint state):
 *         self._verbose =  state             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void set_simulation(self):
 */
  __pyx_v_self->_verbose = __pyx_v_state;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line561")'> 561: </pre>
<pre id='line561' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line562")'> 562:     cdef inline void set_simulation(self):</pre>
<pre id='line562' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":562
 *         self._verbose =  state
 * 
 *     cdef inline void set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 * 
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_21Base_shift_calculator_set_simulation(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line563")'> 563:         self._simulation = currentSimulation()</pre>
<pre id='line563' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":563
 * 
 *     cdef inline void set_simulation(self):
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _prepare(self,change,data):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_5_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_5_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 565; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 565; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 565; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator_4_prepare(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line564")'> 564: </pre>
<pre id='line564' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line565")'> 565:     def _prepare(self,change,data):</pre>
<pre id='line565' class='code' style='background-color: #FFFF6a'>
/* "Cython_shift_calculator.pyx":565
 *         self._simulation = currentSimulation()
 * 
 *     def _prepare(self,change,data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_shift_calculator_4_prepare(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line566")'> 566:         pass</pre>
<pre id='line566' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line567")'> 567: </pre>
<pre id='line567' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line568")'> 568: </pre>
<pre id='line568' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line569")'> 569: </pre>
<pre id='line569' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line570")'> 570: cdef class Fast_distance_shift_calculator(Base_shift_calculator):</pre>
<pre id='line570' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":570
 * 
 * 
 * cdef class Fast_distance_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  int _target_atom_index;
  int _distance_atom_index_1;
  int _distance_atom_index_2;
  int _exponent_index;
  int _coefficient_index;
  int _smoothed;
  float _smoothing_factor;
  float _cutoff;
  struct __pyx_t_17shift_calculators_Distance_component *_compiled_components;
  int _num_components;
};


/* "Cython_shift_calculator.pyx":570
 * 
 * 
 * cdef class Fast_distance_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  void (*_free_compiled_components)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *);
  void (*_compile_components)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, PyObject *);
  struct __pyx_t_17shift_calculators_target_distant_atom (*_get_target_and_distant_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_coefficient_exponent (*_get_coefficient_and_exponent)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_distance_shift_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line571")'> 571: </pre>
<pre id='line571' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line572")'> 572: </pre>
<pre id='line572' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line573")'> 573:     cdef int _target_atom_index</pre>
<pre id='line573' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line574")'> 574:     cdef int _distance_atom_index_1</pre>
<pre id='line574' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line575")'> 575:     cdef int _distance_atom_index_2</pre>
<pre id='line575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line576")'> 576:     cdef int _exponent_index</pre>
<pre id='line576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line577")'> 577:     cdef int _coefficient_index</pre>
<pre id='line577' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line578")'> 578:     cdef bint _smoothed</pre>
<pre id='line578' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line579")'> 579:     cdef float _smoothing_factor</pre>
<pre id='line579' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line580")'> 580:     cdef float _cutoff</pre>
<pre id='line580' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line581")'> 581: </pre>
<pre id='line581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line582")'> 582:     cdef Distance_component* _compiled_components</pre>
<pre id='line582' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line583")'> 583:     cdef int _num_components</pre>
<pre id='line583' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line584")'> 584: </pre>
<pre id='line584' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line585")'> 585:     def __cinit__(self):</pre>
<pre id='line585' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":585
 *     cdef int _num_components
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components  = NULL
 *         self._num_components =  0
 */

static int __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line586")'> 586:         self._compiled_components  = NULL</pre>
<pre id='line586' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":586
 * 
 *     def __cinit__(self):
 *         self._compiled_components  = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line587")'> 587:         self._num_components =  0</pre>
<pre id='line587' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":587
 *     def __cinit__(self):
 *         self._compiled_components  = NULL
 *         self._num_components =  0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_3__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_3__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_2__dealloc__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line588")'> 588: </pre>
<pre id='line588' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line589")'> 589:     def __dealloc__(self):</pre>
<pre id='line589' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":589
 *         self._num_components =  0
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._free_compiled_components()
 */

static void __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_2__dealloc__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line590")'> 590: </pre>
<pre id='line590' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line591")'> 591:         self._free_compiled_components()</pre>
<pre id='line591' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":591
 *     def __dealloc__(self):
 * 
 *         self._free_compiled_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _free_compiled_components(self):
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_free_compiled_components(__pyx_v_self);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line592")'> 592: </pre>
<pre id='line592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line593")'> 593:     cdef void _free_compiled_components(self):</pre>
<pre id='line593' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":593
 *         self._free_compiled_components()
 * 
 *     cdef void _free_compiled_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)
 */

static void __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__free_compiled_components(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line594")'> 594:         if self._compiled_components != NULL:</pre>
<pre id='line594' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":594
 * 
 *     cdef void _free_compiled_components(self):
 *         if self._compiled_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free (self._compiled_components)
 *             self._compiled_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line595")'> 595:             free (self._compiled_components)</pre>
<pre id='line595' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":595
 *     cdef void _free_compiled_components(self):
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_components);
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line596")'> 596:             self._compiled_components = NULL</pre>
<pre id='line596' class='code' style='background-color: #FFFF3b'>
    /* "Cython_shift_calculator.pyx":596
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)
 *             self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _prepare(self, change, data):
 */
    __pyx_v_self->_compiled_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_5_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_5_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_4_prepare(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line597")'> 597: </pre>
<pre id='line597' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line598")'> 598:     def _prepare(self, change, data):</pre>
<pre id='line598' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":598
 *             self._compiled_components = NULL
 * 
 *     def _prepare(self, change, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_4_prepare(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line599")'> 599:         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:</pre>
<pre id='line599' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":599
 * 
 *     def _prepare(self, change, data):
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *              self._free_compiled_components()
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_1, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_3) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_2, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF2c' onclick='toggleDiv("line600")'> 600:              self._free_compiled_components()</pre>
<pre id='line600' class='code' style='background-color: #FFFF2c'>
    /* "Cython_shift_calculator.pyx":600
 *     def _prepare(self, change, data):
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, indices, smoothed, str name = "not set"):
 */
    ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_free_compiled_components(__pyx_v_self);
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_7__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_7__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  PyObject *__pyx_v_smoothed = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject*)__pyx_kp_s_16);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = values[1];
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_6__init__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line601")'> 601: </pre>
<pre id='line601' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line602")'> 602:     def __init__(self, indices, smoothed, str name = "not set"):</pre>
<pre id='line602' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":602
 *              self._free_compiled_components()
 * 
 *     def __init__(self, indices, smoothed, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self, name)
 *         self._target_atom_index = indices.target_atom_index
 */

static int __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_6__init__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_indices, PyObject *__pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line603")'> 603:         Base_shift_calculator.__init__(self, name)</pre>
<pre id='line603' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":603
 * 
 *     def __init__(self, indices, smoothed, str name = "not set"):
 *         Base_shift_calculator.__init__(self, name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line604")'> 604:         self._target_atom_index = indices.target_atom_index</pre>
<pre id='line604' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":604
 *     def __init__(self, indices, smoothed, str name = "not set"):
 *         Base_shift_calculator.__init__(self, name)
 *         self._target_atom_index = indices.target_atom_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices.distance_atom_index_2
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__target_atom_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_target_atom_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line605")'> 605:         self._distance_atom_index_1 =  indices.distance_atom_index_1</pre>
<pre id='line605' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":605
 *         Base_shift_calculator.__init__(self, name)
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_2 =  indices.distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_17);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_1 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line606")'> 606:         self._distance_atom_index_2 =  indices.distance_atom_index_2</pre>
<pre id='line606' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":606
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices.distance_atom_index_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_2 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line607")'> 607:         self._exponent_index  = indices.exponent_index</pre>
<pre id='line607' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":607
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices.distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coefficient_index  = indices.coefficient_index
 * 
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__exponent_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_exponent_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line608")'> 608:         self._coefficient_index  = indices.coefficient_index</pre>
<pre id='line608' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":608
 *         self._distance_atom_index_2 =  indices.distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._smoothed =  smoothed
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__coefficient_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 608; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 608; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_coefficient_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line609")'> 609: </pre>
<pre id='line609' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line610")'> 610:         self._smoothed =  smoothed</pre>
<pre id='line610' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":610
 *         self._coefficient_index  = indices.coefficient_index
 * 
 *         self._smoothed =  smoothed             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 * #
 */
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_smoothed = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line611")'> 611:         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR</pre>
<pre id='line611' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":611
 * 
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         self._cutoff =  DEFAULT_CUTOFF
 */
  __pyx_v_self->_smoothing_factor = __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line612")'> 612: #</pre>
<pre id='line612' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line613")'> 613:         self._cutoff =  DEFAULT_CUTOFF</pre>
<pre id='line613' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":613
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 * #
 *         self._cutoff =  DEFAULT_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 * #    def set_cutoff(self, cutoff):
 */
  __pyx_v_self->_cutoff = __pyx_v_17shift_calculators_DEFAULT_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_9_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_9_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_8_set_components(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line614")'> 614: #</pre>
<pre id='line614' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line615")'> 615: #    def set_cutoff(self, cutoff):</pre>
<pre id='line615' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line616")'> 616: #        self._cutoff =  cutoff</pre>
<pre id='line616' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line617")'> 617: #</pre>
<pre id='line617' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line618")'> 618: #    def set_smoothing_factor(self,smoothing_factor):</pre>
<pre id='line618' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line619")'> 619: #        self._smoothing_factor = smoothing_factor</pre>
<pre id='line619' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line620")'> 620: #</pre>
<pre id='line620' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line621")'> 621: #    TODO: this needs to be removed</pre>
<pre id='line621' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line622")'> 622: </pre>
<pre id='line622' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line623")'> 623: </pre>
<pre id='line623' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line624")'> 624:     def _set_components(self,components):</pre>
<pre id='line624' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":624
 * 
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_8_set_components(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line625")'> 625:         if  self._compiled_components ==  NULL:</pre>
<pre id='line625' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":625
 * 
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line626")'> 626:             self._compile_components(components)</pre>
<pre id='line626' class='code' style='background-color: #FFFFd4'>
    /* "Cython_shift_calculator.pyx":626
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_compile_components(__pyx_v_self, __pyx_v_components);
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line627")'> 627: </pre>
<pre id='line627' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line628")'> 628: </pre>
<pre id='line628' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line629")'> 629:     cdef void _compile_components(self,components):</pre>
<pre id='line629' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":629
 * 
 * 
 *     cdef void _compile_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)
 */

static void __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__compile_components(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_component = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line630")'> 630:         self._compiled_components = &lt;Distance_component*&gt;malloc(len(components) * sizeof(Distance_component))</pre>
<pre id='line630' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":630
 * 
 *     cdef void _compile_components(self,components):
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Distance_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Distance_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line631")'> 631:         self._num_components = len(components)</pre>
<pre id='line631' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":631
 *     cdef void _compile_components(self,components):
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line632")'> 632:         for i,component in enumerate(components):</pre>
<pre id='line632' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":632
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line633")'> 633:             self._compiled_components[i].target_atom = components[i][self._target_atom_index]</pre>
<pre id='line633' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":633
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_target_atom_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).target_atom = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line634")'> 634:             if len(component) == 4:</pre>
<pre id='line634' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":634
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = (__pyx_t_8 == 4);
    if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line635")'> 635:                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]</pre>
<pre id='line635' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":635
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_1 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line636")'> 636:                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]</pre>
<pre id='line636' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":636
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_2 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line637")'> 637:                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]</pre>
<pre id='line637' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":637
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_coefficient_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line638")'> 638:                 self._compiled_components[i].exponent      = components[i][self._exponent_index]</pre>
<pre id='line638' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":638
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_exponent_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).exponent = __pyx_t_10;
      goto __pyx_L5;
    }
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line639")'> 639:             elif len(component) == 5:</pre>
<pre id='line639' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":639
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 639; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = (__pyx_t_8 == 5);
    if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line640")'> 640:                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]</pre>
<pre id='line640' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":640
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_1 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line641")'> 641:                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]</pre>
<pre id='line641' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":641
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_2 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line642")'> 642:                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]</pre>
<pre id='line642' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":642
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             else:
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_coefficient_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line643")'> 643:                 self._compiled_components[i].exponent      = components[i][self._exponent_index]</pre>
<pre id='line643' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":643
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_exponent_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).exponent = __pyx_t_10;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line644")'> 644:             else:</pre>
<pre id='line644' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line645")'> 645:                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))</pre>
<pre id='line645' class='code' style='background-color: #FFFF31'>
      /* "Cython_shift_calculator.pyx":645
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             else:
 *                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
      __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_19), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_t_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_distance_shift_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line646")'> 646: </pre>
<pre id='line646' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line647")'> 647:     @cython.profile(False)</pre>
<pre id='line647' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line648")'> 648:     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index):</pre>
<pre id='line648' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":648
 * 
 *     @cython.profile(False)
 *     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef target_distant_atom result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_v_result;
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_target_and_distant_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line649")'> 649:         cdef target_distant_atom result</pre>
<pre id='line649' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line650")'> 650: </pre>
<pre id='line650' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line651")'> 651:         result.target_atom_id = self._compiled_components[index].remote_atom_1</pre>
<pre id='line651' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":651
 *         cdef target_distant_atom result
 * 
 *         result.target_atom_id = self._compiled_components[index].remote_atom_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.distant_atom_id  = self._compiled_components[index].remote_atom_2
 *         return result
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1;
  __pyx_v_result.target_atom_id = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line652")'> 652:         result.distant_atom_id  = self._compiled_components[index].remote_atom_2</pre>
<pre id='line652' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":652
 * 
 *         result.target_atom_id = self._compiled_components[index].remote_atom_1
 *         result.distant_atom_id  = self._compiled_components[index].remote_atom_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2;
  __pyx_v_result.distant_atom_id = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line653")'> 653:         return result</pre>
<pre id='line653' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":653
 *         result.target_atom_id = self._compiled_components[index].remote_atom_1
 *         result.distant_atom_id  = self._compiled_components[index].remote_atom_2
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line654")'> 654: </pre>
<pre id='line654' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line655")'> 655:     @cython.profile(False)</pre>
<pre id='line655' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line656")'> 656:     cdef inline coefficient_exponent _get_coefficient_and_exponent(self, int index):</pre>
<pre id='line656' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":656
 * 
 *     @cython.profile(False)
 *     cdef inline coefficient_exponent _get_coefficient_and_exponent(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef coefficient_exponent result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_result;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coefficient_and_exponent", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line657")'> 657:         cdef coefficient_exponent result</pre>
<pre id='line657' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line658")'> 658: </pre>
<pre id='line658' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line659")'> 659: </pre>
<pre id='line659' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line660")'> 660:         result.coefficient = self._compiled_components[index].coefficient</pre>
<pre id='line660' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":660
 * 
 * 
 *         result.coefficient = self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.exponent = self._compiled_components[index].exponent
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient;
  __pyx_v_result.coefficient = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line661")'> 661:         result.exponent = self._compiled_components[index].exponent</pre>
<pre id='line661' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":661
 * 
 *         result.coefficient = self._compiled_components[index].coefficient
 *         result.exponent = self._compiled_components[index].exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).exponent;
  __pyx_v_result.exponent = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line662")'> 662: </pre>
<pre id='line662' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line663")'> 663:         return result</pre>
<pre id='line663' class='code' style='background-color: #FFFF2d'>
  /* "Cython_shift_calculator.pyx":663
 *         result.exponent = self._compiled_components[index].exponent
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  __Pyx_memviewslice __pyx_v_results = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_results.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_10__call__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line664")'> 664: </pre>
<pre id='line664' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line665")'> 665:     @cython.profile(True)</pre>
<pre id='line665' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line666")'> 666:     def __call__(self, object components, double[:] results, int[:] component_to_target):</pre>
<pre id='line666' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":666
 * 
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef double start_time = 0.0
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_10__call__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, __Pyx_memviewslice __pyx_v_results, __Pyx_memviewslice __pyx_v_component_to_target) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  float __pyx_v_smoothing_factor;
  float __pyx_v_ratio;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_coef_exp;
  int __pyx_v_target_atom_id;
  int __pyx_v_distant_atom_id;
  float __pyx_v_distance;
  int __pyx_v_index;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 666);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line667")'> 667:         self.set_simulation()</pre>
<pre id='line667' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":667
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 */
  __pyx_f_17shift_calculators_21Base_shift_calculator_set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line668")'> 668:         cdef double start_time = 0.0</pre>
<pre id='line668' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":668
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):
 *         self.set_simulation()
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line669")'> 669:         cdef double end_time = 0.0</pre>
<pre id='line669' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":669
 *         self.set_simulation()
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line670")'> 670: </pre>
<pre id='line670' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line671")'> 671:         if self._verbose:</pre>
<pre id='line671' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":671
 *         cdef double end_time = 0.0
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time=time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line672")'> 672:             start_time=time()</pre>
<pre id='line672' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":672
 * 
 *         if self._verbose:
 *             start_time=time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line673")'> 673: </pre>
<pre id='line673' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line674")'> 674:         self._set_components(components)</pre>
<pre id='line674' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":674
 *             start_time=time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float smoothing_factor = self._smoothing_factor
 *         cdef float ratio
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line675")'> 675:         cdef float smoothing_factor = self._smoothing_factor</pre>
<pre id='line675' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":675
 * 
 *         self._set_components(components)
 *         cdef float smoothing_factor = self._smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float ratio
 *         cdef float result
 */
  __pyx_t_5 = __pyx_v_self->_smoothing_factor;
  __pyx_v_smoothing_factor = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line676")'> 676:         cdef float ratio</pre>
<pre id='line676' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line677")'> 677:         cdef float result</pre>
<pre id='line677' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line678")'> 678:         cdef target_distant_atom atom_indices</pre>
<pre id='line678' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line679")'> 679:         cdef coefficient_exponent coef_exp</pre>
<pre id='line679' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line680")'> 680:         cdef float coefficent</pre>
<pre id='line680' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line681")'> 681:         cdef float exponent</pre>
<pre id='line681' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line682")'> 682:         cdef object component</pre>
<pre id='line682' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line683")'> 683:         cdef int target_atom_id</pre>
<pre id='line683' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line684")'> 684:         cdef int distant_atom_id</pre>
<pre id='line684' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line685")'> 685:         cdef float distance</pre>
<pre id='line685' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line686")'> 686: </pre>
<pre id='line686' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line687")'> 687: </pre>
<pre id='line687' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line688")'> 688: </pre>
<pre id='line688' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line689")'> 689:         if self._verbose:</pre>
<pre id='line689' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":689
 * 
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line690")'> 690:             start_time = time()</pre>
<pre id='line690' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":690
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef int index
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line691")'> 691: </pre>
<pre id='line691' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line692")'> 692:         cdef int index</pre>
<pre id='line692' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line693")'> 693: </pre>
<pre id='line693' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line694")'> 694:         for index in range(self._num_components):</pre>
<pre id='line694' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":694
 *         cdef int index
 * 
 *         for index in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #             component = components[index]
 */
  __pyx_t_6 = __pyx_v_self->_num_components;
  for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_index = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line695")'> 695: </pre>
<pre id='line695' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line696")'> 696: #             component = components[index]</pre>
<pre id='line696' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line697")'> 697: </pre>
<pre id='line697' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line698")'> 698: </pre>
<pre id='line698' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line699")'> 699:             target_atom_id = self._compiled_components[index].remote_atom_1</pre>
<pre id='line699' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":699
 * 
 * 
 *             target_atom_id = self._compiled_components[index].remote_atom_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distant_atom_id  = self._compiled_components[index].remote_atom_2
 * 
 */
    __pyx_t_8 = (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1;
    __pyx_v_target_atom_id = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line700")'> 700:             distant_atom_id  = self._compiled_components[index].remote_atom_2</pre>
<pre id='line700' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":700
 * 
 *             target_atom_id = self._compiled_components[index].remote_atom_1
 *             distant_atom_id  = self._compiled_components[index].remote_atom_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_8 = (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2;
    __pyx_v_distant_atom_id = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line701")'> 701: </pre>
<pre id='line701' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line702")'> 702: </pre>
<pre id='line702' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line703")'> 703:             coef_exp = self._get_coefficient_and_exponent(index)</pre>
<pre id='line703' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":703
 * 
 * 
 *             coef_exp = self._get_coefficient_and_exponent(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 */
    __pyx_v_coef_exp = __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line704")'> 704:             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)</pre>
<pre id='line704' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":704
 * 
 *             coef_exp = self._get_coefficient_and_exponent(index)
 *             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 * 
 */
    __pyx_v_distance = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_target_atom_id, __pyx_v_distant_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line705")'> 705:     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)</pre>
<pre id='line705' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line706")'> 706: </pre>
<pre id='line706' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line707")'> 707:             if self._smoothed:</pre>
<pre id='line707' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":707
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 * 
 *             if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8
 */
    if (__pyx_v_self->_smoothed) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line708")'> 708:                 ratio = distance / self._cutoff</pre>
<pre id='line708' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":708
 * 
 *             if self._smoothed:
 *                 ratio = distance / self._cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 smoothing_factor = 1.0 - ratio ** 8
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 */
      __pyx_v_ratio = (__pyx_v_distance / __pyx_v_self->_cutoff);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line709")'> 709:                 smoothing_factor = 1.0 - ratio ** 8</pre>
<pre id='line709' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":709
 *             if self._smoothed:
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 */
      __pyx_v_smoothing_factor = (1.0 - powf(__pyx_v_ratio, 8.0));
      goto __pyx_L7;
    }
    __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line710")'> 710:             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient</pre>
<pre id='line710' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":710
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_8 = __pyx_v_index;
    __pyx_t_9 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_8 * __pyx_v_component_to_target.strides[0]) )));
    *((double *) ( /* dim=0 */ (__pyx_v_results.data + __pyx_t_9 * __pyx_v_results.strides[0]) )) += ((__pyx_v_smoothing_factor * pow(__pyx_v_distance, __pyx_v_coef_exp.exponent)) * __pyx_v_coef_exp.coefficient);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line711")'> 711: </pre>
<pre id='line711' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line712")'> 712:         if self._verbose:</pre>
<pre id='line712' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":712
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line713")'> 713:             end_time = time()</pre>
<pre id='line713' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":713
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line714")'> 714:             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"</pre>
<pre id='line714' class='code' style='background-color: #FFFF24'>
    /* "Cython_shift_calculator.pyx":714
 *         if self._verbose:
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_20));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_20));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_20));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_4);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_4 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_results, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line715")'> 715: </pre>
<pre id='line715' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line716")'> 716: </pre>
<pre id='line716' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line717")'> 717: </pre>
<pre id='line717' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line718")'> 718: </pre>
<pre id='line718' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line719")'> 719: cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):</pre>
<pre id='line719' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":719
 * 
 * 
 * cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component *_compiled_components
 */
struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_Dihedral_component *_compiled_components;
  int _num_components;
};


/* "Cython_shift_calculator.pyx":719
 * 
 * 
 * cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component *_compiled_components
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  PyObject *(*_set_components)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, PyObject *);
  PyObject *(*_get_component)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_ids (*_get_dihedral_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_parameters (*_get_parameters)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  float (*_get_coefficient)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_dihedral_shift_calculator;
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_component(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line720")'> 720: </pre>
<pre id='line720' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line721")'> 721:     cdef Dihedral_component *_compiled_components</pre>
<pre id='line721' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line722")'> 722:     cdef int _num_components</pre>
<pre id='line722' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line723")'> 723: </pre>
<pre id='line723' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line724")'> 724:     def __cinit__(self):</pre>
<pre id='line724' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":724
 *     cdef int _num_components
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line725")'> 725:         self._compiled_components = NULL</pre>
<pre id='line725' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":725
 * 
 *     def __cinit__(self):
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line726")'> 726:         self._num_components = 0</pre>
<pre id='line726' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":726
 *     def __cinit__(self):
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject*)__pyx_kp_s_16);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line727")'> 727: </pre>
<pre id='line727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line728")'> 728: </pre>
<pre id='line728' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line729")'> 729:     def __init__(self, str name = "not set"):</pre>
<pre id='line729' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":729
 * 
 * 
 *     def __init__(self, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self,name)
 * 
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line730")'> 730:         Base_shift_calculator.__init__(self,name)</pre>
<pre id='line730' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":730
 * 
 *     def __init__(self, str name = "not set"):
 *         Base_shift_calculator.__init__(self,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _set_components(self, object components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line731")'> 731: </pre>
<pre id='line731' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line732")'> 732:     cdef _set_components(self, object components):</pre>
<pre id='line732' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":732
 *         Base_shift_calculator.__init__(self,name)
 * 
 *     cdef _set_components(self, object components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */

static PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__set_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line733")'> 733:         if self._compiled_components ==  NULL:</pre>
<pre id='line733' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":733
 * 
 *     cdef _set_components(self, object components):
 *         if self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line734")'> 734:             self._compile_components(components)</pre>
<pre id='line734' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":734
 *     cdef _set_components(self, object components):
 *         if self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_components(self, components):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___compile_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_5_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_5_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_4_compile_components(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line735")'> 735: </pre>
<pre id='line735' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line736")'> 736:     def _compile_components(self, components):</pre>
<pre id='line736' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":736
 *             self._compile_components(components)
 * 
 *     def _compile_components(self, components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))
 *         self._num_components = len(components)
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_4_compile_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_v_j = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line737")'> 737:         self._compiled_components = &lt;Dihedral_component*&gt;malloc(len(components) * sizeof(Dihedral_component))</pre>
<pre id='line737' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":737
 * 
 *     def _compile_components(self, components):
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Dihedral_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Dihedral_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line738")'> 738:         self._num_components = len(components)</pre>
<pre id='line738' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":738
 *     def _compile_components(self, components):
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line739")'> 739:         for i,component in enumerate(components):</pre>
<pre id='line739' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":739
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line740")'> 740:             self._compiled_components[i].target_atom = component[0]</pre>
<pre id='line740' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":740
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(4):
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 */
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 740; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 740; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 740; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_7]).target_atom = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line741")'> 741:             for j in range(4):</pre>
<pre id='line741' class='code' style='background-color: #FFFF23'>
    /* "Cython_shift_calculator.pyx":741
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_k_tuple_22), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
      __pyx_t_8 = __pyx_t_5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_7 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_8 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = Py_TYPE(__pyx_t_8)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_8)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_8, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_8)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_8)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_8, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_5 = __pyx_t_9(__pyx_t_8);
        if (unlikely(!__pyx_t_5)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
      __pyx_v_j = __pyx_t_5;
      __pyx_t_5 = 0;

  /* "Cython_shift_calculator.pyx":741
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 */
  __pyx_k_tuple_22 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_4);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_22);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_22));
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line742")'> 742:                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]</pre>
<pre id='line742' class='code' style='background-color: #FFFF30'>
      /* "Cython_shift_calculator.pyx":742
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):
 */
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_int_1, __pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component, __pyx_t_5);<span class='error_goto'> if (!__pyx_t_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_10);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_j);<span class='error_goto'> if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((__pyx_v_self->_compiled_components[__pyx_t_11]).dihedral_atoms[__pyx_t_12]) = __pyx_t_6;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line743")'> 743:             self._compiled_components[i].coefficient = component[5]</pre>
<pre id='line743' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":743
 *             for j in range(4):
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(5):
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 */
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 5, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_8);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_7]).coefficient = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line744")'> 744:             for j in range(5):</pre>
<pre id='line744' class='code' style='background-color: #FFFF23'>
    /* "Cython_shift_calculator.pyx":744
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 * 
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_k_tuple_23), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_8)) {
      __pyx_t_10 = __pyx_t_8; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_7 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_10 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_9 = Py_TYPE(__pyx_t_10)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    for (;;) {
      if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_10)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_10)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_10, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_10, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_10)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_10)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_10, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_10, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_8 = __pyx_t_9(__pyx_t_10);
        if (unlikely(!__pyx_t_8)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
      __pyx_v_j = __pyx_t_8;
      __pyx_t_8 = 0;

  /* "Cython_shift_calculator.pyx":744
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 * 
 */
  __pyx_k_tuple_23 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_5);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_23);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_23));
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line745")'> 745:                 self._compiled_components[i].parameters[j] = component[6+j]</pre>
<pre id='line745' class='code' style='background-color: #FFFF25'>
      /* "Cython_shift_calculator.pyx":745
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):
 *                 self._compiled_components[i].parameters[j] = component[6+j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_compiled_components(self):
 */
      __pyx_t_8 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_int_6, __pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component, __pyx_t_8);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_j);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((__pyx_v_self->_compiled_components[__pyx_t_12]).parameters[__pyx_t_11]) = __pyx_t_13;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_7_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_7_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_6_free_compiled_components(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line746")'> 746: </pre>
<pre id='line746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line747")'> 747:     def _free_compiled_components(self):</pre>
<pre id='line747' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":747
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 * 
 *     def _free_compiled_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_6_free_compiled_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line748")'> 748:         if self._compiled_components != NULL:</pre>
<pre id='line748' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":748
 * 
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._compiled_components)
 *             self._compiled_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line749")'> 749:             free(self._compiled_components)</pre>
<pre id='line749' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":749
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_components);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line750")'> 750:             self._compiled_components = NULL</pre>
<pre id='line750' class='code' style='background-color: #FFFF39'>
    /* "Cython_shift_calculator.pyx":750
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)
 *             self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _prepare(self, change, data):
 */
    __pyx_v_self->_compiled_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_9_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_9_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 752; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 752; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 752; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_8_prepare(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line751")'> 751: </pre>
<pre id='line751' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line752")'> 752:     def _prepare(self, change, data):</pre>
<pre id='line752' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":752
 *             self._compiled_components = NULL
 * 
 *     def _prepare(self, change, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_8_prepare(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line753")'> 753:          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:</pre>
<pre id='line753' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":753
 * 
 *     def _prepare(self, change, data):
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *              self._free_compiled_components()
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_1, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_3) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_2, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line754")'> 754:              self._free_compiled_components()</pre>
<pre id='line754' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":754
 *     def _prepare(self, change, data):
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline _get_component(self,int index):
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_24);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line755")'> 755: </pre>
<pre id='line755' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line756")'> 756:     cdef inline _get_component(self,int index):</pre>
<pre id='line756' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":756
 *              self._free_compiled_components()
 * 
 *     cdef inline _get_component(self,int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._components[index]
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_component(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_component", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line757")'> 757:         return self._components[index]</pre>
<pre id='line757' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":757
 * 
 *     cdef inline _get_component(self,int index):
 *         return self._components[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___components);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, __pyx_v_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator._get_component", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line758")'> 758: </pre>
<pre id='line758' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line759")'> 759:     @cython.profile(False)</pre>
<pre id='line759' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line760")'> 760:     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):</pre>
<pre id='line760' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":760
 * 
 *     @cython.profile(False)
 *     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_dihedral_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line761")'> 761:         cdef dihedral_ids result</pre>
<pre id='line761' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line762")'> 762: </pre>
<pre id='line762' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line763")'> 763:         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]</pre>
<pre id='line763' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":763
 *         cdef dihedral_ids result
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 */
  __pyx_v_result.atom_id_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line764")'> 764:         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]</pre>
<pre id='line764' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":764
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 */
  __pyx_v_result.atom_id_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line765")'> 765:         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]</pre>
<pre id='line765' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":765
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 */
  __pyx_v_result.atom_id_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line766")'> 766:         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]</pre>
<pre id='line766' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":766
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_v_result.atom_id_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line767")'> 767: </pre>
<pre id='line767' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line768")'> 768:         return result</pre>
<pre id='line768' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":768
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline dihedral_parameters _get_parameters(self, int index):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line769")'> 769: </pre>
<pre id='line769' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line770")'> 770:     cdef inline dihedral_parameters _get_parameters(self, int index):</pre>
<pre id='line770' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":770
 *         return result
 * 
 *     cdef inline dihedral_parameters _get_parameters(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_parameters result
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_parameters", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line771")'> 771: </pre>
<pre id='line771' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line772")'> 772:         cdef dihedral_parameters result</pre>
<pre id='line772' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line773")'> 773: </pre>
<pre id='line773' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line774")'> 774:         result.param_0 = self._compiled_components[index].parameters[0]</pre>
<pre id='line774' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":774
 *         cdef dihedral_parameters result
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 */
  __pyx_v_result.param_0 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line775")'> 775:         result.param_1 = self._compiled_components[index].parameters[3]</pre>
<pre id='line775' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":775
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 */
  __pyx_v_result.param_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line776")'> 776:         result.param_2 = self._compiled_components[index].parameters[1]</pre>
<pre id='line776' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":776
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]
 */
  __pyx_v_result.param_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line777")'> 777:         result.param_3 = self._compiled_components[index].parameters[4]</pre>
<pre id='line777' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":777
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_4 = self._compiled_components[index].parameters[2]
 * 
 */
  __pyx_v_result.param_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[4]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line778")'> 778:         result.param_4 = self._compiled_components[index].parameters[2]</pre>
<pre id='line778' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":778
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_result.param_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line779")'> 779: </pre>
<pre id='line779' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line780")'> 780: </pre>
<pre id='line780' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line781")'> 781: </pre>
<pre id='line781' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line782")'> 782: </pre>
<pre id='line782' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line783")'> 783:         return result</pre>
<pre id='line783' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":783
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line784")'> 784: </pre>
<pre id='line784' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line785")'> 785:     @cython.profile(False)</pre>
<pre id='line785' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line786")'> 786:     cdef inline float _get_coefficient(self, int index):</pre>
<pre id='line786' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":786
 * 
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._compiled_components[index].coefficient
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coefficient", 0);
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line787")'> 787:         return self._compiled_components[index].coefficient</pre>
<pre id='line787' class='code' style='background-color: #FFFF2d'>
  /* "Cython_shift_calculator.pyx":787
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):
 *         return self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  __Pyx_memviewslice __pyx_v_results = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_results.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_10__call__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line788")'> 788: </pre>
<pre id='line788' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line789")'> 789:     @cython.profile(True)</pre>
<pre id='line789' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line790")'> 790:     def __call__(self, object components, double[:] results, int[:] component_to_target):</pre>
<pre id='line790' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":790
 * 
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef float angle
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_10__call__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, __Pyx_memviewslice __pyx_v_results, __Pyx_memviewslice __pyx_v_component_to_target) {
  float __pyx_v_angle;
  float __pyx_v_angle_term;
  float __pyx_v_shift;
  float __pyx_v_coefficient;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_parameters;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  int __pyx_v_index;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 790);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line791")'> 791:         self.set_simulation()</pre>
<pre id='line791' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":791
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float angle
 *         cdef float angle_term
 */
  __pyx_f_17shift_calculators_21Base_shift_calculator_set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line792")'> 792:         cdef float angle</pre>
<pre id='line792' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line793")'> 793:         cdef float angle_term</pre>
<pre id='line793' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line794")'> 794:         cdef float shift</pre>
<pre id='line794' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line795")'> 795:         cdef float coefficient</pre>
<pre id='line795' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line796")'> 796:         cdef dihedral_parameters parameters</pre>
<pre id='line796' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line797")'> 797:         cdef dihedral_ids dihedral_atom_ids</pre>
<pre id='line797' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line798")'> 798:         cdef double start_time = 0.0</pre>
<pre id='line798' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":798
 *         cdef dihedral_parameters parameters
 *         cdef dihedral_ids dihedral_atom_ids
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line799")'> 799:         cdef double end_time = 0.0</pre>
<pre id='line799' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":799
 *         cdef dihedral_ids dihedral_atom_ids
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line800")'> 800: </pre>
<pre id='line800' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line801")'> 801: </pre>
<pre id='line801' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line802")'> 802: </pre>
<pre id='line802' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line803")'> 803:         if self._verbose:</pre>
<pre id='line803' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":803
 * 
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line804")'> 804:             start_time = time()</pre>
<pre id='line804' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":804
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line805")'> 805: </pre>
<pre id='line805' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line806")'> 806:         self._set_components(components)</pre>
<pre id='line806' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":806
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for index in range(self._num_components):
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)
 */
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_components(__pyx_v_self, __pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 806; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line807")'> 807:         for index in range(self._num_components):</pre>
<pre id='line807' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":807
 * 
 *         self._set_components(components)
 *         for index in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)
 * 
 */
  __pyx_t_4 = __pyx_v_self->_num_components;
  for (__pyx_t_5 = 0; __pyx_t_5 <code><</code> __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_index = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line808")'> 808:             dihedral_atom_ids = self._get_dihedral_atom_ids(index)</pre>
<pre id='line808' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":808
 *         self._set_components(components)
 *         for index in range(self._num_components):
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             coefficient = self._get_coefficient(index)
 */
    __pyx_v_dihedral_atom_ids = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line809")'> 809: </pre>
<pre id='line809' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line810")'> 810:             coefficient = self._get_coefficient(index)</pre>
<pre id='line810' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":810
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)
 * 
 *             coefficient = self._get_coefficient(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             parameters = self._get_parameters(index)
 */
    __pyx_v_coefficient = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line811")'> 811: </pre>
<pre id='line811' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line812")'> 812:             parameters = self._get_parameters(index)</pre>
<pre id='line812' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":812
 *             coefficient = self._get_coefficient(index)
 * 
 *             parameters = self._get_parameters(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)
 */
    __pyx_v_parameters = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line813")'> 813: </pre>
<pre id='line813' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line814")'> 814:             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)</pre>
<pre id='line814' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":814
 *             parameters = self._get_parameters(index)
 * 
 *             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \
 */
    __pyx_v_angle = __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_dihedral_atom_ids);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line815")'> 815: </pre>
<pre id='line815' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line816")'> 816:             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \</pre>
<pre id='line816' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line817")'> 817:                          parameters.param_2 * cos(angle +  parameters.param_3) +      \</pre>
<pre id='line817' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line818")'> 818:                          parameters.param_4</pre>
<pre id='line818' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":818
 *             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \
 *                          parameters.param_2 * cos(angle +  parameters.param_3) +      \
 *                          parameters.param_4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             shift = coefficient * angle_term
 * 
 */
    __pyx_v_angle_term = (((__pyx_v_parameters.param_0 * cos(((3.0 * __pyx_v_angle) + __pyx_v_parameters.param_1))) + (__pyx_v_parameters.param_2 * cos((__pyx_v_angle + __pyx_v_parameters.param_3)))) + __pyx_v_parameters.param_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line819")'> 819:             shift = coefficient * angle_term</pre>
<pre id='line819' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":819
 *                          parameters.param_2 * cos(angle +  parameters.param_3) +      \
 *                          parameters.param_4
 *             shift = coefficient * angle_term             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             results[component_to_target[index]] += shift
 */
    __pyx_v_shift = (__pyx_v_coefficient * __pyx_v_angle_term);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line820")'> 820: </pre>
<pre id='line820' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line821")'> 821:             results[component_to_target[index]] += shift</pre>
<pre id='line821' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":821
 *             shift = coefficient * angle_term
 * 
 *             results[component_to_target[index]] += shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_6 = __pyx_v_index;
    __pyx_t_7 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_6 * __pyx_v_component_to_target.strides[0]) )));
    *((double *) ( /* dim=0 */ (__pyx_v_results.data + __pyx_t_7 * __pyx_v_results.strides[0]) )) += __pyx_v_shift;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line822")'> 822: </pre>
<pre id='line822' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line823")'> 823:         if self._verbose:</pre>
<pre id='line823' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":823
 *             results[component_to_target[index]] += shift
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line824")'> 824:             end_time = time()</pre>
<pre id='line824' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":824
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line825")'> 825:             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line825' class='code' style='background-color: #FFFF25'>
    /* "Cython_shift_calculator.pyx":825
 *         if self._verbose:
 *             end_time = time()
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_9 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_25));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_25));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_25));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_9 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_2), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_results, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line826")'> 826: </pre>
<pre id='line826' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line827")'> 827: cdef class Fast_ring_shift_calculator(Base_shift_calculator):</pre>
<pre id='line827' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":827
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3_list _centre_cache
 *     cdef Vec3_list _normal_cache
 */
struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  struct __pyx_obj_17shift_calculators_Vec3_list *_centre_cache;
  struct __pyx_obj_17shift_calculators_Vec3_list *_normal_cache;
  struct __pyx_t_17shift_calculators_Ring_target_component *_compiled_components;
  int _num_components;
  struct __pyx_t_17shift_calculators_Ring_component *_compiled_ring_components;
  int _num_ring_components;
  struct __pyx_obj_17shift_calculators_Coef_components *_compiled_coef_components;
};


/* "Cython_shift_calculator.pyx":827
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3_list _centre_cache
 *     cdef Vec3_list _normal_cache
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  Vec3 *(*_get_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
  Vec3 *(*_get_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
  float (*_calc_sub_component_shift)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int, int, float, int __pyx_skip_dispatch);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_shift_calculator;
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line828")'> 828:     cdef Vec3_list _centre_cache</pre>
<pre id='line828' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line829")'> 829:     cdef Vec3_list _normal_cache</pre>
<pre id='line829' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line830")'> 830: </pre>
<pre id='line830' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line831")'> 831:     cdef Ring_target_component* _compiled_components</pre>
<pre id='line831' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line832")'> 832:     cdef int _num_components</pre>
<pre id='line832' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line833")'> 833: </pre>
<pre id='line833' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line834")'> 834:     cdef Ring_component* _compiled_ring_components</pre>
<pre id='line834' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line835")'> 835:     cdef int _num_ring_components</pre>
<pre id='line835' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line836")'> 836: </pre>
<pre id='line836' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line837")'> 837:     cdef Coef_components _compiled_coef_components</pre>
<pre id='line837' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line838")'> 838: </pre>
<pre id='line838' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line839")'> 839:     def __cinit__(self):</pre>
<pre id='line839' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":839
 *     cdef Coef_components _compiled_coef_components
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line840")'> 840:         self._compiled_components = NULL</pre>
<pre id='line840' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":840
 * 
 *     def __cinit__(self):
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line841")'> 841:         self._num_components = 0</pre>
<pre id='line841' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":841
 *     def __cinit__(self):
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_ring_components = NULL
 */
  __pyx_v_self->_num_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line842")'> 842: </pre>
<pre id='line842' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line843")'> 843:         self._compiled_ring_components = NULL</pre>
<pre id='line843' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":843
 *         self._num_components = 0
 * 
 *         self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = 0
 * 
 */
  __pyx_v_self->_compiled_ring_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line844")'> 844:         self._num_ring_components = 0</pre>
<pre id='line844' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":844
 * 
 *         self._compiled_ring_components = NULL
 *         self._num_ring_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 */
  __pyx_v_self->_num_ring_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line845")'> 845: </pre>
<pre id='line845' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line846")'> 846:         #note this is not a raw array of structs it's a compiled python class</pre>
<pre id='line846' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line847")'> 847:         self._compiled_coef_components = None</pre>
<pre id='line847' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":847
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 *         self._compiled_coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._centre_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)Py_None);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line848")'> 848: </pre>
<pre id='line848' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line849")'> 849:         self._centre_cache = None</pre>
<pre id='line849' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":849
 *         self._compiled_coef_components = None
 * 
 *         self._centre_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = None
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line850")'> 850:         self._normal_cache = None</pre>
<pre id='line850' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":850
 * 
 *         self._centre_cache = None
 *         self._normal_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, str name = "not set"):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject*)__pyx_kp_s_16);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line851")'> 851: </pre>
<pre id='line851' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line852")'> 852:     def __init__(self, str name = "not set"):</pre>
<pre id='line852' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":852
 *         self._normal_cache = None
 * 
 *     def __init__(self, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self,name)
 * 
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line853")'> 853:         Base_shift_calculator.__init__(self,name)</pre>
<pre id='line853' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":853
 * 
 *     def __init__(self, str name = "not set"):
 *         Base_shift_calculator.__init__(self,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_4_set_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line854")'> 854: </pre>
<pre id='line854' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line855")'> 855: </pre>
<pre id='line855' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line856")'> 856:     def _set_components(self,components):</pre>
<pre id='line856' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":856
 * 
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_4_set_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line857")'> 857:         if  self._compiled_components ==  NULL:</pre>
<pre id='line857' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":857
 * 
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line858")'> 858:             self._compile_components(components)</pre>
<pre id='line858' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":858
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_components(self,components):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___compile_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 858; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 858; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 858; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_7_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_7_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_6_compile_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line859")'> 859: </pre>
<pre id='line859' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line860")'> 860:     def _compile_components(self,components):</pre>
<pre id='line860' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":860
 *             self._compile_components(components)
 * 
 *     def _compile_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_6_compile_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line861")'> 861:         self._compiled_components = &lt;Ring_target_component*&gt;malloc(len(components) * sizeof(Ring_target_component))</pre>
<pre id='line861' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":861
 * 
 *     def _compile_components(self,components):
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Ring_target_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Ring_target_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line862")'> 862:         self._num_components = len(components)</pre>
<pre id='line862' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":862
 *     def _compile_components(self,components):
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 862; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line863")'> 863:         for i,component in enumerate(components):</pre>
<pre id='line863' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":863
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom_id = components[i][0]
 *             self._compiled_components[i].atom_type_id = components[i][1]
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line864")'> 864:             self._compiled_components[i].target_atom_id = components[i][0]</pre>
<pre id='line864' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":864
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].atom_type_id = components[i][1]
 * 
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).target_atom_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line865")'> 865:             self._compiled_components[i].atom_type_id = components[i][1]</pre>
<pre id='line865' class='code' style='background-color: #FFFF31'>
    /* "Cython_shift_calculator.pyx":865
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]
 *             self._compiled_components[i].atom_type_id = components[i][1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_compiled_components(self):
 */
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).atom_type_id = __pyx_t_7;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_9_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_9_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_8_free_compiled_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line866")'> 866: </pre>
<pre id='line866' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line867")'> 867:     def _free_compiled_components(self):</pre>
<pre id='line867' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":867
 *             self._compiled_components[i].atom_type_id = components[i][1]
 * 
 *     def _free_compiled_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_8_free_compiled_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line868")'> 868:         if self._compiled_components != NULL:</pre>
<pre id='line868' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":868
 * 
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._compiled_components)
 *             self._compiled_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line869")'> 869:             free(self._compiled_components)</pre>
<pre id='line869' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":869
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_components);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line870")'> 870:             self._compiled_components = NULL</pre>
<pre id='line870' class='code' style='background-color: #FFFFc4'>
    /* "Cython_shift_calculator.pyx":870
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)
 *             self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_compiled_ring_components(self):
 */
    __pyx_v_self->_compiled_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_11_free_compiled_ring_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_11_free_compiled_ring_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_10_free_compiled_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line871")'> 871: </pre>
<pre id='line871' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line872")'> 872:     def _free_compiled_ring_components(self):</pre>
<pre id='line872' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":872
 *             self._compiled_components = NULL
 * 
 *     def _free_compiled_ring_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_10_free_compiled_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line873")'> 873:         if self._compiled_ring_components != NULL:</pre>
<pre id='line873' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":873
 * 
 *     def _free_compiled_ring_components(self):
 *         if self._compiled_ring_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._compiled_ring_components)
 *             self._compiled_ring_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line874")'> 874:             free(self._compiled_ring_components)</pre>
<pre id='line874' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":874
 *     def _free_compiled_ring_components(self):
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_ring_components);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line875")'> 875:             self._compiled_ring_components = NULL</pre>
<pre id='line875' class='code' style='background-color: #FFFFc4'>
    /* "Cython_shift_calculator.pyx":875
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)
 *             self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_coef_components(self):
 */
    __pyx_v_self->_compiled_ring_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_free_coef_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_free_coef_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_coef_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_12_free_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line876")'> 876: </pre>
<pre id='line876' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line877")'> 877:     def _free_coef_components(self):</pre>
<pre id='line877' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":877
 *             self._compiled_ring_components = NULL
 * 
 *     def _free_coef_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coef_components = None
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_12_free_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line878")'> 878:         self._compiled_coef_components = None</pre>
<pre id='line878' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":878
 * 
 *     def _free_coef_components(self):
 *         self._compiled_coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)Py_None);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_15_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_15_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 881; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 881; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 881; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_14_prepare(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line879")'> 879: </pre>
<pre id='line879' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line880")'> 880: </pre>
<pre id='line880' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line881")'> 881:     def _prepare(self, change, data):</pre>
<pre id='line881' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":881
 * 
 * 
 *     def _prepare(self, change, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *             self._free_compiled_components()
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_14_prepare(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line882")'> 882:         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:</pre>
<pre id='line882' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":882
 * 
 *     def _prepare(self, change, data):
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._free_compiled_components()
 *             self._free_compiled_ring_components()
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_1, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_3) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_2, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line883")'> 883:             self._free_compiled_components()</pre>
<pre id='line883' class='code' style='background-color: #FFFF73'>
    /* "Cython_shift_calculator.pyx":883
 *     def _prepare(self, change, data):
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *             self._free_compiled_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._free_compiled_ring_components()
 *             self._free_coef_components()
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_24);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 883; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 883; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line884")'> 884:             self._free_compiled_ring_components()</pre>
<pre id='line884' class='code' style='background-color: #FFFF73'>
    /* "Cython_shift_calculator.pyx":884
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *             self._free_compiled_components()
 *             self._free_compiled_ring_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._free_coef_components()
 * 
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_26);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line885")'> 885:             self._free_coef_components()</pre>
<pre id='line885' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":885
 *             self._free_compiled_components()
 *             self._free_compiled_ring_components()
 *             self._free_coef_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_27);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_17_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_17_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_16_set_normal_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_normals));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line886")'> 886: </pre>
<pre id='line886' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line887")'> 887: </pre>
<pre id='line887' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line888")'> 888:     def _set_normal_cache(self,normals):</pre>
<pre id='line888' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":888
 * 
 * 
 *     def _set_normal_cache(self,normals):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_16_set_normal_cache(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line889")'> 889:         self._normal_cache = &lt;Vec3_list&gt; normals</pre>
<pre id='line889' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":889
 * 
 *     def _set_normal_cache(self,normals):
 *         self._normal_cache = <code><</code>Vec3_list> normals             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_centre_cache(self,centres):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_19_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_19_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_18_set_centre_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_centres));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line890")'> 890: </pre>
<pre id='line890' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line891")'> 891:     def _set_centre_cache(self,centres):</pre>
<pre id='line891' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":891
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 *     def _set_centre_cache(self,centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = <code><</code>Vec3_list> centres
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_18_set_centre_cache(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line892")'> 892:         self._centre_cache = &lt;Vec3_list&gt; centres</pre>
<pre id='line892' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":892
 * 
 *     def _set_centre_cache(self,centres):
 *         self._centre_cache = <code><</code>Vec3_list> centres             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_coef_components(self,coef_components):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_21_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_21_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_20_set_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_coef_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line893")'> 893: </pre>
<pre id='line893' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line894")'> 894:     def _set_coef_components(self,coef_components):</pre>
<pre id='line894' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":894
 *         self._centre_cache = <code><</code>Vec3_list> centres
 * 
 *     def _set_coef_components(self,coef_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coef_components = Coef_components(coef_components)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_20_set_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line895")'> 895:         self._compiled_coef_components = Coef_components(coef_components)</pre>
<pre id='line895' class='code' style='background-color: #FFFF52'>
  /* "Cython_shift_calculator.pyx":895
 * 
 *     def _set_coef_components(self,coef_components):
 *         self._compiled_coef_components = Coef_components(coef_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Coef_components)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_t_2);
  __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._set_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_23_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_23_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_22_set_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line896")'> 896: </pre>
<pre id='line896' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line897")'> 897: </pre>
<pre id='line897' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line898")'> 898:     #TODO: not needed ?</pre>
<pre id='line898' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line899")'> 899:     def _set_ring_components(self,ring_components):</pre>
<pre id='line899' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":899
 * 
 *     #TODO: not needed ?
 *     def _set_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_ring_components ==  NULL:
 *             self._compile_ring_components(ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_22_set_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line900")'> 900:         if  self._compiled_ring_components ==  NULL:</pre>
<pre id='line900' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":900
 *     #TODO: not needed ?
 *     def _set_ring_components(self,ring_components):
 *         if  self._compiled_ring_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_ring_components(ring_components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line901")'> 901:             self._compile_ring_components(ring_components)</pre>
<pre id='line901' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":901
 *     def _set_ring_components(self,ring_components):
 *         if  self._compiled_ring_components ==  NULL:
 *             self._compile_ring_components(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_ring_components(self,ring_components):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_28);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ring_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_ring_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_ring_components);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._set_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_25_compile_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_25_compile_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_24_compile_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line902")'> 902: </pre>
<pre id='line902' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line903")'> 903:     def _compile_ring_components(self,ring_components):</pre>
<pre id='line903' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":903
 *             self._compile_ring_components(ring_components)
 * 
 *     def _compile_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_24_compile_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_ring_component = NULL;
  PyObject *__pyx_v_j = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line904")'> 904:         self._compiled_ring_components = &lt;Ring_component*&gt;malloc(len(ring_components) * sizeof(Ring_component))</pre>
<pre id='line904' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":904
 * 
 *     def _compile_ring_components(self,ring_components):
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_ring_components = ((struct __pyx_t_17shift_calculators_Ring_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Ring_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line905")'> 905:         self._num_ring_components = len(ring_components)</pre>
<pre id='line905' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":905
 *     def _compile_ring_components(self,ring_components):
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 905; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_ring_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line906")'> 906:         for i,ring_component in enumerate(ring_components):</pre>
<pre id='line906' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":906
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_ring_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_ring_components)) {
    __pyx_t_3 = __pyx_v_ring_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
    __pyx_v_ring_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line907")'> 907:             self._compiled_ring_components[i].ring_id  = ring_components[i][0]</pre>
<pre id='line907' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":907
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_ring_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_ring_components[__pyx_t_8]).ring_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line908")'> 908:             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])</pre>
<pre id='line908' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":908
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(len(ring_component[1])):
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 908; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 908; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_9 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 908; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_ring_components[__pyx_t_9]).num_atoms = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF1d' onclick='toggleDiv("line909")'> 909:             for j in range(len(ring_component[1])):</pre>
<pre id='line909' class='code' style='background-color: #FFFF1d'>
    /* "Cython_shift_calculator.pyx":909
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 * 
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_6) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_6)) {
      __pyx_t_5 = __pyx_t_6; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    for (;;) {
      if (!__pyx_t_10 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) {
        if (__pyx_t_9 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_9++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_10 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
        if (__pyx_t_9 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_9++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_6 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_6)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
      __pyx_v_j = __pyx_t_6;
      __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line910")'> 910:                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]</pre>
<pre id='line910' class='code' style='background-color: #FFFF27'>
      /* "Cython_shift_calculator.pyx":910
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_compiled_ring_components(self):
 */
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_11 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, __pyx_v_j);<span class='error_goto'> if (!__pyx_t_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_j);<span class='error_goto'> if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((__pyx_v_self->_compiled_ring_components[__pyx_t_8]).atom_ids[__pyx_t_12]) = __pyx_t_7;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._compile_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_27_free_compiled_ring_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_27_free_compiled_ring_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_26_free_compiled_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line911")'> 911: </pre>
<pre id='line911' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line912")'> 912:     def _free_compiled_ring_components(self):</pre>
<pre id='line912' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":912
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 * 
 *     def _free_compiled_ring_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_26_free_compiled_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line913")'> 913:         if self._compiled_ring_components != NULL:</pre>
<pre id='line913' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":913
 * 
 *     def _free_compiled_ring_components(self):
 *         if self._compiled_ring_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._compiled_ring_components)
 *             self._compiled_ring_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line914")'> 914:             free(self._compiled_ring_components)</pre>
<pre id='line914' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":914
 *     def _free_compiled_ring_components(self):
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_ring_components);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line915")'> 915:             self._compiled_ring_components = NULL</pre>
<pre id='line915' class='code' style='background-color: #FFFFd4'>
    /* "Cython_shift_calculator.pyx":915
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)
 *             self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_v_self->_compiled_ring_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line916")'> 916: </pre>
<pre id='line916' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line917")'> 917: </pre>
<pre id='line917' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line918")'> 918:     @cython.profile(False)</pre>
<pre id='line918' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line919")'> 919:     cdef inline Vec3* _get_ring_normal(self, int ring_id):</pre>
<pre id='line919' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":919
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._normal_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_normal", 0);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line920")'> 920:         return  self._normal_cache.get(ring_id)</pre>
<pre id='line920' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":920
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id):
 *         return  self._normal_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_normal_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line921")'> 921: </pre>
<pre id='line921' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line922")'> 922:     @cython.profile(False)</pre>
<pre id='line922' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line923")'> 923:     cdef inline Vec3* _get_ring_centre(self, int ring_id):</pre>
<pre id='line923' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":923
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._centre_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_centre", 0);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line924")'> 924:         return  self._centre_cache.get(ring_id)</pre>
<pre id='line924' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":924
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id):
 *         return  self._centre_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_centre_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line925")'> 925: </pre>
<pre id='line925' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line926")'> 926:     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):</pre>
<pre id='line926' class='code' style='background-color: #FFFF16'>
/* "Cython_shift_calculator.pyx":926
 *         return  self._centre_cache.get(ring_id)
 * 
 *     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_atom_pos
 */

static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_29_calc_sub_component_shift(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static float __pyx_f_17shift_calculators_26Fast_ring_shift_calculator__calc_sub_component_shift(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id, float __pyx_v_coefficient, int __pyx_skip_dispatch) {
  Vec3 __pyx_v_target_atom_pos;
  Vec3 __pyx_v_ring_centre;
  Vec3 __pyx_v_ring_normal;
  Vec3 __pyx_v_direction_vector;
  float __pyx_v_distance;
  float __pyx_v_distance3;
  float __pyx_v_angle;
  float __pyx_v_contrib;
  PyObject *__pyx_v_length_normal = NULL;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_sub_component_shift", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_29);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_29_calc_sub_component_shift)) {
      __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_target_atom_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_ring_id);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_coefficient);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_3);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_4);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_4 = 0;
      __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
      __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_6 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_6;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":926
 *         return  self._centre_cache.get(ring_id)
 * 
 *     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_atom_pos
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_28_calc_sub_component_shift(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id, float __pyx_v_coefficient) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_sub_component_shift", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calc_sub_component_shift(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_coefficient, 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._calc_sub_component_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_31__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_31__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  __Pyx_memviewslice __pyx_v_results = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_results.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_30__call__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line927")'> 927: </pre>
<pre id='line927' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line928")'> 928:         cdef Vec3 target_atom_pos</pre>
<pre id='line928' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line929")'> 929:         cdef Vec3 ring_centre</pre>
<pre id='line929' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line930")'> 930:         cdef Vec3 ring_normal</pre>
<pre id='line930' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line931")'> 931:         cdef float lenght_normal</pre>
<pre id='line931' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line932")'> 932:         cdef Vec3 direction_vector</pre>
<pre id='line932' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line933")'> 933:         cdef float distance, distance3, angle, contrib</pre>
<pre id='line933' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line934")'> 934: </pre>
<pre id='line934' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line935")'> 935:         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)</pre>
<pre id='line935' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":935
 *         cdef float distance, distance3, angle, contrib
 * 
 *         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         ring_centre = self._get_ring_centre(ring_id)[0]
 * 
 */
  __pyx_v_target_atom_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line936")'> 936:         ring_centre = self._get_ring_centre(ring_id)[0]</pre>
<pre id='line936' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":936
 * 
 *         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)
 *         ring_centre = self._get_ring_centre(ring_id)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #TODO add this to a cache the same way that camshift does
 */
  __pyx_v_ring_centre = (__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_centre(__pyx_v_self, __pyx_v_ring_id)[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line937")'> 937: </pre>
<pre id='line937' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line938")'> 938:         #TODO add this to a cache the same way that camshift does</pre>
<pre id='line938' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line939")'> 939:         ring_normal = self._get_ring_normal(ring_id)[0]</pre>
<pre id='line939' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":939
 * 
 *         #TODO add this to a cache the same way that camshift does
 *         ring_normal = self._get_ring_normal(ring_id)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         length_normal = norm(ring_normal)
 * 
 */
  __pyx_v_ring_normal = (__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_normal(__pyx_v_self, __pyx_v_ring_id)[0]);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line940")'> 940:         length_normal = norm(ring_normal)</pre>
<pre id='line940' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":940
 *         #TODO add this to a cache the same way that camshift does
 *         ring_normal = self._get_ring_normal(ring_id)[0]
 *         length_normal = norm(ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #correct name?
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(norm(__pyx_v_ring_normal));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_length_normal = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line941")'> 941: </pre>
<pre id='line941' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line942")'> 942:         #correct name?</pre>
<pre id='line942' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line943")'> 943:         direction_vector = target_atom_pos - ring_centre</pre>
<pre id='line943' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":943
 * 
 *         #correct name?
 *         direction_vector = target_atom_pos - ring_centre             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         distance = norm(direction_vector)
 */
  __pyx_v_direction_vector = (__pyx_v_target_atom_pos - __pyx_v_ring_centre);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line944")'> 944: </pre>
<pre id='line944' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line945")'> 945:         distance = norm(direction_vector)</pre>
<pre id='line945' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":945
 *         direction_vector = target_atom_pos - ring_centre
 * 
 *         distance = norm(direction_vector)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distance3 = distance ** 3
 * 
 */
  __pyx_v_distance = norm(__pyx_v_direction_vector);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line946")'> 946:         distance3 = distance ** 3</pre>
<pre id='line946' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":946
 * 
 *         distance = norm(direction_vector)
 *         distance3 = distance ** 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)
 */
  __pyx_v_distance3 = powf(__pyx_v_distance, 3.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line947")'> 947: </pre>
<pre id='line947' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line948")'> 948:         angle = dot(direction_vector, ring_normal) / (distance * length_normal)</pre>
<pre id='line948' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":948
 *         distance3 = distance ** 3
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(dot(__pyx_v_direction_vector, __pyx_v_ring_normal));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_distance);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, __pyx_v_length_normal);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_6 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_angle = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line949")'> 949:         contrib = (1.0 - 3.0 * angle ** 2) / distance3</pre>
<pre id='line949' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":949
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return contrib * coefficient
 */
  __pyx_v_contrib = ((1.0 - (3.0 * powf(__pyx_v_angle, 2.0))) / __pyx_v_distance3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line950")'> 950: </pre>
<pre id='line950' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line951")'> 951:         return contrib * coefficient</pre>
<pre id='line951' class='code' style='background-color: #FFFF1c'>
  /* "Cython_shift_calculator.pyx":951
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3
 * 
 *         return contrib * coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = (__pyx_v_contrib * __pyx_v_coefficient);
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_shift_calculator._calc_sub_component_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_length_normal);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_29_calc_sub_component_shift(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_29_calc_sub_component_shift(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  int __pyx_v_ring_id;
  float __pyx_v_coefficient;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_sub_component_shift (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__ring_id,&__pyx_n_s__coefficient,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_sub_component_shift", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coefficient)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_sub_component_shift", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_sub_component_shift") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_coefficient = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_coefficient == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_sub_component_shift", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._calc_sub_component_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_28_calc_sub_component_shift(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_coefficient);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line952")'> 952: </pre>
<pre id='line952' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line953")'> 953:     @cython.profile(True)</pre>
<pre id='line953' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line954")'> 954:     def __call__(self, object components, double[:] results, int[:] component_to_target):</pre>
<pre id='line954' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":954
 * 
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef int target_atom_id
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_30__call__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, __Pyx_memviewslice __pyx_v_results, __Pyx_memviewslice __pyx_v_component_to_target) {
  int __pyx_v_target_atom_id;
  int __pyx_v_atom_type_id;
  int __pyx_v_ring_id;
  float __pyx_v_coefficient;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_v_coeff_offset;
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component;
  int __pyx_v_index;
  double __pyx_v_shift;
  int __pyx_v_coef_offset;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 954);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line955")'> 955:         self.set_simulation()</pre>
<pre id='line955' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":955
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int target_atom_id
 *         cdef int atom_type_id
 */
  __pyx_f_17shift_calculators_21Base_shift_calculator_set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line956")'> 956:         cdef int target_atom_id</pre>
<pre id='line956' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line957")'> 957:         cdef int atom_type_id</pre>
<pre id='line957' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line958")'> 958:         cdef int ring_id</pre>
<pre id='line958' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line959")'> 959:         cdef float coefficient</pre>
<pre id='line959' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line960")'> 960:         cdef double start_time = 0.0</pre>
<pre id='line960' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":960
 *         cdef int ring_id
 *         cdef float coefficient
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         cdef Component_Offsets* coeff_offset
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line961")'> 961:         cdef double end_time =0.0</pre>
<pre id='line961' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":961
 *         cdef float coefficient
 *         cdef double start_time = 0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Component_Offsets* coeff_offset
 *         cdef Coef_component* coef_component
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line962")'> 962:         cdef Component_Offsets* coeff_offset</pre>
<pre id='line962' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line963")'> 963:         cdef Coef_component* coef_component</pre>
<pre id='line963' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line964")'> 964: </pre>
<pre id='line964' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line965")'> 965:         if self._verbose:</pre>
<pre id='line965' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":965
 *         cdef Coef_component* coef_component
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line966")'> 966:             start_time = time()</pre>
<pre id='line966' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":966
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line967")'> 967: </pre>
<pre id='line967' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line968")'> 968: </pre>
<pre id='line968' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line969")'> 969: </pre>
<pre id='line969' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line970")'> 970:         self._set_components(components)</pre>
<pre id='line970' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":970
 * 
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for index in range(self._num_components):
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line971")'> 971: </pre>
<pre id='line971' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line972")'> 972:         for index in range(self._num_components):</pre>
<pre id='line972' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":972
 *         self._set_components(components)
 * 
 *         for index in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             target_atom_id = self._compiled_components[index].target_atom_id
 *             atom_type_id = self._compiled_components[index].atom_type_id
 */
  __pyx_t_5 = __pyx_v_self->_num_components;
  for (__pyx_t_6 = 0; __pyx_t_6 <code><</code> __pyx_t_5; __pyx_t_6+=1) {
    __pyx_v_index = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line973")'> 973:             target_atom_id = self._compiled_components[index].target_atom_id</pre>
<pre id='line973' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":973
 * 
 *         for index in range(self._num_components):
 *             target_atom_id = self._compiled_components[index].target_atom_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             atom_type_id = self._compiled_components[index].atom_type_id
 * 
 */
    __pyx_t_7 = (__pyx_v_self->_compiled_components[__pyx_v_index]).target_atom_id;
    __pyx_v_target_atom_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line974")'> 974:             atom_type_id = self._compiled_components[index].atom_type_id</pre>
<pre id='line974' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":974
 *         for index in range(self._num_components):
 *             target_atom_id = self._compiled_components[index].target_atom_id
 *             atom_type_id = self._compiled_components[index].atom_type_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             shift = 0.0
 */
    __pyx_t_7 = (__pyx_v_self->_compiled_components[__pyx_v_index]).atom_type_id;
    __pyx_v_atom_type_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line975")'> 975: </pre>
<pre id='line975' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line976")'> 976:             shift = 0.0</pre>
<pre id='line976' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":976
 *             atom_type_id = self._compiled_components[index].atom_type_id
 * 
 *             shift = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 */
    __pyx_v_shift = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line977")'> 977: </pre>
<pre id='line977' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line978")'> 978:             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)</pre>
<pre id='line978' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":978
 *             shift = 0.0
 * 
 *             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):
 */
    __pyx_v_coeff_offset = __pyx_f_17shift_calculators_15Coef_components_get_id_offsets(__pyx_v_self->_compiled_coef_components, __pyx_v_atom_type_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line979")'> 979: </pre>
<pre id='line979' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line980")'> 980:             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):</pre>
<pre id='line980' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":980
 *             coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 * 
 *             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #                TODO: remove magic numbers or add structs
 *                 coef_component = self._compiled_coef_components.get_component(coef_offset)
 */
    __pyx_t_7 = ((__pyx_v_coeff_offset[0]).offset + (__pyx_v_coeff_offset[0]).length);
    for (__pyx_t_8 = (__pyx_v_coeff_offset[0]).offset; __pyx_t_8 <code><</code> __pyx_t_7; __pyx_t_8+=1) {
      __pyx_v_coef_offset = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line981")'> 981: #                TODO: remove magic numbers or add structs</pre>
<pre id='line981' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line982")'> 982:                 coef_component = self._compiled_coef_components.get_component(coef_offset)</pre>
<pre id='line982' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":982
 *             for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):
 * #                TODO: remove magic numbers or add structs
 *                 coef_component = self._compiled_coef_components.get_component(coef_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 ring_id = coef_component[0].ring_id
 */
      __pyx_v_coef_component = __pyx_f_17shift_calculators_15Coef_components_get_component(__pyx_v_self->_compiled_coef_components, __pyx_v_coef_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line983")'> 983: </pre>
<pre id='line983' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line984")'> 984:                 ring_id = coef_component[0].ring_id</pre>
<pre id='line984' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":984
 *                 coef_component = self._compiled_coef_components.get_component(coef_offset)
 * 
 *                 ring_id = coef_component[0].ring_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 coefficient = coef_component[0].coefficient
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 */
      __pyx_t_9 = (__pyx_v_coef_component[0]).ring_id;
      __pyx_v_ring_id = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line985")'> 985:                 coefficient = coef_component[0].coefficient</pre>
<pre id='line985' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":985
 * 
 *                 ring_id = coef_component[0].ring_id
 *                 coefficient = coef_component[0].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 * 
 */
      __pyx_t_10 = (__pyx_v_coef_component[0]).coefficient;
      __pyx_v_coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line986")'> 986:                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)</pre>
<pre id='line986' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":986
 *                 ring_id = coef_component[0].ring_id
 *                 coefficient = coef_component[0].coefficient
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             results[component_to_target[index]] += shift
 */
      __pyx_v_shift = (__pyx_v_shift + ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calc_sub_component_shift(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_coefficient, 0));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line987")'> 987: </pre>
<pre id='line987' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line988")'> 988:             results[component_to_target[index]] += shift</pre>
<pre id='line988' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":988
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 * 
 *             results[component_to_target[index]] += shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_7 = __pyx_v_index;
    __pyx_t_8 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_7 * __pyx_v_component_to_target.strides[0]) )));
    *((double *) ( /* dim=0 */ (__pyx_v_results.data + __pyx_t_8 * __pyx_v_results.strides[0]) )) += __pyx_v_shift;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line989")'> 989: </pre>
<pre id='line989' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line990")'> 990:         if self._verbose:</pre>
<pre id='line990' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":990
 *             results[component_to_target[index]] += shift
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line991")'> 991:             end_time = time()</pre>
<pre id='line991' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":991
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line992")'> 992:             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line992' class='code' style='background-color: #FFFF24'>
    /* "Cython_shift_calculator.pyx":992
 *         if self._verbose:
 *             end_time = time()
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #
 */
    __pyx_t_11 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_30));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_kp_s_30));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_30));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_results, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_25Fast_ring_data_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_25Fast_ring_data_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line993")'> 993: </pre>
<pre id='line993' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line994")'> 994: #</pre>
<pre id='line994' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line995")'> 995: cdef int RING_ATOM_IDS = 1</pre>
<pre id='line995' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":995
 * 
 * #
 * cdef int RING_ATOM_IDS = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_ring_data_calculator:
 */
  __pyx_v_17shift_calculators_RING_ATOM_IDS = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line996")'> 996: </pre>
<pre id='line996' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line997")'> 997: cdef class Fast_ring_data_calculator:</pre>
<pre id='line997' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":997
 * cdef int RING_ATOM_IDS = 1
 * 
 * cdef class Fast_ring_data_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 */
struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *__pyx_vtab;
  int _verbose;
  Simulation *_simulation;
};


/* "Cython_shift_calculator.pyx":997
 * cdef int RING_ATOM_IDS = 1
 * 
 * cdef class Fast_ring_data_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator {
  void (*_calculate_one_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
  void (*_calculate_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, int *, Vec3 *);
  void (*_calculate_one_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
  void (*_build_atom_triplet)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, int *);
  void (*_average_2_vec_3)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, Vec3 &, Vec3 &, Vec3 *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_data_calculator;
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, int *, Vec3 *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, Vec3 *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, int *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, Vec3 &, Vec3 &, Vec3 *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line998")'> 998:     cdef bint _verbose</pre>
<pre id='line998' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line999")'> 999:     cdef Simulation* _simulation</pre>
<pre id='line999' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1000")'> 1000: </pre>
<pre id='line1000' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1001")'> 1001:     def __init__(self):</pre>
<pre id='line1001' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1001
 *     cdef Simulation* _simulation
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self._simulation =  currentSimulation()
 */

static int __pyx_pf_17shift_calculators_25Fast_ring_data_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1002")'> 1002:         self._verbose = False</pre>
<pre id='line1002' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1002
 * 
 *     def __init__(self):
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1003")'> 1003:         self._simulation =  currentSimulation()</pre>
<pre id='line1003' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1003
 *     def __init__(self):
 *         self._verbose = False
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_2set_simulation(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1004")'> 1004: </pre>
<pre id='line1004' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1005")'> 1005:     def set_simulation(self):</pre>
<pre id='line1005' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1005
 *         self._simulation =  currentSimulation()
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation  = currentSimulation()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_2set_simulation(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1006")'> 1006:         self._simulation  = currentSimulation()</pre>
<pre id='line1006' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":1006
 * 
 *     def set_simulation(self):
 *         self._simulation  = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1007")'> 1007: </pre>
<pre id='line1007' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1008")'> 1008:     def set_verbose(self,on):</pre>
<pre id='line1008' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1008
 *         self._simulation  = currentSimulation()
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line1009")'> 1009:         self._verbose =  on</pre>
<pre id='line1009' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":1009
 * 
 *     def set_verbose(self,on):
 *         self._verbose =  on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1009; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1010")'> 1010: </pre>
<pre id='line1010' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1011")'> 1011:     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):</pre>
<pre id='line1011' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1011
 *         self._verbose =  on
 * 
 *     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_ring_component, Vec3 *__pyx_v_result) {
  PyObject *__pyx_v_atom_ids = NULL;
  float __pyx_v_num_atom_ids;
  int __pyx_v_atom_id;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_one_ring_centre", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1012")'> 1012: </pre>
<pre id='line1012' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1013")'> 1013:         atom_ids = ring_component[RING_ATOM_IDS]</pre>
<pre id='line1013' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1013
 *     cdef inline void _calculate_one_ring_centre(self, ring_component, Vec3* result):
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float num_atom_ids = len(atom_ids)
 *         cdef Vec3 total
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, __pyx_v_17shift_calculators_RING_ATOM_IDS, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1013; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_atom_ids = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1014")'> 1014:         cdef float num_atom_ids = len(atom_ids)</pre>
<pre id='line1014' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1014
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 *         cdef float num_atom_ids = len(atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 total
 *         cdef int atom_id
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_ids);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_num_atom_ids = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1015")'> 1015:         cdef Vec3 total</pre>
<pre id='line1015' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1016")'> 1016:         cdef int atom_id</pre>
<pre id='line1016' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1017")'> 1017: </pre>
<pre id='line1017' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1018")'> 1018:         result[0]=Vec3(0.0,0.0,0.0)</pre>
<pre id='line1018' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1018
 *         cdef int atom_id
 * 
 *         result[0]=Vec3(0.0,0.0,0.0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for atom_id in atom_ids:
 *             result[0] += self._simulation.atomPos(atom_id)
 */
  (__pyx_v_result[0]) = Vec3(0.0, 0.0, 0.0);
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1019")'> 1019:         for atom_id in atom_ids:</pre>
<pre id='line1019' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1019
 * 
 *         result[0]=Vec3(0.0,0.0,0.0)
 *         for atom_id in atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[0] += self._simulation.atomPos(atom_id)
 * 
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_atom_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_atom_ids)) {
    __pyx_t_1 = __pyx_v_atom_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_atom_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_3 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_3 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    }
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_atom_id = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1020")'> 1020:             result[0] += self._simulation.atomPos(atom_id)</pre>
<pre id='line1020' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1020
 *         result[0]=Vec3(0.0,0.0,0.0)
 *         for atom_id in atom_ids:
 *             result[0] += self._simulation.atomPos(atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         operator_times(result[0],1.0/float(num_atom_ids))
 */
    (__pyx_v_result[0]) += __pyx_v_self->_simulation->atomPos(__pyx_v_atom_id);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1021")'> 1021: </pre>
<pre id='line1021' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1022")'> 1022:         operator_times(result[0],1.0/float(num_atom_ids))</pre>
<pre id='line1022' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1022
 *             result[0] += self._simulation.atomPos(atom_id)
 * 
 *         operator_times(result[0],1.0/float(num_atom_ids))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #
 */
  __pyx_f_17shift_calculators_operator_times((__pyx_v_result[0]), (1.0 / ((double)__pyx_v_num_atom_ids)));

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_data_calculator._calculate_one_ring_centre", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1023")'> 1023: </pre>
<pre id='line1023' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1024")'> 1024: #</pre>
<pre id='line1024' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1025")'> 1025: </pre>
<pre id='line1025' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1026")'> 1026: </pre>
<pre id='line1026' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1027")'> 1027: </pre>
<pre id='line1027' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1028")'> 1028: #    def _check_ring_size_ok(self, atom_ids):</pre>
<pre id='line1028' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1029")'> 1029: #        num_atom_ids = len(atom_ids)</pre>
<pre id='line1029' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1030")'> 1030: #        if num_atom_ids &lt; 5 or num_atom_ids &gt; 6:</pre>
<pre id='line1030' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1031")'> 1031: #            template = "ring normals function is only implemented for 5 or six member rings i got %d atoms"</pre>
<pre id='line1031' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1032")'> 1032: #            msg = template % num_atom_ids</pre>
<pre id='line1032' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1033")'> 1033: #            raise Exception(msg)</pre>
<pre id='line1033' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1034")'> 1034: #</pre>
<pre id='line1034' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1035")'> 1035: </pre>
<pre id='line1035' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1036")'> 1036:     cdef inline void  _calculate_normal(self, int[3] atom_id_triplet, Vec3* result):</pre>
<pre id='line1036' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1036
 * #
 * 
 *     cdef inline void  _calculate_normal(self, int[3] atom_id_triplet, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 normal
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, int *__pyx_v_atom_id_triplet, Vec3 *__pyx_v_result) {
  Vec3 __pyx_v_vec_1;
  Vec3 __pyx_v_vec_2;
  Vec3 __pyx_v_atom_vector_1;
  Vec3 __pyx_v_atom_vector_2;
  Vec3 __pyx_v_atom_vector_3;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_normal", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1037")'> 1037: </pre>
<pre id='line1037' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1038")'> 1038:         cdef Vec3 normal</pre>
<pre id='line1038' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1039")'> 1039:         cdef Vec3 vec_1</pre>
<pre id='line1039' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1040")'> 1040:         cdef Vec3 vec_2</pre>
<pre id='line1040' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1041")'> 1041: </pre>
<pre id='line1041' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1042")'> 1042:         cdef Vec3 atom_vector_1, atom_vector_2, atom_vector_3</pre>
<pre id='line1042' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1043")'> 1043: </pre>
<pre id='line1043' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1044")'> 1044:         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])</pre>
<pre id='line1044' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1044
 *         cdef Vec3 atom_vector_1, atom_vector_2, atom_vector_3
 * 
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 */
  __pyx_v_atom_vector_1 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1045")'> 1045:         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])</pre>
<pre id='line1045' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1045
 * 
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 * 
 */
  __pyx_v_atom_vector_2 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1046")'> 1046:         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])</pre>
<pre id='line1046' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1046
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2
 */
  __pyx_v_atom_vector_3 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[2]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1047")'> 1047: </pre>
<pre id='line1047' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1048")'> 1048:         vec_1 =  atom_vector_1 -atom_vector_2</pre>
<pre id='line1048' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1048
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         vec_2 =  atom_vector_3- atom_vector_2
 * 
 */
  __pyx_v_vec_1 = (__pyx_v_atom_vector_1 - __pyx_v_atom_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1049")'> 1049:         vec_2 =  atom_vector_3- atom_vector_2</pre>
<pre id='line1049' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1049
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2
 *         vec_2 =  atom_vector_3- atom_vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result[0] =  cross(vec_1,vec_2)
 */
  __pyx_v_vec_2 = (__pyx_v_atom_vector_3 - __pyx_v_atom_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1050")'> 1050: </pre>
<pre id='line1050' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1051")'> 1051:         result[0] =  cross(vec_1,vec_2)</pre>
<pre id='line1051' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1051
 *         vec_2 =  atom_vector_3- atom_vector_2
 * 
 *         result[0] =  cross(vec_1,vec_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal
 */
  (__pyx_v_result[0]) = cross(__pyx_v_vec_1, __pyx_v_vec_2);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1052")'> 1052: </pre>
<pre id='line1052' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1053")'> 1053:     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal</pre>
<pre id='line1053' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1054")'> 1054:     cdef inline  void  _calculate_one_ring_normal(self, ring_component, Vec3* result):</pre>
<pre id='line1054' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1054
 * 
 *     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal
 *     cdef inline  void  _calculate_one_ring_normal(self, ring_component, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_ring_component, Vec3 *__pyx_v_result) {
  PyObject *__pyx_v_atom_ids = NULL;
  int *__pyx_v_atom_triplet_1;
  int *__pyx_v_atom_triplet_2;
  Vec3 __pyx_v_normal_1;
  Vec3 __pyx_v_normal_2;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_one_ring_normal", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1055")'> 1055: </pre>
<pre id='line1055' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1056")'> 1056:         atom_ids = ring_component[RING_ATOM_IDS]</pre>
<pre id='line1056' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1056
 *     cdef inline  void  _calculate_one_ring_normal(self, ring_component, Vec3* result):
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_ring_size_ok(atom_ids)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, __pyx_v_17shift_calculators_RING_ATOM_IDS, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1056; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_atom_ids = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1057")'> 1057: #        self._check_ring_size_ok(atom_ids)</pre>
<pre id='line1057' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1058")'> 1058: </pre>
<pre id='line1058' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1059")'> 1059:         cdef int* atom_triplet_1 = [0,0,0]</pre>
<pre id='line1059' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1059
 * #        self._check_ring_size_ok(atom_ids)
 * 
 *         cdef int* atom_triplet_1 = [0,0,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int* atom_triplet_2 = [0,0,0]
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)
 */
  __pyx_t_2[0] = 0;
  __pyx_t_2[1] = 0;
  __pyx_t_2[2] = 0;
  __pyx_v_atom_triplet_1 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1060")'> 1060:         cdef int* atom_triplet_2 = [0,0,0]</pre>
<pre id='line1060' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1060
 * 
 *         cdef int* atom_triplet_1 = [0,0,0]
 *         cdef int* atom_triplet_2 = [0,0,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)
 */
  __pyx_t_3[0] = 0;
  __pyx_t_3[1] = 0;
  __pyx_t_3[2] = 0;
  __pyx_v_atom_triplet_2 = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1061")'> 1061:         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)</pre>
<pre id='line1061' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1061
 *         cdef int* atom_triplet_1 = [0,0,0]
 *         cdef int* atom_triplet_2 = [0,0,0]
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_atom_ids, 0, 3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1061; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(__pyx_v_self, __pyx_t_1, __pyx_v_atom_triplet_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1062")'> 1062:         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)</pre>
<pre id='line1062' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1062
 *         cdef int* atom_triplet_2 = [0,0,0]
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_atom_ids, -3, PY_SSIZE_T_MAX);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1062; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(__pyx_v_self, __pyx_t_1, __pyx_v_atom_triplet_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1063")'> 1063: </pre>
<pre id='line1063' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1064")'> 1064: </pre>
<pre id='line1064' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1065")'> 1065:         cdef Vec3 normal_1</pre>
<pre id='line1065' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1066")'> 1066:         self._calculate_normal(atom_triplet_1, &amp;normal_1)</pre>
<pre id='line1066' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1066
 * 
 *         cdef Vec3 normal_1
 *         self._calculate_normal(atom_triplet_1, &normal_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 normal_2
 *         self._calculate_normal(atom_triplet_2,  &normal_2)
 */
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(__pyx_v_self, __pyx_v_atom_triplet_1, (&__pyx_v_normal_1));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1067")'> 1067:         cdef Vec3 normal_2</pre>
<pre id='line1067' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1068")'> 1068:         self._calculate_normal(atom_triplet_2,  &amp;normal_2)</pre>
<pre id='line1068' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1068
 *         self._calculate_normal(atom_triplet_1, &normal_1)
 *         cdef Vec3 normal_2
 *         self._calculate_normal(atom_triplet_2,  &normal_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #         cdef Vec3_container result = Vec3_container()
 */
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(__pyx_v_self, __pyx_v_atom_triplet_2, (&__pyx_v_normal_2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1069")'> 1069: </pre>
<pre id='line1069' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1070")'> 1070: #         cdef Vec3_container result = Vec3_container()</pre>
<pre id='line1070' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1071")'> 1071:         self._average_2_vec_3(normal_1, normal_2, result)</pre>
<pre id='line1071' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1071
 * 
 * #         cdef Vec3_container result = Vec3_container()
 *         self._average_2_vec_3(normal_1, normal_2, result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #         result.set_vec3(average)
 * #         return result
 */
  __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(__pyx_v_self, __pyx_v_normal_1, __pyx_v_normal_2, __pyx_v_result);

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_data_calculator._calculate_one_ring_normal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1072")'> 1072: #         result.set_vec3(average)</pre>
<pre id='line1072' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1073")'> 1073: #         return result</pre>
<pre id='line1073' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1074")'> 1074: </pre>
<pre id='line1074' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1075")'> 1075:     cdef inline void  _build_atom_triplet(self,atom_ids, int[3]&amp; result):</pre>
<pre id='line1075' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1075
 * #         return result
 * 
 *     cdef inline void  _build_atom_triplet(self,atom_ids, int[3]& result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int i
 *         for i in range(3):
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_atom_ids, int *__pyx_v_result) {
  int __pyx_v_i;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_atom_triplet", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1076")'> 1076:         cdef int i</pre>
<pre id='line1076' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1077")'> 1077:         for i in range(3):</pre>
<pre id='line1077' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1077
 *     cdef inline void  _build_atom_triplet(self,atom_ids, int[3]& result):
 *         cdef int i
 *         for i in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[i] = atom_ids[i]
 * 
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1078")'> 1078:             result[i] = atom_ids[i]</pre>
<pre id='line1078' class='code' style='background-color: #FFFF5e'>
    /* "Cython_shift_calculator.pyx":1078
 *         cdef int i
 *         for i in range(3):
 *             result[i] = atom_ids[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_atom_ids, __pyx_v_i, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1078; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1078; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    (__pyx_v_result[__pyx_v_i]) = __pyx_t_3;
  }

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_data_calculator._build_atom_triplet", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1079")'> 1079: </pre>
<pre id='line1079' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1080")'> 1080: </pre>
<pre id='line1080' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1081")'> 1081:     cdef inline void _average_2_vec_3(self, Vec3&amp; vector_1, Vec3&amp; vector_2, Vec3* result):</pre>
<pre id='line1081' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1081
 * 
 * 
 *     cdef inline void _average_2_vec_3(self, Vec3& vector_1, Vec3& vector_2, Vec3* result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result[0] =  vector_1 + vector_2
 * 
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, Vec3 &__pyx_v_vector_1, Vec3 &__pyx_v_vector_2, Vec3 *__pyx_v_result) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_average_2_vec_3", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1082")'> 1082:         result[0] =  vector_1 + vector_2</pre>
<pre id='line1082' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1082
 * 
 *     cdef inline void _average_2_vec_3(self, Vec3& vector_1, Vec3& vector_2, Vec3* result):
 *         result[0] =  vector_1 + vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         operator_times(result[0], 1.0/2.0)
 */
  (__pyx_v_result[0]) = (__pyx_v_vector_1 + __pyx_v_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1083")'> 1083: </pre>
<pre id='line1083' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line1084")'> 1084:         operator_times(result[0], 1.0/2.0)</pre>
<pre id='line1084' class='code' style='background-color: #FFFF2d'>
  /* "Cython_shift_calculator.pyx":1084
 *         result[0] =  vector_1 + vector_2
 * 
 *         operator_times(result[0], 1.0/2.0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_operator_times((__pyx_v_result[0]), (1.0 / 2.0));

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_rings = 0;
  struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_normals = 0;
  struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_centres = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__rings,&__pyx_n_s__normals,&__pyx_n_s__centres,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__rings)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__normals)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__centres)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_rings = values[0];
    __pyx_v_normals = ((struct __pyx_obj_17shift_calculators_Vec3_list *)values[1]);
    __pyx_v_centres = ((struct __pyx_obj_17shift_calculators_Vec3_list *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_normals), __pyx_ptype_17shift_calculators_Vec3_list, 1, "normals", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_centres), __pyx_ptype_17shift_calculators_Vec3_list, 1, "centres", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self), __pyx_v_rings, __pyx_v_normals, __pyx_v_centres);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1085")'> 1085: </pre>
<pre id='line1085' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1086")'> 1086: </pre>
<pre id='line1086' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1087")'> 1087:     @cython.profile(True)</pre>
<pre id='line1087' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1088")'> 1088:     def __call__(self, rings, Vec3_list normals, Vec3_list centres):</pre>
<pre id='line1088' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1088
 * 
 *     @cython.profile(True)
 *     def __call__(self, rings, Vec3_list normals, Vec3_list centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 * #        cdef Vec3_container centre
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_6__call__(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_rings, struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_normals, struct __pyx_obj_17shift_calculators_Vec3_list *__pyx_v_centres) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  int __pyx_v_ring_id;
  PyObject *__pyx_v_ring_component = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1088);
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1089")'> 1089:         self.set_simulation()</pre>
<pre id='line1089' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1089
 *     @cython.profile(True)
 *     def __call__(self, rings, Vec3_list normals, Vec3_list centres):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        cdef Vec3_container centre
 * #         cdef Vec3_container normal
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1089; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1089; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1090")'> 1090: #        cdef Vec3_container centre</pre>
<pre id='line1090' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1091")'> 1091: #         cdef Vec3_container normal</pre>
<pre id='line1091' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1092")'> 1092:         cdef double start_time = 0.0</pre>
<pre id='line1092' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1092
 * #        cdef Vec3_container centre
 * #         cdef Vec3_container normal
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         self.set_simulation()
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1093")'> 1093:         cdef double end_time = 0.0</pre>
<pre id='line1093' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1093
 * #         cdef Vec3_container normal
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 * 
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1094")'> 1094:         self.set_simulation()</pre>
<pre id='line1094' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1094
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1095")'> 1095: </pre>
<pre id='line1095' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1096")'> 1096:         if self._verbose:</pre>
<pre id='line1096' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1096
 *         self.set_simulation()
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1097")'> 1097:             start_time = time()</pre>
<pre id='line1097' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1097
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         normals.set_length(len(rings))
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1098")'> 1098: </pre>
<pre id='line1098' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1099")'> 1099:         normals.set_length(len(rings))</pre>
<pre id='line1099' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1099
 *             start_time = time()
 * 
 *         normals.set_length(len(rings))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         centres.set_length(len(rings))
 *         cdef int ring_id
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1099; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_list *)__pyx_v_normals->__pyx_vtab)->set_length(__pyx_v_normals, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1099; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1100")'> 1100:         centres.set_length(len(rings))</pre>
<pre id='line1100' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1100
 * 
 *         normals.set_length(len(rings))
 *         centres.set_length(len(rings))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int ring_id
 *         for ring_id,ring_component in enumerate(rings):
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_list *)__pyx_v_centres->__pyx_vtab)->set_length(__pyx_v_centres, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1101")'> 1101:         cdef int ring_id</pre>
<pre id='line1101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1102")'> 1102:         for ring_id,ring_component in enumerate(rings):</pre>
<pre id='line1102' class='code' style='background-color: #FFFF2a'>
  /* "Cython_shift_calculator.pyx":1102
 *         centres.set_length(len(rings))
 *         cdef int ring_id
 *         for ring_id,ring_component in enumerate(rings):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ring_id = ring_component[0]
 * 
 */
  __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_rings) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_rings)) {
    __pyx_t_2 = __pyx_v_rings; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
    __pyx_v_ring_component = __pyx_t_1;
    __pyx_t_1 = 0;
    __pyx_v_ring_id = __pyx_t_5;
    __pyx_t_5 = (__pyx_t_5 + 1);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1103")'> 1103:             ring_id = ring_component[0]</pre>
<pre id='line1103' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":1103
 *         cdef int ring_id
 *         for ring_id,ring_component in enumerate(rings):
 *             ring_id = ring_component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._calculate_one_ring_centre(ring_component, centres.get(ring_id))
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_ring_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1104")'> 1104: </pre>
<pre id='line1104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1105")'> 1105:             self._calculate_one_ring_centre(ring_component, centres.get(ring_id))</pre>
<pre id='line1105' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1105
 *             ring_id = ring_component[0]
 * 
 *             self._calculate_one_ring_centre(ring_component, centres.get(ring_id))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_centre(__pyx_v_self, __pyx_v_ring_component, __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_centres, __pyx_v_ring_id));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1106")'> 1106: </pre>
<pre id='line1106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1107")'> 1107: </pre>
<pre id='line1107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1108")'> 1108:             self._calculate_one_ring_normal(ring_component, normals.get(ring_id))</pre>
<pre id='line1108' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1108
 * 
 * 
 *             self._calculate_one_ring_normal(ring_component, normals.get(ring_id))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #             normal_component = ring_id, normal
 * #             normals.add_component(normal_component)
 */
    __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_normal(__pyx_v_self, __pyx_v_ring_component, __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_normals, __pyx_v_ring_id));
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1109")'> 1109: #             normal_component = ring_id, normal</pre>
<pre id='line1109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1110")'> 1110: #             normals.add_component(normal_component)</pre>
<pre id='line1110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1111")'> 1111: </pre>
<pre id='line1111' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1112")'> 1112:         if self._verbose:</pre>
<pre id='line1112' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1112
 * #             normals.add_component(normal_component)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1113")'> 1113:             end_time = time()</pre>
<pre id='line1113' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1113
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF17' onclick='toggleDiv("line1114")'> 1114:             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1114' class='code' style='background-color: #FFFF17'>
    /* "Cython_shift_calculator.pyx":1114
 *         if self._verbose:
 *             end_time = time()
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_non_bonded_calculator:
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_normals));<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_9 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, ((PyObject *)__pyx_kp_s_31));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_32));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2, ((PyObject *)__pyx_kp_s_32));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_32));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 3, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 4, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 5, ((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_9 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_8), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_min_residue_seperation = 0;
  PyObject *__pyx_v_cutoff_distance = 0;
  PyObject *__pyx_v_jitter = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_33,&__pyx_n_s__cutoff_distance,&__pyx_n_s__jitter,0};
    PyObject* values[3] = {0,0,0};
    values[1] = __pyx_k_34;
    values[2] = __pyx_k_35;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_33)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__cutoff_distance);
          if (value) { values[1] = value; kw_args--; }
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__jitter);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_min_residue_seperation = values[0];
    __pyx_v_cutoff_distance = values[1];
    __pyx_v_jitter = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), __pyx_v_min_residue_seperation, __pyx_v_cutoff_distance, __pyx_v_jitter);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1115")'> 1115: </pre>
<pre id='line1115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1116")'> 1116: cdef class Fast_non_bonded_calculator:</pre>
<pre id='line1116' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1116
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_non_bonded_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int _min_residue_seperation
 *     cdef float _cutoff_distance
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *__pyx_vtab;
  int _min_residue_seperation;
  float _cutoff_distance;
  float _jitter;
  float _full_cutoff_distance;
  int _verbose;
  Simulation *_simulation;
};


/* "Cython_shift_calculator.pyx":1116
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_non_bonded_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int _min_residue_seperation
 *     cdef float _cutoff_distance
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator {
  int (*_filter_by_residue)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, char *, int, char *, int);
  int (*_is_non_bonded)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, int, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_calculator;
static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, char *, int, char *, int);
static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, int, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1117")'> 1117:     cdef int _min_residue_seperation</pre>
<pre id='line1117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1118")'> 1118:     cdef float _cutoff_distance</pre>
<pre id='line1118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1119")'> 1119:     cdef float _jitter</pre>
<pre id='line1119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1120")'> 1120:     cdef float _full_cutoff_distance</pre>
<pre id='line1120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1121")'> 1121:     cdef bint _verbose</pre>
<pre id='line1121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1122")'> 1122:     cdef Simulation* _simulation</pre>
<pre id='line1122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1123")'> 1123:     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):</pre>
<pre id='line1123' class='code' style='background-color: #FFFF7f'>
/* "Cython_shift_calculator.pyx":1123
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance
 */

static int __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_min_residue_seperation, PyObject *__pyx_v_cutoff_distance, PyObject *__pyx_v_jitter) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);

  /* "Cython_shift_calculator.pyx":1123
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(5.0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_34 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_35 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1124")'> 1124:         self._min_residue_seperation =  min_residue_seperation</pre>
<pre id='line1124' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1124
 *     cdef Simulation* _simulation
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):
 *         self._min_residue_seperation =  min_residue_seperation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_min_residue_seperation);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_min_residue_seperation = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1125")'> 1125:         self._cutoff_distance =  cutoff_distance</pre>
<pre id='line1125' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1125
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 */
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_cutoff_distance);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_cutoff_distance = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1126")'> 1126:         self._jitter = jitter</pre>
<pre id='line1126' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1126
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False
 */
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_jitter);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_jitter = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1127")'> 1127:         self._full_cutoff_distance =  self._cutoff_distance + self._jitter</pre>
<pre id='line1127' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1127
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  False
 *         self._simulation =  currentSimulation()
 */
  __pyx_v_self->_full_cutoff_distance = (__pyx_v_self->_cutoff_distance + __pyx_v_self->_jitter);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1128")'> 1128:         self._verbose =  False</pre>
<pre id='line1128' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1128
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1129")'> 1129:         self._simulation =  currentSimulation()</pre>
<pre id='line1129' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":1129
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_2set_simulation(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1130")'> 1130: </pre>
<pre id='line1130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1131")'> 1131:     def set_simulation(self):</pre>
<pre id='line1131' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1131
 *         self._simulation =  currentSimulation()
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_2set_simulation(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1132")'> 1132:         self._simulation = currentSimulation()</pre>
<pre id='line1132' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":1132
 * 
 *     def set_simulation(self):
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1133")'> 1133: </pre>
<pre id='line1133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1134")'> 1134:     def set_verbose(self,on):</pre>
<pre id='line1134' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1134
 *         self._simulation = currentSimulation()
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose=on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line1135")'> 1135:         self._verbose=on</pre>
<pre id='line1135' class='code' style='background-color: #FFFF6a'>
  /* "Cython_shift_calculator.pyx":1135
 * 
 *     def set_verbose(self,on):
 *         self._verbose=on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1136")'> 1136: </pre>
<pre id='line1136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1137")'> 1137:     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):</pre>
<pre id='line1137' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1137
 *         self._verbose=on
 * 
 *     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int sequence_distance
 *         cdef bint result
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, char *__pyx_v_seg_1, int __pyx_v_residue_1, char *__pyx_v_seg_2, int __pyx_v_residue_2) {
  int __pyx_v_sequence_distance;
  int __pyx_v_result;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_filter_by_residue", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1138")'> 1138:         cdef int sequence_distance</pre>
<pre id='line1138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1139")'> 1139:         cdef bint result</pre>
<pre id='line1139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1140")'> 1140: </pre>
<pre id='line1140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1141")'> 1141:         result = False</pre>
<pre id='line1141' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1141
 *         cdef bint result
 * 
 *         result = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if strcmp(seg_1, seg_2) == 0:
 */
  __pyx_v_result = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1142")'> 1142: </pre>
<pre id='line1142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1143")'> 1143:         if strcmp(seg_1, seg_2) == 0:</pre>
<pre id='line1143' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1143
 *         result = False
 * 
 *         if strcmp(seg_1, seg_2) == 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 */
  __pyx_t_1 = (strcmp(__pyx_v_seg_1, __pyx_v_seg_2) == 0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1144")'> 1144:             sequence_distance =abs(residue_1-residue_2)</pre>
<pre id='line1144' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1144
 * 
 *         if strcmp(seg_1, seg_2) == 0:
 *             sequence_distance =abs(residue_1-residue_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True
 */
    __pyx_t_2 = __Pyx_abs_int((__pyx_v_residue_1 - __pyx_v_residue_2)); 
    __pyx_v_sequence_distance = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1145")'> 1145:             if sequence_distance &lt; self._min_residue_seperation:</pre>
<pre id='line1145' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1145
 *         if strcmp(seg_1, seg_2) == 0:
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result =True
 *         return result
 */
    __pyx_t_1 = (__pyx_v_sequence_distance <code><</code> __pyx_v_self->_min_residue_seperation);
    if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1146")'> 1146:                 result =True</pre>
<pre id='line1146' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1146
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
      __pyx_v_result = 1;
      goto __pyx_L4;
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1147")'> 1147:         return result</pre>
<pre id='line1147' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1147
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1148")'> 1148: </pre>
<pre id='line1148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1149")'> 1149:     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):</pre>
<pre id='line1149' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1149
 *         return result
 * 
 *     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Atom atom_1, atom_2
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, int __pyx_v_atom_id_1, int __pyx_v_atom_id_2) {
  Atom __pyx_v_atom_1;
  Atom __pyx_v_atom_2;
  char *__pyx_v_seg_1;
  char *__pyx_v_seg_2;
  int __pyx_v_residue_1;
  int __pyx_v_residue_2;
  int __pyx_v_is_non_bonded;
  float __pyx_v_distance;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_is_non_bonded", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1150")'> 1150: </pre>
<pre id='line1150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1151")'> 1151:         cdef Atom atom_1, atom_2</pre>
<pre id='line1151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1152")'> 1152:         cdef char *seg_1, *seg_2</pre>
<pre id='line1152' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1153")'> 1153:         cdef int residue_1, residue_2</pre>
<pre id='line1153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1154")'> 1154:         cdef bint is_non_bonded</pre>
<pre id='line1154' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1155")'> 1155:         cdef float distance</pre>
<pre id='line1155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1156")'> 1156: </pre>
<pre id='line1156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1157")'> 1157:         atom_1 = currentSimulation().atomByID(atom_id_1)</pre>
<pre id='line1157' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1157
 *         cdef float distance
 * 
 *         atom_1 = currentSimulation().atomByID(atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_2 = currentSimulation().atomByID(atom_id_2)
 * 
 */
  __pyx_v_atom_1 = Simulation::currentSimulation()->atomByID(__pyx_v_atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1158")'> 1158:         atom_2 = currentSimulation().atomByID(atom_id_2)</pre>
<pre id='line1158' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1158
 * 
 *         atom_1 = currentSimulation().atomByID(atom_id_1)
 *         atom_2 = currentSimulation().atomByID(atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()
 */
  __pyx_v_atom_2 = Simulation::currentSimulation()->atomByID(__pyx_v_atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1159")'> 1159: </pre>
<pre id='line1159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1160")'> 1160:         seg_1 =  &lt;char *&gt;atom_1.segmentName()</pre>
<pre id='line1160' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1160
 *         atom_2 = currentSimulation().atomByID(atom_id_2)
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         residue_1 = atom_1.residueNum()
 * 
 */
  __pyx_v_seg_1 = ((char *)__pyx_v_atom_1.segmentName());
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1161")'> 1161:         residue_1 = atom_1.residueNum()</pre>
<pre id='line1161' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1161
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()
 *         residue_1 = atom_1.residueNum()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()
 */
  __pyx_v_residue_1 = __pyx_v_atom_1.residueNum();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1162")'> 1162: </pre>
<pre id='line1162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1163")'> 1163:         seg_2 = &lt;char*&gt;atom_2.segmentName()</pre>
<pre id='line1163' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1163
 *         residue_1 = atom_1.residueNum()
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         residue_2 =  atom_2.residueNum()
 * 
 */
  __pyx_v_seg_2 = ((char *)__pyx_v_atom_2.segmentName());
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1164")'> 1164:         residue_2 =  atom_2.residueNum()</pre>
<pre id='line1164' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1164
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()
 *         residue_2 =  atom_2.residueNum()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         is_non_bonded = True
 */
  __pyx_v_residue_2 = __pyx_v_atom_2.residueNum();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1165")'> 1165: </pre>
<pre id='line1165' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1166")'> 1166:         is_non_bonded = True</pre>
<pre id='line1166' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1166
 *         residue_2 =  atom_2.residueNum()
 * 
 *         is_non_bonded = True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):
 *             is_non_bonded = False
 */
  __pyx_v_is_non_bonded = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1167")'> 1167:         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):</pre>
<pre id='line1167' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1167
 * 
 *         is_non_bonded = True
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             is_non_bonded = False
 *         else:
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(__pyx_v_self, __pyx_v_seg_1, __pyx_v_residue_1, __pyx_v_seg_2, __pyx_v_residue_2);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1168")'> 1168:             is_non_bonded = False</pre>
<pre id='line1168' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1168
 *         is_non_bonded = True
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):
 *             is_non_bonded = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())
 */
    __pyx_v_is_non_bonded = 0;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1169")'> 1169:         else:</pre>
<pre id='line1169' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1170")'> 1170:             distance = norm(atom_1.pos() - atom_2.pos())</pre>
<pre id='line1170' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1170
 *             is_non_bonded = False
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance
 *         return is_non_bonded
 */
    __pyx_v_distance = norm((__pyx_v_atom_1.pos() - __pyx_v_atom_2.pos()));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1171")'> 1171:             is_non_bonded =  distance &lt; self._full_cutoff_distance</pre>
<pre id='line1171' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1171
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return is_non_bonded
 * 
 */
    __pyx_v_is_non_bonded = (__pyx_v_distance <code><</code> __pyx_v_self->_full_cutoff_distance);
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line1172")'> 1172:         return is_non_bonded</pre>
<pre id='line1172' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":1172
 *             distance = norm(atom_1.pos() - atom_2.pos())
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance
 *         return is_non_bonded             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = __pyx_v_is_non_bonded;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_atom_list_1 = 0;
  PyObject *__pyx_v_atom_list_2 = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__atom_list_1,&__pyx_n_s__atom_list_2,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_list_1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_list_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_atom_list_1 = values[0];
    __pyx_v_atom_list_2 = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), __pyx_v_atom_list_1, __pyx_v_atom_list_2);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1173")'> 1173: </pre>
<pre id='line1173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1174")'> 1174:     @cython.profile(True)</pre>
<pre id='line1174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1175")'> 1175:     def __call__(self, atom_list_1, atom_list_2):</pre>
<pre id='line1175' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1175
 * 
 *     @cython.profile(True)
 *     def __call__(self, atom_list_1, atom_list_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_6__call__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_atom_list_1, PyObject *__pyx_v_atom_list_2) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_non_bonded_lists = NULL;
  int __pyx_v_i;
  int __pyx_v_atom_id_1;
  int __pyx_v_atom_id_2;
  PyObject *__pyx_v_non_bonded_list = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1175);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1176")'> 1176: </pre>
<pre id='line1176' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1177")'> 1177:         if self._verbose:</pre>
<pre id='line1177' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1177
 *     def __call__(self, atom_list_1, atom_list_2):
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '***** BUILD NON BONDED ******'
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1178")'> 1178:             print '***** BUILD NON BONDED ******'</pre>
<pre id='line1178' class='code' style='background-color: #FFFFd4'>
    /* "Cython_shift_calculator.pyx":1178
 * 
 *         if self._verbose:
 *             print '***** BUILD NON BONDED ******'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time = 0.0
 */
    if (<span class='pyx_c_api'>__Pyx_PrintOne</span>(0, ((PyObject *)__pyx_kp_s_36)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1179")'> 1179: </pre>
<pre id='line1179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1180")'> 1180:         cdef double start_time = 0.0</pre>
<pre id='line1180' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1180
 *             print '***** BUILD NON BONDED ******'
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1181")'> 1181:         cdef double end_time = 0.0</pre>
<pre id='line1181' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1181
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1182")'> 1182:         if self._verbose:</pre>
<pre id='line1182' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1182
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1183")'> 1183:             start_time = time()</pre>
<pre id='line1183' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1183
 *         cdef double end_time = 0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1184")'> 1184: </pre>
<pre id='line1184' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1185")'> 1185: </pre>
<pre id='line1185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1186")'> 1186:         self.set_simulation()</pre>
<pre id='line1186' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1186
 * 
 * 
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         non_bonded_lists = []
 *         cdef int i, atom_id_1, atom_id_2
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1187")'> 1187:         non_bonded_lists = []</pre>
<pre id='line1187' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1187
 * 
 *         self.set_simulation()
 *         non_bonded_lists = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int i, atom_id_1, atom_id_2
 *         for atom_id_1 in atom_list_1:
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_non_bonded_lists = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1188")'> 1188:         cdef int i, atom_id_1, atom_id_2</pre>
<pre id='line1188' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1189")'> 1189:         for atom_id_1 in atom_list_1:</pre>
<pre id='line1189' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1189
 *         non_bonded_lists = []
 *         cdef int i, atom_id_1, atom_id_2
 *         for atom_id_1 in atom_list_1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             non_bonded_list = []
 *             non_bonded_lists.append(non_bonded_list)
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_atom_list_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_atom_list_1)) {
    __pyx_t_1 = __pyx_v_atom_list_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_atom_list_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_atom_id_1 = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1190")'> 1190:             non_bonded_list = []</pre>
<pre id='line1190' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":1190
 *         cdef int i, atom_id_1, atom_id_2
 *         for atom_id_1 in atom_list_1:
 *             non_bonded_list = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             non_bonded_lists.append(non_bonded_list)
 *             for i, atom_id_2 in enumerate(atom_list_2):
 */
    __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_v_non_bonded_list));
    __pyx_v_non_bonded_list = ((PyObject*)__pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1191")'> 1191:             non_bonded_lists.append(non_bonded_list)</pre>
<pre id='line1191' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1191
 *         for atom_id_1 in atom_list_1:
 *             non_bonded_list = []
 *             non_bonded_lists.append(non_bonded_list)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i, atom_id_2 in enumerate(atom_list_2):
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 */
    __pyx_t_7 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_non_bonded_lists, ((PyObject *)__pyx_v_non_bonded_list));<span class='error_goto'> if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1192")'> 1192:             for i, atom_id_2 in enumerate(atom_list_2):</pre>
<pre id='line1192' class='code' style='background-color: #FFFF24'>
    /* "Cython_shift_calculator.pyx":1192
 *             non_bonded_list = []
 *             non_bonded_lists.append(non_bonded_list)
 *             for i, atom_id_2 in enumerate(atom_list_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_list.append(i)
 */
    __pyx_t_6 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_atom_list_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_atom_list_2)) {
      __pyx_t_2 = __pyx_v_atom_list_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_atom_list_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_9 = Py_TYPE(__pyx_t_2)->tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_8 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_10 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_8); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_8++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_8); __pyx_t_8++;<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_8 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_10 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_8); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_8++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_8); __pyx_t_8++;<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_10 = __pyx_t_9(__pyx_t_2);
        if (unlikely(!__pyx_t_10)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      }
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_10);<span class='error_goto'> if (unlikely((__pyx_t_11 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_v_atom_id_2 = __pyx_t_11;
      __pyx_v_i = __pyx_t_6;
      __pyx_t_6 = (__pyx_t_6 + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1193")'> 1193:                 if self._is_non_bonded(atom_id_1, atom_id_2):</pre>
<pre id='line1193' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1193
 *             non_bonded_lists.append(non_bonded_list)
 *             for i, atom_id_2 in enumerate(atom_list_2):
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     non_bonded_list.append(i)
 *         if self._verbose:
 */
      __pyx_t_12 = __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(__pyx_v_self, __pyx_v_atom_id_1, __pyx_v_atom_id_2);
      if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1194")'> 1194:                     non_bonded_list.append(i)</pre>
<pre id='line1194' class='code' style='background-color: #FFFF6e'>
        /* "Cython_shift_calculator.pyx":1194
 *             for i, atom_id_2 in enumerate(atom_list_2):
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_list.append(i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             end_time = time()
 */
        __pyx_t_10 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
        __pyx_t_7 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_non_bonded_list, __pyx_t_10);<span class='error_goto'> if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        goto __pyx_L9;
      }
      __pyx_L9:;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1195")'> 1195:         if self._verbose:</pre>
<pre id='line1195' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1195
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_list.append(i)
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1196")'> 1196:             end_time = time()</pre>
<pre id='line1196' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1196
 *                     non_bonded_list.append(i)
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 *         return  non_bonded_lists
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1197")'> 1197:             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1197' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":1197
 *         if self._verbose:
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  non_bonded_lists
 * 
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_list_1);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_list_2);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
    __pyx_t_13 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_13));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_37));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, ((PyObject *)__pyx_kp_s_37));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_37));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_38));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 2, ((PyObject *)__pyx_kp_s_38));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_38));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 3, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 4, ((PyObject *)__pyx_kp_s_39));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 5, ((PyObject *)__pyx_t_13));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_13));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_2 = 0;
    __pyx_t_1 = 0;
    __pyx_t_13 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_10), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line1198")'> 1198:         return  non_bonded_lists</pre>
<pre id='line1198' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":1198
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 *         return  non_bonded_lists             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_non_bonded_lists));
  __pyx_r = ((PyObject *)__pyx_v_non_bonded_lists);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_non_bonded_lists);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_non_bonded_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_22Fast_energy_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_22Fast_energy_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1199")'> 1199: </pre>
<pre id='line1199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1200")'> 1200: </pre>
<pre id='line1200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1201")'> 1201: cdef class Fast_energy_calculator:</pre>
<pre id='line1201' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1201
 * 
 * 
 * cdef class Fast_energy_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _energy_term_cache
 *     cdef object _theory_shifts
 */
struct __pyx_obj_17shift_calculators_Fast_energy_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *__pyx_vtab;
  PyObject *_energy_term_cache;
  PyObject *_theory_shifts;
  PyObject *_observed_shifts;
  int _verbose;
  Simulation *_simulation;
  int calls;
};


/* "Cython_shift_calculator.pyx":1201
 * 
 * 
 * cdef class Fast_energy_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _energy_term_cache
 *     cdef object _theory_shifts
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator {
  PyObject *(*_get_energy_terms)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_calculated_atom_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_observed_atom_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_shift_difference)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_adjust_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, float, float);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *__pyx_vtabptr_17shift_calculators_Fast_energy_calculator;
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, float, float);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1202")'> 1202:     cdef object _energy_term_cache</pre>
<pre id='line1202' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1203")'> 1203:     cdef object _theory_shifts</pre>
<pre id='line1203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1204")'> 1204:     cdef object _observed_shifts</pre>
<pre id='line1204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1205")'> 1205:     cdef bint _verbose</pre>
<pre id='line1205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1206")'> 1206:     cdef Simulation* _simulation</pre>
<pre id='line1206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1207")'> 1207:     cdef int calls</pre>
<pre id='line1207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1208")'> 1208: </pre>
<pre id='line1208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1209")'> 1209:     def __init__(self):</pre>
<pre id='line1209' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1209
 *     cdef int calls
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._energy_term_cache =  None
 *         self._theory_shifts =   None
 */

static int __pyx_pf_17shift_calculators_22Fast_energy_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1210")'> 1210:         self._energy_term_cache =  None</pre>
<pre id='line1210' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1210
 * 
 *     def __init__(self):
 *         self._energy_term_cache =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._theory_shifts =   None
 *         self._observed_shifts =  None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_energy_term_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_energy_term_cache);
  __pyx_v_self->_energy_term_cache = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1211")'> 1211:         self._theory_shifts =   None</pre>
<pre id='line1211' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1211
 *     def __init__(self):
 *         self._energy_term_cache =  None
 *         self._theory_shifts =   None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._observed_shifts =  None
 *         self._verbose = False
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_theory_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_theory_shifts);
  __pyx_v_self->_theory_shifts = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1212")'> 1212:         self._observed_shifts =  None</pre>
<pre id='line1212' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1212
 *         self._energy_term_cache =  None
 *         self._theory_shifts =   None
 *         self._observed_shifts =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self._simulation = currentSimulation()
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_observed_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_observed_shifts);
  __pyx_v_self->_observed_shifts = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1213")'> 1213:         self._verbose = False</pre>
<pre id='line1213' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1213
 *         self._theory_shifts =   None
 *         self._observed_shifts =  None
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 *         self.calls = 0
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1214")'> 1214:         self._simulation = currentSimulation()</pre>
<pre id='line1214' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1214
 *         self._observed_shifts =  None
 *         self._verbose = False
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.calls = 0
 * 
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1215")'> 1215:         self.calls = 0</pre>
<pre id='line1215' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1215
 *         self._verbose = False
 *         self._simulation = currentSimulation()
 *         self.calls = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_v_self->calls = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_2set_simulation(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1216")'> 1216: </pre>
<pre id='line1216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1217")'> 1217:     def set_simulation(self):</pre>
<pre id='line1217' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1217
 *         self.calls = 0
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_2set_simulation(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1218")'> 1218:         self._simulation = currentSimulation()</pre>
<pre id='line1218' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":1218
 * 
 *     def set_simulation(self):
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1219")'> 1219: </pre>
<pre id='line1219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1220")'> 1220:     def set_verbose(self,on):</pre>
<pre id='line1220' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1220
 *         self._simulation = currentSimulation()
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1221")'> 1221:         self._verbose = on</pre>
<pre id='line1221' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1221
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_observed_shifts(self, observed_shifts):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_7set_observed_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_observed_shifts); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_7set_observed_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_observed_shifts) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_observed_shifts (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_6set_observed_shifts(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_observed_shifts));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1222")'> 1222: </pre>
<pre id='line1222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1223")'> 1223:     def set_observed_shifts(self, observed_shifts):</pre>
<pre id='line1223' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1223
 *         self._verbose = on
 * 
 *     def set_observed_shifts(self, observed_shifts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._observed_shifts =  observed_shifts
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_6set_observed_shifts(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_observed_shifts) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_observed_shifts", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1224")'> 1224:         self._observed_shifts =  observed_shifts</pre>
<pre id='line1224' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1224
 * 
 *     def set_observed_shifts(self, observed_shifts):
 *         self._observed_shifts =  observed_shifts             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_calculated_shifts(self, calculated_shifts):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_observed_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_observed_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_observed_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_observed_shifts);
  __pyx_v_self->_observed_shifts = __pyx_v_observed_shifts;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_9set_calculated_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_calculated_shifts); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_9set_calculated_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_calculated_shifts) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_calculated_shifts (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_8set_calculated_shifts(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_calculated_shifts));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1225")'> 1225: </pre>
<pre id='line1225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1226")'> 1226:     def set_calculated_shifts(self, calculated_shifts):</pre>
<pre id='line1226' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1226
 *         self._observed_shifts =  observed_shifts
 * 
 *     def set_calculated_shifts(self, calculated_shifts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._theory_shifts =  calculated_shifts
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_8set_calculated_shifts(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_calculated_shifts) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_calculated_shifts", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1227")'> 1227:         self._theory_shifts =  calculated_shifts</pre>
<pre id='line1227' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1227
 * 
 *     def set_calculated_shifts(self, calculated_shifts):
 *         self._theory_shifts =  calculated_shifts             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_calculated_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_calculated_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_theory_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_theory_shifts);
  __pyx_v_self->_theory_shifts = __pyx_v_calculated_shifts;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_11set_energy_term_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_energy_term_cache); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_11set_energy_term_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_energy_term_cache) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_energy_term_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_10set_energy_term_cache(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_energy_term_cache));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1228")'> 1228: </pre>
<pre id='line1228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1229")'> 1229:     def set_energy_term_cache(self, energy_term_cache ):</pre>
<pre id='line1229' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1229
 *         self._theory_shifts =  calculated_shifts
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._energy_term_cache =  energy_term_cache
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_10set_energy_term_cache(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_energy_term_cache) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_energy_term_cache", 0);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1230")'> 1230:         self._energy_term_cache =  energy_term_cache</pre>
<pre id='line1230' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":1230
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):
 *         self._energy_term_cache =  energy_term_cache             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _get_energy_terms(self, int target_atom_index):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_energy_term_cache);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_energy_term_cache);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_energy_term_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_energy_term_cache);
  __pyx_v_self->_energy_term_cache = __pyx_v_energy_term_cache;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1231")'> 1231: </pre>
<pre id='line1231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1232")'> 1232:     cdef _get_energy_terms(self, int target_atom_index):</pre>
<pre id='line1232' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1232
 *         self._energy_term_cache =  energy_term_cache
 * 
 *     cdef _get_energy_terms(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._energy_term_cache[target_atom_index]
 * 
 */

static PyObject *__pyx_f_17shift_calculators_22Fast_energy_calculator__get_energy_terms(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_energy_terms", 0);
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1233")'> 1233:         return self._energy_term_cache[target_atom_index]</pre>
<pre id='line1233' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":1233
 * 
 *     cdef _get_energy_terms(self, int target_atom_index):
 *         return self._energy_term_cache[target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_self->_energy_term_cache, __pyx_v_target_atom_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator._get_energy_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1234")'> 1234: </pre>
<pre id='line1234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1235")'> 1235:     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):</pre>
<pre id='line1235' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1235
 *         return self._energy_term_cache[target_atom_index]
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._theory_shifts[target_atom_index]
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_calculated_atom_shift", 0);
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1236")'> 1236:         return self._theory_shifts[target_atom_index]</pre>
<pre id='line1236' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":1236
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):
 *         return self._theory_shifts[target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float _get_observed_atom_shift(self, int target_atom_index):
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_self->_theory_shifts, __pyx_v_target_atom_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_energy_calculator._get_calculated_atom_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1237")'> 1237: </pre>
<pre id='line1237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1238")'> 1238:     cdef inline float _get_observed_atom_shift(self, int target_atom_index):</pre>
<pre id='line1238' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1238
 *         return self._theory_shifts[target_atom_index]
 * 
 *     cdef inline float _get_observed_atom_shift(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._observed_shifts.get_chemical_shift(target_atom_index)
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_observed_atom_shift", 0);
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line1239")'> 1239:         return self._observed_shifts.get_chemical_shift(target_atom_index)</pre>
<pre id='line1239' class='code' style='background-color: #FFFF33'>
  /* "Cython_shift_calculator.pyx":1239
 * 
 *     cdef inline float _get_observed_atom_shift(self, int target_atom_index):
 *         return self._observed_shifts.get_chemical_shift(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float  _get_shift_difference(self, int target_atom_index):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_observed_shifts, __pyx_n_s__get_chemical_shift);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_target_atom_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1239; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_energy_calculator._get_observed_atom_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1240")'> 1240: </pre>
<pre id='line1240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1241")'> 1241:     cdef inline float  _get_shift_difference(self, int target_atom_index):</pre>
<pre id='line1241' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1241
 *         return self._observed_shifts.get_chemical_shift(target_atom_index)
 * 
 *     cdef inline float  _get_shift_difference(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float theory_shift
 *         cdef float observed_shift
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  float __pyx_v_theory_shift;
  float __pyx_v_observed_shift;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_shift_difference", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1242")'> 1242:         cdef float theory_shift</pre>
<pre id='line1242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1243")'> 1243:         cdef float observed_shift</pre>
<pre id='line1243' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1244")'> 1244:         theory_shift = self._get_calculated_atom_shift(target_atom_index)</pre>
<pre id='line1244' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1244
 *         cdef float theory_shift
 *         cdef float observed_shift
 *         theory_shift = self._get_calculated_atom_shift(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         observed_shift = self._get_observed_atom_shift(target_atom_index)
 */
  __pyx_v_theory_shift = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(__pyx_v_self, __pyx_v_target_atom_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1245")'> 1245: </pre>
<pre id='line1245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1246")'> 1246:         observed_shift = self._get_observed_atom_shift(target_atom_index)</pre>
<pre id='line1246' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1246
 *         theory_shift = self._get_calculated_atom_shift(target_atom_index)
 * 
 *         observed_shift = self._get_observed_atom_shift(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return observed_shift - theory_shift
 */
  __pyx_v_observed_shift = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(__pyx_v_self, __pyx_v_target_atom_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1247")'> 1247: </pre>
<pre id='line1247' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1248")'> 1248:         return observed_shift - theory_shift</pre>
<pre id='line1248' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1248
 *         observed_shift = self._get_observed_atom_shift(target_atom_index)
 * 
 *         return observed_shift - theory_shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):
 */
  __pyx_r = (__pyx_v_observed_shift - __pyx_v_theory_shift);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1249")'> 1249: </pre>
<pre id='line1249' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1250")'> 1250:     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):</pre>
<pre id='line1250' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1250
 *         return observed_shift - theory_shift
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = 0.0
 *         if (shift_diff > 0.0):
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, float __pyx_v_shift_diff, float __pyx_v_flat_bottom_shift_limit) {
  double __pyx_v_result;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_adjust_shift", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1251")'> 1251:         result  = 0.0</pre>
<pre id='line1251' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1251
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):
 *         result  = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if (shift_diff > 0.0):
 *             result = shift_diff-flat_bottom_shift_limit
 */
  __pyx_v_result = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1252")'> 1252:         if (shift_diff &gt; 0.0):</pre>
<pre id='line1252' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1252
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):
 *         result  = 0.0
 *         if (shift_diff > 0.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = shift_diff-flat_bottom_shift_limit
 *         else:
 */
  __pyx_t_1 = (__pyx_v_shift_diff > 0.0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1253")'> 1253:             result = shift_diff-flat_bottom_shift_limit</pre>
<pre id='line1253' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1253
 *         result  = 0.0
 *         if (shift_diff > 0.0):
 *             result = shift_diff-flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit
 */
    __pyx_v_result = (__pyx_v_shift_diff - __pyx_v_flat_bottom_shift_limit);
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1254")'> 1254:         else:</pre>
<pre id='line1254' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1255")'> 1255:             result = shift_diff + flat_bottom_shift_limit</pre>
<pre id='line1255' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1255
 *             result = shift_diff-flat_bottom_shift_limit
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
    __pyx_v_result = (__pyx_v_shift_diff + __pyx_v_flat_bottom_shift_limit);
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line1256")'> 1256:         return result</pre>
<pre id='line1256' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":1256
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_13__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_13__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_target_atom_ids = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_target_atom_ids = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_target_atom_ids.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_12__call__(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_target_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1257")'> 1257: </pre>
<pre id='line1257' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1258")'> 1258:     @cython.profile(True)</pre>
<pre id='line1258' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1259")'> 1259:     def __call__(self,int[:] target_atom_ids):</pre>
<pre id='line1259' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1259
 * 
 *     @cython.profile(True)
 *     def __call__(self,int[:] target_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef float energy
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_12__call__(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_target_atom_ids) {
  float __pyx_v_energy;
  float __pyx_v_flat_bottom_shift_limit;
  float __pyx_v_adjusted_shift_diff;
  float __pyx_v_end_harmonic;
  float __pyx_v_scale_harmonic;
  float __pyx_v_energy_component;
  float __pyx_v_tanh_amplitude;
  float __pyx_v_tanh_elongation;
  float __pyx_v_tanh_y_offset;
  float __pyx_v_tanh_argument;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  int __pyx_v_target_atom_index;
  PyObject *__pyx_v_shift_diff = NULL;
  PyObject *__pyx_v_energy_terms = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1259);
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1260")'> 1260:         self.set_simulation()</pre>
<pre id='line1260' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1260
 *     @cython.profile(True)
 *     def __call__(self,int[:] target_atom_ids):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float energy
 *         cdef float flat_bottom_shift_limit
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1261")'> 1261:         cdef float energy</pre>
<pre id='line1261' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1262")'> 1262:         cdef float flat_bottom_shift_limit</pre>
<pre id='line1262' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1263")'> 1263:         cdef float adjusted_shift_diff</pre>
<pre id='line1263' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1264")'> 1264:         cdef float end_harmonic</pre>
<pre id='line1264' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1265")'> 1265:         cdef float scale_harmonic</pre>
<pre id='line1265' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1266")'> 1266:         cdef float energy_component</pre>
<pre id='line1266' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1267")'> 1267:         cdef float tanh_amplitude</pre>
<pre id='line1267' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1268")'> 1268:         cdef float tanh_elongation</pre>
<pre id='line1268' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1269")'> 1269:         cdef float tanh_y_offset</pre>
<pre id='line1269' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1270")'> 1270:         cdef float tanh_argument</pre>
<pre id='line1270' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1271")'> 1271: </pre>
<pre id='line1271' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1272")'> 1272:         cdef double start_time = 0.0</pre>
<pre id='line1272' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1272
 *         cdef float tanh_argument
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1273")'> 1273:         cdef double end_time = 0.0</pre>
<pre id='line1273' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1273
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1274")'> 1274:         if self._verbose:</pre>
<pre id='line1274' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1274
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1275")'> 1275:             start_time = time()</pre>
<pre id='line1275' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1275
 *         cdef double end_time = 0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         energy = 0.0
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1276")'> 1276: </pre>
<pre id='line1276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1277")'> 1277:         energy = 0.0</pre>
<pre id='line1277' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1277
 *             start_time = time()
 * 
 *         energy = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef int target_atom_index
 */
  __pyx_v_energy = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1278")'> 1278: </pre>
<pre id='line1278' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1279")'> 1279:         cdef int target_atom_index</pre>
<pre id='line1279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1280")'> 1280:         cdef float shift_diffs</pre>
<pre id='line1280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1281")'> 1281: </pre>
<pre id='line1281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line1282")'> 1282:         for target_atom_index in target_atom_ids:</pre>
<pre id='line1282' class='code' style='background-color: #FFFF23'>
  /* "Cython_shift_calculator.pyx":1282
 *         cdef float shift_diffs
 * 
 *         for target_atom_index in target_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             shift_diff = self._get_shift_difference(target_atom_index)
 *             energy_terms = self._get_energy_terms(target_atom_index)
 */
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_target_atom_ids, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_target_atom_index = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1283")'> 1283:             shift_diff = self._get_shift_difference(target_atom_index)</pre>
<pre id='line1283' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":1283
 * 
 *         for target_atom_index in target_atom_ids:
 *             shift_diff = self._get_shift_difference(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             energy_terms = self._get_energy_terms(target_atom_index)
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(__pyx_v_self, __pyx_v_target_atom_index));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_shift_diff);
    __pyx_v_shift_diff = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1284")'> 1284:             energy_terms = self._get_energy_terms(target_atom_index)</pre>
<pre id='line1284' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1284
 *         for target_atom_index in target_atom_ids:
 *             shift_diff = self._get_shift_difference(target_atom_index)
 *             energy_terms = self._get_energy_terms(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *)__pyx_v_self->__pyx_vtab)->_get_energy_terms(__pyx_v_self, __pyx_v_target_atom_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
    __pyx_v_energy_terms = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1285")'> 1285: </pre>
<pre id='line1285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1286")'> 1286: </pre>
<pre id='line1286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1287")'> 1287:             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit</pre>
<pre id='line1287' class='code' style='background-color: #FFFF62'>
    /* "Cython_shift_calculator.pyx":1287
 * 
 * 
 *             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s_40);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_flat_bottom_shift_limit = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1288")'> 1288: </pre>
<pre id='line1288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1289")'> 1289: </pre>
<pre id='line1289' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line1290")'> 1290:             if abs(shift_diff) &gt; flat_bottom_shift_limit:</pre>
<pre id='line1290' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":1290
 * 
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Absolute</span>(__pyx_v_shift_diff);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_flat_bottom_shift_limit);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_9 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_t_8, Py_GT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_10 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(__pyx_t_10 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1291")'> 1291:                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)</pre>
<pre id='line1291' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":1291
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 end_harmonic = energy_terms.end_harmonic
 */
      __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_shift_diff);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_v_adjusted_shift_diff = __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(__pyx_v_self, __pyx_t_7, __pyx_v_flat_bottom_shift_limit);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1292")'> 1292: </pre>
<pre id='line1292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1293")'> 1293:                 end_harmonic = energy_terms.end_harmonic</pre>
<pre id='line1293' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":1293
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 * 
 *                 end_harmonic = energy_terms.end_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 scale_harmonic = energy_terms.scale_harmonic
 * 
 */
      __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__end_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_v_end_harmonic = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1294")'> 1294:                 scale_harmonic = energy_terms.scale_harmonic</pre>
<pre id='line1294' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":1294
 * 
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__scale_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_v_scale_harmonic = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1295")'> 1295: </pre>
<pre id='line1295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1296")'> 1296: </pre>
<pre id='line1296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1297")'> 1297:                 energy_component = 0.0</pre>
<pre id='line1297' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1297
 * 
 * 
 *                 energy_component = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2
 */
      __pyx_v_energy_component = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1298")'> 1298:                 if adjusted_shift_diff &lt; end_harmonic:</pre>
<pre id='line1298' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1298
 * 
 *                 energy_component = 0.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2
 *                 else:
 */
      __pyx_t_10 = (__pyx_v_adjusted_shift_diff <code><</code> __pyx_v_end_harmonic);
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1299")'> 1299:                     energy_component = (adjusted_shift_diff/scale_harmonic)**2</pre>
<pre id='line1299' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1299
 *                 energy_component = 0.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 *                     tanh_amplitude = energy_terms.tanh_amplitude
 */
        __pyx_v_energy_component = powf((__pyx_v_adjusted_shift_diff / __pyx_v_scale_harmonic), 2.0);
        goto __pyx_L7;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1300")'> 1300:                 else:</pre>
<pre id='line1300' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1301")'> 1301:                     tanh_amplitude = energy_terms.tanh_amplitude</pre>
<pre id='line1301' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":1301
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2
 *                 else:
 *                     tanh_amplitude = energy_terms.tanh_amplitude             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     tanh_elongation = energy_terms.tanh_elongation
 *                     tanh_y_offset = energy_terms.tanh_y_offset
 */
        __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_amplitude);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
        __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_v_tanh_amplitude = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1302")'> 1302:                     tanh_elongation = energy_terms.tanh_elongation</pre>
<pre id='line1302' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":1302
 *                 else:
 *                     tanh_amplitude = energy_terms.tanh_amplitude
 *                     tanh_elongation = energy_terms.tanh_elongation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     tanh_y_offset = energy_terms.tanh_y_offset
 * 
 */
        __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_elongation);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
        __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_v_tanh_elongation = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1303")'> 1303:                     tanh_y_offset = energy_terms.tanh_y_offset</pre>
<pre id='line1303' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":1303
 *                     tanh_amplitude = energy_terms.tanh_amplitude
 *                     tanh_elongation = energy_terms.tanh_elongation
 *                     tanh_y_offset = energy_terms.tanh_y_offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)
 */
        __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_y_offset);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
        __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_v_tanh_y_offset = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1304")'> 1304: </pre>
<pre id='line1304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1305")'> 1305:                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)</pre>
<pre id='line1305' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1305
 *                     tanh_y_offset = energy_terms.tanh_y_offset
 * 
 *                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;
 * 
 */
        __pyx_v_tanh_argument = (__pyx_v_tanh_elongation * (__pyx_v_adjusted_shift_diff - __pyx_v_end_harmonic));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1306")'> 1306:                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;</pre>
<pre id='line1306' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1306
 * 
 *                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)
 *                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 energy += energy_component
 */
        __pyx_v_energy_component = ((__pyx_v_tanh_amplitude * tanh(__pyx_v_tanh_argument)) + __pyx_v_tanh_y_offset);
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1307")'> 1307: </pre>
<pre id='line1307' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1308")'> 1308:                 energy += energy_component</pre>
<pre id='line1308' class='code' style='background-color: #FFFFe7'>
      /* "Cython_shift_calculator.pyx":1308
 *                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;
 * 
 *                 energy += energy_component             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
      __pyx_v_energy = (__pyx_v_energy + __pyx_v_energy_component);
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1309")'> 1309: </pre>
<pre id='line1309' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1310")'> 1310:         if self._verbose:</pre>
<pre id='line1310' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1310
 *                 energy += energy_component
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1311")'> 1311:             end_time = time()</pre>
<pre id='line1311' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1311
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line1312")'> 1312:             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1312' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":1312
 *         if self._verbose:
 *             end_time = time()
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.calls += 1
 */
    __pyx_t_9 = __pyx_memoryview_fromslice(__pyx_v_target_atom_ids, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_8 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_8));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_41));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_41));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_41));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_9);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_kp_s_39));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_t_8));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_8));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_9 = 0;
    __pyx_t_8 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_2), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1313")'> 1313: </pre>
<pre id='line1313' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1314")'> 1314:         self.calls += 1</pre>
<pre id='line1314' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1314
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 *         self.calls += 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return energy
 * 
 */
  __pyx_v_self->calls = (__pyx_v_self->calls + 1);
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line1315")'> 1315:         return energy</pre>
<pre id='line1315' class='code' style='background-color: #FFFF30'>
  /* "Cython_shift_calculator.pyx":1315
 * 
 *         self.calls += 1
 *         return energy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_energy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_shift_diff);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
  __PYX_XDEC_MEMVIEW(&__pyx_v_target_atom_ids, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_28Fast_force_factor_calculator_1__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_28Fast_force_factor_calculator_1__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_target_atom_ids = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1320; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_target_atom_ids = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_target_atom_ids.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1320; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1320; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_force_factor_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_28Fast_force_factor_calculator___call__(((struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self), __pyx_v_target_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1316")'> 1316: </pre>
<pre id='line1316' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1317")'> 1317: cdef class Fast_force_factor_calculator(Fast_energy_calculator):</pre>
<pre id='line1317' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1317
 *         return energy
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator {
  struct __pyx_obj_17shift_calculators_Fast_energy_calculator __pyx_base;
};


/* "Cython_shift_calculator.pyx":1317
 *         return energy
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator __pyx_base;
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *__pyx_vtabptr_17shift_calculators_Fast_force_factor_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1318")'> 1318: </pre>
<pre id='line1318' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1319")'> 1319:     @cython.profile(True)</pre>
<pre id='line1319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1320")'> 1320:     def  __call__(self, int[:] target_atom_ids):</pre>
<pre id='line1320' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1320
 * 
 *     @cython.profile(True)
 *     def  __call__(self, int[:] target_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 */

static PyObject *__pyx_pf_17shift_calculators_28Fast_force_factor_calculator___call__(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_target_atom_ids) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  __Pyx_memviewslice __pyx_v_result = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_i;
  float __pyx_v_factor;
  float __pyx_v_shift_diff;
  PyObject *__pyx_v_target_atom_id = NULL;
  PyObject *__pyx_v_energy_terms = NULL;
  PyObject *__pyx_v_flat_bottom_shift_limit = NULL;
  PyObject *__pyx_v_adjusted_shift_diff = NULL;
  PyObject *__pyx_v_end_harmonic = NULL;
  PyObject *__pyx_v_scale_harmonic = NULL;
  PyObject *__pyx_v_sqr_scale_harmonic = NULL;
  PyObject *__pyx_v_weight = NULL;
  PyObject *__pyx_v_tanh_amplitude = NULL;
  PyObject *__pyx_v_tanh_elongation = NULL;
  double __pyx_v_fact;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1320);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1321")'> 1321:         cdef double start_time =0.0</pre>
<pre id='line1321' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1321
 *     @cython.profile(True)
 *     def  __call__(self, int[:] target_atom_ids):
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1322")'> 1322:         cdef double end_time =0.0</pre>
<pre id='line1322' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1322
 *     def  __call__(self, int[:] target_atom_ids):
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1323")'> 1323:         if self._verbose:</pre>
<pre id='line1323' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1323
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1324")'> 1324:             start_time = time()</pre>
<pre id='line1324' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1324
 *         cdef double end_time =0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.set_simulation()
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1325")'> 1325: </pre>
<pre id='line1325' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1326")'> 1326:         self.set_simulation()</pre>
<pre id='line1326' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1326
 *             start_time = time()
 * 
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO: shouldn't be allocated each time
 *         cdef float[:] result  = allocate_array(len(target_atom_ids),'f')
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1327")'> 1327:         #TODO: shouldn't be allocated each time</pre>
<pre id='line1327' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line1328")'> 1328:         cdef float[:] result  = allocate_array(len(target_atom_ids),'f')</pre>
<pre id='line1328' class='code' style='background-color: #FFFF86'>
  /* "Cython_shift_calculator.pyx":1328
 *         self.set_simulation()
 *         #TODO: shouldn't be allocated each time
 *         cdef float[:] result  = allocate_array(len(target_atom_ids),'f')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int i
 *         cdef float factor, shift_diff
 */
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_target_atom_ids, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5.__pyx_n = 1;
  __pyx_t_5.type = ((PyObject *)__pyx_n_s__f);
  __pyx_t_1 = ((PyObject *)__pyx_f_17shift_calculators_allocate_array(__pyx_t_4, 0, &__pyx_t_5));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_float</span>(__pyx_t_1);
  if (unlikely(!__pyx_t_6.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1329")'> 1329:         cdef int i</pre>
<pre id='line1329' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1330")'> 1330:         cdef float factor, shift_diff</pre>
<pre id='line1330' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1331")'> 1331: </pre>
<pre id='line1331' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line1332")'> 1332:         for i,target_atom_id in enumerate(target_atom_ids):</pre>
<pre id='line1332' class='code' style='background-color: #FFFF29'>
  /* "Cython_shift_calculator.pyx":1332
 *         cdef float factor, shift_diff
 * 
 *         for i,target_atom_id in enumerate(target_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor  = 0.0
 * 
 */
  __pyx_t_7 = 0;
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_target_atom_ids, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_8 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_8 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_1 = __pyx_t_8(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_atom_id);
    __pyx_v_target_atom_id = __pyx_t_1;
    __pyx_t_1 = 0;
    __pyx_v_i = __pyx_t_7;
    __pyx_t_7 = (__pyx_t_7 + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1333")'> 1333:             factor  = 0.0</pre>
<pre id='line1333' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1333
 * 
 *         for i,target_atom_id in enumerate(target_atom_ids):
 *             factor  = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_v_factor = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1334")'> 1334: </pre>
<pre id='line1334' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1335")'> 1335: </pre>
<pre id='line1335' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1336")'> 1336:             shift_diff = self._get_shift_difference(target_atom_id)</pre>
<pre id='line1336' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":1336
 * 
 * 
 *             shift_diff = self._get_shift_difference(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             energy_terms = self._get_energy_terms(target_atom_id)
 * 
 */
    __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_target_atom_id);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_shift_diff = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_t_9);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1337")'> 1337:             energy_terms = self._get_energy_terms(target_atom_id)</pre>
<pre id='line1337' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":1337
 * 
 *             shift_diff = self._get_shift_difference(target_atom_id)
 *             energy_terms = self._get_energy_terms(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_9 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_target_atom_id);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base._get_energy_terms(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
    __pyx_v_energy_terms = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1338")'> 1338: </pre>
<pre id='line1338' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1339")'> 1339: </pre>
<pre id='line1339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1340")'> 1340: </pre>
<pre id='line1340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1341")'> 1341:             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit</pre>
<pre id='line1341' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":1341
 * 
 * 
 *             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s_40);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_flat_bottom_shift_limit);
    __pyx_v_flat_bottom_shift_limit = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1342")'> 1342: </pre>
<pre id='line1342' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1343")'> 1343:             if abs(shift_diff) &gt; flat_bottom_shift_limit:</pre>
<pre id='line1343' class='code' style='background-color: #FFFF5e'>
    /* "Cython_shift_calculator.pyx":1343
 *             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *                 end_harmonic = energy_terms.end_harmonic
 */
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(fabsf(__pyx_v_shift_diff));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_v_flat_bottom_shift_limit, Py_GT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(__pyx_t_11 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (__pyx_t_11) {
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1344")'> 1344:                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)</pre>
<pre id='line1344' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":1344
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic
 */
      __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_flat_bottom_shift_limit);<span class='error_goto'> if (unlikely((__pyx_t_12 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_shift_diff, __pyx_t_12));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adjusted_shift_diff);
      __pyx_v_adjusted_shift_diff = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1345")'> 1345:                 end_harmonic = energy_terms.end_harmonic</pre>
<pre id='line1345' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1345
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *                 end_harmonic = energy_terms.end_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 scale_harmonic = energy_terms.scale_harmonic
 *                 sqr_scale_harmonic = scale_harmonic**2
 */
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__end_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_end_harmonic);
      __pyx_v_end_harmonic = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1346")'> 1346:                 scale_harmonic = energy_terms.scale_harmonic</pre>
<pre id='line1346' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1346
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sqr_scale_harmonic = scale_harmonic**2
 * 
 */
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__scale_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_scale_harmonic);
      __pyx_v_scale_harmonic = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1347")'> 1347:                 sqr_scale_harmonic = scale_harmonic**2</pre>
<pre id='line1347' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1347
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic
 *                 sqr_scale_harmonic = scale_harmonic**2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 weight = energy_terms.weight
 */
      __pyx_t_10 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_scale_harmonic, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sqr_scale_harmonic);
      __pyx_v_sqr_scale_harmonic = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1348")'> 1348: </pre>
<pre id='line1348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1349")'> 1349:                 weight = energy_terms.weight</pre>
<pre id='line1349' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1349
 *                 sqr_scale_harmonic = scale_harmonic**2
 * 
 *                 weight = energy_terms.weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 tanh_amplitude = energy_terms.tanh_amplitude
 */
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__weight);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_weight);
      __pyx_v_weight = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1350")'> 1350: </pre>
<pre id='line1350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1351")'> 1351:                 tanh_amplitude = energy_terms.tanh_amplitude</pre>
<pre id='line1351' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1351
 *                 weight = energy_terms.weight
 * 
 *                 tanh_amplitude = energy_terms.tanh_amplitude             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 tanh_elongation = energy_terms.tanh_elongation
 * 
 */
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_amplitude);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_amplitude);
      __pyx_v_tanh_amplitude = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1352")'> 1352:                 tanh_elongation = energy_terms.tanh_elongation</pre>
<pre id='line1352' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1352
 * 
 *                 tanh_amplitude = energy_terms.tanh_amplitude
 *                 tanh_elongation = energy_terms.tanh_elongation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 # TODO: add factor and lambda to give fact
 */
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_elongation);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_elongation);
      __pyx_v_tanh_elongation = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1353")'> 1353: </pre>
<pre id='line1353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1354")'> 1354:                 # TODO: add factor and lambda to give fact</pre>
<pre id='line1354' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1355")'> 1355:                 fact =1.0</pre>
<pre id='line1355' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1355
 * 
 *                 # TODO: add factor and lambda to give fact
 *                 fact =1.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 */
      __pyx_v_fact = 1.0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1356")'> 1356:                 if adjusted_shift_diff &lt; end_harmonic:</pre>
<pre id='line1356' class='code' style='background-color: #FFFF79'>
      /* "Cython_shift_calculator.pyx":1356
 *                 # TODO: add factor and lambda to give fact
 *                 fact =1.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 *                 else:
 */
      __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_adjusted_shift_diff, __pyx_v_end_harmonic, Py_LT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(__pyx_t_11 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (__pyx_t_11) {
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line1357")'> 1357:                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;</pre>
<pre id='line1357' class='code' style='background-color: #FFFF2d'>
        /* "Cython_shift_calculator.pyx":1357
 *                 fact =1.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 *                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;
 */
        __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(2.0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
        __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_10, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_adjusted_shift_diff);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_fact);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        __pyx_t_13 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_10, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_13, __pyx_v_sqr_scale_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_12 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_factor = __pyx_t_12;
        goto __pyx_L7;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1358")'> 1358:                 else:</pre>
<pre id='line1358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line1359")'> 1359:                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;</pre>
<pre id='line1359' class='code' style='background-color: #FFFF20'>
        /* "Cython_shift_calculator.pyx":1359
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 *                 else:
 *                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             result[i] = factor
 */
        __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_weight, __pyx_v_tanh_amplitude);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        __pyx_t_13 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_tanh_elongation);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_adjusted_shift_diff, __pyx_v_end_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_tanh_elongation, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_10);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(pow(cosh(__pyx_t_3), 2.0));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
        __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_13, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_fact);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
        __pyx_t_13 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_13);<span class='error_goto'> if (unlikely((__pyx_t_12 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_v_factor = __pyx_t_12;
      }
      __pyx_L7:;
      goto __pyx_L6;
    }
    __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1360")'> 1360: </pre>
<pre id='line1360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1361")'> 1361:             result[i] = factor</pre>
<pre id='line1361' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1361
 *                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;
 * 
 *             result[i] = factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_9 = __pyx_v_i;
    *((float *) ( /* dim=0 */ (__pyx_v_result.data + __pyx_t_9 * __pyx_v_result.strides[0]) )) = __pyx_v_factor;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1362")'> 1362: </pre>
<pre id='line1362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1363")'> 1363:         if self._verbose:</pre>
<pre id='line1363' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1363
 *             result[i] = factor
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1364")'> 1364:             end_time = time()</pre>
<pre id='line1364' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1364
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_13 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_13);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line1365")'> 1365:             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1365' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":1365
 *         if self._verbose:
 *             end_time = time()
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_target_atom_ids, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_13);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_13);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_13 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_13);
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_42));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_42));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_42));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_13);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_kp_s_39));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_13 = 0;
    __pyx_t_10 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_2), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1366")'> 1366: </pre>
<pre id='line1366' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1367")'> 1367: </pre>
<pre id='line1367' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line1368")'> 1368:         return  result</pre>
<pre id='line1368' class='code' style='background-color: #FFFF52'>
  /* "Cython_shift_calculator.pyx":1368
 * 
 * 
 *         return  result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef class Base_force_calculator:
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_result, 1, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_force_factor_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_result, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_atom_id);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_flat_bottom_shift_limit);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adjusted_shift_diff);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_end_harmonic);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_scale_harmonic);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sqr_scale_harmonic);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_weight);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_amplitude);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_elongation);
  __PYX_XDEC_MEMVIEW(&__pyx_v_target_atom_ids, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_21Base_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_21Base_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_potential = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__potential,&__pyx_n_s__name,0};
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1369")'> 1369: cdef class Base_force_calculator:</pre>
<pre id='line1369' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1369
 * 
 *         return  result
 * cdef class Base_force_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef bint _verbose
 */
struct __pyx_obj_17shift_calculators_Base_force_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *__pyx_vtab;
  int _verbose;
  Simulation *_simulation;
  PyObject *_name;
};


/* "Cython_shift_calculator.pyx":1369
 * 
 *         return  result
 * cdef class Base_force_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef bint _verbose
 */

struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator {
  void (*_do_calc_components)(struct __pyx_obj_17shift_calculators_Base_force_calculator *, __Pyx_memviewslice, __Pyx_memviewslice, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *__pyx_vtabptr_17shift_calculators_Base_force_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1370")'> 1370: </pre>
<pre id='line1370' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1371")'> 1371:     cdef bint _verbose</pre>
<pre id='line1371' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1372")'> 1372:     cdef Simulation* _simulation</pre>
<pre id='line1372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1373")'> 1373:     cdef str _name</pre>
<pre id='line1373' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1374")'> 1374: </pre>
<pre id='line1374' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line1375")'> 1375:     def __init__(self,potential=None, name= "not set"):</pre>
<pre id='line1375' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":1375
 *     cdef str _name
 * 
 *     def __init__(self,potential=None, name= "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self._simulation =  currentSimulation()
 */
    values[0] = ((PyObject *)Py_None);
    values[1] = ((PyObject *)__pyx_kp_s_16);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__potential);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1375; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_potential = values[0];
    __pyx_v_name = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1375; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_potential, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static int __pyx_pf_17shift_calculators_21Base_force_calculator___init__(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_potential, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1376")'> 1376:         self._verbose = False</pre>
<pre id='line1376' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1376
 * 
 *     def __init__(self,potential=None, name= "not set"):
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1377")'> 1377:         self._simulation =  currentSimulation()</pre>
<pre id='line1377' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1377
 *     def __init__(self,potential=None, name= "not set"):
 *         self._verbose = False
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._name = name
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1378")'> 1378: </pre>
<pre id='line1378' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2c' onclick='toggleDiv("line1379")'> 1379:         self._name = name</pre>
<pre id='line1379' class='code' style='background-color: #FFFF2c'>
  /* "Cython_shift_calculator.pyx":1379
 *         self._simulation =  currentSimulation()
 * 
 *         self._name = name             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _prepare(self, change, data):
 */
  if (!(likely(<span class='py_c_api'>PyString_CheckExact</span>(__pyx_v_name))||((__pyx_v_name) == Py_None)||(<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected str, got %.200s", Py_TYPE(__pyx_v_name)->tp_name), 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_name);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_name);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_name);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_name));
  __pyx_v_self->_name = ((PyObject*)__pyx_v_name);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_3_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_3_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_2_prepare(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1380")'> 1380: </pre>
<pre id='line1380' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1381")'> 1381:     def _prepare(self, change, data):</pre>
<pre id='line1381' class='code' style='background-color: #FFFFc4'>
/* "Cython_shift_calculator.pyx":1381
 *         self._name = name
 * 
 *     def _prepare(self, change, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_2_prepare(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1382")'> 1382:         pass</pre>
<pre id='line1382' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1383")'> 1383: </pre>
<pre id='line1383' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1384")'> 1384:     def set_verbose(self,on):</pre>
<pre id='line1384' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1384
 *         pass
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1385")'> 1385:         self._verbose = on</pre>
<pre id='line1385' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1385
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_7set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_7set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_6set_simulation(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1386")'> 1386: </pre>
<pre id='line1386' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1387")'> 1387:     def set_simulation(self):</pre>
<pre id='line1387' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1387
 *         self._verbose = on
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_6set_simulation(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line1388")'> 1388:         self._simulation =  currentSimulation()</pre>
<pre id='line1388' class='code' style='background-color: #FFFF25'>
  /* "Cython_shift_calculator.pyx":1388
 * 
 *     def set_simulation(self):
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_9__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_9__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  __Pyx_memviewslice __pyx_v_component_to_result = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_force_factors = { 0, 0, { 0 }, { 0 }, { 0 } };
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__component_to_result,&__pyx_n_s__force_factors,&__pyx_n_s__forces,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_result)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factors)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_components = values[0];
    __pyx_v_component_to_result = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_result.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factors = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_float</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_force_factors.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_8__call__(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1389")'> 1389: </pre>
<pre id='line1389' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1390")'> 1390: </pre>
<pre id='line1390' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1391")'> 1391: </pre>
<pre id='line1391' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1392")'> 1392: </pre>
<pre id='line1392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1393")'> 1393: </pre>
<pre id='line1393' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1394")'> 1394: </pre>
<pre id='line1394' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1395")'> 1395: #    TODO should most probably be a fixed array</pre>
<pre id='line1395' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1396")'> 1396:     @cython.profile(True)</pre>
<pre id='line1396' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1397")'> 1397:     def __call__(self, object components, int[:] component_to_result, float[:] force_factors, Out_array forces):</pre>
<pre id='line1397' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1397
 * #    TODO should most probably be a fixed array
 *     @cython.profile(True)
 *     def __call__(self, object components, int[:] component_to_result, float[:] force_factors, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time =0.0
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_8__call__(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_components, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1397);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1398")'> 1398: </pre>
<pre id='line1398' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1399")'> 1399:         cdef double start_time =0.0</pre>
<pre id='line1399' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1399
 *     def __call__(self, object components, int[:] component_to_result, float[:] force_factors, Out_array forces):
 * 
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1400")'> 1400:         cdef double end_time =0.0</pre>
<pre id='line1400' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1400
 * 
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1401")'> 1401:         if self._verbose:</pre>
<pre id='line1401' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1401
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1402")'> 1402:             start_time = time()</pre>
<pre id='line1402' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1402
 *         cdef double end_time =0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1403")'> 1403: </pre>
<pre id='line1403' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line1404")'> 1404:         self._set_components(components)</pre>
<pre id='line1404' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":1404
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 * #        TODO rename component to result to something better
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1405")'> 1405:         self.set_simulation()</pre>
<pre id='line1405' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1405
 * 
 *         self._set_components(components)
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        TODO rename component to result to something better
 *         self._do_calc_components(component_to_result, force_factors, forces)
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1406")'> 1406: #        TODO rename component to result to something better</pre>
<pre id='line1406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1407")'> 1407:         self._do_calc_components(component_to_result, force_factors, forces)</pre>
<pre id='line1407' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1407
 *         self.set_simulation()
 * #        TODO rename component to result to something better
 *         self._do_calc_components(component_to_result, force_factors, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        component_target_atom_ids = components.get_component_atom_ids()
 */
  ((struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *)__pyx_v_self->__pyx_vtab)->_do_calc_components(__pyx_v_self, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1408")'> 1408: </pre>
<pre id='line1408' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1409")'> 1409: #        component_target_atom_ids = components.get_component_atom_ids()</pre>
<pre id='line1409' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1410")'> 1410: #        for i,target_atom_id in enumerate(target_atom_ids):</pre>
<pre id='line1410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1411")'> 1411: #            if target_atom_id in component_target_atom_ids:</pre>
<pre id='line1411' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1412")'> 1412: #                try:</pre>
<pre id='line1412' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1413")'> 1413: #                    index_range = components.get_component_range(target_atom_id)</pre>
<pre id='line1413' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1414")'> 1414: #                except ValueError:</pre>
<pre id='line1414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1415")'> 1415: #                    print "warning atom is not in list", target_atom_id, Atom_utils._get_atom_info_from_index(target_atom_id),self._name</pre>
<pre id='line1415' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1416")'> 1416: #                    index_range = []</pre>
<pre id='line1416' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1417")'> 1417: #                for index in range(*index_range):</pre>
<pre id='line1417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1418")'> 1418: </pre>
<pre id='line1418' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1419")'> 1419:         if self._verbose:</pre>
<pre id='line1419' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1419
 * #                for index in range(*index_range):
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1420")'> 1420:             end_time = time()</pre>
<pre id='line1420' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1420
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1421")'> 1421:             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1421' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":1421
 *         if self._verbose:
 *             end_time = time()
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_43));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_43));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_43));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->_name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self->_name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->_name));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_44));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, ((PyObject *)__pyx_kp_s_44));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_44));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, __pyx_t_4);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_kp_s_39));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_39));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 5, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_4 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_result, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_force_factors, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1422")'> 1422: </pre>
<pre id='line1422' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1423")'> 1423:     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):</pre>
<pre id='line1423' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1423
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise Exception("this should not be called!")
 * 
 */

static void __pyx_f_17shift_calculators_21Base_force_calculator__do_calc_components(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, CYTHON_UNUSED __Pyx_memviewslice __pyx_v_component_to_result, CYTHON_UNUSED __Pyx_memviewslice __pyx_v_force_factors, CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1424")'> 1424:         raise Exception("this should not be called!")</pre>
<pre id='line1424' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":1424
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):
 *         raise Exception("this should not be called!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_k_tuple_46), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
 <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Base_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":1424
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result,  float[:] force_factors, Out_array force):
 *         raise Exception("this should not be called!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_k_tuple_46 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)__pyx_kp_s_45));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_46)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_46);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_46));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1425")'> 1425: </pre>
<pre id='line1425' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1426")'> 1426: </pre>
<pre id='line1426' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1427")'> 1427: </pre>
<pre id='line1427' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1428")'> 1428: </pre>
<pre id='line1428' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1429")'> 1429: cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):</pre>
<pre id='line1429' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1429
 * 
 * 
 * cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  int _target_atom_index;
  int _distance_atom_index_1;
  int _distance_atom_index_2;
  int _exponent_index;
  int _coefficient_index;
  int _smoothed;
  float _smoothing_factor;
  float _cutoff;
  struct __pyx_t_17shift_calculators_Distance_component *_compiled_components;
  int _num_components;
};


/* "Cython_shift_calculator.pyx":1429
 * 
 * 
 * cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  PyObject *(*_compile_components)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, PyObject *);
  Vec3 (*_xyz_distances)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
  float (*_sum_xyz_distances_2)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
  float (*_cython_calc_single_force_factor)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float);
  void (*_distance_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_distance_based_potential_force_calculator;
static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float);
static CYTHON_INLINE void __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1430")'> 1430: </pre>
<pre id='line1430' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1431")'> 1431: </pre>
<pre id='line1431' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1432")'> 1432: </pre>
<pre id='line1432' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1433")'> 1433:     cdef int  _target_atom_index</pre>
<pre id='line1433' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1434")'> 1434:     cdef int  _distance_atom_index_1</pre>
<pre id='line1434' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1435")'> 1435:     cdef int  _distance_atom_index_2</pre>
<pre id='line1435' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1436")'> 1436:     cdef int  _exponent_index</pre>
<pre id='line1436' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1437")'> 1437:     cdef int  _coefficient_index</pre>
<pre id='line1437' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1438")'> 1438:     cdef bint  _smoothed</pre>
<pre id='line1438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1439")'> 1439:     cdef float _smoothing_factor</pre>
<pre id='line1439' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1440")'> 1440:     cdef float _cutoff</pre>
<pre id='line1440' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1441")'> 1441:     cdef Distance_component* _compiled_components</pre>
<pre id='line1441' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1442")'> 1442:     cdef int _num_components</pre>
<pre id='line1442' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1443")'> 1443: </pre>
<pre id='line1443' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1444")'> 1444:     def __cinit__(self):</pre>
<pre id='line1444' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1444
 *     cdef int _num_components
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components  = NULL
 *         self._num_components =  0
 */

static int __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1445")'> 1445:         self._compiled_components  = NULL</pre>
<pre id='line1445' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1445
 * 
 *     def __cinit__(self):
 *         self._compiled_components  = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components =  0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1446")'> 1446:         self._num_components =  0</pre>
<pre id='line1446' class='code' style='background-color: #FFFF2a'>
  /* "Cython_shift_calculator.pyx":1446
 *     def __cinit__(self):
 *         self._compiled_components  = NULL
 *         self._num_components =  0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self, object indices, bint smoothed, name="Not set"):
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)__pyx_kp_s_47);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1447")'> 1447: </pre>
<pre id='line1447' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1448")'> 1448:     def __init__(self, object indices, bint smoothed, name="Not set"):</pre>
<pre id='line1448' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1448
 *         self._num_components =  0
 * 
 *     def __init__(self, object indices, bint smoothed, name="Not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._target_atom_index = indices.target_atom_index
 */

static int __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_indices, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line1449")'> 1449:         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)</pre>
<pre id='line1449' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":1449
 * 
 *     def __init__(self, object indices, bint smoothed, name="Not set"):
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1450")'> 1450:         self._target_atom_index = indices.target_atom_index</pre>
<pre id='line1450' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1450
 *     def __init__(self, object indices, bint smoothed, name="Not set"):
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._target_atom_index = indices.target_atom_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__target_atom_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_target_atom_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1451")'> 1451:         self._distance_atom_index_1 =  indices.distance_atom_index_1</pre>
<pre id='line1451' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1451
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_17);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_1 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1452")'> 1452:         self._distance_atom_index_2 =  indices .distance_atom_index_2</pre>
<pre id='line1452' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1452
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_2 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1453")'> 1453:         self._exponent_index  = indices.exponent_index</pre>
<pre id='line1453' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1453
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coefficient_index  = indices.coefficient_index
 *         self._smoothed =  smoothed
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__exponent_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_exponent_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1454")'> 1454:         self._coefficient_index  = indices.coefficient_index</pre>
<pre id='line1454' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1454
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__coefficient_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_coefficient_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1455")'> 1455:         self._smoothed =  smoothed</pre>
<pre id='line1455' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1455
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index
 *         self._smoothed =  smoothed             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 *         self._cutoff =  DEFAULT_CUTOFF
 */
  __pyx_v_self->_smoothed = __pyx_v_smoothed;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1456")'> 1456:         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR</pre>
<pre id='line1456' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1456
 *         self._coefficient_index  = indices.coefficient_index
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff =  DEFAULT_CUTOFF
 * 
 */
  __pyx_v_self->_smoothing_factor = __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1457")'> 1457:         self._cutoff =  DEFAULT_CUTOFF</pre>
<pre id='line1457' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1457
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 *         self._cutoff =  DEFAULT_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_cutoff(self, cutoff):
 */
  __pyx_v_self->_cutoff = __pyx_v_17shift_calculators_DEFAULT_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_5set_cutoff(PyObject *__pyx_v_self, PyObject *__pyx_v_cutoff); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_5set_cutoff(PyObject *__pyx_v_self, PyObject *__pyx_v_cutoff) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_cutoff (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_4set_cutoff(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_cutoff));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1458")'> 1458: </pre>
<pre id='line1458' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1459")'> 1459:     def set_cutoff(self, cutoff):</pre>
<pre id='line1459' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1459
 *         self._cutoff =  DEFAULT_CUTOFF
 * 
 *     def set_cutoff(self, cutoff):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff =  cutoff
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_4set_cutoff(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_cutoff) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_cutoff", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1460")'> 1460:         self._cutoff =  cutoff</pre>
<pre id='line1460' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1460
 * 
 *     def set_cutoff(self, cutoff):
 *         self._cutoff =  cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_smoothing_factor(self,smoothing_factor):
 */
  __pyx_t_1 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_cutoff);<span class='error_goto'> if (unlikely((__pyx_t_1 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_cutoff = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.set_cutoff", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_7set_smoothing_factor(PyObject *__pyx_v_self, PyObject *__pyx_v_smoothing_factor); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_7set_smoothing_factor(PyObject *__pyx_v_self, PyObject *__pyx_v_smoothing_factor) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_smoothing_factor (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_6set_smoothing_factor(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_smoothing_factor));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1461")'> 1461: </pre>
<pre id='line1461' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1462")'> 1462:     def set_smoothing_factor(self,smoothing_factor):</pre>
<pre id='line1462' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1462
 *         self._cutoff =  cutoff
 * 
 *     def set_smoothing_factor(self,smoothing_factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor = smoothing_factor
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_6set_smoothing_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_smoothing_factor) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_smoothing_factor", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1463")'> 1463:         self._smoothing_factor = smoothing_factor</pre>
<pre id='line1463' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1463
 * 
 *     def set_smoothing_factor(self,smoothing_factor):
 *         self._smoothing_factor = smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_components(self,components):
 */
  __pyx_t_1 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_smoothing_factor);<span class='error_goto'> if (unlikely((__pyx_t_1 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_smoothing_factor = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.set_smoothing_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_9_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_9_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_8_set_components(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1464")'> 1464: </pre>
<pre id='line1464' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1465")'> 1465:     def _set_components(self,components):</pre>
<pre id='line1465' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1465
 *         self._smoothing_factor = smoothing_factor
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_8_set_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1466")'> 1466:         if  self._compiled_components ==  NULL:</pre>
<pre id='line1466' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1466
 * 
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1467")'> 1467:             self._compile_components(components)</pre>
<pre id='line1467' class='code' style='background-color: #FFFF96'>
    /* "Cython_shift_calculator.pyx":1467
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_compiled_components(self):
 */
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_compile_components(__pyx_v_self, __pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_11_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_11_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_10_free_compiled_components(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1468")'> 1468: </pre>
<pre id='line1468' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1469")'> 1469:     def _free_compiled_components(self):</pre>
<pre id='line1469' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1469
 *             self._compile_components(components)
 * 
 *     def _free_compiled_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_10_free_compiled_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1470")'> 1470:         if self._compiled_components != NULL:</pre>
<pre id='line1470' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1470
 * 
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free (self._compiled_components)
 *             self._compiled_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1471")'> 1471:             free (self._compiled_components)</pre>
<pre id='line1471' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1471
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_components);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1472")'> 1472:             self._compiled_components = NULL</pre>
<pre id='line1472' class='code' style='background-color: #FFFF39'>
    /* "Cython_shift_calculator.pyx":1472
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)
 *             self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _prepare(self, change, data):
 */
    __pyx_v_self->_compiled_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_13_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_13_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_12_prepare(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1473")'> 1473: </pre>
<pre id='line1473' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1474")'> 1474:     def _prepare(self, change, data):</pre>
<pre id='line1474' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1474
 *             self._compiled_components = NULL
 * 
 *     def _prepare(self, change, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_12_prepare(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1475")'> 1475:          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:</pre>
<pre id='line1475' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":1475
 * 
 *     def _prepare(self, change, data):
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *              self._free_compiled_components()
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_1, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_3) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_2, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line1476")'> 1476:              self._free_compiled_components()</pre>
<pre id='line1476' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":1476
 *     def _prepare(self, change, data):
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_24);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1477")'> 1477: </pre>
<pre id='line1477' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1478")'> 1478: </pre>
<pre id='line1478' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1479")'> 1479:     cdef _compile_components(self,components):</pre>
<pre id='line1479' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1479
 * 
 * 
 *     cdef _compile_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)
 */

static PyObject *__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__compile_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1480")'> 1480:         self._compiled_components = &lt;Distance_component*&gt;malloc(len(components) * sizeof(Distance_component))</pre>
<pre id='line1480' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1480
 * 
 *     cdef _compile_components(self,components):
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Distance_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Distance_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1481")'> 1481:         self._num_components = len(components)</pre>
<pre id='line1481' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1481
 *     cdef _compile_components(self,components):
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1482")'> 1482:         for i,component in enumerate(components):</pre>
<pre id='line1482' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1482
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1483")'> 1483:             self._compiled_components[i].target_atom = components[i][self._target_atom_index]</pre>
<pre id='line1483' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":1483
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_target_atom_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).target_atom = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1484")'> 1484:             if len(component) == 4:</pre>
<pre id='line1484' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1484
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = (__pyx_t_8 == 4);
    if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1485")'> 1485:                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]</pre>
<pre id='line1485' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1485
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1485; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_1 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1486")'> 1486:                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]</pre>
<pre id='line1486' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1486
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_2 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1487")'> 1487:                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]</pre>
<pre id='line1487' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1487
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_coefficient_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1488")'> 1488:                 self._compiled_components[i].exponent      = components[i][self._exponent_index]</pre>
<pre id='line1488' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1488
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_exponent_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).exponent = __pyx_t_10;
      goto __pyx_L5;
    }
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1489")'> 1489:             elif len(component) == 5:</pre>
<pre id='line1489' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1489
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1489; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = (__pyx_t_8 == 5);
    if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1490")'> 1490:                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]</pre>
<pre id='line1490' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1490
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_1 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1491")'> 1491:                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]</pre>
<pre id='line1491' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1491
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_2 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1492")'> 1492:                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]</pre>
<pre id='line1492' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1492
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             else:
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_coefficient_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1493")'> 1493:                 self._compiled_components[i].exponent      = components[i][self._exponent_index]</pre>
<pre id='line1493' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1493
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_exponent_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).exponent = __pyx_t_10;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1494")'> 1494:             else:</pre>
<pre id='line1494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF15' onclick='toggleDiv("line1495")'> 1495:                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))</pre>
<pre id='line1495' class='code' style='background-color: #FFFF15'>
      /* "Cython_shift_calculator.pyx":1495
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             else:
 *                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #   TODO: generalise this based on compiled components
 */
      __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_19), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_t_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_15_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_15_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,&__pyx_n_s__forces,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_set") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_14_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1496")'> 1496: </pre>
<pre id='line1496' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1497")'> 1497: #   TODO: generalise this based on compiled components</pre>
<pre id='line1497' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1498")'> 1498:     def _calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1498' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1498
 * 
 * #   TODO: generalise this based on compiled components
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO tidy this up a hack for the test suite
 *         cdef Distance_component* saved_component_list = self._compiled_components
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_14_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Distance_component *__pyx_v_saved_component_list;
  int __pyx_v_saved_num_components;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1499")'> 1499:         #TODO tidy this up a hack for the test suite</pre>
<pre id='line1499' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1500")'> 1500:         cdef Distance_component* saved_component_list = self._compiled_components</pre>
<pre id='line1500' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1500
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 *         #TODO tidy this up a hack for the test suite
 *         cdef Distance_component* saved_component_list = self._compiled_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int saved_num_components = self._num_components
 * 
 */
  __pyx_t_1 = __pyx_v_self->_compiled_components;
  __pyx_v_saved_component_list = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1501")'> 1501:         cdef int saved_num_components = self._num_components</pre>
<pre id='line1501' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1501
 *         #TODO tidy this up a hack for the test suite
 *         cdef Distance_component* saved_component_list = self._compiled_components
 *         cdef int saved_num_components = self._num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._num_components  = 1
 */
  __pyx_t_2 = __pyx_v_self->_num_components;
  __pyx_v_saved_num_components = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1502")'> 1502: </pre>
<pre id='line1502' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1503")'> 1503:         self._num_components  = 1</pre>
<pre id='line1503' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1503
 *         cdef int saved_num_components = self._num_components
 * 
 *         self._num_components  = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = &saved_component_list[index]
 * 
 */
  __pyx_v_self->_num_components = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1504")'> 1504:         self._compiled_components = &amp;saved_component_list[index]</pre>
<pre id='line1504' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1504
 * 
 *         self._num_components  = 1
 *         self._compiled_components = &saved_component_list[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._distance_calc_single_force_set(0,factor,forces)
 */
  __pyx_v_self->_compiled_components = (&(__pyx_v_saved_component_list[__pyx_v_index]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1505")'> 1505: </pre>
<pre id='line1505' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1506")'> 1506:         self._distance_calc_single_force_set(0,factor,forces)</pre>
<pre id='line1506' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1506
 *         self._compiled_components = &saved_component_list[index]
 * 
 *         self._distance_calc_single_force_set(0,factor,forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_components = saved_component_list
 */
  __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(__pyx_v_self, 0, __pyx_v_factor, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1507")'> 1507: </pre>
<pre id='line1507' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1508")'> 1508:         self._compiled_components = saved_component_list</pre>
<pre id='line1508' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1508
 *         self._distance_calc_single_force_set(0,factor,forces)
 * 
 *         self._compiled_components = saved_component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = saved_num_components
 * 
 */
  __pyx_v_self->_compiled_components = __pyx_v_saved_component_list;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1509")'> 1509:         self._num_components = saved_num_components</pre>
<pre id='line1509' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1509
 * 
 *         self._compiled_components = saved_component_list
 *         self._num_components = saved_num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_num_components = __pyx_v_saved_num_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1510")'> 1510: </pre>
<pre id='line1510' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1511")'> 1511: </pre>
<pre id='line1511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1512")'> 1512:     @cython.profile(False)</pre>
<pre id='line1512' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1513")'> 1513:     cdef inline Vec3 _xyz_distances(self, int target_atom, int distance_atom):</pre>
<pre id='line1513' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1513
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3 _xyz_distances(self, int target_atom, int distance_atom):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_pos, distant_pos
 * 
 */

static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_target_atom, int __pyx_v_distance_atom) {
  Vec3 __pyx_v_target_pos;
  Vec3 __pyx_v_distant_pos;
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_xyz_distances", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1514")'> 1514:         cdef Vec3 target_pos, distant_pos</pre>
<pre id='line1514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1515")'> 1515: </pre>
<pre id='line1515' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1516")'> 1516: </pre>
<pre id='line1516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1517")'> 1517:         target_pos = self._simulation[0].atomPos(target_atom)</pre>
<pre id='line1517' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1517
 * 
 * 
 *         target_pos = self._simulation[0].atomPos(target_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)
 * 
 */
  __pyx_v_target_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1518")'> 1518:         distant_pos =   self._simulation[0].atomPos(distance_atom)</pre>
<pre id='line1518' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1518
 * 
 *         target_pos = self._simulation[0].atomPos(target_atom)
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return target_pos - distant_pos
 */
  __pyx_v_distant_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_distance_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1519")'> 1519: </pre>
<pre id='line1519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1520")'> 1520:         return target_pos - distant_pos</pre>
<pre id='line1520' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1520
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)
 * 
 *         return target_pos - distant_pos             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = (__pyx_v_target_pos - __pyx_v_distant_pos);
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1521")'> 1521: </pre>
<pre id='line1521' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1522")'> 1522:     @cython.profile(False)</pre>
<pre id='line1522' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1523")'> 1523:     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):</pre>
<pre id='line1523' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1523
 * 
 *     @cython.profile(False)
 *     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_pos, distant_pos, distance
 *         cdef float result =0.0
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_target_atom, int __pyx_v_distance_atom) {
  Vec3 __pyx_v_target_pos;
  Vec3 __pyx_v_distant_pos;
  Vec3 __pyx_v_distance;
  float __pyx_v_result;
  int __pyx_v_i;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_sum_xyz_distances_2", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1524")'> 1524:         cdef Vec3 target_pos, distant_pos, distance</pre>
<pre id='line1524' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1525")'> 1525:         cdef float result =0.0</pre>
<pre id='line1525' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1525
 *     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):
 *         cdef Vec3 target_pos, distant_pos, distance
 *         cdef float result =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int i
 * 
 */
  __pyx_v_result = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1526")'> 1526:         cdef int i</pre>
<pre id='line1526' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1527")'> 1527: </pre>
<pre id='line1527' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1528")'> 1528:         target_pos =   self._simulation[0].atomPos(target_atom)</pre>
<pre id='line1528' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1528
 *         cdef int i
 * 
 *         target_pos =   self._simulation[0].atomPos(target_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)
 * 
 */
  __pyx_v_target_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1529")'> 1529:         distant_pos =  self._simulation[0].atomPos(distance_atom)</pre>
<pre id='line1529' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1529
 * 
 *         target_pos =   self._simulation[0].atomPos(target_atom)
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         distance = Vec3(target_pos - distant_pos)
 */
  __pyx_v_distant_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_distance_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1530")'> 1530: </pre>
<pre id='line1530' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1531")'> 1531:         distance = Vec3(target_pos - distant_pos)</pre>
<pre id='line1531' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1531
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)
 * 
 *         distance = Vec3(target_pos - distant_pos)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for i in range(3):
 */
  __pyx_v_distance = Vec3((__pyx_v_target_pos - __pyx_v_distant_pos));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1532")'> 1532: </pre>
<pre id='line1532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1533")'> 1533:         for i in range(3):</pre>
<pre id='line1533' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1533
 *         distance = Vec3(target_pos - distant_pos)
 * 
 *         for i in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result += distance[i] * distance[i]
 * 
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1534")'> 1534:             result += distance[i] * distance[i]</pre>
<pre id='line1534' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1534
 * 
 *         for i in range(3):
 *             result += distance[i] * distance[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
    __pyx_v_result = (__pyx_v_result + ((__pyx_v_distance[__pyx_v_i]) * (__pyx_v_distance[__pyx_v_i])));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1535")'> 1535: </pre>
<pre id='line1535' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line1536")'> 1536:         return result</pre>
<pre id='line1536' class='code' style='background-color: #FFFF28'>
  /* "Cython_shift_calculator.pyx":1536
 *             result += distance[i] * distance[i]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calc_single_force_factor(self, int index, float factor):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_17_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_17_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_factor", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1538; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_factor") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1538; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1538; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1538; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_factor", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1538; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_16_calc_single_force_factor(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1537")'> 1537: </pre>
<pre id='line1537' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1538")'> 1538:     def _calc_single_force_factor(self, int index, float factor):</pre>
<pre id='line1538' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1538
 *         return result
 * 
 *     def _calc_single_force_factor(self, int index, float factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._cython_calc_single_force_factor(index, factor)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_16_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1539")'> 1539:         return self._cython_calc_single_force_factor(index, factor)</pre>
<pre id='line1539' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1539
 * 
 *     def _calc_single_force_factor(self, int index, float factor):
 *         return self._cython_calc_single_force_factor(index, factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index, __pyx_v_factor));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1540")'> 1540: </pre>
<pre id='line1540' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1541")'> 1541:     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line1541' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1541
 *         return self._cython_calc_single_force_factor(index, factor)
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._num_components):
 *             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 */

static void __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_i;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1542")'> 1542:         for i in range(self._num_components):</pre>
<pre id='line1542' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1542
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         for i in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->_num_components;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1543")'> 1543:             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1543' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1543
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         for i in range(self._num_components):
 *             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_result.data + __pyx_t_3 * __pyx_v_component_to_result.strides[0]) )));
    __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(__pyx_v_self, __pyx_v_i, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_4 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1544")'> 1544: </pre>
<pre id='line1544' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1545")'> 1545: </pre>
<pre id='line1545' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1546")'> 1546:     @cython.profile(False)</pre>
<pre id='line1546' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1547")'> 1547:     cdef inline float _cython_calc_single_force_factor(self, int index, float factor):</pre>
<pre id='line1547' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1547
 * 
 *     @cython.profile(False)
 *     cdef inline float _cython_calc_single_force_factor(self, int index, float factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef target_distant_atom atom_ids
 * #        cdef coefficient_exponent coef_exp
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor) {
  float __pyx_v_exponent;
  float __pyx_v_full_factor;
  float __pyx_v_force_factor;
  float __pyx_v_ratio;
  float __pyx_v_pre_exponent;
  float __pyx_v_reduced_exponent;
  float __pyx_v_sum_xyz_distances_2;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1548")'> 1548:         cdef target_distant_atom atom_ids</pre>
<pre id='line1548' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1549")'> 1549: #        cdef coefficient_exponent coef_exp</pre>
<pre id='line1549' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1550")'> 1550:         cdef float exponent</pre>
<pre id='line1550' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1551")'> 1551: </pre>
<pre id='line1551' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1552")'> 1552:         cdef float full_factor, force_factor</pre>
<pre id='line1552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1553")'> 1553:         cdef float ratio, pre_exponent, reduced_exponent, sum_xyz_distances_2</pre>
<pre id='line1553' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1554")'> 1554: </pre>
<pre id='line1554' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1555")'> 1555: #        atom_ids = self._get_target_and_distant_atom_ids(index)</pre>
<pre id='line1555' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1556")'> 1556: </pre>
<pre id='line1556' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1557")'> 1557:         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)</pre>
<pre id='line1557' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1557
 * #        atom_ids = self._get_target_and_distant_atom_ids(index)
 * 
 *         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         full_factor= factor *  self._compiled_components[index].coefficient
 */
  __pyx_v_sum_xyz_distances_2 = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1558")'> 1558: #</pre>
<pre id='line1558' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1559")'> 1559:         full_factor= factor *  self._compiled_components[index].coefficient</pre>
<pre id='line1559' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1559
 *         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)
 * #
 *         full_factor= factor *  self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         exponent =  self._compiled_components[index].exponent
 */
  __pyx_v_full_factor = (__pyx_v_factor * (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1560")'> 1560: </pre>
<pre id='line1560' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1561")'> 1561:         exponent =  self._compiled_components[index].exponent</pre>
<pre id='line1561' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1561
 *         full_factor= factor *  self._compiled_components[index].coefficient
 * 
 *         exponent =  self._compiled_components[index].exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).exponent;
  __pyx_v_exponent = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1562")'> 1562:         if self._smoothed:</pre>
<pre id='line1562' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1562
 * 
 *         exponent =  self._compiled_components[index].exponent
 *         if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4
 */
  if (__pyx_v_self->_smoothed) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1563")'> 1563:             ratio = sum_xyz_distances_2 / (self._cutoff**2)</pre>
<pre id='line1563' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1563
 *         exponent =  self._compiled_components[index].exponent
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ratio =  ratio**4
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 */
    __pyx_v_ratio = (__pyx_v_sum_xyz_distances_2 / powf(__pyx_v_self->_cutoff, 2.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1564")'> 1564:             ratio =  ratio**4</pre>
<pre id='line1564' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1564
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 *         else:
 */
    __pyx_v_ratio = powf(__pyx_v_ratio, 4.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1565")'> 1565:             pre_exponent = exponent - (exponent + 8.0) * ratio</pre>
<pre id='line1565' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1565
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4
 *             pre_exponent = exponent - (exponent + 8.0) * ratio             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             pre_exponent = exponent
 */
    __pyx_v_pre_exponent = (__pyx_v_exponent - ((__pyx_v_exponent + 8.0) * __pyx_v_ratio));
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1566")'> 1566:         else:</pre>
<pre id='line1566' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1567")'> 1567:             pre_exponent = exponent</pre>
<pre id='line1567' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1567
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 *         else:
 *             pre_exponent = exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         reduced_exponent = (exponent - 2.0) / 2.0
 */
    __pyx_v_pre_exponent = __pyx_v_exponent;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1568")'> 1568: </pre>
<pre id='line1568' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1569")'> 1569:         reduced_exponent = (exponent - 2.0) / 2.0</pre>
<pre id='line1569' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1569
 *             pre_exponent = exponent
 * 
 *         reduced_exponent = (exponent - 2.0) / 2.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent
 */
  __pyx_v_reduced_exponent = ((__pyx_v_exponent - 2.0) / 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1570")'> 1570: </pre>
<pre id='line1570' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1571")'> 1571:         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent</pre>
<pre id='line1571' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1571
 *         reduced_exponent = (exponent - 2.0) / 2.0
 * 
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return force_factor
 */
  __pyx_v_force_factor = ((__pyx_v_full_factor * __pyx_v_pre_exponent) * powf(__pyx_v_sum_xyz_distances_2, __pyx_v_reduced_exponent));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1572")'> 1572: </pre>
<pre id='line1572' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1573")'> 1573:         return force_factor</pre>
<pre id='line1573' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1573
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent
 * 
 *         return force_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_force_factor;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1574")'> 1574: </pre>
<pre id='line1574' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1575")'> 1575: </pre>
<pre id='line1575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1576")'> 1576: </pre>
<pre id='line1576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1577")'> 1577: </pre>
<pre id='line1577' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1578")'> 1578: </pre>
<pre id='line1578' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1579")'> 1579: #    def _calc_single_force_set(self, int index, float factor, object forces):</pre>
<pre id='line1579' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1580")'> 1580: #        self._cython_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1580' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1581")'> 1581: </pre>
<pre id='line1581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1582")'> 1582:     @cython.profile(False)</pre>
<pre id='line1582' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1583")'> 1583:     cdef inline void _distance_calc_single_force_set(self,int index, float factor, Out_array forces):</pre>
<pre id='line1583' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1583
 * 
 *     @cython.profile(False)
 *     cdef inline void _distance_calc_single_force_set(self,int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        cdef target_distant_atom atom_ids
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_xyz_distances;
  float __pyx_v_force_factor;
  Vec3 __pyx_v_target_forces;
  Vec3 __pyx_v_distant_forces;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_distance_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1584")'> 1584: </pre>
<pre id='line1584' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1585")'> 1585: #        cdef target_distant_atom atom_ids</pre>
<pre id='line1585' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1586")'> 1586:         cdef Vec3 xyz_distances</pre>
<pre id='line1586' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1587")'> 1587:         cdef float force_factor, distance</pre>
<pre id='line1587' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1588")'> 1588:         cdef Vec3 result</pre>
<pre id='line1588' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1589")'> 1589: </pre>
<pre id='line1589' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1590")'> 1590: #        atom_ids =  self._get_target_and_distant_atom_ids(index)</pre>
<pre id='line1590' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1591")'> 1591: #</pre>
<pre id='line1591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1592")'> 1592: ##        print atom_ids.target_atom_id,atom_ids.distant_atom_id</pre>
<pre id='line1592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1593")'> 1593:         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)</pre>
<pre id='line1593' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1593
 * #
 * ##        print atom_ids.target_atom_id,atom_ids.distant_atom_id
 *         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)
 */
  __pyx_v_xyz_distances = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1594")'> 1594: </pre>
<pre id='line1594' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1595")'> 1595:         force_factor  = self._cython_calc_single_force_factor(index, factor)</pre>
<pre id='line1595' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1595
 *         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)
 * 
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_forces = xyz_distances
 */
  __pyx_v_force_factor = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index, __pyx_v_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1596")'> 1596: </pre>
<pre id='line1596' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1597")'> 1597:         cdef Vec3 target_forces = xyz_distances</pre>
<pre id='line1597' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1597
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)
 * 
 *         cdef Vec3 target_forces = xyz_distances             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(target_forces, -force_factor)
 * 
 */
  __pyx_v_target_forces = __pyx_v_xyz_distances;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1598")'> 1598:         operator_times(target_forces, -force_factor)</pre>
<pre id='line1598' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1598
 * 
 *         cdef Vec3 target_forces = xyz_distances
 *         operator_times(target_forces, -force_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 distant_forces = xyz_distances
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_target_forces, (-__pyx_v_force_factor));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1599")'> 1599: </pre>
<pre id='line1599' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1600")'> 1600:         cdef Vec3 distant_forces = xyz_distances</pre>
<pre id='line1600' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1600
 *         operator_times(target_forces, -force_factor)
 * 
 *         cdef Vec3 distant_forces = xyz_distances             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(distant_forces, force_factor)
 * #
 */
  __pyx_v_distant_forces = __pyx_v_xyz_distances;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1601")'> 1601:         operator_times(distant_forces, force_factor)</pre>
<pre id='line1601' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1601
 * 
 *         cdef Vec3 distant_forces = xyz_distances
 *         operator_times(distant_forces, force_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_distant_forces, __pyx_v_force_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1602")'> 1602: #</pre>
<pre id='line1602' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1603")'> 1603:         forces.add(self._compiled_components[index].remote_atom_1,target_forces)</pre>
<pre id='line1603' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1603
 *         operator_times(distant_forces, force_factor)
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, __pyx_v_target_forces);
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1604")'> 1604:         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)</pre>
<pre id='line1604' class='code' style='background-color: #FFFF2a'>
  /* "Cython_shift_calculator.pyx":1604
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)
 *         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2, __pyx_v_distant_forces);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)__pyx_kp_s_16);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1605")'> 1605: </pre>
<pre id='line1605' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1606")'> 1606: </pre>
<pre id='line1606' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1607")'> 1607: cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):</pre>
<pre id='line1607' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1607
 * 
 * 
 * cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float _non_bonded_cutoff
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator {
  struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator __pyx_base;
  float _non_bonded_cutoff;
};


/* "Cython_shift_calculator.pyx":1607
 * 
 * 
 * cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float _non_bonded_cutoff
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator __pyx_base;
  void (*_non_bonded_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_force_calculator;
static CYTHON_INLINE void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__non_bonded_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1608")'> 1608:     cdef float _non_bonded_cutoff</pre>
<pre id='line1608' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1609")'> 1609: </pre>
<pre id='line1609' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1610")'> 1610:     def __init__(self, object indices, bint smoothed, name = "not set"):</pre>
<pre id='line1610' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1610
 *     cdef float _non_bonded_cutoff
 * 
 *     def __init__(self, object indices, bint smoothed, name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         global DEFAULT_NB_CUTOFF
 *         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_indices, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1611")'> 1611:         global DEFAULT_NB_CUTOFF</pre>
<pre id='line1611' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line1612")'> 1612:         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)</pre>
<pre id='line1612' class='code' style='background-color: #FFFF28'>
  /* "Cython_shift_calculator.pyx":1612
 *     def __init__(self, object indices, bint smoothed, name = "not set"):
 *         global DEFAULT_NB_CUTOFF
 *         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._non_bonded_cutoff = DEFAULT_NB_CUTOFF
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_indices);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1613")'> 1613:         self._non_bonded_cutoff = DEFAULT_NB_CUTOFF</pre>
<pre id='line1613' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1613
 *         global DEFAULT_NB_CUTOFF
 *         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)
 *         self._non_bonded_cutoff = DEFAULT_NB_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    def _calc_single_force_set(self, int index, float factor, object forces):
 */
  __pyx_v_self->_non_bonded_cutoff = __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1614")'> 1614: </pre>
<pre id='line1614' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1615")'> 1615: #    def _calc_single_force_set(self, int index, float factor, object forces):</pre>
<pre id='line1615' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1616")'> 1616: #        self._cython_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1616' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1617")'> 1617:     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line1617' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1617
 * #    def _calc_single_force_set(self, int index, float factor, object forces):
 * #        self._cython_calc_single_force_set(index, factor, forces)
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._num_components):
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 */

static void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_i;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1618")'> 1618:         for i in range(self._num_components):</pre>
<pre id='line1618' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1618
 * #        self._cython_calc_single_force_set(index, factor, forces)
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         for i in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base._num_components;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1619")'> 1619:             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1619' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1619
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         for i in range(self._num_components):
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):
 */
    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_result.data + __pyx_t_3 * __pyx_v_component_to_result.strides[0]) )));
    __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__non_bonded_calc_single_force_set(__pyx_v_self, __pyx_v_i, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_4 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1620")'> 1620: </pre>
<pre id='line1620' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1621")'> 1621:     cdef inline void  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1621' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1621
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 *     cdef inline void  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float distance  = calc_distance_simulation(self._simulation, self._compiled_components[index].target_atom,self._compiled_components[index].remote_atom_2)
 * #        TODO: this should be the non bonded distance cutoff
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__non_bonded_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  float __pyx_v_distance;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_non_bonded_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1622")'> 1622:         cdef float distance  = calc_distance_simulation(self._simulation, self._compiled_components[index].target_atom,self._compiled_components[index].remote_atom_2)</pre>
<pre id='line1622' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1622
 * 
 *     cdef inline void  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):
 *         cdef float distance  = calc_distance_simulation(self._simulation, self._compiled_components[index].target_atom,self._compiled_components[index].remote_atom_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        TODO: this should be the non bonded distance cutoff
 * #TODO class variable of self are not being looked up!
 */
  __pyx_v_distance = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base.__pyx_base._simulation, (__pyx_v_self->__pyx_base._compiled_components[__pyx_v_index]).target_atom, (__pyx_v_self->__pyx_base._compiled_components[__pyx_v_index]).remote_atom_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1623")'> 1623: #        TODO: this should be the non bonded distance cutoff</pre>
<pre id='line1623' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1624")'> 1624: #TODO class variable of self are not being looked up!</pre>
<pre id='line1624' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1625")'> 1625:         if distance &lt; 5.0:</pre>
<pre id='line1625' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1625
 * #        TODO: this should be the non bonded distance cutoff
 * #TODO class variable of self are not being looked up!
 *         if distance <code><</code> 5.0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._distance_calc_single_force_set(index, factor, forces)
 * 
 */
  __pyx_t_1 = (__pyx_v_distance <code><</code> 5.0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1626")'> 1626:             self._distance_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1626' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":1626
 * #TODO class variable of self are not being looked up!
 *         if distance <code><</code> 5.0:
 *             self._distance_calc_single_force_set(index, factor, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);
    goto __pyx_L3;
  }
  __pyx_L3:;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1627")'> 1627: </pre>
<pre id='line1627' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1628")'> 1628: </pre>
<pre id='line1628' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1629")'> 1629: </pre>
<pre id='line1629' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1630")'> 1630: </pre>
<pre id='line1630' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1631")'> 1631: cdef class Fast_dihedral_force_calculator(Base_force_calculator):</pre>
<pre id='line1631' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1631
 * 
 * 
 * cdef class Fast_dihedral_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component *_compiled_components
 */
struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_Dihedral_component *_compiled_components;
  int _num_components;
};


/* "Cython_shift_calculator.pyx":1631
 * 
 * 
 * cdef class Fast_dihedral_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Dihedral_component *_compiled_components
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_dihedral_ids (*_get_dihedral_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_parameters (*_get_parameters)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  float (*_get_coefficient)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  float (*_cython_calc_single_force_factor)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  void (*_dihedral_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_dihedral_force_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE void __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1632")'> 1632: </pre>
<pre id='line1632' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1633")'> 1633:     cdef Dihedral_component *_compiled_components</pre>
<pre id='line1633' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1634")'> 1634:     cdef int _num_components</pre>
<pre id='line1634' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1635")'> 1635: </pre>
<pre id='line1635' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1636")'> 1636:     def __cinit__(self):</pre>
<pre id='line1636' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1636
 *     cdef int _num_components
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1637")'> 1637:         self._compiled_components = NULL</pre>
<pre id='line1637' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1637
 * 
 *     def __cinit__(self):
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line1638")'> 1638:         self._num_components = 0</pre>
<pre id='line1638' class='code' style='background-color: #FFFF4b'>
  /* "Cython_shift_calculator.pyx":1638
 *     def __cinit__(self):
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self,name="not set"):
 */
  __pyx_v_self->_num_components = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_16);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1640; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1640; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1639")'> 1639: </pre>
<pre id='line1639' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1640")'> 1640:     def __init__(self,name="not set"):</pre>
<pre id='line1640' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1640
 *         self._num_components = 0
 * 
 *     def __init__(self,name="not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_force_calculator.__init__(self,name=name)
 * 
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line1641")'> 1641:         Base_force_calculator.__init__(self,name=name)</pre>
<pre id='line1641' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":1641
 * 
 *     def __init__(self,name="not set"):
 *         Base_force_calculator.__init__(self,name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_force_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_4_set_components(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1642")'> 1642: </pre>
<pre id='line1642' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1643")'> 1643: </pre>
<pre id='line1643' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1644")'> 1644:     def _set_components(self,components):</pre>
<pre id='line1644' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1644
 * 
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_4_set_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1645")'> 1645:         if self._compiled_components ==  NULL:</pre>
<pre id='line1645' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1645
 * 
 *     def _set_components(self,components):
 *         if self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1646")'> 1646:             self._compile_components(components)</pre>
<pre id='line1646' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":1646
 *     def _set_components(self,components):
 *         if self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_components(self, components):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___compile_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1646; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1646; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1646; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_7_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_7_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_6_compile_components(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1647")'> 1647: </pre>
<pre id='line1647' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1648")'> 1648:     def _compile_components(self, components):</pre>
<pre id='line1648' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1648
 *             self._compile_components(components)
 * 
 *     def _compile_components(self, components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))
 *         self._num_components = len(components)
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_6_compile_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_v_j = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1649")'> 1649:         self._compiled_components = &lt;Dihedral_component*&gt;malloc(len(components) * sizeof(Dihedral_component))</pre>
<pre id='line1649' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1649
 * 
 *     def _compile_components(self, components):
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Dihedral_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Dihedral_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1650")'> 1650:         self._num_components = len(components)</pre>
<pre id='line1650' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1650
 *     def _compile_components(self, components):
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1650; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1651")'> 1651:         for i,component in enumerate(components):</pre>
<pre id='line1651' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1651
 *         self._compiled_components = <code><</code>Dihedral_component*>malloc(len(components) * sizeof(Dihedral_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line1652")'> 1652:             self._compiled_components[i].target_atom = component[0]</pre>
<pre id='line1652' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":1652
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(4):
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 */
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_7]).target_atom = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line1653")'> 1653:             for j in range(4):</pre>
<pre id='line1653' class='code' style='background-color: #FFFF23'>
    /* "Cython_shift_calculator.pyx":1653
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_k_tuple_48), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
      __pyx_t_8 = __pyx_t_5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_7 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_8 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = Py_TYPE(__pyx_t_8)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_8)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_8, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_8)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_8)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_8, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_5 = __pyx_t_9(__pyx_t_8);
        if (unlikely(!__pyx_t_5)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
      __pyx_v_j = __pyx_t_5;
      __pyx_t_5 = 0;

  /* "Cython_shift_calculator.pyx":1653
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 */
  __pyx_k_tuple_48 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_4);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_48)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1653; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_48);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_48));
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line1654")'> 1654:                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]</pre>
<pre id='line1654' class='code' style='background-color: #FFFF30'>
      /* "Cython_shift_calculator.pyx":1654
 *             self._compiled_components[i].target_atom = component[0]
 *             for j in range(4):
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):
 */
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_int_1, __pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component, __pyx_t_5);<span class='error_goto'> if (!__pyx_t_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_10);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_j);<span class='error_goto'> if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((__pyx_v_self->_compiled_components[__pyx_t_11]).dihedral_atoms[__pyx_t_12]) = __pyx_t_6;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line1655")'> 1655:             self._compiled_components[i].coefficient = component[5]</pre>
<pre id='line1655' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":1655
 *             for j in range(4):
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(5):
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 */
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 5, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_8);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_7]).coefficient = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line1656")'> 1656:             for j in range(5):</pre>
<pre id='line1656' class='code' style='background-color: #FFFF23'>
    /* "Cython_shift_calculator.pyx":1656
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 * 
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_k_tuple_49), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_8)) {
      __pyx_t_10 = __pyx_t_8; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_7 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_10 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_9 = Py_TYPE(__pyx_t_10)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    for (;;) {
      if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_10)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_10)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_10, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_10, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_10)) {
        if (__pyx_t_7 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_10)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_10, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_10, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_8 = __pyx_t_9(__pyx_t_10);
        if (unlikely(!__pyx_t_8)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
      __pyx_v_j = __pyx_t_8;
      __pyx_t_8 = 0;

  /* "Cython_shift_calculator.pyx":1656
 *                 self._compiled_components[i].dihedral_atoms[j] = component[1+j]
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 * 
 */
  __pyx_k_tuple_49 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_5);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_49)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_49);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_49));
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line1657")'> 1657:                 self._compiled_components[i].parameters[j] = component[6+j]</pre>
<pre id='line1657' class='code' style='background-color: #FFFF25'>
      /* "Cython_shift_calculator.pyx":1657
 *             self._compiled_components[i].coefficient = component[5]
 *             for j in range(5):
 *                 self._compiled_components[i].parameters[j] = component[6+j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_compiled_components(self):
 */
      __pyx_t_8 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_int_6, __pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component, __pyx_t_8);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_13 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_j);<span class='error_goto'> if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((__pyx_v_self->_compiled_components[__pyx_t_12]).parameters[__pyx_t_11]) = __pyx_t_13;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_9_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_9_free_compiled_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_8_free_compiled_components(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1658")'> 1658: </pre>
<pre id='line1658' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1659")'> 1659:     def _free_compiled_components(self):</pre>
<pre id='line1659' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1659
 *                 self._compiled_components[i].parameters[j] = component[6+j]
 * 
 *     def _free_compiled_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_8_free_compiled_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1660")'> 1660:         if self._compiled_components != NULL:</pre>
<pre id='line1660' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1660
 * 
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._compiled_components)
 *             self._compiled_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1661")'> 1661:             free(self._compiled_components)</pre>
<pre id='line1661' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1661
 *     def _free_compiled_components(self):
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_components);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1662")'> 1662:             self._compiled_components = NULL</pre>
<pre id='line1662' class='code' style='background-color: #FFFF39'>
    /* "Cython_shift_calculator.pyx":1662
 *         if self._compiled_components != NULL:
 *             free(self._compiled_components)
 *             self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _prepare(self, change, data):
 */
    __pyx_v_self->_compiled_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_11_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_11_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1664; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1664; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1664; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_10_prepare(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1663")'> 1663: </pre>
<pre id='line1663' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1664")'> 1664:     def _prepare(self, change, data):</pre>
<pre id='line1664' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1664
 *             self._compiled_components = NULL
 * 
 *     def _prepare(self, change, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_10_prepare(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1665")'> 1665:          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:</pre>
<pre id='line1665' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":1665
 * 
 *     def _prepare(self, change, data):
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *              self._free_compiled_components()
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_1, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_3) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_2, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line1666")'> 1666:              self._free_compiled_components()</pre>
<pre id='line1666' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":1666
 *     def _prepare(self, change, data):
 *          if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *              self._free_compiled_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #     TODO: remove this is no longer needed
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_24);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1667")'> 1667: </pre>
<pre id='line1667' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1668")'> 1668: #     TODO: remove this is no longer needed</pre>
<pre id='line1668' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1669")'> 1669:     @cython.profile(False)</pre>
<pre id='line1669' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1670")'> 1670:     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):</pre>
<pre id='line1670' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1670
 * #     TODO: remove this is no longer needed
 *     @cython.profile(False)
 *     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_dihedral_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1671")'> 1671:         cdef dihedral_ids result</pre>
<pre id='line1671' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1672")'> 1672: </pre>
<pre id='line1672' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1673")'> 1673:         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]</pre>
<pre id='line1673' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1673
 *         cdef dihedral_ids result
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 */
  __pyx_v_result.atom_id_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1674")'> 1674:         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]</pre>
<pre id='line1674' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1674
 * 
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 */
  __pyx_v_result.atom_id_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1675")'> 1675:         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]</pre>
<pre id='line1675' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1675
 *         result.atom_id_1 = self._compiled_components[index].dihedral_atoms[0]
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 */
  __pyx_v_result.atom_id_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1676")'> 1676:         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]</pre>
<pre id='line1676' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1676
 *         result.atom_id_2 = self._compiled_components[index].dihedral_atoms[1]
 *         result.atom_id_3 = self._compiled_components[index].dihedral_atoms[2]
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_v_result.atom_id_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).dihedral_atoms[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1677")'> 1677: </pre>
<pre id='line1677' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1678")'> 1678:         return result</pre>
<pre id='line1678' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1678
 *         result.atom_id_4 = self._compiled_components[index].dihedral_atoms[3]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO: remove this an correct order of parameters!
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1679")'> 1679: </pre>
<pre id='line1679' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1680")'> 1680:     #TODO: remove this an correct order of parameters!</pre>
<pre id='line1680' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1681")'> 1681:     @cython.profile(False)</pre>
<pre id='line1681' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1682")'> 1682:     cdef inline dihedral_parameters _get_parameters(self, int index):</pre>
<pre id='line1682' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1682
 *     #TODO: remove this an correct order of parameters!
 *     @cython.profile(False)
 *     cdef inline dihedral_parameters _get_parameters(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_parameters result
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_result;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_parameters", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1683")'> 1683: </pre>
<pre id='line1683' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1684")'> 1684:         cdef dihedral_parameters result</pre>
<pre id='line1684' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1685")'> 1685: </pre>
<pre id='line1685' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1686")'> 1686:         result.param_0 = self._compiled_components[index].parameters[0]</pre>
<pre id='line1686' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1686
 *         cdef dihedral_parameters result
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 */
  __pyx_v_result.param_0 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1687")'> 1687:         result.param_1 = self._compiled_components[index].parameters[3]</pre>
<pre id='line1687' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1687
 * 
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 */
  __pyx_v_result.param_1 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1688")'> 1688:         result.param_2 = self._compiled_components[index].parameters[1]</pre>
<pre id='line1688' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1688
 *         result.param_0 = self._compiled_components[index].parameters[0]
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]
 */
  __pyx_v_result.param_2 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1689")'> 1689:         result.param_3 = self._compiled_components[index].parameters[4]</pre>
<pre id='line1689' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1689
 *         result.param_1 = self._compiled_components[index].parameters[3]
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_4 = self._compiled_components[index].parameters[2]
 * 
 */
  __pyx_v_result.param_3 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[4]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1690")'> 1690:         result.param_4 = self._compiled_components[index].parameters[2]</pre>
<pre id='line1690' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1690
 *         result.param_2 = self._compiled_components[index].parameters[1]
 *         result.param_3 = self._compiled_components[index].parameters[4]
 *         result.param_4 = self._compiled_components[index].parameters[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_result.param_4 = ((__pyx_v_self->_compiled_components[__pyx_v_index]).parameters[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1691")'> 1691: </pre>
<pre id='line1691' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1692")'> 1692: </pre>
<pre id='line1692' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1693")'> 1693: </pre>
<pre id='line1693' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1694")'> 1694: </pre>
<pre id='line1694' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1695")'> 1695:         return result</pre>
<pre id='line1695' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1695
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1696")'> 1696: </pre>
<pre id='line1696' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1697")'> 1697:     @cython.profile(False)</pre>
<pre id='line1697' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1698")'> 1698:     cdef inline float _get_coefficient(self, int index):</pre>
<pre id='line1698' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1698
 * 
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._compiled_components[index].coefficient
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coefficient", 0);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1699")'> 1699:         return self._compiled_components[index].coefficient</pre>
<pre id='line1699' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1699
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):
 *         return self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    TODO make this consistent with the distance forces factor
 */
  __pyx_r = (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_13_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_arg_index); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_13_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_arg_index) {
  int __pyx_v_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor (wrapper)", 0);
  assert(__pyx_arg_index); {
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_arg_index);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1702; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_12_calc_single_force_factor(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), ((int)__pyx_v_index));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1700")'> 1700: </pre>
<pre id='line1700' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1701")'> 1701: #    TODO make this consistent with the distance forces factor</pre>
<pre id='line1701' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1702")'> 1702:     def _calc_single_force_factor(self, int index):</pre>
<pre id='line1702' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1702
 * 
 * #    TODO make this consistent with the distance forces factor
 *     def _calc_single_force_factor(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._cython_calc_single_force_factor(index)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_12_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1703")'> 1703:         return self._cython_calc_single_force_factor(index)</pre>
<pre id='line1703' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1703
 * #    TODO make this consistent with the distance forces factor
 *     def _calc_single_force_factor(self, int index):
 *         return self._cython_calc_single_force_factor(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1704")'> 1704: </pre>
<pre id='line1704' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1705")'> 1705:     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line1705' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1705
 *         return self._cython_calc_single_force_factor(index)
 * 
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int i
 *         for i in range(self._num_components):
 */

static void __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_i;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1706")'> 1706:         cdef int i</pre>
<pre id='line1706' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1707")'> 1707:         for i in range(self._num_components):</pre>
<pre id='line1707' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1707
 *     cdef void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         cdef int i
 *         for i in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._dihedral_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->_num_components;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1708")'> 1708:             self._dihedral_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1708' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1708
 *         cdef int i
 *         for i in range(self._num_components):
 *             self._dihedral_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_result.data + __pyx_t_3 * __pyx_v_component_to_result.strides[0]) )));
    __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(__pyx_v_self, __pyx_v_i, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_4 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1709")'> 1709: </pre>
<pre id='line1709' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1710")'> 1710: </pre>
<pre id='line1710' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1711")'> 1711:     cdef inline float _cython_calc_single_force_factor(self, int index):</pre>
<pre id='line1711' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1711
 * 
 * 
 *     cdef inline float _cython_calc_single_force_factor(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_ids dihedral_atom_ids
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_params;
  float __pyx_v_angle;
  float __pyx_v_result;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1712")'> 1712: </pre>
<pre id='line1712' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1713")'> 1713:         cdef dihedral_ids dihedral_atom_ids</pre>
<pre id='line1713' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1714")'> 1714:         cdef dihedral_parameters params</pre>
<pre id='line1714' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1715")'> 1715: </pre>
<pre id='line1715' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1716")'> 1716:         cdef float angle,result</pre>
<pre id='line1716' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1717")'> 1717: </pre>
<pre id='line1717' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1718")'> 1718: </pre>
<pre id='line1718' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1719")'> 1719:         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)</pre>
<pre id='line1719' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1719
 * 
 * 
 *         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         params = self._get_parameters(index)
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_index);
  __pyx_v_dihedral_atom_ids = __pyx_t_1;
  __pyx_v_dihedral_atom_ids = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1720")'> 1720: </pre>
<pre id='line1720' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1721")'> 1721:         params = self._get_parameters(index)</pre>
<pre id='line1721' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1721
 *         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)
 * 
 *         params = self._get_parameters(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)
 */
  __pyx_v_params = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1722")'> 1722: </pre>
<pre id='line1722' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1723")'> 1723:         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)</pre>
<pre id='line1723' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1723
 *         params = self._get_parameters(index)
 * 
 *         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 */
  __pyx_v_angle = __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_dihedral_atom_ids);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1724")'> 1724: </pre>
<pre id='line1724' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1725")'> 1725:         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \</pre>
<pre id='line1725' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1726")'> 1726:                         params.param_2 * sin(angle + params.param_3)</pre>
<pre id='line1726' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1726
 * 
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 *                         params.param_2 * sin(angle + params.param_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_v_result = (((-3.0 * __pyx_v_params.param_0) * sin(((3.0 * __pyx_v_angle) + __pyx_v_params.param_1))) - (__pyx_v_params.param_2 * sin((__pyx_v_angle + __pyx_v_params.param_3))));
</pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line1727")'> 1727:         return result</pre>
<pre id='line1727' class='code' style='background-color: #FFFF22'>
  /* "Cython_shift_calculator.pyx":1727
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 *                         params.param_2 * sin(angle + params.param_3)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_15_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_15_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,&__pyx_n_s__forces,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_set") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_14_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1728")'> 1728: </pre>
<pre id='line1728' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1729")'> 1729: </pre>
<pre id='line1729' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1730")'> 1730: </pre>
<pre id='line1730' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1731")'> 1731:     def _calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1731' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1731
 * 
 * 
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO tidy this up a hack for the test suite
 *         cdef Dihedral_component* saved_component_list = self._compiled_components
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_14_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Dihedral_component *__pyx_v_saved_component_list;
  int __pyx_v_saved_num_components;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1732")'> 1732:         #TODO tidy this up a hack for the test suite</pre>
<pre id='line1732' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1733")'> 1733:         cdef Dihedral_component* saved_component_list = self._compiled_components</pre>
<pre id='line1733' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1733
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 *         #TODO tidy this up a hack for the test suite
 *         cdef Dihedral_component* saved_component_list = self._compiled_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int saved_num_components = self._num_components
 * 
 */
  __pyx_t_1 = __pyx_v_self->_compiled_components;
  __pyx_v_saved_component_list = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1734")'> 1734:         cdef int saved_num_components = self._num_components</pre>
<pre id='line1734' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1734
 *         #TODO tidy this up a hack for the test suite
 *         cdef Dihedral_component* saved_component_list = self._compiled_components
 *         cdef int saved_num_components = self._num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._num_components  = 1
 */
  __pyx_t_2 = __pyx_v_self->_num_components;
  __pyx_v_saved_num_components = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1735")'> 1735: </pre>
<pre id='line1735' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1736")'> 1736:         self._num_components  = 1</pre>
<pre id='line1736' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1736
 *         cdef int saved_num_components = self._num_components
 * 
 *         self._num_components  = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = &saved_component_list[index]
 * 
 */
  __pyx_v_self->_num_components = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1737")'> 1737:         self._compiled_components = &amp;saved_component_list[index]</pre>
<pre id='line1737' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1737
 * 
 *         self._num_components  = 1
 *         self._compiled_components = &saved_component_list[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._dihedral_calc_single_force_set(0,factor,forces)
 */
  __pyx_v_self->_compiled_components = (&(__pyx_v_saved_component_list[__pyx_v_index]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1738")'> 1738: </pre>
<pre id='line1738' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1739")'> 1739:         self._dihedral_calc_single_force_set(0,factor,forces)</pre>
<pre id='line1739' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1739
 *         self._compiled_components = &saved_component_list[index]
 * 
 *         self._dihedral_calc_single_force_set(0,factor,forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_components = saved_component_list
 */
  __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(__pyx_v_self, 0, __pyx_v_factor, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1740")'> 1740: </pre>
<pre id='line1740' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1741")'> 1741:         self._compiled_components = saved_component_list</pre>
<pre id='line1741' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1741
 *         self._dihedral_calc_single_force_set(0,factor,forces)
 * 
 *         self._compiled_components = saved_component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = saved_num_components
 * 
 */
  __pyx_v_self->_compiled_components = __pyx_v_saved_component_list;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1742")'> 1742:         self._num_components = saved_num_components</pre>
<pre id='line1742' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1742
 * 
 *         self._compiled_components = saved_component_list
 *         self._num_components = saved_num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_num_components = __pyx_v_saved_num_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1743")'> 1743: </pre>
<pre id='line1743' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1744")'> 1744: </pre>
<pre id='line1744' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1745")'> 1745:     cdef inline void _dihedral_calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1745' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1745
 * 
 * 
 *     cdef inline void _dihedral_calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 r1, r2, r4, temp
 *         cdef Vec3 n1, n2
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_r1;
  Vec3 __pyx_v_r2;
  Vec3 __pyx_v_r4;
  Vec3 __pyx_v_n1;
  Vec3 __pyx_v_n2;
  float __pyx_v_weight;
  float __pyx_v_factor_1;
  float __pyx_v_factor_2;
  float __pyx_v_factor_3;
  Vec3 __pyx_v_F2;
  Vec3 __pyx_v_F3;
  float __pyx_v_dihedral_factor;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_atom_ids;
  float __pyx_v_r2_length;
  float __pyx_v_r2_length_2;
  Vec3 __pyx_v_v1;
  Vec3 __pyx_v_v2;
  Vec3 __pyx_v_v3;
  Vec3 __pyx_v_v4;
  Vec3 __pyx_v_r3;
  Vec3 __pyx_v_F1;
  Vec3 __pyx_v_F4;
  Vec3 __pyx_v_T1;
  Vec3 __pyx_v_T2;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_dihedral_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1746")'> 1746:         cdef Vec3 r1, r2, r4, temp</pre>
<pre id='line1746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1747")'> 1747:         cdef Vec3 n1, n2</pre>
<pre id='line1747' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1748")'> 1748:         cdef float weight</pre>
<pre id='line1748' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1749")'> 1749:         cdef float factor_1, factor_2, factor_3</pre>
<pre id='line1749' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1750")'> 1750:         cdef Vec3 F2, F3,</pre>
<pre id='line1750' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1751")'> 1751:         cdef Vec3 T3, T4</pre>
<pre id='line1751' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1752")'> 1752: </pre>
<pre id='line1752' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1753")'> 1753:         cdef float dihedral_factor = self._cython_calc_single_force_factor(index)</pre>
<pre id='line1753' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1753
 *         cdef Vec3 T3, T4
 * 
 *         cdef float dihedral_factor = self._cython_calc_single_force_factor(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)
 * 
 */
  __pyx_v_dihedral_factor = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1754")'> 1754:         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)</pre>
<pre id='line1754' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1754
 * 
 *         cdef float dihedral_factor = self._cython_calc_single_force_factor(index)
 *         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float r2_length, r2_length_2
 */
  __pyx_v_atom_ids = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1755")'> 1755: </pre>
<pre id='line1755' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1756")'> 1756:         cdef float r2_length, r2_length_2</pre>
<pre id='line1756' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1757")'> 1757: </pre>
<pre id='line1757' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1758")'> 1758:         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)</pre>
<pre id='line1758' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1758
 *         cdef float r2_length, r2_length_2
 * 
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 */
  __pyx_v_v1 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1759")'> 1759:         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)</pre>
<pre id='line1759' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1759
 * 
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 */
  __pyx_v_v2 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1760")'> 1760:         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)</pre>
<pre id='line1760' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1760
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 * 
 */
  __pyx_v_v3 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1761")'> 1761:         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)</pre>
<pre id='line1761' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1761
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r1 = v1 - v2
 */
  __pyx_v_v4 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1762")'> 1762: </pre>
<pre id='line1762' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1763")'> 1763:         r1 = v1 - v2</pre>
<pre id='line1763' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1763
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 * 
 *         r1 = v1 - v2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         r2 = v3 - v2
 * 
 */
  __pyx_v_r1 = (__pyx_v_v1 - __pyx_v_v2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1764")'> 1764:         r2 = v3 - v2</pre>
<pre id='line1764' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1764
 * 
 *         r1 = v1 - v2
 *         r2 = v3 - v2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 r3 = r2
 */
  __pyx_v_r2 = (__pyx_v_v3 - __pyx_v_v2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1765")'> 1765: </pre>
<pre id='line1765' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1766")'> 1766:         cdef Vec3 r3 = r2</pre>
<pre id='line1766' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1766
 *         r2 = v3 - v2
 * 
 *         cdef Vec3 r3 = r2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(r3, -1)
 * 
 */
  __pyx_v_r3 = __pyx_v_r2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1767")'> 1767:         operator_times(r3, -1)</pre>
<pre id='line1767' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1767
 * 
 *         cdef Vec3 r3 = r2
 *         operator_times(r3, -1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r4 = v4 - v3
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_r3, -1.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1768")'> 1768: </pre>
<pre id='line1768' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1769")'> 1769:         r4 = v4 - v3</pre>
<pre id='line1769' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1769
 *         operator_times(r3, -1)
 * 
 *         r4 = v4 - v3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        print vec3_as_tuple(r1), vec3_as_tuple(r2), vec3_as_tuple(r3), vec3_as_tuple(r4)
 */
  __pyx_v_r4 = (__pyx_v_v4 - __pyx_v_v3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1770")'> 1770: </pre>
<pre id='line1770' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1771")'> 1771: #        print vec3_as_tuple(r1), vec3_as_tuple(r2), vec3_as_tuple(r3), vec3_as_tuple(r4)</pre>
<pre id='line1771' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1772")'> 1772: </pre>
<pre id='line1772' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1773")'> 1773:         # compute normal vector to plane containing v1, v2, and v3</pre>
<pre id='line1773' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1774")'> 1774:         n1 = cross(r1, r2)</pre>
<pre id='line1774' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1774
 * 
 *         # compute normal vector to plane containing v1, v2, and v3
 *         n1 = cross(r1, r2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # compute normal vector to plane containing v2, v3, and v4
 *         n2 = cross(r3, r4)
 */
  __pyx_v_n1 = cross(__pyx_v_r1, __pyx_v_r2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1775")'> 1775:         # compute normal vector to plane containing v2, v3, and v4</pre>
<pre id='line1775' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1776")'> 1776:         n2 = cross(r3, r4)</pre>
<pre id='line1776' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1776
 *         n1 = cross(r1, r2)
 *         # compute normal vector to plane containing v2, v3, and v4
 *         n2 = cross(r3, r4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)
 */
  __pyx_v_n2 = cross(__pyx_v_r3, __pyx_v_r4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1777")'> 1777: </pre>
<pre id='line1777' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1778")'> 1778:         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)</pre>
<pre id='line1778' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1778
 *         n2 = cross(r3, r4)
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         r2_length_2 = r2_length*r2_length
 * 
 */
  __pyx_v_r2_length = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_atom_ids.atom_id_2, __pyx_v_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1779")'> 1779:         r2_length_2 = r2_length*r2_length</pre>
<pre id='line1779' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1779
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)
 *         r2_length_2 = r2_length*r2_length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_r2_length_2 = (__pyx_v_r2_length * __pyx_v_r2_length);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1780")'> 1780: </pre>
<pre id='line1780' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1781")'> 1781: </pre>
<pre id='line1781' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1782")'> 1782:         weight = factor * self._get_coefficient(index)</pre>
<pre id='line1782' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1782
 * 
 * 
 *         weight = factor * self._get_coefficient(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_weight = (__pyx_v_factor * __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(__pyx_v_self, __pyx_v_index));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1783")'> 1783: </pre>
<pre id='line1783' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1784")'> 1784: </pre>
<pre id='line1784' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1785")'> 1785: </pre>
<pre id='line1785' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1786")'> 1786: #        // force calculation according to Bekker, Berendsen and van Gunsteren (1995),</pre>
<pre id='line1786' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1787")'> 1787: #        // Journal of Computational Chemistry 16, pp. 527-533:</pre>
<pre id='line1787' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1788")'> 1788: ##        // Force and virial of torsional-angle-dependent potentials.</pre>
<pre id='line1788' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1789")'> 1789:         factor_1 = dihedral_factor * r2_length</pre>
<pre id='line1789' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1789
 * #        // Journal of Computational Chemistry 16, pp. 527-533:
 * ##        // Force and virial of torsional-angle-dependent potentials.
 *         factor_1 = dihedral_factor * r2_length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 F1 = n1
 */
  __pyx_v_factor_1 = (__pyx_v_dihedral_factor * __pyx_v_r2_length);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1790")'> 1790: </pre>
<pre id='line1790' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1791")'> 1791:         cdef Vec3 F1 = n1</pre>
<pre id='line1791' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1791
 *         factor_1 = dihedral_factor * r2_length
 * 
 *         cdef Vec3 F1 = n1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F1, (-factor_1 / norm(n1)**2))
 * 
 */
  __pyx_v_F1 = __pyx_v_n1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1792")'> 1792:         operator_times(F1, (-factor_1 / norm(n1)**2))</pre>
<pre id='line1792' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1792
 * 
 *         cdef Vec3 F1 = n1
 *         operator_times(F1, (-factor_1 / norm(n1)**2))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 F4 = n2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F1, ((-__pyx_v_factor_1) / powf(norm(__pyx_v_n1), 2.0)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1793")'> 1793: </pre>
<pre id='line1793' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1794")'> 1794:         cdef Vec3 F4 = n2</pre>
<pre id='line1794' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1794
 *         operator_times(F1, (-factor_1 / norm(n1)**2))
 * 
 *         cdef Vec3 F4 = n2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F4, ( factor_1 / norm(n2)**2))
 * 
 */
  __pyx_v_F4 = __pyx_v_n2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1795")'> 1795:         operator_times(F4, ( factor_1 / norm(n2)**2))</pre>
<pre id='line1795' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1795
 * 
 *         cdef Vec3 F4 = n2
 *         operator_times(F4, ( factor_1 / norm(n2)**2))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F4, (__pyx_v_factor_1 / powf(norm(__pyx_v_n2), 2.0)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1796")'> 1796: </pre>
<pre id='line1796' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1797")'> 1797:         factor_2 = dot(r1, r2) / r2_length_2</pre>
<pre id='line1797' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1797
 *         operator_times(F4, ( factor_1 / norm(n2)**2))
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         factor_3 = dot(r3, r4) / r2_length_2
 * 
 */
  __pyx_v_factor_2 = (dot(__pyx_v_r1, __pyx_v_r2) / __pyx_v_r2_length_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1798")'> 1798:         factor_3 = dot(r3, r4) / r2_length_2</pre>
<pre id='line1798' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1798
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2
 *         factor_3 = dot(r3, r4) / r2_length_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 T1 = F1
 */
  __pyx_v_factor_3 = (dot(__pyx_v_r3, __pyx_v_r4) / __pyx_v_r2_length_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1799")'> 1799: </pre>
<pre id='line1799' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1800")'> 1800:         cdef Vec3 T1 = F1</pre>
<pre id='line1800' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1800
 *         factor_3 = dot(r3, r4) / r2_length_2
 * 
 *         cdef Vec3 T1 = F1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T1,  (factor_2-1))
 * 
 */
  __pyx_v_T1 = __pyx_v_F1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1801")'> 1801:         operator_times(T1,  (factor_2-1))</pre>
<pre id='line1801' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1801
 * 
 *         cdef Vec3 T1 = F1
 *         operator_times(T1,  (factor_2-1))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 T2 = F4
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T1, (__pyx_v_factor_2 - 1.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1802")'> 1802: </pre>
<pre id='line1802' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1803")'> 1803:         cdef Vec3 T2 = F4</pre>
<pre id='line1803' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1803
 *         operator_times(T1,  (factor_2-1))
 * 
 *         cdef Vec3 T2 = F4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T2,  -factor_3)
 * 
 */
  __pyx_v_T2 = __pyx_v_F4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1804")'> 1804:         operator_times(T2,  -factor_3)</pre>
<pre id='line1804' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1804
 * 
 *         cdef Vec3 T2 = F4
 *         operator_times(T2,  -factor_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         F2 = T1 + T2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T2, (-__pyx_v_factor_3));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1805")'> 1805: </pre>
<pre id='line1805' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1806")'> 1806:         F2 = T1 + T2</pre>
<pre id='line1806' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1806
 *         operator_times(T2,  -factor_3)
 * 
 *         F2 = T1 + T2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         T1 = F1
 */
  __pyx_v_F2 = (__pyx_v_T1 + __pyx_v_T2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1807")'> 1807: </pre>
<pre id='line1807' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1808")'> 1808:         T1 = F1</pre>
<pre id='line1808' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1808
 *         F2 = T1 + T2
 * 
 *         T1 = F1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T1,  -factor_2)
 * 
 */
  __pyx_v_T1 = __pyx_v_F1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1809")'> 1809:         operator_times(T1,  -factor_2)</pre>
<pre id='line1809' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1809
 * 
 *         T1 = F1
 *         operator_times(T1,  -factor_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         T2 = F4
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T1, (-__pyx_v_factor_2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1810")'> 1810: </pre>
<pre id='line1810' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1811")'> 1811:         T2 = F4</pre>
<pre id='line1811' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1811
 *         operator_times(T1,  -factor_2)
 * 
 *         T2 = F4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T2, (factor_3 -1))
 * 
 */
  __pyx_v_T2 = __pyx_v_F4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1812")'> 1812:         operator_times(T2, (factor_3 -1))</pre>
<pre id='line1812' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1812
 * 
 *         T2 = F4
 *         operator_times(T2, (factor_3 -1))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         F3 = T1 + T2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T2, (__pyx_v_factor_3 - 1.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1813")'> 1813: </pre>
<pre id='line1813' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1814")'> 1814:         F3 = T1 + T2</pre>
<pre id='line1814' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1814
 *         operator_times(T2, (factor_3 -1))
 * 
 *         F3 = T1 + T2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        print vec3_as_tuple(F1), vec3_as_tuple(F2), vec3_as_tuple(F3), vec3_as_tuple(F4)
 */
  __pyx_v_F3 = (__pyx_v_T1 + __pyx_v_T2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1815")'> 1815: </pre>
<pre id='line1815' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1816")'> 1816: #        print vec3_as_tuple(F1), vec3_as_tuple(F2), vec3_as_tuple(F3), vec3_as_tuple(F4)</pre>
<pre id='line1816' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1817")'> 1817: #        // assign forces</pre>
<pre id='line1817' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1818")'> 1818: #        force_triplet_1 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_1)</pre>
<pre id='line1818' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1819")'> 1819: #        force_triplet_2 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_2)</pre>
<pre id='line1819' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1820")'> 1820: #        force_triplet_3 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_3)</pre>
<pre id='line1820' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1821")'> 1821: #        force_triplet_4 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_4)</pre>
<pre id='line1821' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1822")'> 1822: </pre>
<pre id='line1822' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1823")'> 1823:         operator_times(F1, weight)</pre>
<pre id='line1823' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1823
 * #        force_triplet_4 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_4)
 * 
 *         operator_times(F1, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F1, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1824")'> 1824:         operator_times(F2, weight)</pre>
<pre id='line1824' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1824
 * 
 *         operator_times(F1, weight)
 *         operator_times(F2, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F3, weight)
 *         operator_times(F4, weight)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F2, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1825")'> 1825:         operator_times(F3, weight)</pre>
<pre id='line1825' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1825
 *         operator_times(F1, weight)
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F4, weight)
 * 
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F3, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1826")'> 1826:         operator_times(F4, weight)</pre>
<pre id='line1826' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1826
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)
 *         operator_times(F4, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         forces.add(atom_ids.atom_id_1,F1)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F4, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1827")'> 1827: </pre>
<pre id='line1827' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1828")'> 1828:         forces.add(atom_ids.atom_id_1,F1)</pre>
<pre id='line1828' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1828
 *         operator_times(F4, weight)
 * 
 *         forces.add(atom_ids.atom_id_1,F1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_1, __pyx_v_F1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1829")'> 1829:         forces.add(atom_ids.atom_id_2,F2)</pre>
<pre id='line1829' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1829
 * 
 *         forces.add(atom_ids.atom_id_1,F1)
 *         forces.add(atom_ids.atom_id_2,F2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_3,F3)
 *         forces.add(atom_ids.atom_id_4,F4)
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_2, __pyx_v_F2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1830")'> 1830:         forces.add(atom_ids.atom_id_3,F3)</pre>
<pre id='line1830' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1830
 *         forces.add(atom_ids.atom_id_1,F1)
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_4,F4)
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_3, __pyx_v_F3);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1831")'> 1831:         forces.add(atom_ids.atom_id_4,F4)</pre>
<pre id='line1831' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1831
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)
 *         forces.add(atom_ids.atom_id_4,F4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_4, __pyx_v_F4);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__cinit__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator___cinit__(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1832")'> 1832: </pre>
<pre id='line1832' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1833")'> 1833: </pre>
<pre id='line1833' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1834")'> 1834: cdef struct Ring_target_component:</pre>
<pre id='line1834' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1834
 * 
 * 
 * cdef struct Ring_target_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom_id
 *       int atom_type_id
 */
struct __pyx_t_17shift_calculators_Ring_target_component {
  int target_atom_id;
  int atom_type_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1835")'> 1835:       int target_atom_id</pre>
<pre id='line1835' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1836")'> 1836:       int atom_type_id</pre>
<pre id='line1836' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1837")'> 1837: </pre>
<pre id='line1837' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1838")'> 1838: cdef struct Ring_component:</pre>
<pre id='line1838' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1838
 *       int atom_type_id
 * 
 * cdef struct Ring_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int ring_id
 *     int num_atoms
 */
struct __pyx_t_17shift_calculators_Ring_component {
  int ring_id;
  int num_atoms;
  int atom_ids[6];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1839")'> 1839:     int ring_id</pre>
<pre id='line1839' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1840")'> 1840:     int num_atoms</pre>
<pre id='line1840' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1841")'> 1841:     int[6] atom_ids</pre>
<pre id='line1841' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1842")'> 1842: </pre>
<pre id='line1842' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1843")'> 1843: #cdef int RING_ATOM_IDS = 1</pre>
<pre id='line1843' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1844")'> 1844: cdef class Fast_ring_force_calculator(Base_force_calculator):</pre>
<pre id='line1844' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1844
 * 
 * #cdef int RING_ATOM_IDS = 1
 * cdef class Fast_ring_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  struct __pyx_obj_17shift_calculators_Vec3_list *_centre_cache;
  struct __pyx_obj_17shift_calculators_Vec3_list *_normal_cache;
  struct __pyx_t_17shift_calculators_Ring_target_component *_compiled_components;
  int _num_components;
  struct __pyx_t_17shift_calculators_Ring_component *_compiled_ring_components;
  int _num_ring_components;
  struct __pyx_obj_17shift_calculators_Coef_components *_compiled_coef_components;
};


/* "Cython_shift_calculator.pyx":1844
 * 
 * #cdef int RING_ATOM_IDS = 1
 * cdef class Fast_ring_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  PyObject *(*_free_compiled_components)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *);
  Vec3 *(*_get_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
  Vec3 *(*_get_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
  void (*_ring_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
  void (*_calculate_single_ring_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, struct __pyx_t_17shift_calculators_Coef_component *, float, struct __pyx_obj_17shift_calculators_Out_array *);
  void (*_build_cython_force_terms)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &);
  void (*_cython_calc_target_atom_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &, struct __pyx_obj_17shift_calculators_Out_array *);
  void (*_cython_calculate_ring_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_force_calculator;
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &, struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1845")'> 1845: </pre>
<pre id='line1845' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1846")'> 1846: </pre>
<pre id='line1846' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1847")'> 1847:     cdef Vec3_list _centre_cache</pre>
<pre id='line1847' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1848")'> 1848:     cdef Vec3_list _normal_cache</pre>
<pre id='line1848' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1849")'> 1849: </pre>
<pre id='line1849' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1850")'> 1850:     cdef Ring_target_component* _compiled_components</pre>
<pre id='line1850' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1851")'> 1851:     cdef int _num_components</pre>
<pre id='line1851' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1852")'> 1852: </pre>
<pre id='line1852' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1853")'> 1853:     cdef Ring_component* _compiled_ring_components</pre>
<pre id='line1853' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1854")'> 1854:     cdef int _num_ring_components</pre>
<pre id='line1854' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1855")'> 1855: </pre>
<pre id='line1855' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1856")'> 1856:     cdef Coef_components _compiled_coef_components</pre>
<pre id='line1856' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1857")'> 1857: </pre>
<pre id='line1857' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1858")'> 1858: </pre>
<pre id='line1858' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1859")'> 1859:     def __cinit__(self):</pre>
<pre id='line1859' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1859
 * 
 * 
 *     def __cinit__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._num_components = 0
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_force_calculator___cinit__(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1860")'> 1860:         self._compiled_components = NULL</pre>
<pre id='line1860' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1860
 * 
 *     def __cinit__(self):
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1861")'> 1861:         self._num_components = 0</pre>
<pre id='line1861' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1861
 *     def __cinit__(self):
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_ring_components = NULL
 */
  __pyx_v_self->_num_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1862")'> 1862: </pre>
<pre id='line1862' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1863")'> 1863:         self._compiled_ring_components = NULL</pre>
<pre id='line1863' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1863
 *         self._num_components = 0
 * 
 *         self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = 0
 * 
 */
  __pyx_v_self->_compiled_ring_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1864")'> 1864:         self._num_ring_components = 0</pre>
<pre id='line1864' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1864
 * 
 *         self._compiled_ring_components = NULL
 *         self._num_ring_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 */
  __pyx_v_self->_num_ring_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1865")'> 1865: </pre>
<pre id='line1865' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1866")'> 1866:         #note this is not a raw array of structs it's a compiled python class</pre>
<pre id='line1866' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1867")'> 1867:         self._compiled_coef_components = None</pre>
<pre id='line1867' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1867
 * 
 *         #note this is not a raw array of structs it's a compiled python class
 *         self._compiled_coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._centre_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)Py_None);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1868")'> 1868: </pre>
<pre id='line1868' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1869")'> 1869:         self._centre_cache = None</pre>
<pre id='line1869' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1869
 *         self._compiled_coef_components = None
 * 
 *         self._centre_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = None
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line1870")'> 1870:         self._normal_cache = None</pre>
<pre id='line1870' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":1870
 * 
 *         self._centre_cache = None
 *         self._normal_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self,name="not set"):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)Py_None);

  __pyx_r = 0;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_16);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_2__init__(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1871")'> 1871: </pre>
<pre id='line1871' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1872")'> 1872:     def __init__(self,name="not set"):</pre>
<pre id='line1872' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1872
 *         self._normal_cache = None
 * 
 *     def __init__(self,name="not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_ring_force_calculator, self).__init__(name=name)
 * 
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_2__init__(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line1873")'> 1873:         super(Fast_ring_force_calculator, self).__init__(name=name)</pre>
<pre id='line1873' class='code' style='background-color: #FFFF2d'>
  /* "Cython_shift_calculator.pyx":1873
 * 
 *     def __init__(self,name="not set"):
 *         super(Fast_ring_force_calculator, self).__init__(name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_5_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_4_set_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1874")'> 1874: </pre>
<pre id='line1874' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1875")'> 1875: </pre>
<pre id='line1875' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1876")'> 1876: </pre>
<pre id='line1876' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1877")'> 1877:     def _set_components(self,components):</pre>
<pre id='line1877' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1877
 * 
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_4_set_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1878")'> 1878:         if  self._compiled_components ==  NULL:</pre>
<pre id='line1878' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1878
 * 
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1879")'> 1879:             self._compile_components(components)</pre>
<pre id='line1879' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":1879
 *     def _set_components(self,components):
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_components(self,components):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___compile_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_7_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_7_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_6_compile_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1880")'> 1880: </pre>
<pre id='line1880' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1881")'> 1881:     def _compile_components(self,components):</pre>
<pre id='line1881' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1881
 *             self._compile_components(components)
 * 
 *     def _compile_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_6_compile_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1882")'> 1882:         self._compiled_components = &lt;Ring_target_component*&gt;malloc(len(components) * sizeof(Ring_target_component))</pre>
<pre id='line1882' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1882
 * 
 *     def _compile_components(self,components):
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Ring_target_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Ring_target_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1883")'> 1883:         self._num_components = len(components)</pre>
<pre id='line1883' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1883
 *     def _compile_components(self,components):
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1883; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1884")'> 1884:         for i,component in enumerate(components):</pre>
<pre id='line1884' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1884
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom_id = components[i][0]
 *             self._compiled_components[i].atom_type_id = components[i][1]
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1885")'> 1885:             self._compiled_components[i].target_atom_id = components[i][0]</pre>
<pre id='line1885' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":1885
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].atom_type_id = components[i][1]
 * 
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).target_atom_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line1886")'> 1886:             self._compiled_components[i].atom_type_id = components[i][1]</pre>
<pre id='line1886' class='code' style='background-color: #FFFF31'>
    /* "Cython_shift_calculator.pyx":1886
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]
 *             self._compiled_components[i].atom_type_id = components[i][1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).atom_type_id = __pyx_t_7;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_9_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_9_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_8_set_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_coef_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1887")'> 1887: </pre>
<pre id='line1887' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1888")'> 1888: </pre>
<pre id='line1888' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1889")'> 1889:     def _set_coef_components(self,coef_components):</pre>
<pre id='line1889' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1889
 * 
 * 
 *     def _set_coef_components(self,coef_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coef_components = Coef_components(coef_components)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_8_set_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line1890")'> 1890:         self._compiled_coef_components = Coef_components(coef_components)</pre>
<pre id='line1890' class='code' style='background-color: #FFFF52'>
  /* "Cython_shift_calculator.pyx":1890
 * 
 *     def _set_coef_components(self,coef_components):
 *         self._compiled_coef_components = Coef_components(coef_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_ring_components(self,ring_components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1890; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Coef_components)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1890; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_t_2);
  __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._set_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_11_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_11_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_10_set_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1891")'> 1891: </pre>
<pre id='line1891' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1892")'> 1892:     def _set_ring_components(self,ring_components):</pre>
<pre id='line1892' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1892
 *         self._compiled_coef_components = Coef_components(coef_components)
 * 
 *     def _set_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_ring_components ==  NULL:
 *             self._compile_ring_components(ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_10_set_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1893")'> 1893:         if  self._compiled_ring_components ==  NULL:</pre>
<pre id='line1893' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1893
 * 
 *     def _set_ring_components(self,ring_components):
 *         if  self._compiled_ring_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_ring_components(ring_components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1894")'> 1894:             self._compile_ring_components(ring_components)</pre>
<pre id='line1894' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":1894
 *     def _set_ring_components(self,ring_components):
 *         if  self._compiled_ring_components ==  NULL:
 *             self._compile_ring_components(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_ring_components(self,ring_components):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_28);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ring_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_ring_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_ring_components);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._set_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_13_compile_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_13_compile_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_12_compile_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1895")'> 1895: </pre>
<pre id='line1895' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1896")'> 1896:     def _compile_ring_components(self,ring_components):</pre>
<pre id='line1896' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1896
 *             self._compile_ring_components(ring_components)
 * 
 *     def _compile_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_12_compile_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_ring_component = NULL;
  PyObject *__pyx_v_j = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1897")'> 1897:         self._compiled_ring_components = &lt;Ring_component*&gt;malloc(len(ring_components) * sizeof(Ring_component))</pre>
<pre id='line1897' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1897
 * 
 *     def _compile_ring_components(self,ring_components):
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1897; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_ring_components = ((struct __pyx_t_17shift_calculators_Ring_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Ring_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1898")'> 1898:         self._num_ring_components = len(ring_components)</pre>
<pre id='line1898' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1898
 *     def _compile_ring_components(self,ring_components):
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_ring_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1899")'> 1899:         for i,ring_component in enumerate(ring_components):</pre>
<pre id='line1899' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1899
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_ring_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_ring_components)) {
    __pyx_t_3 = __pyx_v_ring_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
    __pyx_v_ring_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1900")'> 1900:             self._compiled_ring_components[i].ring_id  = ring_components[i][0]</pre>
<pre id='line1900' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":1900
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_ring_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_ring_components[__pyx_t_8]).ring_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line1901")'> 1901:             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])</pre>
<pre id='line1901' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":1901
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(len(ring_component[1])):
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_9 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_ring_components[__pyx_t_9]).num_atoms = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF1d' onclick='toggleDiv("line1902")'> 1902:             for j in range(len(ring_component[1])):</pre>
<pre id='line1902' class='code' style='background-color: #FFFF1d'>
    /* "Cython_shift_calculator.pyx":1902
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 * 
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_6) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_6)) {
      __pyx_t_5 = __pyx_t_6; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    for (;;) {
      if (!__pyx_t_10 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) {
        if (__pyx_t_9 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_9++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_10 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
        if (__pyx_t_9 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_9++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_6 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_6)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
      __pyx_v_j = __pyx_t_6;
      __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line1903")'> 1903:                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]</pre>
<pre id='line1903' class='code' style='background-color: #FFFF27'>
      /* "Cython_shift_calculator.pyx":1903
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_compiled_ring_components(self):
 */
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_11 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, __pyx_v_j);<span class='error_goto'> if (!__pyx_t_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_j);<span class='error_goto'> if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1903; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((__pyx_v_self->_compiled_ring_components[__pyx_t_8]).atom_ids[__pyx_t_12]) = __pyx_t_7;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._compile_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_15_free_compiled_ring_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_15_free_compiled_ring_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_14_free_compiled_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1904")'> 1904: </pre>
<pre id='line1904' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1905")'> 1905:     def _free_compiled_ring_components(self):</pre>
<pre id='line1905' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1905
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 * 
 *     def _free_compiled_ring_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_14_free_compiled_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_ring_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1906")'> 1906:         if self._compiled_ring_components != NULL:</pre>
<pre id='line1906' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1906
 * 
 *     def _free_compiled_ring_components(self):
 *         if self._compiled_ring_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free(self._compiled_ring_components)
 *             self._compiled_ring_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1907")'> 1907:             free(self._compiled_ring_components)</pre>
<pre id='line1907' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1907
 *     def _free_compiled_ring_components(self):
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_ring_components);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1908")'> 1908:             self._compiled_ring_components = NULL</pre>
<pre id='line1908' class='code' style='background-color: #FFFFc4'>
    /* "Cython_shift_calculator.pyx":1908
 *         if self._compiled_ring_components != NULL:
 *             free(self._compiled_ring_components)
 *             self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _free_coef_components(self):
 */
    __pyx_v_self->_compiled_ring_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_17_free_coef_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_17_free_coef_components(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_coef_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_16_free_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1909")'> 1909: </pre>
<pre id='line1909' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1910")'> 1910:     def _free_coef_components(self):</pre>
<pre id='line1910' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1910
 *             self._compiled_ring_components = NULL
 * 
 *     def _free_coef_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_coef_components = None
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_16_free_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1911")'> 1911:         self._compiled_coef_components = None</pre>
<pre id='line1911' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":1911
 * 
 *     def _free_coef_components(self):
 *         self._compiled_coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _free_compiled_components(self):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_compiled_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_compiled_coef_components));
  __pyx_v_self->_compiled_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)Py_None);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1912")'> 1912: </pre>
<pre id='line1912' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1913")'> 1913:     cdef _free_compiled_components(self):</pre>
<pre id='line1913' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1913
 *         self._compiled_coef_components = None
 * 
 *     cdef _free_compiled_components(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)
 */

static PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__free_compiled_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_free_compiled_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1914")'> 1914:         if self._compiled_components != NULL:</pre>
<pre id='line1914' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1914
 * 
 *     cdef _free_compiled_components(self):
 *         if self._compiled_components != NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             free (self._compiled_components)
 *             self._compiled_components = NULL
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components != NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1915")'> 1915:             free (self._compiled_components)</pre>
<pre id='line1915' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1915
 *     cdef _free_compiled_components(self):
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components = NULL
 * 
 */
    free(__pyx_v_self->_compiled_components);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1916")'> 1916:             self._compiled_components = NULL</pre>
<pre id='line1916' class='code' style='background-color: #FFFF39'>
    /* "Cython_shift_calculator.pyx":1916
 *         if self._compiled_components != NULL:
 *             free (self._compiled_components)
 *             self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _prepare(self, change, data):
 */
    __pyx_v_self->_compiled_components = NULL;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_19_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_19_prepare(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_change = 0;
  CYTHON_UNUSED PyObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__change,&__pyx_n_s__data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__change)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1918; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_prepare") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1918; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_change = values[0];
    __pyx_v_data = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_prepare", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1918; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_18_prepare(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_change, __pyx_v_data);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1917")'> 1917: </pre>
<pre id='line1917' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1918")'> 1918:     def _prepare(self, change, data):</pre>
<pre id='line1918' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1918
 *             self._compiled_components = NULL
 * 
 *     def _prepare(self, change, data):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *             self._free_compiled_components()
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_18_prepare(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_change, CYTHON_UNUSED PyObject *__pyx_v_data) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_prepare", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1919")'> 1919:         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:</pre>
<pre id='line1919' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":1919
 * 
 *     def _prepare(self, change, data):
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._free_compiled_components()
 *             self._free_compiled_ring_components()
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_1, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_3) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__STRUCTURE_CHANGED);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_change, __pyx_t_2, Py_EQ); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_4 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1920")'> 1920:             self._free_compiled_components()</pre>
<pre id='line1920' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1920
 *     def _prepare(self, change, data):
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *             self._free_compiled_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._free_compiled_ring_components()
 *             self._free_coef_components()
 */
    __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_free_compiled_components(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1921")'> 1921:             self._free_compiled_ring_components()</pre>
<pre id='line1921' class='code' style='background-color: #FFFF73'>
    /* "Cython_shift_calculator.pyx":1921
 *         if change == TARGET_ATOM_IDS_CHANGED or change == STRUCTURE_CHANGED:
 *             self._free_compiled_components()
 *             self._free_compiled_ring_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._free_coef_components()
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_26);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1922")'> 1922:             self._free_coef_components()</pre>
<pre id='line1922' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1922
 *             self._free_compiled_components()
 *             self._free_compiled_ring_components()
 *             self._free_coef_components()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_normal_cache(self,normals):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_27);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1922; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1922; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._prepare", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_21_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_21_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_20_set_normal_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_normals));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1923")'> 1923: </pre>
<pre id='line1923' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1924")'> 1924:     def _set_normal_cache(self,normals):</pre>
<pre id='line1924' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1924
 *             self._free_coef_components()
 * 
 *     def _set_normal_cache(self,normals):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_20_set_normal_cache(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache", 0);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1925")'> 1925:         self._normal_cache = &lt;Vec3_list&gt; normals</pre>
<pre id='line1925' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1925
 * 
 *     def _set_normal_cache(self,normals):
 *         self._normal_cache = <code><</code>Vec3_list> normals             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_centre_cache(self,centres):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_normal_cache));
  __pyx_v_self->_normal_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_normals);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_23_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_23_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_22_set_centre_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_centres));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1926")'> 1926: </pre>
<pre id='line1926' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1927")'> 1927:     def _set_centre_cache(self,centres):</pre>
<pre id='line1927' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1927
 *         self._normal_cache = <code><</code>Vec3_list> normals
 * 
 *     def _set_centre_cache(self,centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = <code><</code>Vec3_list> centres
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_22_set_centre_cache(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache", 0);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line1928")'> 1928:         self._centre_cache = &lt;Vec3_list&gt; centres</pre>
<pre id='line1928' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":1928
 * 
 *     def _set_centre_cache(self,centres):
 *         self._centre_cache = <code><</code>Vec3_list> centres             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_centre_cache));
  __pyx_v_self->_centre_cache = ((struct __pyx_obj_17shift_calculators_Vec3_list *)__pyx_v_centres);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1929")'> 1929: </pre>
<pre id='line1929' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1930")'> 1930: </pre>
<pre id='line1930' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1931")'> 1931:     @cython.profile(False)</pre>
<pre id='line1931' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1932")'> 1932:     cdef inline Vec3* _get_ring_normal(self, int ring_id):</pre>
<pre id='line1932' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1932
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._normal_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_normal", 0);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1933")'> 1933:         return  self._normal_cache.get(ring_id)</pre>
<pre id='line1933' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1933
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_normal(self, int ring_id):
 *         return  self._normal_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_normal_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1934")'> 1934: </pre>
<pre id='line1934' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1935")'> 1935:     @cython.profile(False)</pre>
<pre id='line1935' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1936")'> 1936:     cdef inline Vec3* _get_ring_centre(self, int ring_id):</pre>
<pre id='line1936' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1936
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  self._centre_cache.get(ring_id)
 * 
 */

static CYTHON_INLINE Vec3 *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  Vec3 *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_centre", 0);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1937")'> 1937:         return  self._centre_cache.get(ring_id)</pre>
<pre id='line1937' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1937
 *     @cython.profile(False)
 *     cdef inline Vec3* _get_ring_centre(self, int ring_id):
 *         return  self._centre_cache.get(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_f_17shift_calculators_9Vec3_list_get(__pyx_v_self->_centre_cache, __pyx_v_ring_id);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1938")'> 1938: </pre>
<pre id='line1938' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1939")'> 1939: </pre>
<pre id='line1939' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1940")'> 1940: #    @cython.profile(False)</pre>
<pre id='line1940' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1941")'> 1941: #    cdef inline target_type _get_target_and_type(self,int index):</pre>
<pre id='line1941' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1942")'> 1942: #        component = self._get_component(index)</pre>
<pre id='line1942' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1943")'> 1943: ##        TODO: this needs to contain better names a union?</pre>
<pre id='line1943' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1944")'> 1944: #        cdef target_type result</pre>
<pre id='line1944' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1945")'> 1945: #        result.target_atom_id = component[0]</pre>
<pre id='line1945' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1946")'> 1946: #        result.atom_type_id = component[1]</pre>
<pre id='line1946' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1947")'> 1947: #</pre>
<pre id='line1947' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1948")'> 1948: #        return result#</pre>
<pre id='line1948' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1949")'> 1949: </pre>
<pre id='line1949' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1950")'> 1950: </pre>
<pre id='line1950' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1951")'> 1951:     cdef inline void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):</pre>
<pre id='line1951' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1951
 * 
 * 
 *     cdef inline void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._num_components):
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 */

static void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, __Pyx_memviewslice __pyx_v_component_to_result, __Pyx_memviewslice __pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_i;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1952")'> 1952:         for i in range(self._num_components):</pre>
<pre id='line1952' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1952
 * 
 *     cdef inline void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         for i in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->_num_components;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1953")'> 1953:             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1953' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":1953
 *     cdef inline void _do_calc_components(self, int[:] component_to_result, float[:] force_factors, Out_array force):
 *         for i in range(self._num_components):
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):
 */
    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_result.data + __pyx_t_3 * __pyx_v_component_to_result.strides[0]) )));
    __pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(__pyx_v_self, __pyx_v_i, (*((float *) ( /* dim=0 */ (__pyx_v_force_factors.data + __pyx_t_4 * __pyx_v_force_factors.strides[0]) ))), __pyx_v_force);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1954")'> 1954: </pre>
<pre id='line1954' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1955")'> 1955:     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):</pre>
<pre id='line1955' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1955
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int atom_type_id  = self._compiled_components[index].atom_type_id
 *         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  int __pyx_v_atom_type_id;
  struct __pyx_t_17shift_calculators_Component_Offsets *__pyx_v_coeff_offset;
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component;
  int __pyx_v_coef_offset;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_ring_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1956")'> 1956:         cdef int atom_type_id  = self._compiled_components[index].atom_type_id</pre>
<pre id='line1956' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1956
 * 
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):
 *         cdef int atom_type_id  = self._compiled_components[index].atom_type_id             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)
 *         cdef Coef_component* coef_component
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_components[__pyx_v_index]).atom_type_id;
  __pyx_v_atom_type_id = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1957")'> 1957:         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)</pre>
<pre id='line1957' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1957
 *     cdef inline void _ring_calc_single_force_set(self,  int index, float force_factor, Out_array forces):
 *         cdef int atom_type_id  = self._compiled_components[index].atom_type_id
 *         cdef Component_Offsets* coeff_offset =  self._compiled_coef_components.get_id_offsets(atom_type_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Coef_component* coef_component
 * 
 */
  __pyx_v_coeff_offset = __pyx_f_17shift_calculators_15Coef_components_get_id_offsets(__pyx_v_self->_compiled_coef_components, __pyx_v_atom_type_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1958")'> 1958:         cdef Coef_component* coef_component</pre>
<pre id='line1958' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1959")'> 1959: </pre>
<pre id='line1959' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1960")'> 1960:         for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):</pre>
<pre id='line1960' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1960
 *         cdef Coef_component* coef_component
 * 
 *         for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #           TODO: remove magic numbers or add structs
 *             coef_component = self._compiled_coef_components.get_component(coef_offset)
 */
  __pyx_t_1 = ((__pyx_v_coeff_offset[0]).offset + (__pyx_v_coeff_offset[0]).length);
  for (__pyx_t_2 = (__pyx_v_coeff_offset[0]).offset; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_coef_offset = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1961")'> 1961: #           TODO: remove magic numbers or add structs</pre>
<pre id='line1961' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1962")'> 1962:             coef_component = self._compiled_coef_components.get_component(coef_offset)</pre>
<pre id='line1962' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1962
 *         for coef_offset in range(coeff_offset[0].offset,coeff_offset[0].offset+coeff_offset[0].length):
 * #           TODO: remove magic numbers or add structs
 *             coef_component = self._compiled_coef_components.get_component(coef_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)
 * 
 */
    __pyx_v_coef_component = __pyx_f_17shift_calculators_15Coef_components_get_component(__pyx_v_self->_compiled_coef_components, __pyx_v_coef_offset);
</pre><pre class='line' style='background-color: #FFFF18' onclick='toggleDiv("line1963")'> 1963:             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)</pre>
<pre id='line1963' class='code' style='background-color: #FFFF18'>
    /* "Cython_shift_calculator.pyx":1963
 * #           TODO: remove magic numbers or add structs
 *             coef_component = self._compiled_coef_components.get_component(coef_offset)
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):
 */
    ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calculate_single_ring_forces(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).target_atom_id, (__pyx_v_self->_compiled_components[__pyx_v_index]).atom_type_id, __pyx_v_coef_component, __pyx_v_force_factor, __pyx_v_forces);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_25_calculate_ring_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_25_calculate_ring_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_atom_type_id;
  int __pyx_v_ring_id;
  float __pyx_v_force_factor;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms = 0;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_ring_forces (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__atom_type_id,&__pyx_n_s__ring_id,&__pyx_n_s__force_factor,&__pyx_n_s__python_sub_terms,&__pyx_n_s__forces,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_type_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__python_sub_terms)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calculate_ring_forces") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_atom_type_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_atom_type_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_force_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_python_sub_terms = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)values[3]);
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[4]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calculate_ring_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_python_sub_terms), __pyx_ptype_17shift_calculators_Python_ring_force_sub_terms, 1, "python_sub_terms", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_24_calculate_ring_forces(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_atom_type_id, __pyx_v_ring_id, __pyx_v_force_factor, __pyx_v_python_sub_terms, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1964")'> 1964: </pre>
<pre id='line1964' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1965")'> 1965:     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):</pre>
<pre id='line1965' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1965
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_24_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_atom_type_id, int __pyx_v_ring_id, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_ring_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1966")'> 1966:         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()</pre>
<pre id='line1966' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1966
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 * 
 */
  __pyx_v_terms = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_python_sub_terms->__pyx_vtab)->get_terms(__pyx_v_python_sub_terms);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1967")'> 1967:         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)</pre>
<pre id='line1967' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1967
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms,Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef void _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor,Out_array forces):
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(__pyx_v_self, __pyx_v_atom_type_id, __pyx_v_ring_id, __pyx_v_force_factor, __pyx_v_terms, __pyx_v_forces);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1968")'> 1968: </pre>
<pre id='line1968' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1969")'> 1969:     cdef void _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor,Out_array forces):</pre>
<pre id='line1969' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1969
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 * 
 *     cdef void _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor,Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Ring_force_sub_terms force_terms
 */

static void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__calculate_single_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_atom_type_id, struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_force_terms;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_single_ring_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1970")'> 1970: </pre>
<pre id='line1970' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1971")'> 1971:         cdef Ring_force_sub_terms force_terms</pre>
<pre id='line1971' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1972")'> 1972:         self._build_cython_force_terms(target_atom_id, coef_component.ring_id, force_terms)</pre>
<pre id='line1972' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1972
 * 
 *         cdef Ring_force_sub_terms force_terms
 *         self._build_cython_force_terms(target_atom_id, coef_component.ring_id, force_terms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_coef_component->ring_id, __pyx_v_force_terms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1973")'> 1973: </pre>
<pre id='line1973' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1974")'> 1974:         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)</pre>
<pre id='line1974' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1974
 *         self._build_cython_force_terms(target_atom_id, coef_component.ring_id, force_terms)
 * 
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(__pyx_v_self, __pyx_v_target_atom_id, (__pyx_v_force_factor * __pyx_v_coef_component->coefficient), __pyx_v_force_terms, __pyx_v_forces);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1975")'> 1975: </pre>
<pre id='line1975' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1976")'> 1976: #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals</pre>
<pre id='line1976' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line1977")'> 1977:         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)</pre>
<pre id='line1977' class='code' style='background-color: #FFFF28'>
  /* "Cython_shift_calculator.pyx":1977
 * 
 * #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals
 *         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _build_force_terms(self, int target_atom_id, int ring_id):
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(__pyx_v_self, __pyx_v_atom_type_id, __pyx_v_coef_component->ring_id, (__pyx_v_force_factor * __pyx_v_coef_component->coefficient), __pyx_v_force_terms, __pyx_v_forces);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_27_build_force_terms(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_27_build_force_terms(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  int __pyx_v_ring_id;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_force_terms (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__ring_id,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_force_terms", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_build_force_terms") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_force_terms", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._build_force_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_26_build_force_terms(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_ring_id);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1978")'> 1978: </pre>
<pre id='line1978' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1979")'> 1979:     def _build_force_terms(self, int target_atom_id, int ring_id):</pre>
<pre id='line1979' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1979
 *         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)
 * 
 *     def _build_force_terms(self, int target_atom_id, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms terms
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_26_build_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_result = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_force_terms", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1980")'> 1980:         cdef Ring_force_sub_terms terms</pre>
<pre id='line1980' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1981")'> 1981:         self._build_cython_force_terms(target_atom_id, ring_id, terms)</pre>
<pre id='line1981' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1981
 *     def _build_force_terms(self, int target_atom_id, int ring_id):
 *         cdef Ring_force_sub_terms terms
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_terms);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1982")'> 1982:         result  = Python_ring_force_sub_terms()</pre>
<pre id='line1982' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1982
 *         cdef Ring_force_sub_terms terms
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)
 *         result  = Python_ring_force_sub_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.setup(terms)
 *         return result
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Python_ring_force_sub_terms)), ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1982; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1983")'> 1983:         result.setup(terms)</pre>
<pre id='line1983' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1983
 *         self._build_cython_force_terms(target_atom_id, ring_id, terms)
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_result->__pyx_vtab)->setup(__pyx_v_result, __pyx_v_terms);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1984")'> 1984:         return result</pre>
<pre id='line1984' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":1984
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms& result):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._build_force_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1985")'> 1985: </pre>
<pre id='line1985' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1986")'> 1986:     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms&amp; result):</pre>
<pre id='line1986' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1986
 *         return result
 * 
 *     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms& result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)
 * 
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_result) {
  Vec3 __pyx_v_target_atom_pos;
  Vec3 __pyx_v_ring_centre;
  Vec3 *__pyx_v_ring_normal;
  Vec3 __pyx_v_d;
  float __pyx_v_dL;
  float __pyx_v_dL2;
  float __pyx_v_dL4;
  float __pyx_v_dL3;
  float __pyx_v_dL6;
  float __pyx_v_nL;
  float __pyx_v_nL2;
  float __pyx_v_dLnL;
  float __pyx_v_dL3nL3;
  float __pyx_v_dn;
  float __pyx_v_dn2;
  float __pyx_v_u;
  float __pyx_v_gradUQ_factor;
  Vec3 __pyx_v_scaled_d;
  Vec3 __pyx_v_scaled_normal;
  Vec3 __pyx_v_gradUQ;
  float __pyx_v_gradVQ_factor;
  Vec3 __pyx_v_gradVQ;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_cython_force_terms", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1987")'> 1987:         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)</pre>
<pre id='line1987' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1987
 * 
 *     cdef inline void _build_cython_force_terms(self, int target_atom_id, int ring_id, Ring_force_sub_terms& result):
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]
 */
  __pyx_v_target_atom_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1988")'> 1988: </pre>
<pre id='line1988' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1989")'> 1989:         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]</pre>
<pre id='line1989' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1989
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3* ring_normal = self._get_ring_normal(ring_id)
 * 
 */
  __pyx_v_ring_centre = (__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_centre(__pyx_v_self, __pyx_v_ring_id)[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1990")'> 1990:         cdef Vec3* ring_normal = self._get_ring_normal(ring_id)</pre>
<pre id='line1990' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1990
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)[0]
 *         cdef Vec3* ring_normal = self._get_ring_normal(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # distance vector between atom of interest and ring center
 */
  __pyx_v_ring_normal = __pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_normal(__pyx_v_self, __pyx_v_ring_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1991")'> 1991: </pre>
<pre id='line1991' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1992")'> 1992:         # distance vector between atom of interest and ring center</pre>
<pre id='line1992' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1993")'> 1993:         cdef Vec3 d = target_atom_pos - ring_centre</pre>
<pre id='line1993' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1993
 * 
 *         # distance vector between atom of interest and ring center
 *         cdef Vec3 d = target_atom_pos - ring_centre             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL = norm(d)
 * 
 */
  __pyx_v_d = (__pyx_v_target_atom_pos - __pyx_v_ring_centre);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1994")'> 1994:         cdef float dL = norm(d)</pre>
<pre id='line1994' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1994
 *         # distance vector between atom of interest and ring center
 *         cdef Vec3 d = target_atom_pos - ring_centre
 *         cdef float dL = norm(d)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # squared distance of atom of interest from ring center
 */
  __pyx_v_dL = norm(__pyx_v_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1995")'> 1995: </pre>
<pre id='line1995' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1996")'> 1996:         # squared distance of atom of interest from ring center</pre>
<pre id='line1996' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1997")'> 1997:         cdef float dL2 = dot(d, d) #            if (dL2 &lt; 0.5) cout &lt;&lt; "CAMSHIFT WARNING: Distance between atom and center of ring alarmingly small at " &lt;&lt; sqrt(dL2) &lt;&lt; " Angstrom!" &lt;&lt; endl;</pre>
<pre id='line1997' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1997
 * 
 *         # squared distance of atom of interest from ring center
 *         cdef float dL2 = dot(d, d) #            if (dL2 <code><</code> 0.5) cout <code><</code><code><</code> "CAMSHIFT WARNING: Distance between atom and center of ring alarmingly small at " <code><</code><code><</code> sqrt(dL2) <code><</code><code><</code> " Angstrom!" <code><</code><code><</code> endl;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 */
  __pyx_v_dL2 = dot(__pyx_v_d, __pyx_v_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1998")'> 1998: </pre>
<pre id='line1998' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1999")'> 1999:         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates</pre>
<pre id='line1999' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2000")'> 2000:         cdef float dL4 = dL ** 4</pre>
<pre id='line2000' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2000
 * 
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 *         cdef float dL4 = dL ** 4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL3 = dL ** 3
 *         cdef float dL6 = dL3 ** 2
 */
  __pyx_v_dL4 = powf(__pyx_v_dL, 4.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2001")'> 2001:         cdef float dL3 = dL ** 3</pre>
<pre id='line2001' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2001
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 *         cdef float dL4 = dL ** 4
 *         cdef float dL3 = dL ** 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL6 = dL3 ** 2
 * 
 */
  __pyx_v_dL3 = powf(__pyx_v_dL, 3.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2002")'> 2002:         cdef float dL6 = dL3 ** 2</pre>
<pre id='line2002' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2002
 *         cdef float dL4 = dL ** 4
 *         cdef float dL3 = dL ** 3
 *         cdef float dL6 = dL3 ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float nL = norm(ring_normal[0])
 */
  __pyx_v_dL6 = powf(__pyx_v_dL3, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2003")'> 2003: </pre>
<pre id='line2003' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2004")'> 2004:         cdef float nL = norm(ring_normal[0])</pre>
<pre id='line2004' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2004
 *         cdef float dL6 = dL3 ** 2
 * 
 *         cdef float nL = norm(ring_normal[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL
 */
  __pyx_v_nL = norm((__pyx_v_ring_normal[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2005")'> 2005:         cdef float nL2 = nL ** 2</pre>
<pre id='line2005' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2005
 * 
 *         cdef float nL = norm(ring_normal[0])
 *         cdef float nL2 = nL ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dLnL = dL * nL
 *         cdef float dL3nL3 = dL3 * nL2 * nL
 */
  __pyx_v_nL2 = powf(__pyx_v_nL, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2006")'> 2006:         cdef float dLnL = dL * nL</pre>
<pre id='line2006' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2006
 *         cdef float nL = norm(ring_normal[0])
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL3nL3 = dL3 * nL2 * nL
 * 
 */
  __pyx_v_dLnL = (__pyx_v_dL * __pyx_v_nL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2007")'> 2007:         cdef float dL3nL3 = dL3 * nL2 * nL</pre>
<pre id='line2007' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2007
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL
 *         cdef float dL3nL3 = dL3 * nL2 * nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float dn = dot(d, ring_normal[0])
 */
  __pyx_v_dL3nL3 = ((__pyx_v_dL3 * __pyx_v_nL2) * __pyx_v_nL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2008")'> 2008: </pre>
<pre id='line2008' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2009")'> 2009:         cdef float dn = dot(d, ring_normal[0])</pre>
<pre id='line2009' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2009
 *         cdef float dL3nL3 = dL3 * nL2 * nL
 * 
 *         cdef float dn = dot(d, ring_normal[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dn2 = dn ** 2
 * 
 */
  __pyx_v_dn = dot(__pyx_v_d, (__pyx_v_ring_normal[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2010")'> 2010:         cdef float dn2 = dn ** 2</pre>
<pre id='line2010' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2010
 * 
 *         cdef float dn = dot(d, ring_normal[0])
 *         cdef float dn2 = dn ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)
 */
  __pyx_v_dn2 = powf(__pyx_v_dn, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2011")'> 2011: </pre>
<pre id='line2011' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2012")'> 2012:         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)</pre>
<pre id='line2012' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2012
 *         cdef float dn2 = dn ** 2
 * 
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)
 */
  __pyx_v_u = (1.0 - ((3.0 * __pyx_v_dn2) / (__pyx_v_dL2 * __pyx_v_nL2)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2013")'> 2013: </pre>
<pre id='line2013' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2014")'> 2014:         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)</pre>
<pre id='line2014' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2014
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)
 * 
 *         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #TODO: remove temporarys and operator_mu;t#
 */
  __pyx_v_gradUQ_factor = ((-6.0 * __pyx_v_dn) / (__pyx_v_dL4 * __pyx_v_nL2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2015")'> 2015: </pre>
<pre id='line2015' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2016")'> 2016:         #TODO: remove temporarys and operator_mu;t#</pre>
<pre id='line2016' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2017")'> 2017:         cdef Vec3 scaled_d =  d</pre>
<pre id='line2017' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2017
 * 
 *         #TODO: remove temporarys and operator_mu;t#
 *         cdef Vec3 scaled_d =  d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal[0]
 */
  __pyx_v_scaled_d = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2018")'> 2018:         operator_times(scaled_d,dn)</pre>
<pre id='line2018' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2018
 *         #TODO: remove temporarys and operator_mu;t#
 *         cdef Vec3 scaled_d =  d
 *         operator_times(scaled_d,dn)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 scaled_normal = ring_normal[0]
 *         operator_times(scaled_normal,dL2)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_scaled_d, __pyx_v_dn);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2019")'> 2019:         cdef Vec3 scaled_normal = ring_normal[0]</pre>
<pre id='line2019' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2019
 *         cdef Vec3 scaled_d =  d
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(scaled_normal,dL2)
 * 
 */
  __pyx_v_scaled_normal = (__pyx_v_ring_normal[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2020")'> 2020:         operator_times(scaled_normal,dL2)</pre>
<pre id='line2020' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2020
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal[0]
 *         operator_times(scaled_normal,dL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_scaled_normal, __pyx_v_dL2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2021")'> 2021: </pre>
<pre id='line2021' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2022")'> 2022:         cdef Vec3 gradUQ = scaled_normal - scaled_d</pre>
<pre id='line2022' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2022
 *         operator_times(scaled_normal,dL2)
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(gradUQ,gradUQ_factor)
 * 
 */
  __pyx_v_gradUQ = (__pyx_v_scaled_normal - __pyx_v_scaled_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2023")'> 2023:         operator_times(gradUQ,gradUQ_factor)</pre>
<pre id='line2023' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2023
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d
 *         operator_times(gradUQ,gradUQ_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_gradUQ, __pyx_v_gradUQ_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2024")'> 2024: </pre>
<pre id='line2024' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2025")'> 2025: </pre>
<pre id='line2025' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2026")'> 2026:         cdef float gradVQ_factor = 3.0 * dL</pre>
<pre id='line2026' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2026
 * 
 * 
 *         cdef float gradVQ_factor = 3.0 * dL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 gradVQ = d
 *         operator_times(gradVQ,gradVQ_factor)
 */
  __pyx_v_gradVQ_factor = (3.0 * __pyx_v_dL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2027")'> 2027:         cdef Vec3 gradVQ = d</pre>
<pre id='line2027' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2027
 * 
 *         cdef float gradVQ_factor = 3.0 * dL
 *         cdef Vec3 gradVQ = d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(gradVQ,gradVQ_factor)
 * 
 */
  __pyx_v_gradVQ = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2028")'> 2028:         operator_times(gradVQ,gradVQ_factor)</pre>
<pre id='line2028' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2028
 *         cdef float gradVQ_factor = 3.0 * dL
 *         cdef Vec3 gradVQ = d
 *         operator_times(gradVQ,gradVQ_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.dL3nL3 = dL3nL3
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_gradVQ, __pyx_v_gradVQ_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2029")'> 2029: </pre>
<pre id='line2029' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2030")'> 2030:         result.dL3nL3 = dL3nL3</pre>
<pre id='line2030' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2030
 *         operator_times(gradVQ,gradVQ_factor)
 * 
 *         result.dL3nL3 = dL3nL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dLnL =dLnL
 *         result.dn = dn
 */
  __pyx_v_result.dL3nL3 = __pyx_v_dL3nL3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2031")'> 2031:         result.dLnL =dLnL</pre>
<pre id='line2031' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2031
 * 
 *         result.dL3nL3 = dL3nL3
 *         result.dLnL =dLnL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dn = dn
 *         result.dL = dL
 */
  __pyx_v_result.dLnL = __pyx_v_dLnL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2032")'> 2032:         result.dn = dn</pre>
<pre id='line2032' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2032
 *         result.dL3nL3 = dL3nL3
 *         result.dLnL =dLnL
 *         result.dn = dn             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL = dL
 *         result.nL = nL
 */
  __pyx_v_result.dn = __pyx_v_dn;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2033")'> 2033:         result.dL = dL</pre>
<pre id='line2033' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2033
 *         result.dLnL =dLnL
 *         result.dn = dn
 *         result.dL = dL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.nL = nL
 *         result.d = d
 */
  __pyx_v_result.dL = __pyx_v_dL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2034")'> 2034:         result.nL = nL</pre>
<pre id='line2034' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2034
 *         result.dn = dn
 *         result.dL = dL
 *         result.nL = nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.d = d
 *         result.gradUQ = gradUQ
 */
  __pyx_v_result.nL = __pyx_v_nL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2035")'> 2035:         result.d = d</pre>
<pre id='line2035' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2035
 *         result.dL = dL
 *         result.nL = nL
 *         result.d = d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3
 */
  __pyx_v_result.d = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2036")'> 2036:         result.gradUQ = gradUQ</pre>
<pre id='line2036' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2036
 *         result.nL = nL
 *         result.d = d
 *         result.gradUQ = gradUQ             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL3 =dL3
 *         result.u  = u
 */
  __pyx_v_result.gradUQ = __pyx_v_gradUQ;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2037")'> 2037:         result.dL3 =dL3</pre>
<pre id='line2037' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2037
 *         result.d = d
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.u  = u
 *         result.gradVQ = gradVQ
 */
  __pyx_v_result.dL3 = __pyx_v_dL3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2038")'> 2038:         result.u  = u</pre>
<pre id='line2038' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2038
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3
 *         result.u  = u             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6
 */
  __pyx_v_result.u = __pyx_v_u;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2039")'> 2039:         result.gradVQ = gradVQ</pre>
<pre id='line2039' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2039
 *         result.dL3 =dL3
 *         result.u  = u
 *         result.gradVQ = gradVQ             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL6 = dL6
 *         result.ring_normal =  ring_normal[0]
 */
  __pyx_v_result.gradVQ = __pyx_v_gradVQ;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2040")'> 2040:         result.dL6 = dL6</pre>
<pre id='line2040' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2040
 *         result.u  = u
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.ring_normal =  ring_normal[0]
 * 
 */
  __pyx_v_result.dL6 = __pyx_v_dL6;
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line2041")'> 2041:         result.ring_normal =  ring_normal[0]</pre>
<pre id='line2041' class='code' style='background-color: #FFFF1e'>
  /* "Cython_shift_calculator.pyx":2041
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6
 *         result.ring_normal =  ring_normal[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        return  dL3, u, dL6, ring_normal,  atom_type_id, coefficient, d, factor, dn, dL3nL3, dL, nL, dLnL
 */
  __pyx_v_result.ring_normal = (__pyx_v_ring_normal[0]);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_29_calc_target_atom_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_29_calc_target_atom_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  float __pyx_v_force_factor;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms = 0;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_target_atom_forces (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__force_factor,&__pyx_n_s__python_sub_terms,&__pyx_n_s__forces,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__python_sub_terms)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_target_atom_forces") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_force_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_python_sub_terms = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)values[2]);
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calc_target_atom_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_python_sub_terms), __pyx_ptype_17shift_calculators_Python_ring_force_sub_terms, 1, "python_sub_terms", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2046; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_28_calc_target_atom_forces(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_force_factor, __pyx_v_python_sub_terms, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2042")'> 2042: </pre>
<pre id='line2042' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2043")'> 2043: #        return  dL3, u, dL6, ring_normal,  atom_type_id, coefficient, d, factor, dn, dL3nL3, dL, nL, dLnL</pre>
<pre id='line2043' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2044")'> 2044: ##    ---</pre>
<pre id='line2044' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2045")'> 2045: #</pre>
<pre id='line2045' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2046")'> 2046:     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):</pre>
<pre id='line2046' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2046
 * ##    ---
 * #
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_28_calc_target_atom_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_target_atom_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2047")'> 2047:         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()</pre>
<pre id='line2047' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2047
 * #
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 * 
 */
  __pyx_v_terms = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_python_sub_terms->__pyx_vtab)->get_terms(__pyx_v_python_sub_terms);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2048")'> 2048:         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)</pre>
<pre id='line2048' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":2048
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline void _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms& sub_terms, Out_array forces):
 */
  __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_force_factor, __pyx_v_terms, __pyx_v_forces);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2049")'> 2049: </pre>
<pre id='line2049' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2050")'> 2050:     cdef inline void _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms&amp; sub_terms, Out_array forces):</pre>
<pre id='line2050' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2050
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 * 
 *     cdef inline void _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms& sub_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef object target_force_triplet
 *         cdef int axis
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, float __pyx_v_force_factor, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  int __pyx_v_axis;
  float __pyx_v_term1;
  Vec3 __pyx_v_result;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_target_atom_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2051")'> 2051:         cdef object target_force_triplet</pre>
<pre id='line2051' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2052")'> 2052:         cdef int axis</pre>
<pre id='line2052' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2053")'> 2053: #        target_force_triplet = self._get_or_make_target_force_triplet(forces, target_atom_id)</pre>
<pre id='line2053' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2054")'> 2054: #</pre>
<pre id='line2054' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2055")'> 2055: #        # update forces on query atom</pre>
<pre id='line2055' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2056")'> 2056:         cdef float term1</pre>
<pre id='line2056' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2057")'> 2057:         cdef Vec3 result</pre>
<pre id='line2057' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2058")'> 2058:         for axis in range(3):</pre>
<pre id='line2058' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2058
 *         cdef float term1
 *         cdef Vec3 result
 *         for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_axis = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2059")'> 2059:             #TODO: report this as a bug it produces an un initialized reference</pre>
<pre id='line2059' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2060")'> 2060:             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])</pre>
<pre id='line2060' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2060
 *         for axis in range(3):
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[axis] = -force_factor * term1 / sub_terms.dL6
 * 
 */
    __pyx_v_term1 = (((__pyx_v_sub_terms.gradUQ[__pyx_v_axis]) * __pyx_v_sub_terms.dL3) - (__pyx_v_sub_terms.u * (__pyx_v_sub_terms.gradVQ[__pyx_v_axis])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2061")'> 2061:             result[axis] = -force_factor * term1 / sub_terms.dL6</pre>
<pre id='line2061' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2061
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])
 *             result[axis] = -force_factor * term1 / sub_terms.dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         forces.add(target_atom_id, result)
 */
    (__pyx_v_result[__pyx_v_axis]) = (((-__pyx_v_force_factor) * __pyx_v_term1) / __pyx_v_sub_terms.dL6);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2062")'> 2062: </pre>
<pre id='line2062' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line2063")'> 2063:         forces.add(target_atom_id, result)</pre>
<pre id='line2063' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":2063
 *             result[axis] = -force_factor * term1 / sub_terms.dL6
 * 
 *         forces.add(target_atom_id, result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #             *  / sub_terms.dL6
 * #
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_target_atom_id, __pyx_v_result);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2064")'> 2064: #             *  / sub_terms.dL6</pre>
<pre id='line2064' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2065")'> 2065: #</pre>
<pre id='line2065' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2066")'> 2066: #    #TODO: calculation of GradU and gradV are not consistent with force_terms for target atom correct</pre>
<pre id='line2066' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2067")'> 2067: #    #TODO: reduce number of parameters to method</pre>
<pre id='line2067' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2068")'> 2068: </pre>
<pre id='line2068' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2069")'> 2069:     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):</pre>
<pre id='line2069' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2069
 * #    #TODO: reduce number of parameters to method
 * 
 *     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, CYTHON_UNUSED int __pyx_v_atom_type_id, int __pyx_v_ring_id, float __pyx_v_force_factor, struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_force_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_temp_normal;
  Vec3 __pyx_v_nSum;
  int __pyx_v_num_ring_atoms;
  int __pyx_v_limit;
  Vec3 __pyx_v_g;
  int __pyx_v_ring_atom_id;
  int __pyx_v_ring_atom_index;
  int __pyx_v_index_1;
  int __pyx_v_index_2;
  float __pyx_v_pos_1;
  float __pyx_v_pos_2;
  float __pyx_v_pos_3;
  float __pyx_v_pos_4;
  int __pyx_v_offset;
  int __pyx_v_indices_1[3];
  int __pyx_v_indices_2[3];
  float __pyx_v_ab[3];
  float __pyx_v_c[3];
  float __pyx_v_factor;
  float __pyx_v_factor2;
  float __pyx_v_one_over_num_ring_atoms;
  float __pyx_v_factor3;
  Vec3 __pyx_v_gradU;
  Vec3 __pyx_v_gradV;
  Vec3 __pyx_v_result;
  int __pyx_v_axis;
  float __pyx_v_sub_term;
  float __pyx_v_sub_force;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calculate_ring_forces", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2070")'> 2070:         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)</pre>
<pre id='line2070' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2070
 * 
 *     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 nSum = temp_normal
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 */
  __pyx_v_temp_normal = Vec3(__pyx_v_force_terms.ring_normal);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2071")'> 2071:         cdef Vec3 nSum = temp_normal</pre>
<pre id='line2071' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2071
 *     cdef inline void _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 */
  __pyx_v_nSum = __pyx_v_temp_normal;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2072")'> 2072:         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]</pre>
<pre id='line2072' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2072
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_nSum, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2073")'> 2073:     #// 2 for a 5-membered ring, 3 for a 6-membered ring</pre>
<pre id='line2073' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2074")'> 2074:         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms</pre>
<pre id='line2074' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2074
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int limit = num_ring_atoms - 3
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).num_atoms;
  __pyx_v_num_ring_atoms = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2075")'> 2075:         cdef int limit = num_ring_atoms - 3</pre>
<pre id='line2075' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2075
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms
 *         cdef int limit = num_ring_atoms - 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        for atom_type_id, ring_id, coefficient in coef_components:
 */
  __pyx_v_limit = (__pyx_v_num_ring_atoms - 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2076")'> 2076: </pre>
<pre id='line2076' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2077")'> 2077: #        for atom_type_id, ring_id, coefficient in coef_components:</pre>
<pre id='line2077' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2078")'> 2078:         cdef Vec3 g = Vec3()</pre>
<pre id='line2078' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2078
 * 
 * #        for atom_type_id, ring_id, coefficient in coef_components:
 *         cdef Vec3 g = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int ring_atom_id
 *         cdef int ring_atom_index
 */
  __pyx_v_g = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2079")'> 2079:         cdef int ring_atom_id</pre>
<pre id='line2079' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2080")'> 2080:         cdef int ring_atom_index</pre>
<pre id='line2080' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2081")'> 2081:         cdef int index_1</pre>
<pre id='line2081' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2082")'> 2082:         cdef int index_2</pre>
<pre id='line2082' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2083")'> 2083:         cdef float pos_1</pre>
<pre id='line2083' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2084")'> 2084:         cdef float pos_2</pre>
<pre id='line2084' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2085")'> 2085:         cdef float pos_3</pre>
<pre id='line2085' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2086")'> 2086:         cdef float pos_4</pre>
<pre id='line2086' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2087")'> 2087:         cdef int offset</pre>
<pre id='line2087' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2088")'> 2088: </pre>
<pre id='line2088' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2089")'> 2089:         cdef int[3] indices_1</pre>
<pre id='line2089' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2090")'> 2090:         cdef int[3] indices_2</pre>
<pre id='line2090' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2091")'> 2091: </pre>
<pre id='line2091' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2092")'> 2092:         cdef float[3] ab</pre>
<pre id='line2092' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2093")'> 2093:         cdef float[3] c</pre>
<pre id='line2093' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2094")'> 2094: </pre>
<pre id='line2094' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2095")'> 2095:         cdef float factor</pre>
<pre id='line2095' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2096")'> 2096:         cdef float factor2</pre>
<pre id='line2096' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2097")'> 2097:         cdef float one_over_num_ring_atoms</pre>
<pre id='line2097' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2098")'> 2098:         cdef float factor3</pre>
<pre id='line2098' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2099")'> 2099: </pre>
<pre id='line2099' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2100")'> 2100:         cdef Vec3 gradU</pre>
<pre id='line2100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2101")'> 2101:         cdef Vec3 gradV</pre>
<pre id='line2101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2102")'> 2102:         cdef Vec3 result</pre>
<pre id='line2102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2103")'> 2103: </pre>
<pre id='line2103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2104")'> 2104:         cdef int axis</pre>
<pre id='line2104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2105")'> 2105:         cdef float sub_term</pre>
<pre id='line2105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2106")'> 2106:         cdef float sub_force</pre>
<pre id='line2106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2107")'> 2107: </pre>
<pre id='line2107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2108")'> 2108:         for ring_atom_index in range(num_ring_atoms):</pre>
<pre id='line2108' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2108
 *         cdef float sub_force
 * 
 *         for ring_atom_index in range(num_ring_atoms):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:
 */
  __pyx_t_1 = __pyx_v_num_ring_atoms;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_ring_atom_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2109")'> 2109:             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]</pre>
<pre id='line2109' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2109
 * 
 *         for ring_atom_index in range(num_ring_atoms):
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):
 */
    __pyx_v_ring_atom_id = ((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_ring_atom_index]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2110")'> 2110:             if ring_atom_index &lt; limit:</pre>
<pre id='line2110' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2110
 *         for ring_atom_index in range(num_ring_atoms):
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3
 */
    __pyx_t_3 = (__pyx_v_ring_atom_index <code><</code> __pyx_v_limit);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2111")'> 2111:                 for axis in range(3):</pre>
<pre id='line2111' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2111
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3
 */
      for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
        __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2112")'> 2112:                     index_1 = (ring_atom_index + 1) % 3</pre>
<pre id='line2112' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2112
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 */
        __pyx_v_index_1 = ((__pyx_v_ring_atom_index + 1) % 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2113")'> 2113:                     index_2 = (ring_atom_index + 2) % 3</pre>
<pre id='line2113' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2113
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 */
        __pyx_v_index_2 = ((__pyx_v_ring_atom_index + 2) % 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2114")'> 2114:                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]</pre>
<pre id='line2114' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2114
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)
 */
        __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2115")'> 2115:                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]</pre>
<pre id='line2115' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2115
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)
 * 
 */
        __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_2]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2116")'> 2116:                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)</pre>
<pre id='line2116' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2116
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             else:
 */
        (__pyx_v_g[__pyx_v_axis]) = (__pyx_v_pos_1 - __pyx_v_pos_2);
      }
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2117")'> 2117: </pre>
<pre id='line2117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2118")'> 2118:             else:</pre>
<pre id='line2118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2119")'> 2119:                 if  ring_atom_index &gt;= num_ring_atoms - limit:</pre>
<pre id='line2119' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2119
 * 
 *             else:
 *                 if  ring_atom_index >= num_ring_atoms - limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):
 */
      __pyx_t_3 = (__pyx_v_ring_atom_index >= (__pyx_v_num_ring_atoms - __pyx_v_limit));
      if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2120")'> 2120:                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring</pre>
<pre id='line2120' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2120
 *             else:
 *                 if  ring_atom_index >= num_ring_atoms - limit:
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 */
        __pyx_v_offset = (__pyx_v_num_ring_atoms - 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2121")'> 2121:                     for axis in range(3):</pre>
<pre id='line2121' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2121
 *                 if  ring_atom_index >= num_ring_atoms - limit:
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 */
        for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
          __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2122")'> 2122:                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset</pre>
<pre id='line2122' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2122
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 */
          __pyx_v_index_1 = ((((__pyx_v_ring_atom_index + 1) - __pyx_v_offset) % 3) + __pyx_v_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2123")'> 2123:                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset</pre>
<pre id='line2123' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2123
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 */
          __pyx_v_index_2 = ((((__pyx_v_ring_atom_index + 2) - __pyx_v_offset) % 3) + __pyx_v_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2124")'> 2124:                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]</pre>
<pre id='line2124' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2124
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                         g[axis] = pos_1 - pos_2
 */
          __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2125")'> 2125:                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]</pre>
<pre id='line2125' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2125
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         g[axis] = pos_1 - pos_2
 *                 else:
 */
          __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_2]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2126")'> 2126:                         g[axis] = pos_1 - pos_2</pre>
<pre id='line2126' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2126
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                         g[axis] = pos_1 - pos_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 * 
 */
          (__pyx_v_g[__pyx_v_axis]) = (__pyx_v_pos_1 - __pyx_v_pos_2);
        }
        goto __pyx_L8;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2127")'> 2127:                 else:</pre>
<pre id='line2127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2128")'> 2128: </pre>
<pre id='line2128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2129")'> 2129:                     for axis in range(3):</pre>
<pre id='line2129' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2129
 *                 else:
 * 
 *                     for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 */
        for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
          __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2130")'> 2130:                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]</pre>
<pre id='line2130' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2130
 * 
 *                     for axis in range(3):
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 */
          __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[0]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2131")'> 2131:                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]</pre>
<pre id='line2131' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2131
 *                     for axis in range(3):
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]
 */
          __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2132")'> 2132:                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]</pre>
<pre id='line2132' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2132
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4
 */
          __pyx_v_pos_3 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[3]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2133")'> 2133:                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]</pre>
<pre id='line2133' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2133
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4
 * 
 */
          __pyx_v_pos_4 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[4]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2134")'> 2134:                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4</pre>
<pre id='line2134' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":2134
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[4])[axis]
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # 0 1 2 2 1   (0+1) %3 (0+2) %3
 */
          (__pyx_v_g[__pyx_v_axis]) = (((__pyx_v_pos_1 - __pyx_v_pos_2) + __pyx_v_pos_3) - __pyx_v_pos_4);
        }
      }
      __pyx_L8:;
    }
    __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2135")'> 2135: </pre>
<pre id='line2135' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2136")'> 2136:             # 0 1 2 2 1   (0+1) %3 (0+2) %3</pre>
<pre id='line2136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2137")'> 2137:             # 1 2 0 0 2</pre>
<pre id='line2137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2138")'> 2138:             # 2 0 1 10</pre>
<pre id='line2138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2139")'> 2139:             #atom 2 (5-membered rings)</pre>
<pre id='line2139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2140")'> 2140:             for axis in range(3):</pre>
<pre id='line2140' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2140
 *             # 2 0 1 10
 *             #atom 2 (5-membered rings)
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 indices_1[axis] = (axis + 1) % 3
 *                 indices_2[axis] = (axis + 2) % 3
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2141")'> 2141:                 indices_1[axis] = (axis + 1) % 3</pre>
<pre id='line2141' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2141
 *             #atom 2 (5-membered rings)
 *             for axis in range(3):
 *                 indices_1[axis] = (axis + 1) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 indices_2[axis] = (axis + 2) % 3
 * 
 */
      (__pyx_v_indices_1[__pyx_v_axis]) = ((__pyx_v_axis + 1) % 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2142")'> 2142:                 indices_2[axis] = (axis + 2) % 3</pre>
<pre id='line2142' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2142
 *             for axis in range(3):
 *                 indices_1[axis] = (axis + 1) % 3
 *                 indices_2[axis] = (axis + 2) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for axis in range(3):
 */
      (__pyx_v_indices_2[__pyx_v_axis]) = ((__pyx_v_axis + 2) % 3);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2143")'> 2143: </pre>
<pre id='line2143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2144")'> 2144:             for axis in range(3):</pre>
<pre id='line2144' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2144
 *                 indices_2[axis] = (axis + 2) % 3
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2145")'> 2145:                 index_1 = indices_1[axis]</pre>
<pre id='line2145' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2145
 * 
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_2 = indices_2[axis]
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 */
      __pyx_v_index_1 = (__pyx_v_indices_1[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2146")'> 2146:                 index_2 = indices_2[axis]</pre>
<pre id='line2146' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2146
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 * 
 */
      __pyx_v_index_2 = (__pyx_v_indices_2[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2147")'> 2147:                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]</pre>
<pre id='line2147' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2147
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for axis in range(3):
 */
      (__pyx_v_ab[__pyx_v_axis]) = (((__pyx_v_force_terms.d[__pyx_v_index_1]) * (__pyx_v_g[__pyx_v_index_2])) - ((__pyx_v_force_terms.d[__pyx_v_index_2]) * (__pyx_v_g[__pyx_v_index_1])));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2148")'> 2148: </pre>
<pre id='line2148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2149")'> 2149:             for axis in range(3):</pre>
<pre id='line2149' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2149
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2150")'> 2150:                 index_1 = indices_1[axis]</pre>
<pre id='line2150' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2150
 * 
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_2 = indices_2[axis]
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 */
      __pyx_v_index_1 = (__pyx_v_indices_1[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2151")'> 2151:                 index_2 = indices_2[axis]</pre>
<pre id='line2151' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2151
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 * 
 */
      __pyx_v_index_2 = (__pyx_v_indices_2[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2152")'> 2152:                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]</pre>
<pre id='line2152' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2152
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 */
      (__pyx_v_c[__pyx_v_axis]) = (((__pyx_v_nSum[__pyx_v_index_1]) * (__pyx_v_g[__pyx_v_index_2])) - ((__pyx_v_nSum[__pyx_v_index_2]) * (__pyx_v_g[__pyx_v_index_1])));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2153")'> 2153: </pre>
<pre id='line2153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2154")'> 2154:             factor = -6.0 * force_terms.dn / force_terms.dL3nL3</pre>
<pre id='line2154' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2154
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 */
    __pyx_v_factor = ((-6.0 * __pyx_v_force_terms.dn) / __pyx_v_force_terms.dL3nL3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2155")'> 2155:             factor2 = 0.25 * force_terms.dL / force_terms.nL</pre>
<pre id='line2155' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2155
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 */
    __pyx_v_factor2 = ((0.25 * __pyx_v_force_terms.dL) / __pyx_v_force_terms.nL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2156")'> 2156:             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)</pre>
<pre id='line2156' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2156
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 * 
 */
    __pyx_v_one_over_num_ring_atoms = (1.0 / ((double)__pyx_v_num_ring_atoms));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2157")'> 2157:             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms</pre>
<pre id='line2157' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2157
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             gradU = Vec3()
 */
    __pyx_v_factor3 = ((__pyx_v_force_terms.nL / __pyx_v_force_terms.dL) * __pyx_v_one_over_num_ring_atoms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2158")'> 2158: </pre>
<pre id='line2158' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2159")'> 2159:             gradU = Vec3()</pre>
<pre id='line2159' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2159
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 * 
 *             gradU = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for axis in range(3):
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 */
    __pyx_v_gradU = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2160")'> 2160:             for axis in range(3):</pre>
<pre id='line2160' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2160
 * 
 *             gradU = Vec3()
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 * 
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2161")'> 2161:                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))</pre>
<pre id='line2161' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2161
 *             gradU = Vec3()
 *             for axis in range(3):
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             gradV = Vec3()
 */
      (__pyx_v_gradU[__pyx_v_axis]) = (__pyx_v_factor * ((((0.5 * (__pyx_v_ab[__pyx_v_axis])) - ((__pyx_v_force_terms.ring_normal[__pyx_v_axis]) * __pyx_v_one_over_num_ring_atoms)) * __pyx_v_force_terms.dLnL) - (__pyx_v_force_terms.dn * ((__pyx_v_factor2 * (__pyx_v_c[__pyx_v_axis])) - (__pyx_v_factor3 * (__pyx_v_force_terms.d[__pyx_v_axis]))))));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2162")'> 2162: </pre>
<pre id='line2162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2163")'> 2163:             gradV = Vec3()</pre>
<pre id='line2163' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2163
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 * 
 *             gradV = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):
 */
    __pyx_v_gradV = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2164")'> 2164:             factor = -3 * force_terms.dL * one_over_num_ring_atoms</pre>
<pre id='line2164' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2164
 * 
 *             gradV = Vec3()
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for axis in range(3):
 *                 gradV[axis] = factor * force_terms.d[axis]
 */
    __pyx_v_factor = ((-3.0 * __pyx_v_force_terms.dL) * __pyx_v_one_over_num_ring_atoms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2165")'> 2165:             for axis in range(3):</pre>
<pre id='line2165' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2165
 *             gradV = Vec3()
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 gradV[axis] = factor * force_terms.d[axis]
 * 
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2166")'> 2166:                 gradV[axis] = factor * force_terms.d[axis]</pre>
<pre id='line2166' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2166
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):
 *                 gradV[axis] = factor * force_terms.d[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #TODO: rename force terms  sub_terms or vice versa
 */
      (__pyx_v_gradV[__pyx_v_axis]) = (__pyx_v_factor * (__pyx_v_force_terms.d[__pyx_v_axis]));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2167")'> 2167: </pre>
<pre id='line2167' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2168")'> 2168: #TODO: rename force terms  sub_terms or vice versa</pre>
<pre id='line2168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2169")'> 2169: </pre>
<pre id='line2169' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2170")'> 2170: #            ring_target_force_triplet = self._get_or_make_target_force_triplet(forces, ring_atom_id)</pre>
<pre id='line2170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2171")'> 2171: </pre>
<pre id='line2171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2172")'> 2172:             for axis in range(3):</pre>
<pre id='line2172' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2172
 * #            ring_target_force_triplet = self._get_or_make_target_force_triplet(forces, ring_atom_id)
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2173")'> 2173:                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])</pre>
<pre id='line2173' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2173
 * 
 *             for axis in range(3):
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force
 */
      __pyx_v_sub_term = (((__pyx_v_gradU[__pyx_v_axis]) * __pyx_v_force_terms.dL3) - (__pyx_v_force_terms.u * (__pyx_v_gradV[__pyx_v_axis])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2174")'> 2174:                 sub_force = -force_factor * sub_term / force_terms.dL6</pre>
<pre id='line2174' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2174
 *             for axis in range(3):
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[axis] = sub_force
 *             forces.add(ring_atom_id,result)
 */
      __pyx_v_sub_force = (((-__pyx_v_force_factor) * __pyx_v_sub_term) / __pyx_v_force_terms.dL6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2175")'> 2175:                 result[axis] = sub_force</pre>
<pre id='line2175' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2175
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             forces.add(ring_atom_id,result)
 * #                print AXIS_NAMES[axis],sub_force,-force_factor, gradU[axis], force_terms.dL3, force_terms.u, gradV[axis],force_terms.dL6
 */
      (__pyx_v_result[__pyx_v_axis]) = __pyx_v_sub_force;
    }
</pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line2176")'> 2176:             forces.add(ring_atom_id,result)</pre>
<pre id='line2176' class='code' style='background-color: #FFFF27'>
    /* "Cython_shift_calculator.pyx":2176
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force
 *             forces.add(ring_atom_id,result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #                print AXIS_NAMES[axis],sub_force,-force_factor, gradU[axis], force_terms.dL3, force_terms.u, gradV[axis],force_terms.dL6
 * #            print
 */
    __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_ring_atom_id, __pyx_v_result);
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2185; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2185; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2185; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2185; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2185; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2177")'> 2177: #                print AXIS_NAMES[axis],sub_force,-force_factor, gradU[axis], force_terms.dL3, force_terms.u, gradV[axis],force_terms.dL6</pre>
<pre id='line2177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2178")'> 2178: #            print</pre>
<pre id='line2178' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2179")'> 2179: ##        print</pre>
<pre id='line2179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2180")'> 2180: </pre>
<pre id='line2180' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2181")'> 2181: cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):</pre>
<pre id='line2181' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2181
 * ##        print
 * 
 * cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator {
  struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator __pyx_base;
  float _nb_cutoff;
};



/* "Cython_shift_calculator.pyx":2181
 * ##        print
 * 
 * cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator __pyx_base;
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_shift_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2182")'> 2182: </pre>
<pre id='line2182' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2183")'> 2183:     cdef float _nb_cutoff</pre>
<pre id='line2183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2184")'> 2184: </pre>
<pre id='line2184' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2185")'> 2185:     def __init__(self, object indices, bint smoothed, str name):</pre>
<pre id='line2185' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2185
 *     cdef float _nb_cutoff
 * 
 *     def __init__(self, object indices, bint smoothed, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)
 *         global DEFAULT_NB_CUTOFF
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_indices, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line2186")'> 2186:         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)</pre>
<pre id='line2186' class='code' style='background-color: #FFFF2f'>
  /* "Cython_shift_calculator.pyx":2186
 * 
 *     def __init__(self, object indices, bint smoothed, str name):
 *         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_indices);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2187")'> 2187:         global DEFAULT_NB_CUTOFF</pre>
<pre id='line2187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line2188")'> 2188:         self._nb_cutoff = DEFAULT_NB_CUTOFF</pre>
<pre id='line2188' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":2188
 *         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_nb_cutoff = __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2189")'> 2189: </pre>
<pre id='line2189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2190")'> 2190:     def set_verbose(self,on):</pre>
<pre id='line2190' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":2190
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line2191")'> 2191:         self._verbose = on</pre>
<pre id='line2191' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":2191
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(True)
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->__pyx_base.__pyx_base._verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  __Pyx_memviewslice __pyx_v_results = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_component_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_results.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_component_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_component_to_target.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_4__call__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2192")'> 2192: </pre>
<pre id='line2192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2193")'> 2193:     @cython.profile(True)</pre>
<pre id='line2193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line2194")'> 2194:     def __call__(self, object components, double[:] results, int[:] component_to_target):</pre>
<pre id='line2194' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":2194
 * 
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._set_components(components)
 *         self.set_simulation()
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_4__call__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, __Pyx_memviewslice __pyx_v_results, __Pyx_memviewslice __pyx_v_component_to_target) {
  float __pyx_v_default_smoothing_factor;
  float __pyx_v_smoothing_factor;
  float __pyx_v_ratio;
  float __pyx_v_distance;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_coef_exp;
  int __pyx_v_target_atom_id;
  int __pyx_v_distant_atom_id;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  int __pyx_v_index;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 2194);
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line2195")'> 2195:         self._set_components(components)</pre>
<pre id='line2195' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":2195
 *     @cython.profile(True)
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2196")'> 2196:         self.set_simulation()</pre>
<pre id='line2196' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2196
 *     def __call__(self, object components, double[:] results, int[:] component_to_target):
 *         self._set_components(components)
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float default_smoothing_factor = self._smoothing_factor
 */
  __pyx_f_17shift_calculators_21Base_shift_calculator_set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2197")'> 2197: </pre>
<pre id='line2197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2198")'> 2198:         cdef float default_smoothing_factor = self._smoothing_factor</pre>
<pre id='line2198' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2198
 *         self.set_simulation()
 * 
 *         cdef float default_smoothing_factor = self._smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float smoothing_factor
 *         cdef float ratio
 */
  __pyx_t_4 = __pyx_v_self->__pyx_base._smoothing_factor;
  __pyx_v_default_smoothing_factor = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2199")'> 2199:         cdef float smoothing_factor</pre>
<pre id='line2199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2200")'> 2200:         cdef float ratio</pre>
<pre id='line2200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2201")'> 2201:         cdef float result</pre>
<pre id='line2201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2202")'> 2202:         cdef float distance</pre>
<pre id='line2202' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2203")'> 2203:         cdef target_distant_atom atom_indices</pre>
<pre id='line2203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2204")'> 2204:         cdef coefficient_exponent coef_exp</pre>
<pre id='line2204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2205")'> 2205:         cdef int target_atom_id</pre>
<pre id='line2205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2206")'> 2206:         cdef int distant_atom_id</pre>
<pre id='line2206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2207")'> 2207:         cdef int result_index</pre>
<pre id='line2207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2208")'> 2208:         cdef double value</pre>
<pre id='line2208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2209")'> 2209: </pre>
<pre id='line2209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2210")'> 2210:         cdef double start_time =0.0</pre>
<pre id='line2210' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2210
 *         cdef double value
 * 
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2211")'> 2211:         cdef double end_time =0.0</pre>
<pre id='line2211' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2211
 * 
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2212")'> 2212:         if self._verbose:</pre>
<pre id='line2212' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2212
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base.__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line2213")'> 2213:             start_time = time()</pre>
<pre id='line2213' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":2213
 *         cdef double end_time =0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for index in range(self._num_components):
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_5 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_5;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2214")'> 2214: </pre>
<pre id='line2214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2215")'> 2215:         for index in range(self._num_components):</pre>
<pre id='line2215' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2215
 *             start_time = time()
 * 
 *         for index in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             target_atom_id = self._compiled_components[index].remote_atom_1
 *             distant_atom_id  = self._compiled_components[index].remote_atom_2
 */
  __pyx_t_6 = __pyx_v_self->__pyx_base._num_components;
  for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_index = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2216")'> 2216:             target_atom_id = self._compiled_components[index].remote_atom_1</pre>
<pre id='line2216' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2216
 * 
 *         for index in range(self._num_components):
 *             target_atom_id = self._compiled_components[index].remote_atom_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distant_atom_id  = self._compiled_components[index].remote_atom_2
 * 
 */
    __pyx_t_8 = (__pyx_v_self->__pyx_base._compiled_components[__pyx_v_index]).remote_atom_1;
    __pyx_v_target_atom_id = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2217")'> 2217:             distant_atom_id  = self._compiled_components[index].remote_atom_2</pre>
<pre id='line2217' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2217
 *         for index in range(self._num_components):
 *             target_atom_id = self._compiled_components[index].remote_atom_1
 *             distant_atom_id  = self._compiled_components[index].remote_atom_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)
 */
    __pyx_t_8 = (__pyx_v_self->__pyx_base._compiled_components[__pyx_v_index]).remote_atom_2;
    __pyx_v_distant_atom_id = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2218")'> 2218: </pre>
<pre id='line2218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2219")'> 2219:             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)</pre>
<pre id='line2219' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2219
 *             distant_atom_id  = self._compiled_components[index].remote_atom_2
 * 
 *             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if distance <code><</code> self._nb_cutoff:
 * 
 */
    __pyx_v_distance = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base.__pyx_base._simulation, __pyx_v_target_atom_id, __pyx_v_distant_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2220")'> 2220:             if distance &lt; self._nb_cutoff:</pre>
<pre id='line2220' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":2220
 * 
 *             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)
 *             if distance <code><</code> self._nb_cutoff:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 coef_exp = self._get_coefficient_and_exponent(index)
 */
    __pyx_t_9 = (__pyx_v_distance <code><</code> __pyx_v_self->_nb_cutoff);
    if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2221")'> 2221: </pre>
<pre id='line2221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2222")'> 2222:                 coef_exp = self._get_coefficient_and_exponent(index)</pre>
<pre id='line2222' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2222
 *             if distance <code><</code> self._nb_cutoff:
 * 
 *                 coef_exp = self._get_coefficient_and_exponent(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:
 */
      __pyx_v_coef_exp = __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2223")'> 2223:                 smoothing_factor = default_smoothing_factor</pre>
<pre id='line2223' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2223
 * 
 *                 coef_exp = self._get_coefficient_and_exponent(index)
 *                 smoothing_factor = default_smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff
 */
      __pyx_v_smoothing_factor = __pyx_v_default_smoothing_factor;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2224")'> 2224:                 if self._smoothed:</pre>
<pre id='line2224' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2224
 *                 coef_exp = self._get_coefficient_and_exponent(index)
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8
 */
      if (__pyx_v_self->__pyx_base._smoothed) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2225")'> 2225:                     ratio = distance / self._cutoff</pre>
<pre id='line2225' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2225
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     smoothing_factor = 1.0 - ratio ** 8
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 */
        __pyx_v_ratio = (__pyx_v_distance / __pyx_v_self->__pyx_base._cutoff);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2226")'> 2226:                     smoothing_factor = 1.0 - ratio ** 8</pre>
<pre id='line2226' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":2226
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 */
        __pyx_v_smoothing_factor = (1.0 - powf(__pyx_v_ratio, 8.0));
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2227")'> 2227:                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient</pre>
<pre id='line2227' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":2227
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
      __pyx_t_8 = __pyx_v_index;
      __pyx_t_10 = (*((int *) ( /* dim=0 */ (__pyx_v_component_to_target.data + __pyx_t_8 * __pyx_v_component_to_target.strides[0]) )));
      *((double *) ( /* dim=0 */ (__pyx_v_results.data + __pyx_t_10 * __pyx_v_results.strides[0]) )) += ((__pyx_v_smoothing_factor * pow(__pyx_v_distance, __pyx_v_coef_exp.exponent)) * __pyx_v_coef_exp.coefficient);
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2228")'> 2228: </pre>
<pre id='line2228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2229")'> 2229:         if self._verbose:</pre>
<pre id='line2229' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":2229
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base.__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line2230")'> 2230:             end_time = time()</pre>
<pre id='line2230' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":2230
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_5 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_end_time = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line2231")'> 2231:             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"</pre>
<pre id='line2231' class='code' style='background-color: #FFFF2b'>
    /* "Cython_shift_calculator.pyx":2231
 *         if self._verbose:
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_11 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_21), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_20));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_20));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_20));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 4, ((PyObject *)__pyx_t_1));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_1));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_3 = 0;
    __pyx_t_1 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_2), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_results, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_component_to_target, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static CYTHON_UNUSED int __pyx_pw_7cpython_5array_5array_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
static CYTHON_UNUSED int __pyx_pw_7cpython_5array_5array_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getbuffer__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7cpython_5array_5array___getbuffer__(((arrayobject *)__pyx_v_self), ((Py_buffer *)__pyx_v_info), ((int)__pyx_v_flags));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2232")'> 2232: </pre>
<pre id='line2232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2233")'> 2233: </pre>
<pre id='line2233' class='code' style='background-color: #FFFFff'></pre></body></html>
