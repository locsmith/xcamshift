<!-- Generated by Cython 0.16 on Mon Mar 18 09:16:47 2013 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.16 on Mon Mar 18 09:16:47 2013
<p>Raw output: <a href="Cython_shift_calculator.cpp">Cython_shift_calculator.cpp</a>
<pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1")'> 1: #-------------------------------------------------------------------------------</pre>
<pre id='line1' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # Copyright (c) 2013 Gary Thompson &amp; The University of Leeds.</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: # All rights reserved. This program and the accompanying materials</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: # are made available under the terms of the GNU Lesser Public License v3.0</pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: # which accompanies this distribution, and is available at</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: # http://www.gnu.org/licenses/lgpl-3.0.html</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: #</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # Contributors:</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: #     gary thompson - initial API and implementation</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: #-------------------------------------------------------------------------------</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: # cython: profile=True</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: '''</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: Created on 31 Jul 2012</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: </pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: @author: garyt</pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: </pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: '''</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: </pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: cimport cython</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line20")'> 20: from vec3 import Vec3 as python_vec3</pre>
<pre id='line20' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":20
 * 
 * cimport cython
 * from vec3 import Vec3 as python_vec3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from  xplor_access cimport norm,Vec3,currentSimulation, Dihedral, Atom,  dot,  cross,  Simulation
 * from libc.math cimport cos,sin,  fabs, tanh, pow, cosh
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Vec3));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__Vec3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Vec3));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__vec3), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__Vec3);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Vec3);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__python_vec3, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: from  xplor_access cimport norm,Vec3,currentSimulation, Dihedral, Atom,  dot,  cross,  Simulation</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: from libc.math cimport cos,sin,  fabs, tanh, pow, cosh</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: from libc.stdlib cimport malloc, free</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: from libc.string cimport strcmp</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line25")'> 25: from time import time</pre>
<pre id='line25' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":25
 * from libc.stdlib cimport malloc, free
 * from libc.string cimport strcmp
 * from time import time             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from utils import Atom_utils
 * from component_list import Component_list
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__time));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__time));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__time));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__time), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__time);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__time);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__time, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line26")'> 26: from utils import Atom_utils</pre>
<pre id='line26' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":26
 * from libc.string cimport strcmp
 * from time import time
 * from utils import Atom_utils             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from component_list import Component_list
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Atom_utils));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__Atom_utils));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Atom_utils));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__utils), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__Atom_utils);
  if (__pyx_t_1 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Atom_utils);
    if (unlikely(!__pyx_t_1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__Atom_utils, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line27")'> 27: from component_list import Component_list</pre>
<pre id='line27' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":27
 * from time import time
 * from utils import Atom_utils
 * from component_list import Component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__Component_list));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__Component_list));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__Component_list));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__component_list), ((PyObject *)__pyx_t_2), -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__Component_list);
  if (__pyx_t_2 == NULL) {
    if (<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_AttributeError)) <span class='pyx_c_api'>__Pyx_RaiseImportError</span>(__pyx_n_s__Component_list);
    if (unlikely(!__pyx_t_2))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__Component_list, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: </pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29: </pre>
<pre id='line29' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: cdef class Out_array:</pre>
<pre id='line30' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":30
 * 
 * 
 * cdef class Out_array:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long _length
 *     cdef double[60000] _data
 */
struct __pyx_obj_17shift_calculators_Out_array {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Out_array *__pyx_vtab;
  long _length;
  double _data[60000];
  int _mask[60000];
};


/* "Cython_shift_calculator.pyx":30
 * 
 * 
 * cdef class Out_array:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long _length
 *     cdef double[60000] _data
 */

struct __pyx_vtabstruct_17shift_calculators_Out_array {
  PyObject *(*get_length)(struct __pyx_obj_17shift_calculators_Out_array *, int __pyx_skip_dispatch);
  PyObject *(*add_all)(struct __pyx_obj_17shift_calculators_Out_array *, struct __pyx_obj_17shift_calculators_Out_array *, int __pyx_skip_dispatch);
  int (*_check_clear_length)(struct __pyx_obj_17shift_calculators_Out_array *, long);
  int (*_check_offset)(struct __pyx_obj_17shift_calculators_Out_array *, long);
  int (*realloc)(struct __pyx_obj_17shift_calculators_Out_array *, long, int __pyx_skip_dispatch);
  int (*_check_state)(struct __pyx_obj_17shift_calculators_Out_array *);
  PyObject *(*_clear)(struct __pyx_obj_17shift_calculators_Out_array *, PyObject *);
  void (*add)(struct __pyx_obj_17shift_calculators_Out_array *, long, Vec3 &);
};
static struct __pyx_vtabstruct_17shift_calculators_Out_array *__pyx_vtabptr_17shift_calculators_Out_array;
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_clear_length(struct __pyx_obj_17shift_calculators_Out_array *, long);
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_offset(struct __pyx_obj_17shift_calculators_Out_array *, long);
static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_state(struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE void __pyx_f_17shift_calculators_9Out_array_add(struct __pyx_obj_17shift_calculators_Out_array *, long, Vec3 &);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31:     cdef long _length</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32:     cdef double[60000] _data</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33:     cdef int[60000] _mask</pre>
<pre id='line33' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34: </pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line35")'> 35:     def __init__ (self, length):</pre>
<pre id='line35' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":35
 *     cdef int[60000] _mask
 * 
 *     def __init__ (self, length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._length = length
 * 
 */

static int __pyx_pf_17shift_calculators_9Out_array___init__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 35);
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line36")'> 36:         self._length = length</pre>
<pre id='line36' class='code' style='background-color: #FFFF35'>
  /* "Cython_shift_calculator.pyx":36
 * 
 *     def __init__ (self, length):
 *         self._length = length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely((__pyx_t_1 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_length = __pyx_t_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_9Out_array_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_9Out_array_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_length = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__length,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__length);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_length = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_2__cinit__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_length);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37: </pre>
<pre id='line37' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38: </pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line39")'> 39:     def __cinit__(self,  length):</pre>
<pre id='line39' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":39
 * 
 * 
 *     def __cinit__(self,  length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._length =  60000
 * 
 */

static int __pyx_pf_17shift_calculators_9Out_array_2__cinit__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__cinit__", __pyx_f[0], 39);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40:         self._length =  60000</pre>
<pre id='line40' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":40
 * 
 *     def __cinit__(self,  length):
 *         self._length =  60000             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if length > 60000:
 */
  __pyx_v_self->_length = 60000;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41: </pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line42")'> 42:         if length &gt; 60000:</pre>
<pre id='line42' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":42
 *         self._length =  60000
 * 
 *         if length > 60000:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError("couldn't allocate array beyond length %i" % 60000)
 * #        self._data = <code><</code>double *>malloc(length * sizeof(double))
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_length, __pyx_int_60000, Py_GT);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF44' onclick='toggleDiv("line43")'> 43:             raise MemoryError("couldn't allocate array beyond length %i" % 60000)</pre>
<pre id='line43' class='code' style='background-color: #FFFF44'>
    /* "Cython_shift_calculator.pyx":43
 * 
 *         if length > 60000:
 *             raise MemoryError("couldn't allocate array beyond length %i" % 60000)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._data = <code><</code>double *>malloc(length * sizeof(double))
 * #        if not self._data:
 */
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_1), __pyx_int_60000);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_t_1));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_1));
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44: #        self._data = &lt;double *&gt;malloc(length * sizeof(double))</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45: #        if not self._data:</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46: #            raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47: #</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48: #        self._mask = &lt;long *&gt;malloc(length * sizeof(long))</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49: #        if not self._mask:</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50: #            raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51: #</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52: #        if  self._data  and self._mask:</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53: #            self._clear(length)</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54: #        print 'allocated'</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55: </pre>
<pre id='line55' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line56")'> 56:     cpdef get_length(self):</pre>
<pre id='line56' class='code' style='background-color: #FFFF48'>
/* "Cython_shift_calculator.pyx":56
 * #        print 'allocated'
 * 
 *     cpdef get_length(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._length
 * 
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_f_17shift_calculators_9Out_array_get_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, int __pyx_skip_dispatch) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("get_length", __pyx_f[0], 56);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__get_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_5get_length)) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":56
 * #        print 'allocated'
 * 
 *     cpdef get_length(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._length
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_4get_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("get_length", __pyx_f[0], 56);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->get_length(__pyx_v_self, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.get_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line57")'> 57:         return self._length</pre>
<pre id='line57' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":57
 * 
 *     cpdef get_length(self):
 *         return self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef add_all(self, Out_array target_array):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.get_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_5get_length(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_length (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_4get_length(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58: </pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line59")'> 59:     cpdef add_all(self, Out_array target_array):</pre>
<pre id='line59' class='code' style='background-color: #FFFF39'>
/* "Cython_shift_calculator.pyx":59
 *         return self._length
 * 
 *     cpdef add_all(self, Out_array target_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array); /*proto*/
static PyObject *__pyx_f_17shift_calculators_9Out_array_add_all(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_target_array, int __pyx_skip_dispatch) {
  Vec3 __pyx_v_value;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("add_all", __pyx_f[0], 59);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__add_all);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_7add_all)) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_target_array));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_target_array));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_target_array));
      __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":59
 *         return self._length
 * 
 *     cpdef add_all(self, Out_array target_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_6add_all(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_target_array) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("add_all", __pyx_f[0], 59);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->add_all(__pyx_v_self, __pyx_v_target_array, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_all", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_9Out_array_9__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_9Out_array_9__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_9Out_array_8__dealloc__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:         cdef Vec3 value</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line61")'> 61:         for i in range(target_array._length):</pre>
<pre id='line61' class='code' style='background-color: #FFFF21'>
  /* "Cython_shift_calculator.pyx":61
 *     cpdef add_all(self, Out_array target_array):
 *         cdef Vec3 value
 *         for i in range(target_array._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_target_array->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF44' onclick='toggleDiv("line62")'> 62:             if i &lt; self._length and target_array._mask[i]:</pre>
<pre id='line62' class='code' style='background-color: #FFFF44'>
    /* "Cython_shift_calculator.pyx":62
 *         cdef Vec3 value
 *         for i in range(target_array._length):
 *             if i <code><</code> self._length and target_array._mask[i]:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 *                 self.add(i, value)
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_i, __pyx_t_1, Py_LT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_6 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_6) {
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_8 = (__pyx_v_target_array->_mask[__pyx_t_7]);
    } else {
      __pyx_t_8 = __pyx_t_6;
    }
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line63")'> 63:                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])</pre>
<pre id='line63' class='code' style='background-color: #FFFF21'>
      /* "Cython_shift_calculator.pyx":63
 *         for i in range(target_array._length):
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self.add(i, value)
 * 
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_10 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_value = Vec3((__pyx_v_target_array->_data[__pyx_t_7]), (__pyx_v_target_array->_data[__pyx_t_9]), (__pyx_v_target_array->_data[__pyx_t_10]));
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line64")'> 64:                 self.add(i, value)</pre>
<pre id='line64' class='code' style='background-color: #FFFF4b'>
      /* "Cython_shift_calculator.pyx":64
 *             if i <code><</code> self._length and target_array._mask[i]:
 *                 value = Vec3(target_array._data[i*3+0],target_array._data[i*3+1],target_array._data[i*3+2])
 *                 self.add(i, value)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_11 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_self, __pyx_t_11, __pyx_v_value);
      goto __pyx_L5;
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_all", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_7add_all(PyObject *__pyx_v_self, PyObject *__pyx_v_target_array) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_all (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_target_array), __pyx_ptype_17shift_calculators_Out_array, 1, "target_array", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_6add_all(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_target_array));
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65: </pre>
<pre id='line65' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line66")'> 66:     def __dealloc__(self):</pre>
<pre id='line66' class='code' style='background-color: #FFFFaa'>
/* "Cython_shift_calculator.pyx":66
 *                 self.add(i, value)
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * #        free(self._data)
 */

static void __pyx_pf_17shift_calculators_9Out_array_8__dealloc__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__dealloc__", __pyx_f[0], 66);

  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:         pass</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68: #        free(self._data)</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69: #        self._data = NULL</pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70: #        free(self._mask)</pre>
<pre id='line70' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71: #        self._mask = NULL</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72: </pre>
<pre id='line72' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line73")'> 73:     cdef inline bint _check_clear_length(self, long length) except -1:</pre>
<pre id='line73' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":73
 * #        self._mask = NULL
 * 
 *     cdef inline bint _check_clear_length(self, long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_clear_length(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_clear_length", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_check_clear_length", __pyx_f[0], 73);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:         if not length &lt;= self._length:</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":74
 * 
 *     cdef inline bint _check_clear_length(self, long length) except -1:
 *         if not length <code><</code>= self._length:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 */
  __pyx_t_1 = (!(__pyx_v_length <code><</code>= __pyx_v_self->_length));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line75")'> 75:             raise IndexError("tried to clear to %i length is %i" % (length,self._length))</pre>
<pre id='line75' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":75
 *     cdef inline bint _check_clear_length(self, long length) except -1:
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_2), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76:         if self._data is NULL:</pre>
<pre id='line76' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":76
 *         if not length <code><</code>= self._length:
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line77")'> 77:             raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line77' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":77
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_AttributeError, ((PyObject *)__pyx_k_tuple_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_clear_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":77
 *             raise IndexError("tried to clear to %i length is %i" % (length,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 */
  __pyx_k_tuple_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_4, 0, ((PyObject *)__pyx_kp_s_3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_4));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78: </pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line79")'> 79:     cdef inline bint _check_offset(self, long offset) except -1:</pre>
<pre id='line79' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":79
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_offset(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_offset) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_offset", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_check_offset", __pyx_f[0], 79);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:         if not offset &lt; self._length:</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":80
 * 
 *     cdef inline bint _check_offset(self, long offset) except -1:
 *         if not offset <code><</code> self._length:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 */
  __pyx_t_1 = (!(__pyx_v_offset <code><</code> __pyx_v_self->_length));
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line81")'> 81:             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))</pre>
<pre id='line81' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":81
 *     cdef inline bint _check_offset(self, long offset) except -1:
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_5), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:         if self._data is NULL:</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":82
 *         if not offset <code><</code> self._length:
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line83")'> 83:             raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line83' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":83
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef bint realloc(self,long length) except -1:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_AttributeError, ((PyObject *)__pyx_k_tuple_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_offset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "Cython_shift_calculator.pyx":83
 *             raise IndexError("tried to access object at %i length is %i" % (offset,self._length))
 *         if self._data is NULL:
 *             raise AttributeError("trying to access deallocated memory!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef bint realloc(self,long length) except -1:
 */
  __pyx_k_tuple_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_6, 0, ((PyObject *)__pyx_kp_s_3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_6));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84: </pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line85")'> 85:     cpdef bint realloc(self,long length) except -1:</pre>
<pre id='line85' class='code' style='background-color: #FFFF29'>
/* "Cython_shift_calculator.pyx":85
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cpdef bint realloc(self,long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if length <code><</code>60000:
 * #            free(self._data)
 */

static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length); /*proto*/
static int __pyx_f_17shift_calculators_9Out_array_realloc(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length, int __pyx_skip_dispatch) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("realloc", __pyx_f[0], 85);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__realloc);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_9Out_array_11realloc)) {
      __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_4;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":85
 *             raise AttributeError("trying to access deallocated memory!")
 * 
 *     cpdef bint realloc(self,long length) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if length <code><</code>60000:
 * #            free(self._data)
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_10realloc(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_length) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("realloc", __pyx_f[0], 85);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->realloc(__pyx_v_self, __pyx_v_length, 1);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:         if length &lt;60000:</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":86
 * 
 *     cpdef bint realloc(self,long length) except -1:
 *         if length <code><</code>60000:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #            free(self._data)
 * #            self._data = NULL
 */
  __pyx_t_4 = (__pyx_v_length <code><</code> 60000);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87: #            free(self._data)</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88: #            self._data = NULL</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89: #            self._data = &lt;double *&gt;malloc(3 *(length+1) * sizeof(double))</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: #            if not self._data:</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91: #                raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92: #            if  self._data:</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93: #                self._length =length</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line94")'> 94:             self._clear(length)</pre>
<pre id='line94' class='code' style='background-color: #FFFF96'>
    /* "Cython_shift_calculator.pyx":94
 * #            if  self._data:
 * #                self._length =length
 *             self._clear(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             raise MemoryError("couldn't beyond of length %i" % 60000)
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Out_array *)__pyx_v_self->__pyx_vtab)->_clear(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:         else:</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line96")'> 96:             raise MemoryError("couldn't beyond of length %i" % 60000)</pre>
<pre id='line96' class='code' style='background-color: #FFFF31'>
    /* "Cython_shift_calculator.pyx":96
 *             self._clear(length)
 *         else:
 *             raise MemoryError("couldn't beyond of length %i" % 60000)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 * #            free(self._mask)
 */
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_7), __pyx_int_60000);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_11realloc(PyObject *__pyx_v_self, PyObject *__pyx_arg_length) {
  long __pyx_v_length;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("realloc (wrapper)", 0);
  assert(__pyx_arg_length); {
    __pyx_v_length = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_arg_length);<span class='error_goto'> if (unlikely((__pyx_v_length == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.realloc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_10realloc(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((long)__pyx_v_length));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97: #</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98: #            free(self._mask)</pre>
<pre id='line98' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99: #            self._mask = NULL</pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100: #            self._mask = &lt;int *&gt;malloc((length+1) * sizeof(int))</pre>
<pre id='line100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: #            if not self._mask:</pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102: #                raise MemoryError("couldn't allocate array of length %i" % length)</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103: #            if  self._mask:</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104: #                self._clear_mask(length)</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105: </pre>
<pre id='line105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line106")'> 106:     cdef inline bint _check_state(self) except -1:</pre>
<pre id='line106' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":106
 * #                self._clear_mask(length)
 * 
 *     cdef inline bint _check_state(self) except -1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._data is NULL:
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_9Out_array__check_state(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_check_state", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_check_state", __pyx_f[0], 106);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:         if self._data is NULL:</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":107
 * 
 *     cdef inline bint _check_state(self) except -1:
 *         if self._data is NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_data == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line108")'> 108:             raise MemoryError("couldn't reallocate array of length %i" % self._length)</pre>
<pre id='line108' class='code' style='background-color: #FFFF3b'>
    /* "Cython_shift_calculator.pyx":108
 *     cdef inline bint _check_state(self) except -1:
 *         if self._data is NULL:
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _clear(self, length):
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_8), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_MemoryError, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._check_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109: </pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line110")'> 110:     cdef _clear(self, length):</pre>
<pre id='line110' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":110
 *             raise MemoryError("couldn't reallocate array of length %i" % self._length)
 * 
 *     cdef _clear(self, length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._check_clear_length(length)
 *         for i in range(length*3):
 */

static PyObject *__pyx_f_17shift_calculators_9Out_array__clear(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_length) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_clear", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_clear", __pyx_f[0], 110);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line111")'> 111:         self._check_clear_length(length)</pre>
<pre id='line111' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":111
 * 
 *     cdef _clear(self, length):
 *         self._check_clear_length(length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(length*3):
 *             self._data[i] = 0.0
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_length);<span class='error_goto'> if (unlikely((__pyx_t_1 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __pyx_f_17shift_calculators_9Out_array__check_clear_length(__pyx_v_self, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line112")'> 112:         for i in range(length*3):</pre>
<pre id='line112' class='code' style='background-color: #FFFF21'>
  /* "Cython_shift_calculator.pyx":112
 *     cdef _clear(self, length):
 *         self._check_clear_length(length)
 *         for i in range(length*3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[i] = 0.0
 *         for i in range(length):
 */
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_length, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
    __pyx_t_4 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line113")'> 113:             self._data[i] = 0.0</pre>
<pre id='line113' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":113
 *         self._check_clear_length(length)
 *         for i in range(length*3):
 *             self._data[i] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(length):
 *             self._mask[i]=0
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_data[__pyx_t_7]) = 0.0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line114")'> 114:         for i in range(length):</pre>
<pre id='line114' class='code' style='background-color: #FFFF23'>
  /* "Cython_shift_calculator.pyx":114
 *         for i in range(length*3):
 *             self._data[i] = 0.0
 *         for i in range(length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._mask[i]=0
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_length);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_length);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_length);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
    __pyx_t_4 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_4)) break;
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_4)) break;
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_4, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++;
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_3;
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line115")'> 115:             self._mask[i]=0</pre>
<pre id='line115' class='code' style='background-color: #FFFF29'>
    /* "Cython_shift_calculator.pyx":115
 *             self._data[i] = 0.0
 *         for i in range(length):
 *             self._mask[i]=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def padd(self,offset,value):
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_mask[__pyx_t_7]) = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array._clear", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_13padd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_13padd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_value = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__value,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("padd (wrapper)", 0);
  {
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__offset);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__value);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("padd", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "padd") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_offset = values[0];
    __pyx_v_value = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("padd", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.padd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_12padd(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_offset, __pyx_v_value);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116: </pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line117")'> 117:     def padd(self,offset,value):</pre>
<pre id='line117' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":117
 *             self._mask[i]=0
 * 
 *     def padd(self,offset,value):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])
 *         self.add(offset, cvalue)
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_12padd(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_value) {
  Vec3 __pyx_v_cvalue;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("padd", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("padd", __pyx_f[0], 117);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line118")'> 118:         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])</pre>
<pre id='line118' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":118
 * 
 *     def padd(self,offset,value):
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.add(offset, cvalue)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_value, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_cvalue = Vec3(__pyx_t_2, __pyx_t_3, __pyx_t_4);
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line119")'> 119:         self.add(offset, cvalue)</pre>
<pre id='line119' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":119
 *     def padd(self,offset,value):
 *         cdef Vec3 cvalue  = Vec3(value[0],value[1],value[2])
 *         self.add(offset, cvalue)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_self, __pyx_t_5, __pyx_v_cvalue);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.padd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120: </pre>
<pre id='line120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121:     @cython.profile(False)</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:     cdef inline void  add(self,long offset, Vec3&amp; value):</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":122
 * 
 *     @cython.profile(False)
 *     cdef inline void  add(self,long offset, Vec3& value):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_offset(offset)
 *         cdef long id3 = offset *3
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_9Out_array_add(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, long __pyx_v_offset, Vec3 &__pyx_v_value) {
  long __pyx_v_id3;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123: #        self._check_offset(offset)</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124:         cdef long id3 = offset *3</pre>
<pre id='line124' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":124
 *     cdef inline void  add(self,long offset, Vec3& value):
 * #        self._check_offset(offset)
 *         cdef long id3 = offset *3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._data[id3]   += value[0]
 */
  __pyx_v_id3 = (__pyx_v_offset * 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125: </pre>
<pre id='line125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126:         self._data[id3]   += value[0]</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":126
 *         cdef long id3 = offset *3
 * 
 *         self._data[id3]   += value[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._data[id3+1] += value[1]
 *         self._data[id3+2] += value[2]
 */
  __pyx_t_1 = __pyx_v_id3;
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127:         self._data[id3+1] += value[1]</pre>
<pre id='line127' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":127
 * 
 *         self._data[id3]   += value[0]
 *         self._data[id3+1] += value[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._data[id3+2] += value[2]
 * 
 */
  __pyx_t_1 = (__pyx_v_id3 + 1);
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128:         self._data[id3+2] += value[2]</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":128
 *         self._data[id3]   += value[0]
 *         self._data[id3+1] += value[1]
 *         self._data[id3+2] += value[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._mask[offset] = 1
 */
  __pyx_t_1 = (__pyx_v_id3 + 2);
  (__pyx_v_self->_data[__pyx_t_1]) = ((__pyx_v_self->_data[__pyx_t_1]) + (__pyx_v_value[2]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129: </pre>
<pre id='line129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line130")'> 130:         self._mask[offset] = 1</pre>
<pre id='line130' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":130
 *         self._data[id3+2] += value[2]
 * 
 *         self._mask[offset] = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def clear_by_id(self,target_ids):
 */
  (__pyx_v_self->_mask[__pyx_v_offset]) = 1;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_15clear_by_id(PyObject *__pyx_v_self, PyObject *__pyx_v_target_ids); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_15clear_by_id(PyObject *__pyx_v_self, PyObject *__pyx_v_target_ids) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear_by_id (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_14clear_by_id(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), ((PyObject *)__pyx_v_target_ids));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131: </pre>
<pre id='line131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line132")'> 132:     def clear_by_id(self,target_ids):</pre>
<pre id='line132' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":132
 *         self._mask[offset] = 1
 * 
 *     def clear_by_id(self,target_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3 = 0
 *         for target_id in target_ids:
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_14clear_by_id(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_target_ids) {
  long __pyx_v_id3;
  PyObject *__pyx_v_target_id = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("clear_by_id", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("clear_by_id", __pyx_f[0], 132);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133:         cdef long id3 = 0</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":133
 * 
 *     def clear_by_id(self,target_ids):
 *         cdef long id3 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for target_id in target_ids:
 *             self._check_offset(target_id)
 */
  __pyx_v_id3 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line134")'> 134:         for target_id in target_ids:</pre>
<pre id='line134' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":134
 *     def clear_by_id(self,target_ids):
 *         cdef long id3 = 0
 *         for target_id in target_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._check_offset(target_id)
 *             id3 = target_id *3
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_target_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_target_ids)) {
    __pyx_t_1 = __pyx_v_target_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_target_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_3 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;
    } else if (!__pyx_t_3 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_id);
    __pyx_v_target_id = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line135")'> 135:             self._check_offset(target_id)</pre>
<pre id='line135' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":135
 *         cdef long id3 = 0
 *         for target_id in target_ids:
 *             self._check_offset(target_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             id3 = target_id *3
 * 
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_target_id);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = __pyx_f_17shift_calculators_9Out_array__check_offset(__pyx_v_self, __pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line136")'> 136:             id3 = target_id *3</pre>
<pre id='line136' class='code' style='background-color: #FFFF62'>
    /* "Cython_shift_calculator.pyx":136
 *         for target_id in target_ids:
 *             self._check_offset(target_id)
 *             id3 = target_id *3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._data[id3]   = 0.0
 */
    __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_target_id, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_id3 = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137: </pre>
<pre id='line137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line138")'> 138:             self._data[id3]   = 0.0</pre>
<pre id='line138' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":138
 *             id3 = target_id *3
 * 
 *             self._data[id3]   = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[id3+1] = 0.0
 *             self._data[id3+2] = 0.0
 */
    (__pyx_v_self->_data[__pyx_v_id3]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139:             self._data[id3+1] = 0.0</pre>
<pre id='line139' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":139
 * 
 *             self._data[id3]   = 0.0
 *             self._data[id3+1] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._data[id3+2] = 0.0
 * 
 */
    (__pyx_v_self->_data[(__pyx_v_id3 + 1)]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140:             self._data[id3+2] = 0.0</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":140
 *             self._data[id3]   = 0.0
 *             self._data[id3+1] = 0.0
 *             self._data[id3+2] = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             self._mask[target_id] = 0
 */
    (__pyx_v_self->_data[(__pyx_v_id3 + 2)]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141: </pre>
<pre id='line141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line142")'> 142:             self._mask[target_id] = 0</pre>
<pre id='line142' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":142
 *             self._data[id3+2] = 0.0
 * 
 *             self._mask[target_id] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_target_id);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_mask[__pyx_t_7]) = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.clear_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_id);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_17add_forces_to_result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_17add_forces_to_result(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_result = 0;
  PyObject *__pyx_v_weight = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__result,&__pyx_n_s__weight,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result (wrapper)", 0);
  {
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143: </pre>
<pre id='line143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line144")'> 144:     def add_forces_to_result(self, result=None, weight=1.0):</pre>
<pre id='line144' class='code' style='background-color: #FFFF35'>
    /* "Cython_shift_calculator.pyx":144
 *             self._mask[target_id] = 0
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if result ==  None:
 *             result = [None] * self._length
 */
    values[0] = ((PyObject *)Py_None);
    values[1] = __pyx_k_9;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__result);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__weight);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_forces_to_result") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_result = values[0];
    __pyx_v_weight = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_forces_to_result", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_16add_forces_to_result(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_result, __pyx_v_weight);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_17shift_calculators_9Out_array_16add_forces_to_result(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_result, PyObject *__pyx_v_weight) {
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  long __pyx_v_id3;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("add_forces_to_result", __pyx_f[0], 144);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);

  /* "Cython_shift_calculator.pyx":144
 *             self._mask[target_id] = 0
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if result ==  None:
 *             result = [None] * self._length
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(1.0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_9 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line145")'> 145:         if result ==  None:</pre>
<pre id='line145' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":145
 * 
 *     def add_forces_to_result(self, result=None, weight=1.0):
 *         if result ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = [None] * self._length
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_result, Py_None, Py_EQ);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line146")'> 146:             result = [None] * self._length</pre>
<pre id='line146' class='code' style='background-color: #FFFF8d'>
    /* "Cython_shift_calculator.pyx":146
 *     def add_forces_to_result(self, result=None, weight=1.0):
 *         if result ==  None:
 *             result = [None] * self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double x = 0.0
 */
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1 * ((__pyx_v_self->_length<code><</code>0) ? 0:__pyx_v_self->_length));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp <code><</code> __pyx_v_self->_length; __pyx_temp++) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, __pyx_temp, Py_None);
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_result);
    __pyx_v_result = ((PyObject *)__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147: </pre>
<pre id='line147' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148:         cdef double x = 0.0</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":148
 *             result = [None] * self._length
 * 
 *         cdef double x = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double y = 0.0
 *         cdef double z = 0.0
 */
  __pyx_v_x = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line149")'> 149:         cdef double y = 0.0</pre>
<pre id='line149' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":149
 * 
 *         cdef double x = 0.0
 *         cdef double y = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double z = 0.0
 *         cdef long id3
 */
  __pyx_v_y = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150:         cdef double z = 0.0</pre>
<pre id='line150' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":150
 *         cdef double x = 0.0
 *         cdef double y = 0.0
 *         cdef double z = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3
 *         for i in range(self._length):
 */
  __pyx_v_z = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151:         cdef long id3</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line152")'> 152:         for i in range(self._length):</pre>
<pre id='line152' class='code' style='background-color: #FFFF21'>
  /* "Cython_shift_calculator.pyx":152
 *         cdef double z = 0.0
 *         cdef long id3
 *         for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line153")'> 153:             if self._mask[i] != 0:</pre>
<pre id='line153' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":153
 *         cdef long id3
 *         for i in range(self._length):
 *             if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_6]) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line154")'> 154:                 if result[i] ==  None:</pre>
<pre id='line154' class='code' style='background-color: #FFFF5e'>
      /* "Cython_shift_calculator.pyx":154
 *         for i in range(self._length):
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 */
      __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, Py_None, Py_EQ);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line155")'> 155:                     result[i] = [0.0]*3</pre>
<pre id='line155' class='code' style='background-color: #FFFF57'>
        /* "Cython_shift_calculator.pyx":155
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 id3 = i * 3
 *                 x  = self._data[id3] * weight
 */
        __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1 * 3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
        { Py_ssize_t __pyx_temp;
          for (__pyx_temp=0; __pyx_temp <code><</code> 3; __pyx_temp++) {
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
            <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, __pyx_temp, __pyx_t_7);
            <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
          }
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_result, __pyx_v_i, ((PyObject *)__pyx_t_1)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line156")'> 156:                 id3 = i * 3</pre>
<pre id='line156' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":156
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 x  = self._data[id3] * weight
 *                 y  = self._data[id3+1] *weight
 */
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line157")'> 157:                 x  = self._data[id3] * weight</pre>
<pre id='line157' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":157
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 *                 x  = self._data[id3] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 y  = self._data[id3+1] *weight
 *                 z  = self._data[id3+2] * weight
 */
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_9 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_x = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line158")'> 158:                 y  = self._data[id3+1] *weight</pre>
<pre id='line158' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":158
 *                 id3 = i * 3
 *                 x  = self._data[id3] * weight
 *                 y  = self._data[id3+1] *weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 z  = self._data[id3+2] * weight
 *                 result[i][0] += x
 */
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_9 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_y = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line159")'> 159:                 z  = self._data[id3+2] * weight</pre>
<pre id='line159' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":159
 *                 x  = self._data[id3] * weight
 *                 y  = self._data[id3+1] *weight
 *                 z  = self._data[id3+2] * weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][0] += x
 *                 result[i][1] += y
 */
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_9 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_z = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line160")'> 160:                 result[i][0] += x</pre>
<pre id='line160' class='code' style='background-color: #FFFF4d'>
      /* "Cython_shift_calculator.pyx":160
 *                 y  = self._data[id3+1] *weight
 *                 z  = self._data[id3+2] * weight
 *                 result[i][0] += x             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][1] += y
 *                 result[i][2] += z
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_6 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_1, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_7, __pyx_t_6, __pyx_t_11, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line161")'> 161:                 result[i][1] += y</pre>
<pre id='line161' class='code' style='background-color: #FFFF4d'>
      /* "Cython_shift_calculator.pyx":161
 *                 z  = self._data[id3+2] * weight
 *                 result[i][0] += x
 *                 result[i][1] += y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][2] += z
 * 
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_6 = 1;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_1 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_7, __pyx_t_6, __pyx_t_1, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line162")'> 162:                 result[i][2] += z</pre>
<pre id='line162' class='code' style='background-color: #FFFF4b'>
      /* "Cython_shift_calculator.pyx":162
 *                 result[i][0] += x
 *                 result[i][1] += y
 *                 result[i][2] += z             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_6 = 2;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_1, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_7, __pyx_t_6, __pyx_t_11, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163: </pre>
<pre id='line163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164: </pre>
<pre id='line164' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line165")'> 165:         return result</pre>
<pre id='line165' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":165
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_19add_forces_to_result_by_id(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_19add_forces_to_result_by_id(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_target_atom_ids = 0;
  PyObject *__pyx_v_result = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,&__pyx_n_s__result,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result_by_id (wrapper)", 0);
  {
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166: </pre>
<pre id='line166' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF36' onclick='toggleDiv("line167")'> 167:     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):</pre>
<pre id='line167' class='code' style='background-color: #FFFF36'>
    /* "Cython_shift_calculator.pyx":167
 *         return result
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if result ==  None:
 *             result = [None] * self._length
 */
    values[1] = ((PyObject*)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__result);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_forces_to_result_by_id") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_target_atom_ids = ((PyObject*)values[0]);
    __pyx_v_result = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_forces_to_result_by_id", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_target_atom_ids), (&PyList_Type), 1, "target_atom_ids", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_result), (&PyList_Type), 1, "result", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_18add_forces_to_result_by_id(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self), __pyx_v_target_atom_ids, __pyx_v_result);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_17shift_calculators_9Out_array_18add_forces_to_result_by_id(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self, PyObject *__pyx_v_target_atom_ids, PyObject *__pyx_v_result) {
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  long __pyx_v_id3;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("add_forces_to_result_by_id", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("add_forces_to_result_by_id", __pyx_f[0], 167);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line168")'> 168:         if result ==  None:</pre>
<pre id='line168' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":168
 * 
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 *         if result ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = [None] * self._length
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_result), Py_None, Py_EQ);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line169")'> 169:             result = [None] * self._length</pre>
<pre id='line169' class='code' style='background-color: #FFFF8d'>
    /* "Cython_shift_calculator.pyx":169
 *     def add_forces_to_result_by_id(self, list target_atom_ids, list result=None):
 *         if result ==  None:
 *             result = [None] * self._length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double x = 0.0
 */
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1 * ((__pyx_v_self->_length<code><</code>0) ? 0:__pyx_v_self->_length));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp <code><</code> __pyx_v_self->_length; __pyx_temp++) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, __pyx_temp, Py_None);
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_result));
    __pyx_v_result = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170: </pre>
<pre id='line170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171:         cdef double x = 0.0</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":171
 *             result = [None] * self._length
 * 
 *         cdef double x = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double y = 0.0
 *         cdef double z = 0.0
 */
  __pyx_v_x = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172:         cdef double y = 0.0</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":172
 * 
 *         cdef double x = 0.0
 *         cdef double y = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double z = 0.0
 *         cdef long id3
 */
  __pyx_v_y = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173:         cdef double z = 0.0</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":173
 *         cdef double x = 0.0
 *         cdef double y = 0.0
 *         cdef double z = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef long id3
 *         for i in target_atom_ids:
 */
  __pyx_v_z = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174:         cdef long id3</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line175")'> 175:         for i in target_atom_ids:</pre>
<pre id='line175' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":175
 *         cdef double z = 0.0
 *         cdef long id3
 *         for i in target_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 */
  if (unlikely(((PyObject *)__pyx_v_target_atom_ids) == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span> 
  }
  __pyx_t_1 = ((PyObject *)__pyx_v_target_atom_ids); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_3 = 0;
  for (;;) {
    if (__pyx_t_3 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
    __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_3++;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line176")'> 176:             if self._mask[i] != 0:</pre>
<pre id='line176' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":176
 *         cdef long id3
 *         for i in target_atom_ids:
 *             if self._mask[i] != 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = ((__pyx_v_self->_mask[__pyx_t_5]) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line177")'> 177:                 if result[i] ==  None:</pre>
<pre id='line177' class='code' style='background-color: #FFFF5e'>
      /* "Cython_shift_calculator.pyx":177
 *         for i in target_atom_ids:
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 */
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, Py_None, Py_EQ);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line178")'> 178:                     result[i] = [0.0]*3</pre>
<pre id='line178' class='code' style='background-color: #FFFF57'>
        /* "Cython_shift_calculator.pyx":178
 *             if self._mask[i] != 0:
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 id3 = i * 3
 *                 x  = self._data[id3]
 */
        __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
        __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(1 * 3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
        { Py_ssize_t __pyx_temp;
          for (__pyx_temp=0; __pyx_temp <code><</code> 3; __pyx_temp++) {
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
            <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, __pyx_temp, __pyx_t_6);
            <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
          }
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        if (<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i, ((PyObject *)__pyx_t_4)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line179")'> 179:                 id3 = i * 3</pre>
<pre id='line179' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":179
 *                 if result[i] ==  None:
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]
 */
      __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_7 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_id3 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180:                 x  = self._data[id3]</pre>
<pre id='line180' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":180
 *                     result[i] = [0.0]*3
 *                 id3 = i * 3
 *                 x  = self._data[id3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]
 */
      __pyx_v_x = (__pyx_v_self->_data[__pyx_v_id3]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181:                 y  = self._data[id3+1]</pre>
<pre id='line181' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":181
 *                 id3 = i * 3
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x
 */
      __pyx_v_y = (__pyx_v_self->_data[(__pyx_v_id3 + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:                 z  = self._data[id3+2]</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":182
 *                 x  = self._data[id3]
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][0] += x
 *                 result[i][1] += y
 */
      __pyx_v_z = (__pyx_v_self->_data[(__pyx_v_id3 + 2)]);
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line183")'> 183:                 result[i][0] += x</pre>
<pre id='line183' class='code' style='background-color: #FFFF4d'>
      /* "Cython_shift_calculator.pyx":183
 *                 y  = self._data[id3+1]
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][1] += y
 *                 result[i][2] += z
 */
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_9, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line184")'> 184:                 result[i][1] += y</pre>
<pre id='line184' class='code' style='background-color: #FFFF4d'>
      /* "Cython_shift_calculator.pyx":184
 *                 z  = self._data[id3+2]
 *                 result[i][0] += x
 *                 result[i][1] += y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[i][2] += z
 * 
 */
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 1;
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_6 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_9, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line185")'> 185:                 result[i][2] += z</pre>
<pre id='line185' class='code' style='background-color: #FFFF4b'>
      /* "Cython_shift_calculator.pyx":185
 *                 result[i][0] += x
 *                 result[i][1] += y
 *                 result[i][2] += z             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_result), __pyx_v_i);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = 2;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_4, __pyx_t_5, sizeof(Py_ssize_t), PyInt_FromSsize_t);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_9 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_4, __pyx_t_5, __pyx_t_9, sizeof(Py_ssize_t), PyInt_FromSsize_t) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186: </pre>
<pre id='line186' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: </pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line188")'> 188:         return result</pre>
<pre id='line188' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":188
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __str__(self):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.add_forces_to_result_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_9Out_array_21__str__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_9Out_array_21__str__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_9Out_array_20__str__(((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189: </pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line190")'> 190:     def __str__(self):</pre>
<pre id='line190' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":190
 *         return result
 * 
 *     def __str__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef long id3 =0
 */

static PyObject *__pyx_pf_17shift_calculators_9Out_array_20__str__(struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_self) {
  long __pyx_v_id3;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__str__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__str__", __pyx_f[0], 190);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191: </pre>
<pre id='line191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192:         cdef long id3 =0</pre>
<pre id='line192' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":192
 *     def __str__(self):
 * 
 *         cdef long id3 =0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result =  []
 *         result.append('length = %i' % self._length)
 */
  __pyx_v_id3 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line193")'> 193:         result =  []</pre>
<pre id='line193' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":193
 * 
 *         cdef long id3 =0
 *         result =  []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line194")'> 194:         result.append('length = %i' % self._length)</pre>
<pre id='line194' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":194
 *         cdef long id3 =0
 *         result =  []
 *         result.append('length = %i' % self._length)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._length):
 *             if self._mask[i] ==0:
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_10), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line195")'> 195:         for i in range(self._length):</pre>
<pre id='line195' class='code' style='background-color: #FFFF21'>
  /* "Cython_shift_calculator.pyx":195
 *         result =  []
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if self._mask[i] ==0:
 *                 result.append("%5i ." % i)
 */
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_self->_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line196")'> 196:             if self._mask[i] ==0:</pre>
<pre id='line196' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":196
 *         result.append('length = %i' % self._length)
 *         for i in range(self._length):
 *             if self._mask[i] ==0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result.append("%5i ." % i)
 *             else:
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((__pyx_v_self->_mask[__pyx_t_6]) == 0);
    if (__pyx_t_7) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line197")'> 197:                 result.append("%5i ." % i)</pre>
<pre id='line197' class='code' style='background-color: #FFFF79'>
      /* "Cython_shift_calculator.pyx":197
 *         for i in range(self._length):
 *             if self._mask[i] ==0:
 *                 result.append("%5i ." % i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 id3 = i * 3
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_11), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
      __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198:             else:</pre>
<pre id='line198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line199")'> 199:                 id3 = i * 3</pre>
<pre id='line199' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":199
 *                 result.append("%5i ." % i)
 *             else:
 *                 id3 = i * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))
 *         return '\n'.join(result)
 */
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_i, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_8 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_id3 = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line200")'> 200:                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))</pre>
<pre id='line200' class='code' style='background-color: #FFFF35'>
      /* "Cython_shift_calculator.pyx":200
 *             else:
 *                 id3 = i * 3
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return '\n'.join(result)
 * 
 */
      __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[__pyx_v_id3]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 1)]));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->_data[(__pyx_v_id3 + 2)]));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_v_i);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 2, __pyx_t_9);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 3, __pyx_t_10);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_10);
      __pyx_t_2 = 0;
      __pyx_t_9 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_12), ((PyObject *)__pyx_t_11));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_11)); __pyx_t_11 = 0;
      __pyx_t_3 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, ((PyObject *)__pyx_t_10));<span class='error_goto'> if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line201")'> 201:         return '\n'.join(result)</pre>
<pre id='line201' class='code' style='background-color: #FFFF3b'>
  /* "Cython_shift_calculator.pyx":201
 *                 id3 = i * 3
 *                 result.append('%5i %4.7f,%4.7f,%4.7f' % (i,self._data[id3],self._data[id3+1],self._data[id3+2]))
 *         return '\n'.join(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_kp_s_13), __pyx_n_s__join);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, ((PyObject *)__pyx_v_result));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_result));
  __pyx_t_11 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_10), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  __pyx_r = __pyx_t_11;
  __pyx_t_11 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Out_array.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202: </pre>
<pre id='line202' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203: </pre>
<pre id='line203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204: #cdef float* out_array = null</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205: #cdef long out_array_length = -1</pre>
<pre id='line205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206: #cdef bint allocate_out_array_for_forces(long length) except -1:</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207: #    global out_array</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208: #    global out_array_length</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209: #    cdef long required_length = length*3</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210: #    cdef bint allocate =  False</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211: #    if out_array ==  null:</pre>
<pre id='line211' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212: #        out_array = &lt;float*&gt; malloc*(required_length *sizeof(float))</pre>
<pre id='line212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213: #        if out_array  == null:</pre>
<pre id='line213' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214: #            Raise</pre>
<pre id='line214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215: #        allocate=True</pre>
<pre id='line215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216: #        out_array_length =</pre>
<pre id='line216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217: #        elif  len(out_array) &lt; required_length</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218: #    return allocate</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219: #</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: #def _clear_out_array_for_forces(self, length):</pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221: #</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222: #</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223: #    is_new  = self.allocate_out_array_for_forces(length)</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224: #</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225: #    if not is_new:</pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226: #        length = length*3</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227: #        for i in range(length):</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228: #            self._out_array[i] =0.0</pre>
<pre id='line228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229: #    return self._out_array</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230: #</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line231")'> 231: #def _copy_back_forces(self, data_dict, data_array, target_atom_ids):</pre>
<pre id='line231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232: #    for id in target_atom_ids:</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233: #        result =  dict.setdefault(id,[0.0,0.0,0.0])</pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234: #        id3 = id*3</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235: #        result[0] = data_array[id3]</pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236: #        result[1] = data_array[id3+1]</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237: #        result[2] = data_array[id3+2]</pre>
<pre id='line237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238: </pre>
<pre id='line238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239: </pre>
<pre id='line239' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240: </pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line241")'> 241: cdef object vec3_as_tuple(Vec3&amp; vec_3):</pre>
<pre id='line241' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":241
 * 
 * 
 * cdef object vec3_as_tuple(Vec3& vec_3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 */

static PyObject *__pyx_f_17shift_calculators_vec3_as_tuple(Vec3 &__pyx_v_vec_3) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("vec3_as_tuple", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("vec3_as_tuple", __pyx_f[0], 241);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line242")'> 242:     return vec_3.x(), vec_3.y(), vec_3.z()</pre>
<pre id='line242' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":242
 * 
 * cdef object vec3_as_tuple(Vec3& vec_3):
 *     return vec_3.x(), vec_3.y(), vec_3.z()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Vec3_container:
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.x());<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.y());<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_vec_3.z());<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_r = ((PyObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.vec3_as_tuple", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243: </pre>
<pre id='line243' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244: cdef class Vec3_container:</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":244
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 * cdef class Vec3_container:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float[3] floats
 */
struct __pyx_obj_17shift_calculators_Vec3_container {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Vec3_container *__pyx_vtab;
  float floats[3];
};


/* "Cython_shift_calculator.pyx":244
 *     return vec_3.x(), vec_3.y(), vec_3.z()
 * 
 * cdef class Vec3_container:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float[3] floats
 */

struct __pyx_vtabstruct_17shift_calculators_Vec3_container {
  PyObject *(*set_vec3)(struct __pyx_obj_17shift_calculators_Vec3_container *, Vec3 &);
  Vec3 (*get_vec3)(struct __pyx_obj_17shift_calculators_Vec3_container *);
};
static struct __pyx_vtabstruct_17shift_calculators_Vec3_container *__pyx_vtabptr_17shift_calculators_Vec3_container;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245: </pre>
<pre id='line245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246:     cdef float[3] floats</pre>
<pre id='line246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247: </pre>
<pre id='line247' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line248")'> 248:     cdef set_vec3(self,Vec3&amp; vec3):</pre>
<pre id='line248' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":248
 *     cdef float[3] floats
 * 
 *     cdef set_vec3(self,Vec3& vec3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()
 */

static PyObject *__pyx_f_17shift_calculators_14Vec3_container_set_vec3(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self, Vec3 &__pyx_v_vec3) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_vec3", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_vec3", __pyx_f[0], 248);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249:         self.floats[0] =  vec3.x()</pre>
<pre id='line249' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":249
 * 
 *     cdef set_vec3(self,Vec3& vec3):
 *         self.floats[0] =  vec3.x()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[1] =  vec3.y()
 *         self.floats[2] =  vec3.z()
 */
  (__pyx_v_self->floats[0]) = __pyx_v_vec3.x();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250:         self.floats[1] =  vec3.y()</pre>
<pre id='line250' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":250
 *     cdef set_vec3(self,Vec3& vec3):
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.floats[2] =  vec3.z()
 * 
 */
  (__pyx_v_self->floats[1]) = __pyx_v_vec3.y();
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line251")'> 251:         self.floats[2] =  vec3.z()</pre>
<pre id='line251' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":251
 *         self.floats[0] =  vec3.x()
 *         self.floats[1] =  vec3.y()
 *         self.floats[2] =  vec3.z()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  (__pyx_v_self->floats[2]) = __pyx_v_vec3.z();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252: </pre>
<pre id='line252' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:     @cython.profile(False)</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254:     cdef Vec3  get_vec3(self):</pre>
<pre id='line254' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":254
 * 
 *     @cython.profile(False)
 *     cdef Vec3  get_vec3(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])
 * 
 */

static Vec3 __pyx_f_17shift_calculators_14Vec3_container_get_vec3(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self) {
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_vec3", 0);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line255")'> 255:         return Vec3(self.floats[0],self.floats[1],self.floats[2])</pre>
<pre id='line255' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":255
 *     @cython.profile(False)
 *     cdef Vec3  get_vec3(self):
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __getitem__(self, i):
 */
  __pyx_r = Vec3((__pyx_v_self->floats[0]), (__pyx_v_self->floats[1]), (__pyx_v_self->floats[2]));
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_14Vec3_container_1__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_14Vec3_container_1__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__ (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_14Vec3_container___getitem__(((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_v_self), ((PyObject *)__pyx_v_i));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256: </pre>
<pre id='line256' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line257")'> 257:     def __getitem__(self, i):</pre>
<pre id='line257' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":257
 *         return Vec3(self.floats[0],self.floats[1],self.floats[2])
 * 
 *     def __getitem__(self, i):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"
 */

static PyObject *__pyx_pf_17shift_calculators_14Vec3_container___getitem__(struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_self, PyObject *__pyx_v_i) {
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_v_values = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getitem__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__getitem__", __pyx_f[0], 257);
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line258")'> 258:         if i &gt; 2:</pre>
<pre id='line258' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":258
 * 
 *     def __getitem__(self, i):
 *         if i > 2:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_i, __pyx_int_2, Py_GT);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line259")'> 259:             msg = "tried to access object at %i length is %i"</pre>
<pre id='line259' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":259
 *     def __getitem__(self, i):
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             values = (i,3)
 *             raise IndexError(msg % values)
 */
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_5));
    __pyx_v_msg = ((PyObject *)__pyx_kp_s_5);
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line260")'> 260:             values = (i,3)</pre>
<pre id='line260' class='code' style='background-color: #FFFF86'>
    /* "Cython_shift_calculator.pyx":260
 *         if i > 2:
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise IndexError(msg % values)
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_i);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_i);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_i);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_int_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_3);
    __pyx_v_values = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line261")'> 261:             raise IndexError(msg % values)</pre>
<pre id='line261' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":261
 *             msg = "tried to access object at %i length is %i"
 *             values = (i,3)
 *             raise IndexError(msg % values)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return self.floats[i]
 */
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Remainder</span>(__pyx_v_msg, ((PyObject *)__pyx_v_values));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_IndexError, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262: </pre>
<pre id='line262' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF35' onclick='toggleDiv("line263")'> 263:         return self.floats[i]</pre>
<pre id='line263' class='code' style='background-color: #FFFF35'>
  /* "Cython_shift_calculator.pyx":263
 *             raise IndexError(msg % values)
 * 
 *         return self.floats[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_4 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_self->floats[__pyx_t_4]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Vec3_container.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_msg);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_values);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_27Python_ring_force_sub_terms_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_27Python_ring_force_sub_terms_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_27Python_ring_force_sub_terms___init__(((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264: </pre>
<pre id='line264' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265: </pre>
<pre id='line265' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line266")'> 266: cdef struct target_distant_atom:</pre>
<pre id='line266' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":266
 * 
 * 
 * cdef struct target_distant_atom:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int target_atom_id
 *     int distant_atom_id
 */
struct __pyx_t_17shift_calculators_target_distant_atom {
  int target_atom_id;
  int distant_atom_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267:     int target_atom_id</pre>
<pre id='line267' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268:     int distant_atom_id</pre>
<pre id='line268' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269: </pre>
<pre id='line269' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270: cdef struct target_type:</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":270
 *     int distant_atom_id
 * 
 * cdef struct target_type:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int  target_atom_id
 *     int  atom_type_id
 */
struct __pyx_t_17shift_calculators_target_type {
  int target_atom_id;
  int atom_type_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line271")'> 271:     int  target_atom_id</pre>
<pre id='line271' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272:     int  atom_type_id</pre>
<pre id='line272' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line273")'> 273: </pre>
<pre id='line273' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274: cdef struct coefficient_exponent:</pre>
<pre id='line274' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":274
 *     int  atom_type_id
 * 
 * cdef struct coefficient_exponent:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     float coefficient
 *     float exponent
 */
struct __pyx_t_17shift_calculators_coefficient_exponent {
  float coefficient;
  float exponent;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275:     float coefficient</pre>
<pre id='line275' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276:     float exponent</pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277: </pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278: cdef struct dihedral_ids:</pre>
<pre id='line278' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":278
 *     float exponent
 * 
 * cdef struct dihedral_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int atom_id_1
 *     int atom_id_2
 */
struct __pyx_t_17shift_calculators_dihedral_ids {
  int atom_id_1;
  int atom_id_2;
  int atom_id_3;
  int atom_id_4;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line279")'> 279:     int atom_id_1</pre>
<pre id='line279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280:     int atom_id_2</pre>
<pre id='line280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281:     int atom_id_3</pre>
<pre id='line281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282:     int atom_id_4</pre>
<pre id='line282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283: </pre>
<pre id='line283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284: cdef struct Coef_component:</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":284
 *     int atom_id_4
 * 
 * cdef struct Coef_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int atom_type_id
 *     int ring_id
 */
struct __pyx_t_17shift_calculators_Coef_component {
  int atom_type_id;
  int ring_id;
  float coefficient;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285:     int atom_type_id</pre>
<pre id='line285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286:     int ring_id</pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287:     float coefficient</pre>
<pre id='line287' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288: </pre>
<pre id='line288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289: cdef struct Ring_force_sub_terms:</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":289
 *     float coefficient
 * 
 * cdef struct Ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     Vec3 d
 *     float dLnL
 */
struct __pyx_t_17shift_calculators_Ring_force_sub_terms {
  Vec3 d;
  float dLnL;
  float dL3nL3;
  float dn;
  float dL;
  float nL;
  Vec3 gradUQ;
  float dL3;
  float u;
  Vec3 gradVQ;
  float dL6;
  Vec3 ring_normal;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290:     Vec3 d</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291:     float dLnL</pre>
<pre id='line291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292:     float dL3nL3</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293:     float dn</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294:     float dL</pre>
<pre id='line294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295:     float nL</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line296")'> 296:     Vec3 gradUQ</pre>
<pre id='line296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line297")'> 297:     float dL3</pre>
<pre id='line297' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298:     float u</pre>
<pre id='line298' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299:     Vec3 gradVQ</pre>
<pre id='line299' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line300")'> 300:     float dL6</pre>
<pre id='line300' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line301")'> 301:     Vec3 ring_normal</pre>
<pre id='line301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302: </pre>
<pre id='line302' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line303")'> 303: cdef class Python_ring_force_sub_terms:</pre>
<pre id='line303' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":303
 *     Vec3 ring_normal
 * 
 * cdef class Python_ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Ring_force_sub_terms _terms
 * 
 */
struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *__pyx_vtab;
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms _terms;
};


/* "Cython_shift_calculator.pyx":303
 *     Vec3 ring_normal
 * 
 * cdef class Python_ring_force_sub_terms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Ring_force_sub_terms _terms
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms {
  PyObject *(*setup)(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &);
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms (*get_terms)(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *);
};
static struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *__pyx_vtabptr_17shift_calculators_Python_ring_force_sub_terms;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line304")'> 304:     cdef Ring_force_sub_terms _terms</pre>
<pre id='line304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line305")'> 305: </pre>
<pre id='line305' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line306")'> 306: #    def __cinit__(self):</pre>
<pre id='line306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line307")'> 307: #        self._terms = NULL</pre>
<pre id='line307' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308: </pre>
<pre id='line308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line309")'> 309:     def __init__(self):</pre>
<pre id='line309' class='code' style='background-color: #FFFFaa'>
/* "Cython_shift_calculator.pyx":309
 * #        self._terms = NULL
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         pass
 * 
 */

static int __pyx_pf_17shift_calculators_27Python_ring_force_sub_terms___init__(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 309);

  __pyx_r = 0;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line310")'> 310:         pass</pre>
<pre id='line310' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line311")'> 311: </pre>
<pre id='line311' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line312")'> 312:     cdef setup(self, Ring_force_sub_terms&amp; terms):</pre>
<pre id='line312' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":312
 *         pass
 * 
 *     cdef setup(self, Ring_force_sub_terms& terms):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._terms=terms
 * 
 */

static PyObject *__pyx_f_17shift_calculators_27Python_ring_force_sub_terms_setup(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_terms) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("setup", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("setup", __pyx_f[0], 312);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line313")'> 313:         self._terms=terms</pre>
<pre id='line313' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":313
 * 
 *     cdef setup(self, Ring_force_sub_terms& terms):
 *         self._terms=terms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Ring_force_sub_terms get_terms(self):
 */
  __pyx_v_self->_terms = __pyx_v_terms;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line314")'> 314: </pre>
<pre id='line314' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line315")'> 315:     cdef Ring_force_sub_terms get_terms(self):</pre>
<pre id='line315' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":315
 *         self._terms=terms
 * 
 *     cdef Ring_force_sub_terms get_terms(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._terms
 * 
 */

static struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_f_17shift_calculators_27Python_ring_force_sub_terms_get_terms(struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_self) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_terms", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("get_terms", __pyx_f[0], 315);
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line316")'> 316:         return self._terms</pre>
<pre id='line316' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":316
 * 
 *     cdef Ring_force_sub_terms get_terms(self):
 *         return self._terms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Coef_components:
 */
  __pyx_r = __pyx_v_self->_terms;
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_15Coef_components_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_15Coef_components_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_components = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_15Coef_components___init__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self), __pyx_v_components);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line317")'> 317: </pre>
<pre id='line317' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line318")'> 318: cdef class Coef_components:</pre>
<pre id='line318' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":318
 *         return self._terms
 * 
 * cdef class Coef_components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int num_components
 *     cdef Coef_component* _components
 */
struct __pyx_obj_17shift_calculators_Coef_components {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Coef_components *__pyx_vtab;
  int num_components;
  struct __pyx_t_17shift_calculators_Coef_component *_components;
};


/* "Cython_shift_calculator.pyx":318
 *         return self._terms
 * 
 * cdef class Coef_components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int num_components
 *     cdef Coef_component* _components
 */

struct __pyx_vtabstruct_17shift_calculators_Coef_components {
  struct __pyx_t_17shift_calculators_Coef_component *(*get_component)(struct __pyx_obj_17shift_calculators_Coef_components *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Coef_components *__pyx_vtabptr_17shift_calculators_Coef_components;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_Coef_component *__pyx_f_17shift_calculators_15Coef_components_get_component(struct __pyx_obj_17shift_calculators_Coef_components *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line319")'> 319:     cdef int num_components</pre>
<pre id='line319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line320")'> 320:     cdef Coef_component* _components</pre>
<pre id='line320' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line321")'> 321: </pre>
<pre id='line321' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line322")'> 322:     def __init__ (self, object components):</pre>
<pre id='line322' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":322
 *     cdef Coef_component* _components
 * 
 *     def __init__ (self, object components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.num_components = len(components)
 *         for i,component in enumerate(components):
 */

static int __pyx_pf_17shift_calculators_15Coef_components___init__(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_component = NULL;
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 322);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line323")'> 323:         self.num_components = len(components)</pre>
<pre id='line323' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":323
 * 
 *     def __init__ (self, object components):
 *         self.num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._components[i].atom_type_id = component[0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line324")'> 324:         for i,component in enumerate(components):</pre>
<pre id='line324' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":324
 *     def __init__ (self, object components):
 *         self.num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._components[i].atom_type_id = component[0]
 *             self._components[i].ring_id = component[1]
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line325")'> 325:             self._components[i].atom_type_id = component[0]</pre>
<pre id='line325' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":325
 *         self.num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._components[i].atom_type_id = component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._components[i].ring_id = component[1]
 *             self._components[i].coefficient = component[2]
 */
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_components[__pyx_t_7]).atom_type_id = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line326")'> 326:             self._components[i].ring_id = component[1]</pre>
<pre id='line326' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":326
 *         for i,component in enumerate(components):
 *             self._components[i].atom_type_id = component[0]
 *             self._components[i].ring_id = component[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._components[i].coefficient = component[2]
 * 
 */
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_components[__pyx_t_7]).ring_id = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line327")'> 327:             self._components[i].coefficient = component[2]</pre>
<pre id='line327' class='code' style='background-color: #FFFF25'>
    /* "Cython_shift_calculator.pyx":327
 *             self._components[i].atom_type_id = component[0]
 *             self._components[i].ring_id = component[1]
 *             self._components[i].coefficient = component[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __cinit__(self, object components):
 */
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_8 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_components[__pyx_t_7]).coefficient = __pyx_t_8;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_15Coef_components_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_15Coef_components_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_components = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_15Coef_components_2__cinit__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self), __pyx_v_components);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line328")'> 328: </pre>
<pre id='line328' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line329")'> 329:     def __cinit__(self, object components):</pre>
<pre id='line329' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":329
 *             self._components[i].coefficient = component[2]
 * 
 *     def __cinit__(self, object components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = <code><</code>Coef_component *>malloc(len(components) * sizeof(Coef_component))
 *         if not self._components:
 */

static int __pyx_pf_17shift_calculators_15Coef_components_2__cinit__(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, PyObject *__pyx_v_components) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__cinit__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__cinit__", __pyx_f[0], 329);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line330")'> 330:         self._components = &lt;Coef_component *&gt;malloc(len(components) * sizeof(Coef_component))</pre>
<pre id='line330' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":330
 * 
 *     def __cinit__(self, object components):
 *         self._components = <code><</code>Coef_component *>malloc(len(components) * sizeof(Coef_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if not self._components:
 *             raise MemoryError()
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_components = ((struct __pyx_t_17shift_calculators_Coef_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Coef_component)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line331")'> 331:         if not self._components:</pre>
<pre id='line331' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":331
 *     def __cinit__(self, object components):
 *         self._components = <code><</code>Coef_component *>malloc(len(components) * sizeof(Coef_component))
 *         if not self._components:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             raise MemoryError()
 * 
 */
  __pyx_t_2 = (!(__pyx_v_self->_components != 0));
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line332")'> 332:             raise MemoryError()</pre>
<pre id='line332' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":332
 *         self._components = <code><</code>Coef_component *>malloc(len(components) * sizeof(Coef_component))
 *         if not self._components:
 *             raise MemoryError()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __dealloc__(self):
 */
    <span class='py_c_api'>PyErr_NoMemory</span>();<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Coef_components.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_17shift_calculators_15Coef_components_5__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_17shift_calculators_15Coef_components_5__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_17shift_calculators_15Coef_components_4__dealloc__(((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line333")'> 333: </pre>
<pre id='line333' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line334")'> 334:     def __dealloc__(self):</pre>
<pre id='line334' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":334
 *             raise MemoryError()
 * 
 *     def __dealloc__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         free(self._components)
 *         self._components = NULL
 */

static void __pyx_pf_17shift_calculators_15Coef_components_4__dealloc__(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self) {
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__dealloc__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__dealloc__", __pyx_f[0], 334);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line335")'> 335:         free(self._components)</pre>
<pre id='line335' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":335
 * 
 *     def __dealloc__(self):
 *         free(self._components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = NULL
 * 
 */
  free(__pyx_v_self->_components);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line336")'> 336:         self._components = NULL</pre>
<pre id='line336' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":336
 *     def __dealloc__(self):
 *         free(self._components)
 *         self._components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    cdef int _check_offset(self, int offset) except -1:
 */
  __pyx_v_self->_components = NULL;

  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line337")'> 337: </pre>
<pre id='line337' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line338")'> 338: #    cdef int _check_offset(self, int offset) except -1:</pre>
<pre id='line338' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line339")'> 339: #</pre>
<pre id='line339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line340")'> 340: #        if not offset &lt; self.num_components:</pre>
<pre id='line340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line341")'> 341: #            raise IndexError("tried to access object at %i length is %i" % (offset,self._num_components))</pre>
<pre id='line341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line342")'> 342: #        if self._components is NULL:</pre>
<pre id='line342' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343: #            raise AttributeError("trying to access deallocated memory!")</pre>
<pre id='line343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line344")'> 344: #        return 0</pre>
<pre id='line344' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line345")'> 345: </pre>
<pre id='line345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line346")'> 346: </pre>
<pre id='line346' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line347")'> 347: #    cdef set_component(self,int offset, coef_component&amp; component):</pre>
<pre id='line347' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line348")'> 348: #        self._check_offset(offset)</pre>
<pre id='line348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line349")'> 349: #        self._components[offset] = component</pre>
<pre id='line349' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line350")'> 350: </pre>
<pre id='line350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line351")'> 351:     @cython.profile(False)</pre>
<pre id='line351' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352:     cdef inline Coef_component* get_component(self,int offset):</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":352
 * 
 *     @cython.profile(False)
 *     cdef inline Coef_component* get_component(self,int offset):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_offset(offset)
 *         return &self._components[offset]
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_Coef_component *__pyx_f_17shift_calculators_15Coef_components_get_component(struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_self, int __pyx_v_offset) {
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_component", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line353")'> 353: #        self._check_offset(offset)</pre>
<pre id='line353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line354")'> 354:         return &amp;self._components[offset]</pre>
<pre id='line354' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":354
 *     cdef inline Coef_component* get_component(self,int offset):
 * #        self._check_offset(offset)
 *         return &self._components[offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef struct ring_atom_ids:
 */
  __pyx_r = (&(__pyx_v_self->_components[__pyx_v_offset]));
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line355")'> 355: </pre>
<pre id='line355' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line356")'> 356: cdef struct ring_atom_ids:</pre>
<pre id='line356' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":356
 *         return &self._components[offset]
 * 
 * cdef struct ring_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int num_atoms
 *     int[6] atom_ids
 */
struct __pyx_t_17shift_calculators_ring_atom_ids {
  int num_atoms;
  int atom_ids[6];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line357")'> 357:     int num_atoms</pre>
<pre id='line357' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line358")'> 358:     int[6] atom_ids</pre>
<pre id='line358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line359")'> 359: </pre>
<pre id='line359' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line360")'> 360: </pre>
<pre id='line360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line361")'> 361: </pre>
<pre id='line361' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line362")'> 362: </pre>
<pre id='line362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line363")'> 363: </pre>
<pre id='line363' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line364")'> 364: </pre>
<pre id='line364' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line365")'> 365: cdef struct dihedral_parameters:</pre>
<pre id='line365' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":365
 * 
 * 
 * cdef struct dihedral_parameters:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     float param_0
 *     float param_1
 */
struct __pyx_t_17shift_calculators_dihedral_parameters {
  float param_0;
  float param_1;
  float param_2;
  float param_3;
  float param_4;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line366")'> 366:     float param_0</pre>
<pre id='line366' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line367")'> 367:     float param_1</pre>
<pre id='line367' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line368")'> 368:     float param_2</pre>
<pre id='line368' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line369")'> 369:     float param_3</pre>
<pre id='line369' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line370")'> 370:     float param_4</pre>
<pre id='line370' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line371")'> 371: </pre>
<pre id='line371' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line372")'> 372: </pre>
<pre id='line372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line373")'> 373: #cdef float sum(Vec3 vec3):</pre>
<pre id='line373' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line374")'> 374: #    return vec3.x()+vec3.y()+vec3.z()</pre>
<pre id='line374' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line375")'> 375: </pre>
<pre id='line375' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line376")'> 376: </pre>
<pre id='line376' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line377")'> 377: @cython.profile(False)</pre>
<pre id='line377' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line378")'> 378: cdef inline void operator_times (Vec3&amp; vec3, float scale):</pre>
<pre id='line378' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":378
 * 
 * @cython.profile(False)
 * cdef inline void operator_times (Vec3& vec3, float scale):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale
 */

static CYTHON_INLINE void __pyx_f_17shift_calculators_operator_times(Vec3 &__pyx_v_vec3, float __pyx_v_scale) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("operator_times", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line379")'> 379:      vec3[0] =  vec3[0] * scale</pre>
<pre id='line379' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":379
 * @cython.profile(False)
 * cdef inline void operator_times (Vec3& vec3, float scale):
 *      vec3[0] =  vec3[0] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[1] =  vec3[1] * scale
 *      vec3[2] =  vec3[2] * scale
 */
  (__pyx_v_vec3[0]) = ((__pyx_v_vec3[0]) * __pyx_v_scale);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line380")'> 380:      vec3[1] =  vec3[1] * scale</pre>
<pre id='line380' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":380
 * cdef inline void operator_times (Vec3& vec3, float scale):
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *      vec3[2] =  vec3[2] * scale
 * 
 */
  (__pyx_v_vec3[1]) = ((__pyx_v_vec3[1]) * __pyx_v_scale);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line381")'> 381:      vec3[2] =  vec3[2] * scale</pre>
<pre id='line381' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":381
 *      vec3[0] =  vec3[0] * scale
 *      vec3[1] =  vec3[1] * scale
 *      vec3[2] =  vec3[2] * scale             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * @cython.profile(False)
 */
  (__pyx_v_vec3[2]) = ((__pyx_v_vec3[2]) * __pyx_v_scale);

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line382")'> 382: </pre>
<pre id='line382' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line383")'> 383: @cython.profile(False)</pre>
<pre id='line383' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line384")'> 384: cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, atom_index_2):</pre>
<pre id='line384' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":384
 * 
 * @cython.profile(False)
 * cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, atom_index_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_calc_distance_simulation(Simulation *__pyx_v_sim, int __pyx_v_atom_index_1, PyObject *__pyx_v_atom_index_2) {
  Vec3 __pyx_v_vec1;
  Vec3 __pyx_v_vec2;
  Vec3 __pyx_v_result;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("calc_distance_simulation", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line385")'> 385: </pre>
<pre id='line385' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line386")'> 386:     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)</pre>
<pre id='line386' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":386
 * cdef inline float calc_distance_simulation(Simulation* sim, int atom_index_1, atom_index_2):
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1
 */
  __pyx_v_vec1 = (__pyx_v_sim[0]).atomPos(__pyx_v_atom_index_1);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line387")'> 387:     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)</pre>
<pre id='line387' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":387
 * 
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef Vec3 result =  vec2 - vec1
 *     return norm(result)
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_atom_index_2);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_vec2 = (__pyx_v_sim[0]).atomPos(__pyx_t_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line388")'> 388:     cdef Vec3 result =  vec2 - vec1</pre>
<pre id='line388' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":388
 *     cdef Vec3 vec1 = sim[0].atomPos(atom_index_1)
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return norm(result)
 * 
 */
  __pyx_v_result = (__pyx_v_vec2 - __pyx_v_vec1);
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line389")'> 389:     return norm(result)</pre>
<pre id='line389' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":389
 *     cdef Vec3 vec2 = sim[0].atomPos(atom_index_2)
 *     cdef Vec3 result =  vec2 - vec1
 *     return norm(result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = norm(__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.calc_distance_simulation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line390")'> 390: </pre>
<pre id='line390' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line391")'> 391: </pre>
<pre id='line391' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line392")'> 392: </pre>
<pre id='line392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line393")'> 393: #</pre>
<pre id='line393' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line394")'> 394: #</pre>
<pre id='line394' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line395")'> 395: #cdef inline bint distance_less_than(int atom_index_1, atom_index_2, float target):</pre>
<pre id='line395' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line396")'> 396: #    cdef float total = 0.0</pre>
<pre id='line396' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line397")'> 397: #    cdef float diff</pre>
<pre id='line397' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line398")'> 398: #    cdef float target2  = target*target</pre>
<pre id='line398' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line399")'> 399: #</pre>
<pre id='line399' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line400")'> 400: #    cdef Vec3 vec1 = currentSimulation().atomPosArr().data(atom_index_1)</pre>
<pre id='line400' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line401")'> 401: #    cdef Vec3 vec2 = currentSimulation().atomPosArr().data(atom_index_2)</pre>
<pre id='line401' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line402")'> 402: #    cdef bint result  =  True</pre>
<pre id='line402' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line403")'> 403: #    for i in range(3):</pre>
<pre id='line403' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line404")'> 404: #        diff = vec1[i] - vec2[i]</pre>
<pre id='line404' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line405")'> 405: #        total += diff * diff</pre>
<pre id='line405' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line406")'> 406: #</pre>
<pre id='line406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line407")'> 407: #        if total &gt; target2:</pre>
<pre id='line407' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line408")'> 408: #            result = False</pre>
<pre id='line408' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line409")'> 409: #            break</pre>
<pre id='line409' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line410")'> 410: #    return result</pre>
<pre id='line410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line411")'> 411: </pre>
<pre id='line411' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line412")'> 412: </pre>
<pre id='line412' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line413")'> 413: </pre>
<pre id='line413' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line414")'> 414: </pre>
<pre id='line414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line415")'> 415: </pre>
<pre id='line415' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line416")'> 416: #TODO how does currentSimulation().atomByID work inside</pre>
<pre id='line416' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line417")'> 417: @cython.profile(False)</pre>
<pre id='line417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line418")'> 418: cdef inline float calc_dihedral_angle_simulation(Simulation* simulation, dihedral_ids dihedral_atom_ids):</pre>
<pre id='line418' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":418
 * #TODO how does currentSimulation().atomByID work inside
 * @cython.profile(False)
 * cdef inline float calc_dihedral_angle_simulation(Simulation* simulation, dihedral_ids dihedral_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(Simulation *__pyx_v_simulation, struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids) {
  Atom __pyx_v_atom_1;
  Atom __pyx_v_atom_2;
  Atom __pyx_v_atom_3;
  Atom __pyx_v_atom_4;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("calc_dihedral_angle_simulation", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line419")'> 419: </pre>
<pre id='line419' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line420")'> 420: </pre>
<pre id='line420' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line421")'> 421: </pre>
<pre id='line421' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line422")'> 422:     atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)</pre>
<pre id='line422' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":422
 * 
 * 
 *     atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 */
  __pyx_v_atom_1 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line423")'> 423:     atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)</pre>
<pre id='line423' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":423
 * 
 *     atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)
 *     atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 *     atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 */
  __pyx_v_atom_2 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line424")'> 424:     atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)</pre>
<pre id='line424' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":424
 *     atom_1  = simulation[0].atomByID(dihedral_atom_ids.atom_id_1)
 *     atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 * 
 */
  __pyx_v_atom_3 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line425")'> 425:     atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)</pre>
<pre id='line425' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":425
 *     atom_2  = simulation[0].atomByID(dihedral_atom_ids.atom_id_2)
 *     atom_3  = simulation[0].atomByID(dihedral_atom_ids.atom_id_3)
 *     atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return Dihedral(atom_1,atom_2,atom_3,atom_4).value()
 */
  __pyx_v_atom_4 = (__pyx_v_simulation[0]).atomByID(__pyx_v_dihedral_atom_ids.atom_id_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line426")'> 426: </pre>
<pre id='line426' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line427")'> 427:     return Dihedral(atom_1,atom_2,atom_3,atom_4).value()</pre>
<pre id='line427' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":427
 *     atom_4  = simulation[0].atomByID(dihedral_atom_ids.atom_id_4)
 * 
 *     return Dihedral(atom_1,atom_2,atom_3,atom_4).value()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = Dihedral(__pyx_v_atom_1, __pyx_v_atom_2, __pyx_v_atom_3, __pyx_v_atom_4).value();
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_21Base_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_21Base_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_name = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line428")'> 428: </pre>
<pre id='line428' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line429")'> 429: </pre>
<pre id='line429' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line430")'> 430: </pre>
<pre id='line430' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line431")'> 431: cdef float DEFAULT_CUTOFF = 5.0</pre>
<pre id='line431' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":431
 * 
 * 
 * cdef float DEFAULT_CUTOFF = 5.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 */
  __pyx_v_17shift_calculators_DEFAULT_CUTOFF = 5.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line432")'> 432: cdef float DEFAULT_SMOOTHING_FACTOR = 1.0</pre>
<pre id='line432' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":432
 * 
 * cdef float DEFAULT_CUTOFF = 5.0
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 */
  __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line433")'> 433: cdef float DEFAULT_NB_CUTOFF = 5.0</pre>
<pre id='line433' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":433
 * cdef float DEFAULT_CUTOFF = 5.0
 * cdef float DEFAULT_SMOOTHING_FACTOR = 1.0
 * cdef float DEFAULT_NB_CUTOFF = 5.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Base_shift_calculator:
 */
  __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF = 5.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line434")'> 434: </pre>
<pre id='line434' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line435")'> 435: cdef class Base_shift_calculator:</pre>
<pre id='line435' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":435
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 * cdef class Base_shift_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef str _name
 */
struct __pyx_obj_17shift_calculators_Base_shift_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator *__pyx_vtab;
  int _verbose;
  PyObject *_name;
  Simulation *_simulation;
};


/* "Cython_shift_calculator.pyx":435
 * cdef float DEFAULT_NB_CUTOFF = 5.0
 * 
 * cdef class Base_shift_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef str _name
 */

struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator {
  PyObject *(*set_simulation)(struct __pyx_obj_17shift_calculators_Base_shift_calculator *);
};
static struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator *__pyx_vtabptr_17shift_calculators_Base_shift_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line436")'> 436:     cdef bint _verbose</pre>
<pre id='line436' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line437")'> 437:     cdef str _name</pre>
<pre id='line437' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line438")'> 438:     cdef Simulation* _simulation</pre>
<pre id='line438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line439")'> 439: </pre>
<pre id='line439' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line440")'> 440:     def __init__(self, str name):</pre>
<pre id='line440' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":440
 *     cdef Simulation* _simulation
 * 
 *     def __init__(self, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._verbose = False
 *             self._name = name
 */

static int __pyx_pf_17shift_calculators_21Base_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 440);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line441")'> 441:             self._verbose = False</pre>
<pre id='line441' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":441
 * 
 *     def __init__(self, str name):
 *             self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._name = name
 *             self._simulation =  currentSimulation()
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line442")'> 442:             self._name = name</pre>
<pre id='line442' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":442
 *     def __init__(self, str name):
 *             self._verbose = False
 *             self._name = name             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._simulation =  currentSimulation()
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_name);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_name));
  __pyx_v_self->_name = __pyx_v_name;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line443")'> 443:             self._simulation =  currentSimulation()</pre>
<pre id='line443' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":443
 *             self._verbose = False
 *             self._name = name
 *             self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = 0;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
  int __pyx_v_state;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  assert(__pyx_arg_state); {
    __pyx_v_state = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_arg_state);<span class='error_goto'> if (unlikely((__pyx_v_state == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_shift_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_shift_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self), ((int)__pyx_v_state));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line444")'> 444: </pre>
<pre id='line444' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line445")'> 445: </pre>
<pre id='line445' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line446")'> 446:     def set_verbose(self,bint state):</pre>
<pre id='line446' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":446
 * 
 * 
 *     def set_verbose(self,bint state):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  state
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_shift_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self, int __pyx_v_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_verbose", __pyx_f[0], 446);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line447")'> 447:         self._verbose =  state</pre>
<pre id='line447' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":447
 * 
 *     def set_verbose(self,bint state):
 *         self._verbose =  state             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef set_simulation(self):
 */
  __pyx_v_self->_verbose = __pyx_v_state;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line448")'> 448: </pre>
<pre id='line448' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line449")'> 449:     cdef set_simulation(self):</pre>
<pre id='line449' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":449
 *         self._verbose =  state
 * 
 *     cdef set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 * 
 */

static PyObject *__pyx_f_17shift_calculators_21Base_shift_calculator_set_simulation(struct __pyx_obj_17shift_calculators_Base_shift_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_simulation", __pyx_f[0], 449);
</pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line450")'> 450:         self._simulation = currentSimulation()</pre>
<pre id='line450' class='code' style='background-color: #FFFF2e'>
  /* "Cython_shift_calculator.pyx":450
 * 
 *     cdef set_simulation(self):
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  PyObject *__pyx_v_smoothed = 0;
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject*)__pyx_kp_s_14);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = values[1];
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line451")'> 451: </pre>
<pre id='line451' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line452")'> 452: </pre>
<pre id='line452' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line453")'> 453: cdef class Fast_distance_shift_calculator(Base_shift_calculator):</pre>
<pre id='line453' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":453
 * 
 * 
 * cdef class Fast_distance_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  int _target_atom_index;
  int _distance_atom_index_1;
  int _distance_atom_index_2;
  int _exponent_index;
  int _coefficient_index;
  int _smoothed;
  PyObject *_components;
  float _smoothing_factor;
  float _cutoff;
};


/* "Cython_shift_calculator.pyx":453
 * 
 * 
 * cdef class Fast_distance_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  PyObject *(*_set_components)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, PyObject *);
  struct __pyx_t_17shift_calculators_target_distant_atom (*_get_target_and_distant_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_coefficient_exponent (*_get_coefficient_and_exponent)(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_distance_shift_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line454")'> 454: </pre>
<pre id='line454' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line455")'> 455: </pre>
<pre id='line455' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line456")'> 456:     cdef int _target_atom_index</pre>
<pre id='line456' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line457")'> 457:     cdef int _distance_atom_index_1</pre>
<pre id='line457' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line458")'> 458:     cdef int _distance_atom_index_2</pre>
<pre id='line458' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line459")'> 459:     cdef int _exponent_index</pre>
<pre id='line459' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line460")'> 460:     cdef int _coefficient_index</pre>
<pre id='line460' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line461")'> 461:     cdef bint _smoothed</pre>
<pre id='line461' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line462")'> 462:     cdef object _components</pre>
<pre id='line462' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line463")'> 463:     cdef float _smoothing_factor</pre>
<pre id='line463' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line464")'> 464:     cdef float _cutoff</pre>
<pre id='line464' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line465")'> 465: </pre>
<pre id='line465' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line466")'> 466: </pre>
<pre id='line466' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line467")'> 467:     def __init__(self, indices, smoothed, str name = "not set"):</pre>
<pre id='line467' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":467
 * 
 * 
 *     def __init__(self, indices, smoothed, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self, name)
 *         self._target_atom_index = indices.target_atom_index
 */

static int __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_indices, PyObject *__pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 467);
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line468")'> 468:         Base_shift_calculator.__init__(self, name)</pre>
<pre id='line468' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":468
 * 
 *     def __init__(self, indices, smoothed, str name = "not set"):
 *         Base_shift_calculator.__init__(self, name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line469")'> 469:         self._target_atom_index = indices.target_atom_index</pre>
<pre id='line469' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":469
 *     def __init__(self, indices, smoothed, str name = "not set"):
 *         Base_shift_calculator.__init__(self, name)
 *         self._target_atom_index = indices.target_atom_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__target_atom_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_target_atom_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line470")'> 470:         self._distance_atom_index_1 =  indices.distance_atom_index_1</pre>
<pre id='line470' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":470
 *         Base_shift_calculator.__init__(self, name)
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_1 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line471")'> 471:         self._distance_atom_index_2 =  indices .distance_atom_index_2</pre>
<pre id='line471' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":471
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_16);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_2 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line472")'> 472:         self._exponent_index  = indices.exponent_index</pre>
<pre id='line472' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":472
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coefficient_index  = indices.coefficient_index
 * 
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__exponent_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_exponent_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line473")'> 473:         self._coefficient_index  = indices.coefficient_index</pre>
<pre id='line473' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":473
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._smoothed =  smoothed
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__coefficient_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_coefficient_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line474")'> 474: </pre>
<pre id='line474' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line475")'> 475:         self._smoothed =  smoothed</pre>
<pre id='line475' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":475
 *         self._coefficient_index  = indices.coefficient_index
 * 
 *         self._smoothed =  smoothed             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 * #
 */
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_smoothed = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line476")'> 476:         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR</pre>
<pre id='line476' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":476
 * 
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         self._components =  None
 */
  __pyx_v_self->_smoothing_factor = __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line477")'> 477: #</pre>
<pre id='line477' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line478")'> 478:         self._components =  None</pre>
<pre id='line478' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":478
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 * #
 *         self._components =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff =  DEFAULT_CUTOFF
 * #
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = Py_None;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line479")'> 479:         self._cutoff =  DEFAULT_CUTOFF</pre>
<pre id='line479' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":479
 * #
 *         self._components =  None
 *         self._cutoff =  DEFAULT_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 * #    def set_cutoff(self, cutoff):
 */
  __pyx_v_self->_cutoff = __pyx_v_17shift_calculators_DEFAULT_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line480")'> 480: #</pre>
<pre id='line480' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line481")'> 481: #    def set_cutoff(self, cutoff):</pre>
<pre id='line481' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line482")'> 482: #        self._cutoff =  cutoff</pre>
<pre id='line482' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line483")'> 483: #</pre>
<pre id='line483' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line484")'> 484: #    def set_smoothing_factor(self,smoothing_factor):</pre>
<pre id='line484' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line485")'> 485: #        self._smoothing_factor = smoothing_factor</pre>
<pre id='line485' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line486")'> 486: #</pre>
<pre id='line486' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line487")'> 487: #    TODO: this needs to be removed</pre>
<pre id='line487' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line488")'> 488:     cdef _set_components(self,components):</pre>
<pre id='line488' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":488
 * #
 * #    TODO: this needs to be removed
 *     cdef _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = components
 * 
 */

static PyObject *__pyx_f_17shift_calculators_30Fast_distance_shift_calculator__set_components(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_components", __pyx_f[0], 488);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line489")'> 489:         self._components = components</pre>
<pre id='line489' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":489
 * #    TODO: this needs to be removed
 *     cdef _set_components(self,components):
 *         self._components = components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = __pyx_v_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line490")'> 490: </pre>
<pre id='line490' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line491")'> 491:     @cython.profile(False)</pre>
<pre id='line491' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line492")'> 492:     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index):</pre>
<pre id='line492' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":492
 * 
 *     @cython.profile(False)
 *     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef object values
 *         cdef target_distant_atom result
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_v_values = 0;
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_v_result;
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_target_and_distant_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line493")'> 493:         cdef object values</pre>
<pre id='line493' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line494")'> 494:         cdef target_distant_atom result</pre>
<pre id='line494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line495")'> 495:         values  = self._components.get_component(index)</pre>
<pre id='line495' class='code' style='background-color: #FFFF4d'>
  /* "Cython_shift_calculator.pyx":495
 *         cdef object values
 *         cdef target_distant_atom result
 *         values  = self._components.get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.target_atom_id = values[self._distance_atom_index_1]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_components, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_v_values = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line496")'> 496: </pre>
<pre id='line496' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line497")'> 497:         result.target_atom_id = values[self._distance_atom_index_1]</pre>
<pre id='line497' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":497
 *         values  = self._components.get_component(index)
 * 
 *         result.target_atom_id = values[self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.distant_atom_id  = values[self._distance_atom_index_2]
 *         return result
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_values, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result.target_atom_id = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line498")'> 498:         result.distant_atom_id  = values[self._distance_atom_index_2]</pre>
<pre id='line498' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":498
 * 
 *         result.target_atom_id = values[self._distance_atom_index_1]
 *         result.distant_atom_id  = values[self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_values, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result.distant_atom_id = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line499")'> 499:         return result</pre>
<pre id='line499' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":499
 *         result.target_atom_id = values[self._distance_atom_index_1]
 *         result.distant_atom_id  = values[self._distance_atom_index_2]
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_distance_shift_calculator._get_target_and_distant_atom_ids", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_values);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line500")'> 500: </pre>
<pre id='line500' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line501")'> 501:     @cython.profile(False)</pre>
<pre id='line501' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line502")'> 502:     cdef inline coefficient_exponent _get_coefficient_and_exponent(self, int index):</pre>
<pre id='line502' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":502
 * 
 *     @cython.profile(False)
 *     cdef inline coefficient_exponent _get_coefficient_and_exponent(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef object values
 *         cdef coefficient_exponent result
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_v_values = 0;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_result;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coefficient_and_exponent", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line503")'> 503:         cdef object values</pre>
<pre id='line503' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line504")'> 504:         cdef coefficient_exponent result</pre>
<pre id='line504' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line505")'> 505:         values = self._components.get_component(index)</pre>
<pre id='line505' class='code' style='background-color: #FFFF4d'>
  /* "Cython_shift_calculator.pyx":505
 *         cdef object values
 *         cdef coefficient_exponent result
 *         values = self._components.get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.coefficient = values[self._coefficient_index]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_components, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_v_values = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line506")'> 506: </pre>
<pre id='line506' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line507")'> 507:         result.coefficient = values[self._coefficient_index]</pre>
<pre id='line507' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":507
 *         values = self._components.get_component(index)
 * 
 *         result.coefficient = values[self._coefficient_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.exponent = values[self._exponent_index]
 * 
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_values, __pyx_v_self->_coefficient_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result.coefficient = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line508")'> 508:         result.exponent = values[self._exponent_index]</pre>
<pre id='line508' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":508
 * 
 *         result.coefficient = values[self._coefficient_index]
 *         result.exponent = values[self._exponent_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_values, __pyx_v_self->_exponent_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result.exponent = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line509")'> 509: </pre>
<pre id='line509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line510")'> 510:         return result</pre>
<pre id='line510' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":510
 *         result.exponent = values[self._exponent_index]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *     def __call__(self, object components, object results, object component_to_target):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_distance_shift_calculator._get_coefficient_and_exponent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_values);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_3__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_distance_shift_calculator_3__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  PyObject *__pyx_v_results = 0;
  PyObject *__pyx_v_component_to_target = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = values[1];
    __pyx_v_component_to_target = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_2__call__(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line511")'> 511: #</pre>
<pre id='line511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line512")'> 512:     def __call__(self, object components, object results, object component_to_target):</pre>
<pre id='line512' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":512
 *         return result
 * #
 *     def __call__(self, object components, object results, object component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef double start_time = 0.0
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_distance_shift_calculator_2__call__(struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, PyObject *__pyx_v_results, PyObject *__pyx_v_component_to_target) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  float __pyx_v_smoothing_factor;
  float __pyx_v_ratio;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_coef_exp;
  PyObject *__pyx_v_component = 0;
  int __pyx_v_target_atom_id;
  int __pyx_v_distant_atom_id;
  PyObject *__pyx_v_index = NULL;
  PyObject *__pyx_v_distance = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 512);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line513")'> 513:         self.set_simulation()</pre>
<pre id='line513' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":513
 * #
 *     def __call__(self, object components, object results, object component_to_target):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line514")'> 514:         cdef double start_time = 0.0</pre>
<pre id='line514' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":514
 *     def __call__(self, object components, object results, object component_to_target):
 *         self.set_simulation()
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line515")'> 515:         cdef double end_time = 0.0</pre>
<pre id='line515' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":515
 *         self.set_simulation()
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line516")'> 516: </pre>
<pre id='line516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line517")'> 517:         if self._verbose:</pre>
<pre id='line517' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":517
 *         cdef double end_time = 0.0
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time=time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line518")'> 518:             start_time=time()</pre>
<pre id='line518' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":518
 * 
 *         if self._verbose:
 *             start_time=time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line519")'> 519: </pre>
<pre id='line519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line520")'> 520:         self._set_components(components)</pre>
<pre id='line520' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":520
 *             start_time=time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float smoothing_factor = self._smoothing_factor
 *         cdef float ratio
 */
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_components(__pyx_v_self, __pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line521")'> 521:         cdef float smoothing_factor = self._smoothing_factor</pre>
<pre id='line521' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":521
 * 
 *         self._set_components(components)
 *         cdef float smoothing_factor = self._smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float ratio
 *         cdef float result
 */
  __pyx_v_smoothing_factor = __pyx_v_self->_smoothing_factor;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line522")'> 522:         cdef float ratio</pre>
<pre id='line522' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line523")'> 523:         cdef float result</pre>
<pre id='line523' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line524")'> 524:         cdef target_distant_atom atom_indices</pre>
<pre id='line524' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line525")'> 525:         cdef coefficient_exponent coef_exp</pre>
<pre id='line525' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line526")'> 526:         cdef object component</pre>
<pre id='line526' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line527")'> 527:         cdef int target_atom_id</pre>
<pre id='line527' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line528")'> 528:         cdef int distant_atom_id</pre>
<pre id='line528' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line529")'> 529: </pre>
<pre id='line529' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line530")'> 530: </pre>
<pre id='line530' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line531")'> 531: </pre>
<pre id='line531' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line532")'> 532:         if self._verbose:</pre>
<pre id='line532' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":532
 * 
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line533")'> 533:             start_time = time()</pre>
<pre id='line533' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":533
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for index in range(len(components)):
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line534")'> 534: </pre>
<pre id='line534' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line535")'> 535:         for index in range(len(components)):</pre>
<pre id='line535' class='code' style='background-color: #FFFF1f'>
  /* "Cython_shift_calculator.pyx":535
 *             start_time = time()
 * 
 *         for index in range(len(components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             component = components[index]
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
    __pyx_v_index = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line536")'> 536: </pre>
<pre id='line536' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line537")'> 537:             component = components[index]</pre>
<pre id='line537' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":537
 *         for index in range(len(components)):
 * 
 *             component = components[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_index);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line538")'> 538: </pre>
<pre id='line538' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line539")'> 539: </pre>
<pre id='line539' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line540")'> 540:             target_atom_id = component[self._distance_atom_index_1]</pre>
<pre id='line540' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":540
 * 
 * 
 *             target_atom_id = component[self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distant_atom_id  = component[self._distance_atom_index_2]
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_target_atom_id = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line541")'> 541:             distant_atom_id  = component[self._distance_atom_index_2]</pre>
<pre id='line541' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":541
 * 
 *             target_atom_id = component[self._distance_atom_index_1]
 *             distant_atom_id  = component[self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_distant_atom_id = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line542")'> 542: </pre>
<pre id='line542' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line543")'> 543: </pre>
<pre id='line543' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line544")'> 544:             coef_exp = self._get_coefficient_and_exponent(index)</pre>
<pre id='line544' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":544
 * 
 * 
 *             coef_exp = self._get_coefficient_and_exponent(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_index);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_coef_exp = __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(__pyx_v_self, __pyx_t_6);
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line545")'> 545:             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)</pre>
<pre id='line545' class='code' style='background-color: #FFFF73'>
    /* "Cython_shift_calculator.pyx":545
 * 
 *             coef_exp = self._get_coefficient_and_exponent(index)
 *             distance =calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_distant_atom_id);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_target_atom_id, __pyx_t_1));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_distance);
    __pyx_v_distance = __pyx_t_7;
    __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line546")'> 546:     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)</pre>
<pre id='line546' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line547")'> 547: </pre>
<pre id='line547' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line548")'> 548:             if self._smoothed:</pre>
<pre id='line548' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":548
 *     #        Atom_utils._calculate_distance(target_atom_index, sidechain_atom_index)
 * 
 *             if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8
 */
    if (__pyx_v_self->_smoothed) {
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line549")'> 549:                 ratio = distance / self._cutoff</pre>
<pre id='line549' class='code' style='background-color: #FFFF4f'>
      /* "Cython_shift_calculator.pyx":549
 * 
 *             if self._smoothed:
 *                 ratio = distance / self._cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 smoothing_factor = 1.0 - ratio ** 8
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 */
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_self->_cutoff);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_v_distance, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_8 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_ratio = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line550")'> 550:                 smoothing_factor = 1.0 - ratio ** 8</pre>
<pre id='line550' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":550
 *             if self._smoothed:
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 */
      __pyx_v_smoothing_factor = (1.0 - powf(__pyx_v_ratio, 8.0));
      goto __pyx_L7;
    }
    __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line551")'> 551:             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient</pre>
<pre id='line551' class='code' style='background-color: #FFFF33'>
    /* "Cython_shift_calculator.pyx":551
 *                 ratio = distance / self._cutoff
 *                 smoothing_factor = 1.0 - ratio ** 8
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component_to_target, __pyx_v_index);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_results, __pyx_t_1);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_distance);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_smoothing_factor * pow(__pyx_t_3, __pyx_v_coef_exp.exponent)) * __pyx_v_coef_exp.coefficient));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_7, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_results, __pyx_t_1, __pyx_t_10) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line552")'> 552: </pre>
<pre id='line552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line553")'> 553:         if self._verbose:</pre>
<pre id='line553' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":553
 *             results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line554")'> 554:             end_time = time()</pre>
<pre id='line554' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":554
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line555")'> 555:             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"</pre>
<pre id='line555' class='code' style='background-color: #FFFF1c'>
    /* "Cython_shift_calculator.pyx":555
 *         if self._verbose:
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_17));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_17));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_17));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 4, ((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_10 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_2), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_distance);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    values[0] = ((PyObject*)__pyx_kp_s_14);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 563; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line556")'> 556: </pre>
<pre id='line556' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line557")'> 557: </pre>
<pre id='line557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line558")'> 558: </pre>
<pre id='line558' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line559")'> 559: </pre>
<pre id='line559' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line560")'> 560: cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):</pre>
<pre id='line560' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":560
 * 
 * 
 * cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _components
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  PyObject *_components;
};


/* "Cython_shift_calculator.pyx":560
 * 
 * 
 * cdef class Fast_dihedral_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _components
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  PyObject *(*_set_components)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, PyObject *);
  PyObject *(*_get_component)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_ids (*_get_dihedral_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  float (*_get_coefficient)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_parameters (*_get_parameters)(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_dihedral_shift_calculator;
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_component(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line561")'> 561:     cdef object _components</pre>
<pre id='line561' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line562")'> 562: </pre>
<pre id='line562' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line563")'> 563:     def __init__(self, str name = "not set"):</pre>
<pre id='line563' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":563
 *     cdef object _components
 * 
 *     def __init__(self, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self,name)
 *         self._components = None
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 563);
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line564")'> 564:         Base_shift_calculator.__init__(self,name)</pre>
<pre id='line564' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":564
 * 
 *     def __init__(self, str name = "not set"):
 *         Base_shift_calculator.__init__(self,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = None
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line565")'> 565:         self._components = None</pre>
<pre id='line565' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":565
 *     def __init__(self, str name = "not set"):
 *         Base_shift_calculator.__init__(self,name)
 *         self._components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _set_components(self, object components):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = Py_None;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line566")'> 566: </pre>
<pre id='line566' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line567")'> 567:     cdef _set_components(self, object components):</pre>
<pre id='line567' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":567
 *         self._components = None
 * 
 *     cdef _set_components(self, object components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = components
 * 
 */

static PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__set_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_components", __pyx_f[0], 567);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line568")'> 568:         self._components = components</pre>
<pre id='line568' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":568
 * 
 *     cdef _set_components(self, object components):
 *         self._components = components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline _get_component(self,int index):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = __pyx_v_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line569")'> 569: </pre>
<pre id='line569' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line570")'> 570:     cdef inline _get_component(self,int index):</pre>
<pre id='line570' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":570
 *         self._components = components
 * 
 *     cdef inline _get_component(self,int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._components[index]
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_component(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_component", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_get_component", __pyx_f[0], 570);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line571")'> 571:         return self._components[index]</pre>
<pre id='line571' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":571
 * 
 *     cdef inline _get_component(self,int index):
 *         return self._components[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_self->_components, __pyx_v_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator._get_component", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line572")'> 572: </pre>
<pre id='line572' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line573")'> 573:     @cython.profile(False)</pre>
<pre id='line573' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line574")'> 574:     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):</pre>
<pre id='line574' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":574
 * 
 *     @cython.profile(False)
 *     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_result;
  PyObject *__pyx_v_component = NULL;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_dihedral_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line575")'> 575:         cdef dihedral_ids result</pre>
<pre id='line575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line576")'> 576: </pre>
<pre id='line576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line577")'> 577:         component = self._get_component(index)</pre>
<pre id='line577' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":577
 *         cdef dihedral_ids result
 * 
 *         component = self._get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.atom_id_1= component[1]
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_component(__pyx_v_self, __pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 577; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_component = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line578")'> 578: </pre>
<pre id='line578' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line579")'> 579:         result.atom_id_1= component[1]</pre>
<pre id='line579' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":579
 *         component = self._get_component(index)
 * 
 *         result.atom_id_1= component[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_2= component[2]
 *         result.atom_id_3= component[3]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 579; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 579; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_1 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line580")'> 580:         result.atom_id_2= component[2]</pre>
<pre id='line580' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":580
 * 
 *         result.atom_id_1= component[1]
 *         result.atom_id_2= component[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_3= component[3]
 *         result.atom_id_4= component[4]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_2 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line581")'> 581:         result.atom_id_3= component[3]</pre>
<pre id='line581' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":581
 *         result.atom_id_1= component[1]
 *         result.atom_id_2= component[2]
 *         result.atom_id_3= component[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_4= component[4]
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 3, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 581; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 581; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_3 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line582")'> 582:         result.atom_id_4= component[4]</pre>
<pre id='line582' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":582
 *         result.atom_id_2= component[2]
 *         result.atom_id_3= component[3]
 *         result.atom_id_4= component[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 4, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 582; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 582; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_4 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line583")'> 583: </pre>
<pre id='line583' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line584")'> 584:         return result</pre>
<pre id='line584' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":584
 *         result.atom_id_4= component[4]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_dihedral_shift_calculator._get_dihedral_atom_ids", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line585")'> 585: </pre>
<pre id='line585' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line586")'> 586:     @cython.profile(False)</pre>
<pre id='line586' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line587")'> 587:     cdef inline float _get_coefficient(self, int index):</pre>
<pre id='line587' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":587
 * 
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component = self._get_component(index)
 *         coefficient = component[5]
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_v_coefficient = NULL;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coefficient", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line588")'> 588:         component = self._get_component(index)</pre>
<pre id='line588' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":588
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):
 *         component = self._get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         coefficient = component[5]
 *         return coefficient
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_component(__pyx_v_self, __pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_component = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line589")'> 589:         coefficient = component[5]</pre>
<pre id='line589' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":589
 *     cdef inline float _get_coefficient(self, int index):
 *         component = self._get_component(index)
 *         coefficient = component[5]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return coefficient
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 5, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_coefficient = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line590")'> 590:         return coefficient</pre>
<pre id='line590' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":590
 *         component = self._get_component(index)
 *         coefficient = component[5]
 *         return coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_coefficient);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 590; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_dihedral_shift_calculator._get_coefficient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coefficient);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line591")'> 591: </pre>
<pre id='line591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line592")'> 592:     @cython.profile(False)</pre>
<pre id='line592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line593")'> 593:     cdef inline dihedral_parameters _get_parameters(self, int index):</pre>
<pre id='line593' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":593
 * 
 *     @cython.profile(False)
 *     cdef inline dihedral_parameters _get_parameters(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component = self._get_component(index)
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_v_component = NULL;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_result;
  PyObject *__pyx_v_parameters = NULL;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_parameters", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line594")'> 594:         component = self._get_component(index)</pre>
<pre id='line594' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":594
 *     @cython.profile(False)
 *     cdef inline dihedral_parameters _get_parameters(self, int index):
 *         component = self._get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_parameters result
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_component(__pyx_v_self, __pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_component = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line595")'> 595: </pre>
<pre id='line595' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line596")'> 596:         cdef dihedral_parameters result</pre>
<pre id='line596' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line597")'> 597: </pre>
<pre id='line597' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line598")'> 598:         parameters = component[6:11]</pre>
<pre id='line598' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":598
 *         cdef dihedral_parameters result
 * 
 *         parameters = component[6:11]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.param_0 =  parameters[0]
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_component, 6, 11);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_parameters = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line599")'> 599: </pre>
<pre id='line599' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line600")'> 600:         result.param_0 =  parameters[0]</pre>
<pre id='line600' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":600
 *         parameters = component[6:11]
 * 
 *         result.param_0 =  parameters[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_1 =  parameters[3]
 *         result.param_2 =  parameters[1]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 600; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 600; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_0 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line601")'> 601:         result.param_1 =  parameters[3]</pre>
<pre id='line601' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":601
 * 
 *         result.param_0 =  parameters[0]
 *         result.param_1 =  parameters[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_2 =  parameters[1]
 *         result.param_3 =  parameters[4]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 3, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_1 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line602")'> 602:         result.param_2 =  parameters[1]</pre>
<pre id='line602' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":602
 *         result.param_0 =  parameters[0]
 *         result.param_1 =  parameters[3]
 *         result.param_2 =  parameters[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_3 =  parameters[4]
 *         result.param_4 =  parameters[2]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_2 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line603")'> 603:         result.param_3 =  parameters[4]</pre>
<pre id='line603' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":603
 *         result.param_1 =  parameters[3]
 *         result.param_2 =  parameters[1]
 *         result.param_3 =  parameters[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_4 =  parameters[2]
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 4, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_3 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line604")'> 604:         result.param_4 =  parameters[2]</pre>
<pre id='line604' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":604
 *         result.param_2 =  parameters[1]
 *         result.param_3 =  parameters[4]
 *         result.param_4 =  parameters[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_4 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line605")'> 605: </pre>
<pre id='line605' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line606")'> 606: </pre>
<pre id='line606' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2c' onclick='toggleDiv("line607")'> 607:         return result</pre>
<pre id='line607' class='code' style='background-color: #FFFF2c'>
  /* "Cython_shift_calculator.pyx":607
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __call__(self, object components, object results, object component_to_target):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_dihedral_shift_calculator._get_parameters", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_parameters);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_3__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_shift_calculator_3__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  PyObject *__pyx_v_results = 0;
  PyObject *__pyx_v_component_to_target = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = values[1];
    __pyx_v_component_to_target = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 609; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_2__call__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line608")'> 608: </pre>
<pre id='line608' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line609")'> 609:     def __call__(self, object components, object results, object component_to_target):</pre>
<pre id='line609' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":609
 *         return result
 * 
 *     def __call__(self, object components, object results, object component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef float angle
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_shift_calculator_2__call__(struct __pyx_obj_17shift_calculators_Fast_dihedral_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, PyObject *__pyx_v_results, PyObject *__pyx_v_component_to_target) {
  float __pyx_v_angle;
  float __pyx_v_angle_term;
  float __pyx_v_shift;
  float __pyx_v_coefficient;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_parameters;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_index = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 609);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line610")'> 610:         self.set_simulation()</pre>
<pre id='line610' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":610
 * 
 *     def __call__(self, object components, object results, object component_to_target):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float angle
 *         cdef float angle_term
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line611")'> 611:         cdef float angle</pre>
<pre id='line611' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line612")'> 612:         cdef float angle_term</pre>
<pre id='line612' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line613")'> 613:         cdef float shift</pre>
<pre id='line613' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line614")'> 614:         cdef float coefficient</pre>
<pre id='line614' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line615")'> 615:         cdef dihedral_parameters parameters</pre>
<pre id='line615' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line616")'> 616:         cdef dihedral_ids dihedral_atom_ids</pre>
<pre id='line616' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line617")'> 617:         cdef double start_time = 0.0</pre>
<pre id='line617' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":617
 *         cdef dihedral_parameters parameters
 *         cdef dihedral_ids dihedral_atom_ids
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line618")'> 618:         cdef double end_time = 0.0</pre>
<pre id='line618' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":618
 *         cdef dihedral_ids dihedral_atom_ids
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line619")'> 619: </pre>
<pre id='line619' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line620")'> 620: </pre>
<pre id='line620' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line621")'> 621: </pre>
<pre id='line621' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line622")'> 622:         if self._verbose:</pre>
<pre id='line622' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":622
 * 
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line623")'> 623:             start_time = time()</pre>
<pre id='line623' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":623
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line624")'> 624: </pre>
<pre id='line624' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line625")'> 625:         self._set_components(components)</pre>
<pre id='line625' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":625
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for index in range(len(components)):
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)
 */
  __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_components(__pyx_v_self, __pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line626")'> 626:         for index in range(len(components)):</pre>
<pre id='line626' class='code' style='background-color: #FFFF1f'>
  /* "Cython_shift_calculator.pyx":626
 * 
 *         self._set_components(components)
 *         for index in range(len(components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
    __pyx_v_index = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line627")'> 627:             dihedral_atom_ids = self._get_dihedral_atom_ids(index)</pre>
<pre id='line627' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":627
 *         self._set_components(components)
 *         for index in range(len(components)):
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             coefficient = self._get_coefficient(index)
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_index);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_dihedral_atom_ids = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_t_6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line628")'> 628: </pre>
<pre id='line628' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line629")'> 629:             coefficient = self._get_coefficient(index)</pre>
<pre id='line629' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":629
 *             dihedral_atom_ids = self._get_dihedral_atom_ids(index)
 * 
 *             coefficient = self._get_coefficient(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             parameters = self._get_parameters(index)
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_index);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 629; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_coefficient = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_coefficient(__pyx_v_self, __pyx_t_6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line630")'> 630: </pre>
<pre id='line630' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line631")'> 631:             parameters = self._get_parameters(index)</pre>
<pre id='line631' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":631
 *             coefficient = self._get_coefficient(index)
 * 
 *             parameters = self._get_parameters(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_index);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_parameters = __pyx_f_17shift_calculators_30Fast_dihedral_shift_calculator__get_parameters(__pyx_v_self, __pyx_t_6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line632")'> 632: </pre>
<pre id='line632' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line633")'> 633:             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)</pre>
<pre id='line633' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":633
 *             parameters = self._get_parameters(index)
 * 
 *             angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \
 */
    __pyx_v_angle = __pyx_f_17shift_calculators_calc_dihedral_angle_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_dihedral_atom_ids);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line634")'> 634: </pre>
<pre id='line634' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line635")'> 635:             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \</pre>
<pre id='line635' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line636")'> 636:                          parameters.param_2 * cos(angle +  parameters.param_3) +      \</pre>
<pre id='line636' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line637")'> 637:                          parameters.param_4</pre>
<pre id='line637' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":637
 *             angle_term = parameters.param_0 * cos(3.0 * angle + parameters.param_1) + \
 *                          parameters.param_2 * cos(angle +  parameters.param_3) +      \
 *                          parameters.param_4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             shift = coefficient * angle_term
 * 
 */
    __pyx_v_angle_term = (((__pyx_v_parameters.param_0 * cos(((3.0 * __pyx_v_angle) + __pyx_v_parameters.param_1))) + (__pyx_v_parameters.param_2 * cos((__pyx_v_angle + __pyx_v_parameters.param_3)))) + __pyx_v_parameters.param_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line638")'> 638:             shift = coefficient * angle_term</pre>
<pre id='line638' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":638
 *                          parameters.param_2 * cos(angle +  parameters.param_3) +      \
 *                          parameters.param_4
 *             shift = coefficient * angle_term             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             results[component_to_target[index]] += shift
 */
    __pyx_v_shift = (__pyx_v_coefficient * __pyx_v_angle_term);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line639")'> 639: </pre>
<pre id='line639' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line640")'> 640:             results[component_to_target[index]] += shift</pre>
<pre id='line640' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":640
 *             shift = coefficient * angle_term
 * 
 *             results[component_to_target[index]] += shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component_to_target, __pyx_v_index);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_results, __pyx_t_2);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_shift);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_9 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_7, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_results, __pyx_t_2, __pyx_t_9) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line641")'> 641: </pre>
<pre id='line641' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line642")'> 642:         if self._verbose:</pre>
<pre id='line642' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":642
 *             results[component_to_target[index]] += shift
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line643")'> 643:             end_time = time()</pre>
<pre id='line643' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":643
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line644")'> 644:             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line644' class='code' style='background-color: #FFFF1e'>
    /* "Cython_shift_calculator.pyx":644
 *         if self._verbose:
 *             end_time = time()
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_9 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_19));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_19));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_19));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_9));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_2 = 0;
    __pyx_t_9 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    values[0] = ((PyObject*)__pyx_kp_s_14);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = ((PyObject*)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line645")'> 645: </pre>
<pre id='line645' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line646")'> 646: cdef class Fast_ring_shift_calculator(Base_shift_calculator):</pre>
<pre id='line646' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":646
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _components
 *     cdef object _coef_components
 */
struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator {
  struct __pyx_obj_17shift_calculators_Base_shift_calculator __pyx_base;
  PyObject *_components;
  PyObject *_coef_components;
  PyObject *_ring_components;
  PyObject *_centre_cache;
  PyObject *_normal_cache;
};


/* "Cython_shift_calculator.pyx":646
 *             print '   dihedral shift components ',len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_ring_shift_calculator(Base_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _components
 *     cdef object _coef_components
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_shift_calculator __pyx_base;
  PyObject *(*_get_coef_components)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
  Vec3 (*_get_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
  Vec3 (*_get_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int);
  float (*_calc_sub_component_shift)(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *, int, int, float, int __pyx_skip_dispatch);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_shift_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line647")'> 647:     cdef object _components</pre>
<pre id='line647' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line648")'> 648:     cdef object _coef_components</pre>
<pre id='line648' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line649")'> 649:     cdef object _ring_components</pre>
<pre id='line649' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line650")'> 650:     cdef object _centre_cache</pre>
<pre id='line650' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line651")'> 651:     cdef object _normal_cache</pre>
<pre id='line651' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line652")'> 652: </pre>
<pre id='line652' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line653")'> 653: </pre>
<pre id='line653' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line654")'> 654:     def __init__(self, str name = "not set"):</pre>
<pre id='line654' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":654
 * 
 * 
 *     def __init__(self, str name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_shift_calculator.__init__(self,name)
 *         self._components = None
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 654);
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line655")'> 655:         Base_shift_calculator.__init__(self,name)</pre>
<pre id='line655' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":655
 * 
 *     def __init__(self, str name = "not set"):
 *         Base_shift_calculator.__init__(self,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = None
 *         self._coef_components = None
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_shift_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line656")'> 656:         self._components = None</pre>
<pre id='line656' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":656
 *     def __init__(self, str name = "not set"):
 *         Base_shift_calculator.__init__(self,name)
 *         self._components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coef_components = None
 *         self._ring_components = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line657")'> 657:         self._coef_components = None</pre>
<pre id='line657' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":657
 *         Base_shift_calculator.__init__(self,name)
 *         self._components = None
 *         self._coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._ring_components = None
 *         self._centre_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_coef_components);
  __pyx_v_self->_coef_components = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line658")'> 658:         self._ring_components = None</pre>
<pre id='line658' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":658
 *         self._components = None
 *         self._coef_components = None
 *         self._ring_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = None
 *         self._normal_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_ring_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_ring_components);
  __pyx_v_self->_ring_components = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line659")'> 659:         self._centre_cache = None</pre>
<pre id='line659' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":659
 *         self._coef_components = None
 *         self._ring_components = None
 *         self._centre_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = None
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_centre_cache);
  __pyx_v_self->_centre_cache = Py_None;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line660")'> 660:         self._normal_cache = None</pre>
<pre id='line660' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":660
 *         self._ring_components = None
 *         self._centre_cache = None
 *         self._normal_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_components(self,components):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_normal_cache);
  __pyx_v_self->_normal_cache = Py_None;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_3_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_3_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_2_set_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line661")'> 661: </pre>
<pre id='line661' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line662")'> 662:     def _set_components(self,components):</pre>
<pre id='line662' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":662
 *         self._normal_cache = None
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = components
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_2_set_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_components", __pyx_f[0], 662);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line663")'> 663:         self._components = components</pre>
<pre id='line663' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":663
 * 
 *     def _set_components(self,components):
 *         self._components = components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_coef_components(self,coef_components):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = __pyx_v_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_5_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_5_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_4_set_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_coef_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line664")'> 664: </pre>
<pre id='line664' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line665")'> 665:     def _set_coef_components(self,coef_components):</pre>
<pre id='line665' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":665
 *         self._components = components
 * 
 *     def _set_coef_components(self,coef_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coef_components =  coef_components
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_4_set_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_coef_components", __pyx_f[0], 665);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line666")'> 666:         self._coef_components =  coef_components</pre>
<pre id='line666' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":666
 * 
 *     def _set_coef_components(self,coef_components):
 *         self._coef_components =  coef_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_ring_components(self,coef_components):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_coef_components);
  __pyx_v_self->_coef_components = __pyx_v_coef_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_7_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_7_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_6_set_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_coef_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line667")'> 667: </pre>
<pre id='line667' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line668")'> 668:     def _set_ring_components(self,coef_components):</pre>
<pre id='line668' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":668
 *         self._coef_components =  coef_components
 * 
 *     def _set_ring_components(self,coef_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._ring_components =  coef_components
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_6_set_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_ring_components", __pyx_f[0], 668);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line669")'> 669:         self._ring_components =  coef_components</pre>
<pre id='line669' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":669
 * 
 *     def _set_ring_components(self,coef_components):
 *         self._ring_components =  coef_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_normal_cache(self,normals):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_ring_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_ring_components);
  __pyx_v_self->_ring_components = __pyx_v_coef_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_9_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_9_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_8_set_normal_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_normals));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line670")'> 670: </pre>
<pre id='line670' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line671")'> 671:     def _set_normal_cache(self,normals):</pre>
<pre id='line671' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":671
 *         self._ring_components =  coef_components
 * 
 *     def _set_normal_cache(self,normals):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = normals
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_8_set_normal_cache(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_normal_cache", __pyx_f[0], 671);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line672")'> 672:         self._normal_cache = normals</pre>
<pre id='line672' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":672
 * 
 *     def _set_normal_cache(self,normals):
 *         self._normal_cache = normals             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_centre_cache(self,centres):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_normal_cache);
  __pyx_v_self->_normal_cache = __pyx_v_normals;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_11_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_11_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_10_set_centre_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_centres));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line673")'> 673: </pre>
<pre id='line673' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line674")'> 674:     def _set_centre_cache(self,centres):</pre>
<pre id='line674' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":674
 *         self._normal_cache = normals
 * 
 *     def _set_centre_cache(self,centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = centres
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_10_set_centre_cache(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_centre_cache", __pyx_f[0], 674);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line675")'> 675:         self._centre_cache = centres</pre>
<pre id='line675' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":675
 * 
 *     def _set_centre_cache(self,centres):
 *         self._centre_cache = centres             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_centre_cache);
  __pyx_v_self->_centre_cache = __pyx_v_centres;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line676")'> 676: </pre>
<pre id='line676' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line677")'> 677:     @cython.profile(False)</pre>
<pre id='line677' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line678")'> 678:     cdef _get_coef_components(self, int atom_type_id):</pre>
<pre id='line678' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":678
 * 
 *     @cython.profile(False)
 *     cdef _get_coef_components(self, int atom_type_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._coef_components.get_components_for_atom_id(atom_type_id)
 * 
 */

static PyObject *__pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_atom_type_id) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line679")'> 679:         return self._coef_components.get_components_for_atom_id(atom_type_id)</pre>
<pre id='line679' class='code' style='background-color: #FFFF3e'>
  /* "Cython_shift_calculator.pyx":679
 *     @cython.profile(False)
 *     cdef _get_coef_components(self, int atom_type_id):
 *         return self._coef_components.get_components_for_atom_id(atom_type_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_coef_components, __pyx_n_s_20);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_atom_type_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._get_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line680")'> 680: </pre>
<pre id='line680' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line681")'> 681:     @cython.profile(False)</pre>
<pre id='line681' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line682")'> 682:     cdef Vec3 _get_ring_normal(self, int ring_id):</pre>
<pre id='line682' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":682
 * 
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_normal(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()
 */

static Vec3 __pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_container = 0;
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_normal", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line683")'> 683:         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]</pre>
<pre id='line683' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":683
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_normal(self, int ring_id):
 *         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  container.get_vec3()
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_normal_cache, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_ring_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_17shift_calculators_Vec3_container)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_container = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line684")'> 684:         return  container.get_vec3()</pre>
<pre id='line684' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":684
 *     cdef Vec3 _get_ring_normal(self, int ring_id):
 *         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_container *)__pyx_v_container->__pyx_vtab)->get_vec3(__pyx_v_container);
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_shift_calculator._get_ring_normal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_container);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line685")'> 685: </pre>
<pre id='line685' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line686")'> 686:     @cython.profile(False)</pre>
<pre id='line686' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line687")'> 687:     cdef Vec3 _get_ring_centre(self, int ring_id):</pre>
<pre id='line687' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":687
 * 
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_centre(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3_container container =  self._centre_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()
 */

static Vec3 __pyx_f_17shift_calculators_26Fast_ring_shift_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_container = 0;
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_centre", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line688")'> 688:         cdef Vec3_container container =  self._centre_cache.get_component(ring_id)[1]</pre>
<pre id='line688' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":688
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_centre(self, int ring_id):
 *         cdef Vec3_container container =  self._centre_cache.get_component(ring_id)[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  container.get_vec3()
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_centre_cache, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_ring_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_17shift_calculators_Vec3_container)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_container = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line689")'> 689:         return  container.get_vec3()</pre>
<pre id='line689' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":689
 *     cdef Vec3 _get_ring_centre(self, int ring_id):
 *         cdef Vec3_container container =  self._centre_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):
 */
  __pyx_r = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_container *)__pyx_v_container->__pyx_vtab)->get_vec3(__pyx_v_container);
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_shift_calculator._get_ring_centre", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_container);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line690")'> 690: </pre>
<pre id='line690' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line691")'> 691:     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):</pre>
<pre id='line691' class='code' style='background-color: #FFFF16'>
/* "Cython_shift_calculator.pyx":691
 *         return  container.get_vec3()
 * 
 *     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_atom_pos
 */

static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_calc_sub_component_shift(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static float __pyx_f_17shift_calculators_26Fast_ring_shift_calculator__calc_sub_component_shift(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id, float __pyx_v_coefficient, int __pyx_skip_dispatch) {
  Vec3 __pyx_v_target_atom_pos;
  Vec3 __pyx_v_ring_centre;
  Vec3 __pyx_v_ring_normal;
  Vec3 __pyx_v_direction_vector;
  float __pyx_v_distance;
  float __pyx_v_distance3;
  float __pyx_v_angle;
  float __pyx_v_contrib;
  PyObject *__pyx_v_length_normal = NULL;
  float __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_sub_component_shift", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calc_sub_component_shift", __pyx_f[0], 691);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_21);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_calc_sub_component_shift)) {
      __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_target_atom_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_ring_id);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_coefficient);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_3);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_4);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_4 = 0;
      __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
      __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_6 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_6;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

/* "Cython_shift_calculator.pyx":691
 *         return  container.get_vec3()
 * 
 *     cpdef float  _calc_sub_component_shift(self, int target_atom_id, int ring_id, float coefficient):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_atom_pos
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_12_calc_sub_component_shift(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id, float __pyx_v_coefficient) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_sub_component_shift", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calc_sub_component_shift", __pyx_f[0], 691);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calc_sub_component_shift(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_coefficient, 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._calc_sub_component_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_15__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_15__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  PyObject *__pyx_v_results = 0;
  PyObject *__pyx_v_component_to_target = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = values[1];
    __pyx_v_component_to_target = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_14__call__(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line692")'> 692: </pre>
<pre id='line692' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line693")'> 693:         cdef Vec3 target_atom_pos</pre>
<pre id='line693' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line694")'> 694:         cdef Vec3 ring_centre</pre>
<pre id='line694' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line695")'> 695:         cdef Vec3 ring_normal</pre>
<pre id='line695' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line696")'> 696:         cdef float lenght_normal</pre>
<pre id='line696' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line697")'> 697:         cdef Vec3 direction_vector</pre>
<pre id='line697' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line698")'> 698:         cdef float distance, distance3, angle, contrib</pre>
<pre id='line698' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line699")'> 699: </pre>
<pre id='line699' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line700")'> 700:         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)</pre>
<pre id='line700' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":700
 *         cdef float distance, distance3, angle, contrib
 * 
 *         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         ring_centre = self._get_ring_centre(ring_id)
 * 
 */
  __pyx_v_target_atom_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line701")'> 701:         ring_centre = self._get_ring_centre(ring_id)</pre>
<pre id='line701' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":701
 * 
 *         target_atom_pos =  self._simulation[0].atomPos(target_atom_id)
 *         ring_centre = self._get_ring_centre(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #TODO add this to a cache the same way that camshift does
 */
  __pyx_v_ring_centre = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_get_ring_centre(__pyx_v_self, __pyx_v_ring_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line702")'> 702: </pre>
<pre id='line702' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line703")'> 703:         #TODO add this to a cache the same way that camshift does</pre>
<pre id='line703' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line704")'> 704:         ring_normal = self._get_ring_normal(ring_id)</pre>
<pre id='line704' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":704
 * 
 *         #TODO add this to a cache the same way that camshift does
 *         ring_normal = self._get_ring_normal(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         length_normal = norm(ring_normal)
 * 
 */
  __pyx_v_ring_normal = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_get_ring_normal(__pyx_v_self, __pyx_v_ring_id);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line705")'> 705:         length_normal = norm(ring_normal)</pre>
<pre id='line705' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":705
 *         #TODO add this to a cache the same way that camshift does
 *         ring_normal = self._get_ring_normal(ring_id)
 *         length_normal = norm(ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #correct name?
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(norm(__pyx_v_ring_normal));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_length_normal = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line706")'> 706: </pre>
<pre id='line706' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line707")'> 707:         #correct name?</pre>
<pre id='line707' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line708")'> 708:         direction_vector = target_atom_pos - ring_centre</pre>
<pre id='line708' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":708
 * 
 *         #correct name?
 *         direction_vector = target_atom_pos - ring_centre             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         distance = norm(direction_vector)
 */
  __pyx_v_direction_vector = (__pyx_v_target_atom_pos - __pyx_v_ring_centre);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line709")'> 709: </pre>
<pre id='line709' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line710")'> 710:         distance = norm(direction_vector)</pre>
<pre id='line710' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":710
 *         direction_vector = target_atom_pos - ring_centre
 * 
 *         distance = norm(direction_vector)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distance3 = distance ** 3
 * 
 */
  __pyx_v_distance = norm(__pyx_v_direction_vector);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line711")'> 711:         distance3 = distance ** 3</pre>
<pre id='line711' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":711
 * 
 *         distance = norm(direction_vector)
 *         distance3 = distance ** 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)
 */
  __pyx_v_distance3 = powf(__pyx_v_distance, 3.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line712")'> 712: </pre>
<pre id='line712' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line713")'> 713:         angle = dot(direction_vector, ring_normal) / (distance * length_normal)</pre>
<pre id='line713' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":713
 *         distance3 = distance ** 3
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(dot(__pyx_v_direction_vector, __pyx_v_ring_normal));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_distance);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, __pyx_v_length_normal);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_6 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_angle = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line714")'> 714:         contrib = (1.0 - 3.0 * angle ** 2) / distance3</pre>
<pre id='line714' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":714
 * 
 *         angle = dot(direction_vector, ring_normal) / (distance * length_normal)
 *         contrib = (1.0 - 3.0 * angle ** 2) / distance3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        print Atom_utils._get_atom_info_from_index(target_atom_id), ring_id, angle, distance3, coefficient, contrib * coefficient, angle
 */
  __pyx_t_7 = (1.0 - (3.0 * powf(__pyx_v_angle, 2.0)));
  if (unlikely(__pyx_v_distance3 == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_contrib = (__pyx_t_7 / __pyx_v_distance3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line715")'> 715: </pre>
<pre id='line715' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line716")'> 716: #        print Atom_utils._get_atom_info_from_index(target_atom_id), ring_id, angle, distance3, coefficient, contrib * coefficient, angle</pre>
<pre id='line716' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1b' onclick='toggleDiv("line717")'> 717:         return contrib * coefficient</pre>
<pre id='line717' class='code' style='background-color: #FFFF1b'>
  /* "Cython_shift_calculator.pyx":717
 * 
 * #        print Atom_utils._get_atom_info_from_index(target_atom_id), ring_id, angle, distance3, coefficient, contrib * coefficient, angle
 *         return contrib * coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = (__pyx_v_contrib * __pyx_v_coefficient);
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_shift_calculator._calc_sub_component_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_length_normal);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_calc_sub_component_shift(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_shift_calculator_13_calc_sub_component_shift(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  int __pyx_v_ring_id;
  float __pyx_v_coefficient;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__ring_id,&__pyx_n_s__coefficient,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_sub_component_shift (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_sub_component_shift", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coefficient);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_sub_component_shift", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_sub_component_shift") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_coefficient = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_coefficient == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_sub_component_shift", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 691; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator._calc_sub_component_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_12_calc_sub_component_shift(((struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_coefficient);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line718")'> 718: </pre>
<pre id='line718' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line719")'> 719: </pre>
<pre id='line719' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line720")'> 720:     def __call__(self, object components, object results, object component_to_target):</pre>
<pre id='line720' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":720
 * 
 * 
 *     def __call__(self, object components, object results, object component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef int target_atom_id
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_shift_calculator_14__call__(struct __pyx_obj_17shift_calculators_Fast_ring_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, PyObject *__pyx_v_results, PyObject *__pyx_v_component_to_target) {
  int __pyx_v_target_atom_id;
  int __pyx_v_ring_id;
  float __pyx_v_coefficient;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_index = NULL;
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_v_atom_type_id = NULL;
  double __pyx_v_shift;
  PyObject *__pyx_v_coef_component = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 720);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line721")'> 721:         self.set_simulation()</pre>
<pre id='line721' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":721
 * 
 *     def __call__(self, object components, object results, object component_to_target):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int target_atom_id
 *         cdef int ring_id
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line722")'> 722:         cdef int target_atom_id</pre>
<pre id='line722' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line723")'> 723:         cdef int ring_id</pre>
<pre id='line723' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line724")'> 724:         cdef float coefficient</pre>
<pre id='line724' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line725")'> 725:         cdef double start_time = 0.0</pre>
<pre id='line725' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":725
 *         cdef int ring_id
 *         cdef float coefficient
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 * 
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line726")'> 726:         cdef double end_time =0.0</pre>
<pre id='line726' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":726
 *         cdef float coefficient
 *         cdef double start_time = 0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line727")'> 727: </pre>
<pre id='line727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line728")'> 728:         if self._verbose:</pre>
<pre id='line728' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":728
 *         cdef double end_time =0.0
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line729")'> 729:             start_time = time()</pre>
<pre id='line729' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":729
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line730")'> 730: </pre>
<pre id='line730' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line731")'> 731: </pre>
<pre id='line731' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line732")'> 732: </pre>
<pre id='line732' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line733")'> 733:         self._set_components(components)</pre>
<pre id='line733' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":733
 * 
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for index in range(len(components)):
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line734")'> 734: </pre>
<pre id='line734' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line735")'> 735:         for index in range(len(components)):</pre>
<pre id='line735' class='code' style='background-color: #FFFF1f'>
  /* "Cython_shift_calculator.pyx":735
 *         self._set_components(components)
 * 
 *         for index in range(len(components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component = components[index]
 *             atom_type_id = component[1]
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
    __pyx_t_1 = __pyx_t_4; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  for (;;) {
    if (!__pyx_t_6 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5++;
    } else if (!__pyx_t_6 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_5 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_5++;
    } else {
      __pyx_t_4 = __pyx_t_6(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
    __pyx_v_index = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line736")'> 736:             component = components[index]</pre>
<pre id='line736' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":736
 * 
 *         for index in range(len(components)):
 *             component = components[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             atom_type_id = component[1]
 * 
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_index);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line737")'> 737:             atom_type_id = component[1]</pre>
<pre id='line737' class='code' style='background-color: #FFFFc4'>
    /* "Cython_shift_calculator.pyx":737
 *         for index in range(len(components)):
 *             component = components[index]
 *             atom_type_id = component[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             shift = 0.0
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_type_id);
    __pyx_v_atom_type_id = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line738")'> 738: </pre>
<pre id='line738' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line739")'> 739:             shift = 0.0</pre>
<pre id='line739' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":739
 *             atom_type_id = component[1]
 * 
 *             shift = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_v_shift = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line740")'> 740: </pre>
<pre id='line740' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line741")'> 741: </pre>
<pre id='line741' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line742")'> 742:             for coef_component in self._get_coef_components(atom_type_id):</pre>
<pre id='line742' class='code' style='background-color: #FFFF24'>
    /* "Cython_shift_calculator.pyx":742
 * 
 * 
 *             for coef_component in self._get_coef_components(atom_type_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #                TODO: remove magic numbers or add structs
 * 
 */
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_atom_type_id);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_4 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_get_coef_components(__pyx_v_self, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4)) {
      __pyx_t_2 = __pyx_t_4; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_9 = Py_TYPE(__pyx_t_2)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    for (;;) {
      if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_8 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
        __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_8); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_8++;
      } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_8 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
        __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_8); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_8++;
      } else {
        __pyx_t_4 = __pyx_t_9(__pyx_t_2);
        if (unlikely(!__pyx_t_4)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coef_component);
      __pyx_v_coef_component = __pyx_t_4;
      __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line743")'> 743: #                TODO: remove magic numbers or add structs</pre>
<pre id='line743' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line744")'> 744: </pre>
<pre id='line744' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line745")'> 745:                 target_atom_id = component[0]</pre>
<pre id='line745' class='code' style='background-color: #FFFF6e'>
      /* "Cython_shift_calculator.pyx":745
 * #                TODO: remove magic numbers or add structs
 * 
 *                 target_atom_id = component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 ring_id = coef_component[1]
 *                 coefficient = coef_component[2]
 */
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_target_atom_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line746")'> 746:                 ring_id = coef_component[1]</pre>
<pre id='line746' class='code' style='background-color: #FFFF6e'>
      /* "Cython_shift_calculator.pyx":746
 * 
 *                 target_atom_id = component[0]
 *                 ring_id = coef_component[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 coefficient = coef_component[2]
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 */
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_coef_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_ring_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line747")'> 747:                 coefficient = coef_component[2]</pre>
<pre id='line747' class='code' style='background-color: #FFFF6e'>
      /* "Cython_shift_calculator.pyx":747
 *                 target_atom_id = component[0]
 *                 ring_id = coef_component[1]
 *                 coefficient = coef_component[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 * 
 */
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_coef_component, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line748")'> 748:                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)</pre>
<pre id='line748' class='code' style='background-color: #FFFFe7'>
      /* "Cython_shift_calculator.pyx":748
 *                 ring_id = coef_component[1]
 *                 coefficient = coef_component[2]
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             results[component_to_target[index]] += shift
 */
      __pyx_v_shift = (__pyx_v_shift + ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calc_sub_component_shift(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id, __pyx_v_coefficient, 0));
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line749")'> 749: </pre>
<pre id='line749' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line750")'> 750:             results[component_to_target[index]] += shift</pre>
<pre id='line750' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":750
 *                 shift += self._calc_sub_component_shift(target_atom_id,  ring_id, coefficient)
 * 
 *             results[component_to_target[index]] += shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component_to_target, __pyx_v_index);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_results, __pyx_t_2);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_shift);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
    __pyx_t_12 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_4, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_results, __pyx_t_2, __pyx_t_12) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line751")'> 751: </pre>
<pre id='line751' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line752")'> 752:         if self._verbose:</pre>
<pre id='line752' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":752
 *             results[component_to_target[index]] += shift
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line753")'> 753:             end_time = time()</pre>
<pre id='line753' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":753
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line754")'> 754:             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line754' class='code' style='background-color: #FFFF21'>
    /* "Cython_shift_calculator.pyx":754
 *         if self._verbose:
 *             end_time = time()
 *             print '   ring shift components ' ,self._name,len(components), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_12 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_12));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_22));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_22));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_22));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_t_12));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_12));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_2 = 0;
    __pyx_t_12 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_type_id);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coef_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_25Fast_ring_data_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_25Fast_ring_data_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line755")'> 755: </pre>
<pre id='line755' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line756")'> 756: #</pre>
<pre id='line756' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line757")'> 757: cdef int RING_ATOM_IDS = 1</pre>
<pre id='line757' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":757
 * 
 * #
 * cdef int RING_ATOM_IDS = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_ring_data_calculator:
 */
  __pyx_v_17shift_calculators_RING_ATOM_IDS = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line758")'> 758: </pre>
<pre id='line758' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line759")'> 759: cdef class Fast_ring_data_calculator:</pre>
<pre id='line759' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":759
 * cdef int RING_ATOM_IDS = 1
 * 
 * cdef class Fast_ring_data_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 */
struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *__pyx_vtab;
  int _verbose;
  Simulation *_simulation;
};


/* "Cython_shift_calculator.pyx":759
 * cdef int RING_ATOM_IDS = 1
 * 
 * cdef class Fast_ring_data_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator {
  struct __pyx_obj_17shift_calculators_Vec3_container *(*_calculate_one_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *);
  Vec3 (*_calculate_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, int *);
  struct __pyx_obj_17shift_calculators_Vec3_container *(*_calculate_one_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *);
  PyObject *(*_build_atom_triplet)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, int *);
  Vec3 (*_average_2_vec_3)(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, Vec3 &, Vec3 &);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_data_calculator;
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, PyObject *, int *);
static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *, Vec3 &, Vec3 &);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line760")'> 760:     cdef bint _verbose</pre>
<pre id='line760' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line761")'> 761:     cdef Simulation* _simulation</pre>
<pre id='line761' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line762")'> 762: </pre>
<pre id='line762' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line763")'> 763:     def __init__(self):</pre>
<pre id='line763' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":763
 *     cdef Simulation* _simulation
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self._simulation =  currentSimulation()
 */

static int __pyx_pf_17shift_calculators_25Fast_ring_data_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 763);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line764")'> 764:         self._verbose = False</pre>
<pre id='line764' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":764
 * 
 *     def __init__(self):
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line765")'> 765:         self._simulation =  currentSimulation()</pre>
<pre id='line765' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":765
 *     def __init__(self):
 *         self._verbose = False
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = 0;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_2set_simulation(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line766")'> 766: </pre>
<pre id='line766' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line767")'> 767:     def set_simulation(self):</pre>
<pre id='line767' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":767
 *         self._simulation =  currentSimulation()
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation  = currentSimulation()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_2set_simulation(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_simulation", __pyx_f[0], 767);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line768")'> 768:         self._simulation  = currentSimulation()</pre>
<pre id='line768' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":768
 * 
 *     def set_simulation(self):
 *         self._simulation  = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line769")'> 769: </pre>
<pre id='line769' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line770")'> 770:     def set_verbose(self,on):</pre>
<pre id='line770' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":770
 *         self._simulation  = currentSimulation()
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_verbose", __pyx_f[0], 770);
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line771")'> 771:         self._verbose =  on</pre>
<pre id='line771' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":771
 * 
 *     def set_verbose(self,on):
 *         self._verbose =  on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Vec3_container  _calculate_one_ring_centre(self, ring_component):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line772")'> 772: </pre>
<pre id='line772' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line773")'> 773:     cdef Vec3_container  _calculate_one_ring_centre(self, ring_component):</pre>
<pre id='line773' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":773
 *         self._verbose =  on
 * 
 *     cdef Vec3_container  _calculate_one_ring_centre(self, ring_component):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 */

static struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_ring_component) {
  PyObject *__pyx_v_atom_ids = NULL;
  float __pyx_v_num_atom_ids;
  Vec3 __pyx_v_total;
  Vec3 __pyx_v_average;
  PyObject *__pyx_v_atom_id = NULL;
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_result = 0;
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_one_ring_centre", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calculate_one_ring_centre", __pyx_f[0], 773);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line774")'> 774: </pre>
<pre id='line774' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line775")'> 775:         atom_ids = ring_component[RING_ATOM_IDS]</pre>
<pre id='line775' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":775
 *     cdef Vec3_container  _calculate_one_ring_centre(self, ring_component):
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float num_atom_ids = len(atom_ids)
 *         cdef Vec3 total,average
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, __pyx_v_17shift_calculators_RING_ATOM_IDS, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_atom_ids = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line776")'> 776:         cdef float num_atom_ids = len(atom_ids)</pre>
<pre id='line776' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":776
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 *         cdef float num_atom_ids = len(atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 total,average
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_ids);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_num_atom_ids = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line777")'> 777:         cdef Vec3 total,average</pre>
<pre id='line777' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line778")'> 778: </pre>
<pre id='line778' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line779")'> 779:         total=Vec3(0.0,0.0,0.0)</pre>
<pre id='line779' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":779
 *         cdef Vec3 total,average
 * 
 *         total=Vec3(0.0,0.0,0.0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for atom_id in atom_ids:
 *             total += self._simulation.atomPos(atom_id)
 */
  __pyx_v_total = Vec3(0.0, 0.0, 0.0);
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line780")'> 780:         for atom_id in atom_ids:</pre>
<pre id='line780' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":780
 * 
 *         total=Vec3(0.0,0.0,0.0)
 *         for atom_id in atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             total += self._simulation.atomPos(atom_id)
 * 
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_atom_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_atom_ids)) {
    __pyx_t_1 = __pyx_v_atom_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_atom_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_3 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;
    } else if (!__pyx_t_3 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++;
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_id);
    __pyx_v_atom_id = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line781")'> 781:             total += self._simulation.atomPos(atom_id)</pre>
<pre id='line781' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":781
 *         total=Vec3(0.0,0.0,0.0)
 *         for atom_id in atom_ids:
 *             total += self._simulation.atomPos(atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        TODO get operator / workin properly
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_atom_id);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_total += __pyx_v_self->_simulation->atomPos(__pyx_t_5);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line782")'> 782: </pre>
<pre id='line782' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line783")'> 783: #        TODO get operator / workin properly</pre>
<pre id='line783' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line784")'> 784:         average = Vec3(total.x()/num_atom_ids,total.y()/num_atom_ids,total.z()/num_atom_ids)</pre>
<pre id='line784' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":784
 * 
 * #        TODO get operator / workin properly
 *         average = Vec3(total.x()/num_atom_ids,total.y()/num_atom_ids,total.z()/num_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3_container result = Vec3_container()
 */
  __pyx_t_6 = __pyx_v_total.x();
  if (unlikely(__pyx_v_num_atom_ids == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_7 = __pyx_v_total.y();
  if (unlikely(__pyx_v_num_atom_ids == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_8 = __pyx_v_total.z();
  if (unlikely(__pyx_v_num_atom_ids == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_average = Vec3((__pyx_t_6 / __pyx_v_num_atom_ids), (__pyx_t_7 / __pyx_v_num_atom_ids), (__pyx_t_8 / __pyx_v_num_atom_ids));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line785")'> 785: </pre>
<pre id='line785' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line786")'> 786:         cdef Vec3_container result = Vec3_container()</pre>
<pre id='line786' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":786
 *         average = Vec3(total.x()/num_atom_ids,total.y()/num_atom_ids,total.z()/num_atom_ids)
 * 
 *         cdef Vec3_container result = Vec3_container()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.set_vec3(average)
 *         return result
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Vec3_container)), ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 786; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line787")'> 787:         result.set_vec3(average)</pre>
<pre id='line787' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":787
 * 
 *         cdef Vec3_container result = Vec3_container()
 *         result.set_vec3(average)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_container *)__pyx_v_result->__pyx_vtab)->set_vec3(__pyx_v_result, __pyx_v_average);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line788")'> 788:         return result</pre>
<pre id='line788' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":788
 *         cdef Vec3_container result = Vec3_container()
 *         result.set_vec3(average)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = ((struct __pyx_obj_17shift_calculators_Vec3_container *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator._calculate_one_ring_centre", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_ids);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_id);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line789")'> 789: </pre>
<pre id='line789' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line790")'> 790: </pre>
<pre id='line790' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line791")'> 791: #    def _check_ring_size_ok(self, atom_ids):</pre>
<pre id='line791' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line792")'> 792: #        num_atom_ids = len(atom_ids)</pre>
<pre id='line792' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line793")'> 793: #        if num_atom_ids &lt; 5 or num_atom_ids &gt; 6:</pre>
<pre id='line793' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line794")'> 794: #            template = "ring normals function is only implemented for 5 or six member rings i got %d atoms"</pre>
<pre id='line794' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line795")'> 795: #            msg = template % num_atom_ids</pre>
<pre id='line795' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line796")'> 796: #            raise Exception(msg)</pre>
<pre id='line796' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line797")'> 797: #</pre>
<pre id='line797' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line798")'> 798: </pre>
<pre id='line798' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line799")'> 799:     cdef Vec3  _calculate_normal(self, int[3] atom_id_triplet):</pre>
<pre id='line799' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":799
 * #
 * 
 *     cdef Vec3  _calculate_normal(self, int[3] atom_id_triplet):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 normal
 */

static Vec3 __pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, int *__pyx_v_atom_id_triplet) {
  Vec3 __pyx_v_vec_1;
  Vec3 __pyx_v_vec_2;
  Vec3 __pyx_v_atom_vector_1;
  Vec3 __pyx_v_atom_vector_2;
  Vec3 __pyx_v_atom_vector_3;
  Vec3 __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_normal", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calculate_normal", __pyx_f[0], 799);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line800")'> 800: </pre>
<pre id='line800' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line801")'> 801:         cdef Vec3 normal</pre>
<pre id='line801' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line802")'> 802:         cdef Vec3 vec_1</pre>
<pre id='line802' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line803")'> 803:         cdef Vec3 vec_2</pre>
<pre id='line803' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line804")'> 804: </pre>
<pre id='line804' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line805")'> 805:         cdef Vec3 atom_vector_1, atom_vector_2, atom_vector_3</pre>
<pre id='line805' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line806")'> 806: </pre>
<pre id='line806' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line807")'> 807:         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])</pre>
<pre id='line807' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":807
 *         cdef Vec3 atom_vector_1, atom_vector_2, atom_vector_3
 * 
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 */
  __pyx_v_atom_vector_1 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line808")'> 808:         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])</pre>
<pre id='line808' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":808
 * 
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 * 
 */
  __pyx_v_atom_vector_2 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line809")'> 809:         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])</pre>
<pre id='line809' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":809
 *         atom_vector_1 = self._simulation[0].atomPos(atom_id_triplet[0])
 *         atom_vector_2 = self._simulation[0].atomPos(atom_id_triplet[1])
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2
 */
  __pyx_v_atom_vector_3 = (__pyx_v_self->_simulation[0]).atomPos((__pyx_v_atom_id_triplet[2]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line810")'> 810: </pre>
<pre id='line810' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line811")'> 811:         vec_1 =  atom_vector_1 -atom_vector_2</pre>
<pre id='line811' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":811
 *         atom_vector_3 = self._simulation[0].atomPos(atom_id_triplet[2])
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         vec_2 =  atom_vector_3- atom_vector_2
 * 
 */
  __pyx_v_vec_1 = (__pyx_v_atom_vector_1 - __pyx_v_atom_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line812")'> 812:         vec_2 =  atom_vector_3- atom_vector_2</pre>
<pre id='line812' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":812
 * 
 *         vec_1 =  atom_vector_1 -atom_vector_2
 *         vec_2 =  atom_vector_3- atom_vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return cross(vec_1,vec_2)
 */
  __pyx_v_vec_2 = (__pyx_v_atom_vector_3 - __pyx_v_atom_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line813")'> 813: </pre>
<pre id='line813' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line814")'> 814:         return cross(vec_1,vec_2)</pre>
<pre id='line814' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":814
 *         vec_2 =  atom_vector_3- atom_vector_2
 * 
 *         return cross(vec_1,vec_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal
 */
  __pyx_r = cross(__pyx_v_vec_1, __pyx_v_vec_2);
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line815")'> 815: </pre>
<pre id='line815' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line816")'> 816:     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal</pre>
<pre id='line816' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line817")'> 817:     cdef Vec3_container _calculate_one_ring_normal(self, ring_component):</pre>
<pre id='line817' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":817
 * 
 *     #TODO could try newells method http://www.opengl.org/wiki/Calculating_a_Surface_Normal
 *     cdef Vec3_container _calculate_one_ring_normal(self, ring_component):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]
 */

static struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_f_17shift_calculators_25Fast_ring_data_calculator__calculate_one_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_ring_component) {
  PyObject *__pyx_v_atom_ids = NULL;
  int __pyx_v_atom_triplet_1[3];
  int __pyx_v_atom_triplet_2[3];
  Vec3 __pyx_v_normal_1;
  Vec3 __pyx_v_normal_2;
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_result = 0;
  Vec3 __pyx_v_average;
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_one_ring_normal", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calculate_one_ring_normal", __pyx_f[0], 817);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line818")'> 818: </pre>
<pre id='line818' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line819")'> 819:         atom_ids = ring_component[RING_ATOM_IDS]</pre>
<pre id='line819' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":819
 *     cdef Vec3_container _calculate_one_ring_normal(self, ring_component):
 * 
 *         atom_ids = ring_component[RING_ATOM_IDS]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        self._check_ring_size_ok(atom_ids)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, __pyx_v_17shift_calculators_RING_ATOM_IDS, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_atom_ids = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line820")'> 820: #        self._check_ring_size_ok(atom_ids)</pre>
<pre id='line820' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line821")'> 821: </pre>
<pre id='line821' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line822")'> 822:         cdef int[3] atom_triplet_1</pre>
<pre id='line822' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line823")'> 823:         cdef int[3] atom_triplet_2</pre>
<pre id='line823' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line824")'> 824:         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)</pre>
<pre id='line824' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":824
 *         cdef int[3] atom_triplet_1
 *         cdef int[3] atom_triplet_2
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_atom_ids, 0, 3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(__pyx_v_self, __pyx_t_1, __pyx_v_atom_triplet_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line825")'> 825:         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)</pre>
<pre id='line825' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":825
 *         cdef int[3] atom_triplet_2
 *         self._build_atom_triplet(atom_ids[:3], atom_triplet_1)
 *         self._build_atom_triplet(atom_ids[-3:], atom_triplet_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_atom_ids, -3, PY_SSIZE_T_MAX);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(__pyx_v_self, __pyx_t_2, __pyx_v_atom_triplet_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line826")'> 826: </pre>
<pre id='line826' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line827")'> 827: </pre>
<pre id='line827' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line828")'> 828:         cdef Vec3 normal_1 = self._calculate_normal(atom_triplet_1)</pre>
<pre id='line828' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":828
 * 
 * 
 *         cdef Vec3 normal_1 = self._calculate_normal(atom_triplet_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 normal_2 = self._calculate_normal(atom_triplet_2)
 * 
 */
  __pyx_v_normal_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self->__pyx_vtab)->_calculate_normal(__pyx_v_self, __pyx_v_atom_triplet_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line829")'> 829:         cdef Vec3 normal_2 = self._calculate_normal(atom_triplet_2)</pre>
<pre id='line829' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":829
 * 
 *         cdef Vec3 normal_1 = self._calculate_normal(atom_triplet_1)
 *         cdef Vec3 normal_2 = self._calculate_normal(atom_triplet_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3_container result = Vec3_container()
 */
  __pyx_v_normal_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self->__pyx_vtab)->_calculate_normal(__pyx_v_self, __pyx_v_atom_triplet_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line830")'> 830: </pre>
<pre id='line830' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line831")'> 831:         cdef Vec3_container result = Vec3_container()</pre>
<pre id='line831' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":831
 *         cdef Vec3 normal_2 = self._calculate_normal(atom_triplet_2)
 * 
 *         cdef Vec3_container result = Vec3_container()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 average  = self._average_2_vec_3(normal_1, normal_2)
 *         result.set_vec3(average)
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Vec3_container)), ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 831; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line832")'> 832:         cdef Vec3 average  = self._average_2_vec_3(normal_1, normal_2)</pre>
<pre id='line832' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":832
 * 
 *         cdef Vec3_container result = Vec3_container()
 *         cdef Vec3 average  = self._average_2_vec_3(normal_1, normal_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.set_vec3(average)
 *         return result
 */
  __pyx_v_average = __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(__pyx_v_self, __pyx_v_normal_1, __pyx_v_normal_2);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line833")'> 833:         result.set_vec3(average)</pre>
<pre id='line833' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":833
 *         cdef Vec3_container result = Vec3_container()
 *         cdef Vec3 average  = self._average_2_vec_3(normal_1, normal_2)
 *         result.set_vec3(average)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_container *)__pyx_v_result->__pyx_vtab)->set_vec3(__pyx_v_result, __pyx_v_average);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 833; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line834")'> 834:         return result</pre>
<pre id='line834' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":834
 *         cdef Vec3 average  = self._average_2_vec_3(normal_1, normal_2)
 *         result.set_vec3(average)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline  _build_atom_triplet(self,atom_ids, int[3]& result):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = ((struct __pyx_obj_17shift_calculators_Vec3_container *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator._calculate_one_ring_normal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_ids);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line835")'> 835: </pre>
<pre id='line835' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line836")'> 836:     cdef inline  _build_atom_triplet(self,atom_ids, int[3]&amp; result):</pre>
<pre id='line836' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":836
 *         return result
 * 
 *     cdef inline  _build_atom_triplet(self,atom_ids, int[3]& result):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(3):
 *             result[i] = atom_ids[i]
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_25Fast_ring_data_calculator__build_atom_triplet(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_atom_ids, int *__pyx_v_result) {
  long __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_atom_triplet", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_build_atom_triplet", __pyx_f[0], 836);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line837")'> 837:         for i in range(3):</pre>
<pre id='line837' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":837
 * 
 *     cdef inline  _build_atom_triplet(self,atom_ids, int[3]& result):
 *         for i in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[i] = atom_ids[i]
 * 
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line838")'> 838:             result[i] = atom_ids[i]</pre>
<pre id='line838' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":838
 *     cdef inline  _build_atom_triplet(self,atom_ids, int[3]& result):
 *         for i in range(3):
 *             result[i] = atom_ids[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_atom_ids, __pyx_v_i, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    (__pyx_v_result[__pyx_v_i]) = __pyx_t_3;
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator._build_atom_triplet", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line839")'> 839: </pre>
<pre id='line839' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line840")'> 840: </pre>
<pre id='line840' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line841")'> 841:     cdef inline Vec3 _average_2_vec_3(self, Vec3&amp; vector_1, Vec3&amp; vector_2):</pre>
<pre id='line841' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":841
 * 
 * 
 *     cdef inline Vec3 _average_2_vec_3(self, Vec3& vector_1, Vec3& vector_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 sum
 * 
 */

static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_25Fast_ring_data_calculator__average_2_vec_3(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, Vec3 &__pyx_v_vector_1, Vec3 &__pyx_v_vector_2) {
  Vec3 __pyx_v_sum;
  Vec3 __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_average_2_vec_3", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_average_2_vec_3", __pyx_f[0], 841);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line842")'> 842:         cdef Vec3 sum</pre>
<pre id='line842' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line843")'> 843: </pre>
<pre id='line843' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line844")'> 844:         sum =  vector_1 + vector_2</pre>
<pre id='line844' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":844
 *         cdef Vec3 sum
 * 
 *         sum =  vector_1 + vector_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return Vec3(sum.x()/2.0, sum.y()/2.0, sum.z()/2.0)
 */
  __pyx_v_sum = (__pyx_v_vector_1 + __pyx_v_vector_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line845")'> 845: </pre>
<pre id='line845' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line846")'> 846:         return Vec3(sum.x()/2.0, sum.y()/2.0, sum.z()/2.0)</pre>
<pre id='line846' class='code' style='background-color: #FFFF2f'>
  /* "Cython_shift_calculator.pyx":846
 *         sum =  vector_1 + vector_2
 * 
 *         return Vec3(sum.x()/2.0, sum.y()/2.0, sum.z()/2.0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = Vec3((__pyx_v_sum.x() / 2.0), (__pyx_v_sum.y() / 2.0), (__pyx_v_sum.z() / 2.0));
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_25Fast_ring_data_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_rings = 0;
  PyObject *__pyx_v_normals = 0;
  PyObject *__pyx_v_centres = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__rings,&__pyx_n_s__normals,&__pyx_n_s__centres,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__rings);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__normals);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 850; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__centres);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 850; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 850; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_rings = values[0];
    __pyx_v_normals = values[1];
    __pyx_v_centres = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 850; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_25Fast_ring_data_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self), __pyx_v_rings, __pyx_v_normals, __pyx_v_centres);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line847")'> 847: </pre>
<pre id='line847' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line848")'> 848: </pre>
<pre id='line848' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line849")'> 849: </pre>
<pre id='line849' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line850")'> 850:     def __call__(self, rings, normals, centres):</pre>
<pre id='line850' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":850
 * 
 * 
 *     def __call__(self, rings, normals, centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef Vec3_container centre
 */

static PyObject *__pyx_pf_17shift_calculators_25Fast_ring_data_calculator_6__call__(struct __pyx_obj_17shift_calculators_Fast_ring_data_calculator *__pyx_v_self, PyObject *__pyx_v_rings, PyObject *__pyx_v_normals, PyObject *__pyx_v_centres) {
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_centre = 0;
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_normal = 0;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_ring_component = NULL;
  PyObject *__pyx_v_ring_id = NULL;
  PyObject *__pyx_v_centre_component = NULL;
  PyObject *__pyx_v_normal_component = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 850);
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line851")'> 851:         self.set_simulation()</pre>
<pre id='line851' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":851
 * 
 *     def __call__(self, rings, normals, centres):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3_container centre
 *         cdef Vec3_container normal
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 851; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 851; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line852")'> 852:         cdef Vec3_container centre</pre>
<pre id='line852' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line853")'> 853:         cdef Vec3_container normal</pre>
<pre id='line853' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line854")'> 854:         cdef double start_time = 0.0</pre>
<pre id='line854' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":854
 *         cdef Vec3_container centre
 *         cdef Vec3_container normal
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         self.set_simulation()
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line855")'> 855:         cdef double end_time = 0.0</pre>
<pre id='line855' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":855
 *         cdef Vec3_container normal
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 * 
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line856")'> 856:         self.set_simulation()</pre>
<pre id='line856' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":856
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line857")'> 857: </pre>
<pre id='line857' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line858")'> 858:         if self._verbose:</pre>
<pre id='line858' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":858
 *         self.set_simulation()
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line859")'> 859:             start_time = time()</pre>
<pre id='line859' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":859
 * 
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 859; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line860")'> 860: </pre>
<pre id='line860' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line861")'> 861: </pre>
<pre id='line861' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line862")'> 862: </pre>
<pre id='line862' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line863")'> 863:         for ring_component in rings:</pre>
<pre id='line863' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":863
 * 
 * 
 *         for ring_component in rings:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ring_id = ring_component[0]
 * 
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_rings) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_rings)) {
    __pyx_t_2 = __pyx_v_rings; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4++;
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 863; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
    __pyx_v_ring_component = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line864")'> 864:             ring_id = ring_component[0]</pre>
<pre id='line864' class='code' style='background-color: #FFFFc4'>
    /* "Cython_shift_calculator.pyx":864
 * 
 *         for ring_component in rings:
 *             ring_id = ring_component[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             centre = self._calculate_one_ring_centre(ring_component)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_id);
    __pyx_v_ring_id = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line865")'> 865: </pre>
<pre id='line865' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line866")'> 866:             centre = self._calculate_one_ring_centre(ring_component)</pre>
<pre id='line866' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":866
 *             ring_id = ring_component[0]
 * 
 *             centre = self._calculate_one_ring_centre(ring_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             centre_component = ring_id, centre
 *             centres.add_component(centre_component)
 */
    __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self->__pyx_vtab)->_calculate_one_ring_centre(__pyx_v_self, __pyx_v_ring_component));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 866; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_v_centre));
    __pyx_v_centre = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line867")'> 867:             centre_component = ring_id, centre</pre>
<pre id='line867' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":867
 * 
 *             centre = self._calculate_one_ring_centre(ring_component)
 *             centre_component = ring_id, centre             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             centres.add_component(centre_component)
 * 
 */
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ring_id);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_ring_id);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_ring_id);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_centre));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_centre));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_centre));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_v_centre_component));
    __pyx_v_centre_component = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line868")'> 868:             centres.add_component(centre_component)</pre>
<pre id='line868' class='code' style='background-color: #FFFF55'>
    /* "Cython_shift_calculator.pyx":868
 *             centre = self._calculate_one_ring_centre(ring_component)
 *             centre_component = ring_id, centre
 *             centres.add_component(centre_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             normal = self._calculate_one_ring_normal(ring_component)
 */
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_centres, __pyx_n_s__add_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 868; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 868; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_centre_component));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_v_centre_component));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_centre_component));
    __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 868; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line869")'> 869: </pre>
<pre id='line869' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line870")'> 870:             normal = self._calculate_one_ring_normal(ring_component)</pre>
<pre id='line870' class='code' style='background-color: #FFFFe7'>
    /* "Cython_shift_calculator.pyx":870
 *             centres.add_component(centre_component)
 * 
 *             normal = self._calculate_one_ring_normal(ring_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             normal_component = ring_id, normal
 *             normals.add_component(normal_component)
 */
    __pyx_t_7 = ((PyObject *)((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_data_calculator *)__pyx_v_self->__pyx_vtab)->_calculate_one_ring_normal(__pyx_v_self, __pyx_v_ring_component));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 870; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_v_normal));
    __pyx_v_normal = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_7);
    __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line871")'> 871:             normal_component = ring_id, normal</pre>
<pre id='line871' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":871
 * 
 *             normal = self._calculate_one_ring_normal(ring_component)
 *             normal_component = ring_id, normal             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             normals.add_component(normal_component)
 * 
 */
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 871; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ring_id);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_v_ring_id);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_ring_id);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_normal));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, ((PyObject *)__pyx_v_normal));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_normal));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_v_normal_component));
    __pyx_v_normal_component = __pyx_t_7;
    __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line872")'> 872:             normals.add_component(normal_component)</pre>
<pre id='line872' class='code' style='background-color: #FFFF52'>
    /* "Cython_shift_calculator.pyx":872
 *             normal = self._calculate_one_ring_normal(ring_component)
 *             normal_component = ring_id, normal
 *             normals.add_component(normal_component)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_normals, __pyx_n_s__add_component);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 872; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 872; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_normal_component));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_v_normal_component));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_normal_component));
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_7, ((PyObject *)__pyx_t_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 872; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line873")'> 873: </pre>
<pre id='line873' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line874")'> 874:         if self._verbose:</pre>
<pre id='line874' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":874
 *             normals.add_component(normal_component)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line875")'> 875:             end_time = time()</pre>
<pre id='line875' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":875
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line876")'> 876:             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line876' class='code' style='background-color: #FFFF16'>
    /* "Cython_shift_calculator.pyx":876
 *         if self._verbose:
 *             end_time = time()
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_non_bonded_calculator:
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_rings);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_normals);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_7));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_23));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_kp_s_23));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_23));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_24));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 2, ((PyObject *)__pyx_kp_s_24));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_24));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 3, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 4, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 5, ((PyObject *)__pyx_t_7));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_7));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_7 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_6), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_data_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_centre);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_normal);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_id);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_centre_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_normal_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_min_residue_seperation = 0;
  PyObject *__pyx_v_cutoff_distance = 0;
  PyObject *__pyx_v_jitter = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_25,&__pyx_n_s__cutoff_distance,&__pyx_n_s__jitter,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    values[1] = __pyx_k_26;
    values[2] = __pyx_k_27;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_25);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__cutoff_distance);
          if (value) { values[1] = value; kw_args--; }
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__jitter);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_min_residue_seperation = values[0];
    __pyx_v_cutoff_distance = values[1];
    __pyx_v_jitter = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), __pyx_v_min_residue_seperation, __pyx_v_cutoff_distance, __pyx_v_jitter);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line877")'> 877: </pre>
<pre id='line877' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line878")'> 878: cdef class Fast_non_bonded_calculator:</pre>
<pre id='line878' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":878
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_non_bonded_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int _min_residue_seperation
 *     cdef float _cutoff_distance
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *__pyx_vtab;
  int _min_residue_seperation;
  float _cutoff_distance;
  float _jitter;
  float _full_cutoff_distance;
  int _verbose;
  Simulation *_simulation;
};


/* "Cython_shift_calculator.pyx":878
 *             print '   ring data centres: ',len(rings), ' normals ', len(normals), 'in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 * cdef class Fast_non_bonded_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int _min_residue_seperation
 *     cdef float _cutoff_distance
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator {
  int (*_filter_by_residue)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, char *, int, char *, int);
  int (*_is_non_bonded)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, int, int);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_calculator;
static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, char *, int, char *, int);
static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *, int, int);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line879")'> 879:     cdef int _min_residue_seperation</pre>
<pre id='line879' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line880")'> 880:     cdef float _cutoff_distance</pre>
<pre id='line880' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line881")'> 881:     cdef float _jitter</pre>
<pre id='line881' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line882")'> 882:     cdef float _full_cutoff_distance</pre>
<pre id='line882' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line883")'> 883:     cdef bint _verbose</pre>
<pre id='line883' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line884")'> 884:     cdef Simulation* _simulation</pre>
<pre id='line884' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line885")'> 885:     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):</pre>
<pre id='line885' class='code' style='background-color: #FFFF73'>
/* "Cython_shift_calculator.pyx":885
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance
 */

static int __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_min_residue_seperation, PyObject *__pyx_v_cutoff_distance, PyObject *__pyx_v_jitter) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 885);

  /* "Cython_shift_calculator.pyx":885
 *     cdef bint _verbose
 *     cdef Simulation* _simulation
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(5.0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_26 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_27 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line886")'> 886:         self._min_residue_seperation =  min_residue_seperation</pre>
<pre id='line886' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":886
 *     cdef Simulation* _simulation
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):
 *         self._min_residue_seperation =  min_residue_seperation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_min_residue_seperation);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_min_residue_seperation = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line887")'> 887:         self._cutoff_distance =  cutoff_distance</pre>
<pre id='line887' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":887
 *     def __init__(self,min_residue_seperation,cutoff_distance=5.0,jitter=0.2):
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 */
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_cutoff_distance);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 887; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_cutoff_distance = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line888")'> 888:         self._jitter = jitter</pre>
<pre id='line888' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":888
 *         self._min_residue_seperation =  min_residue_seperation
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False
 */
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_jitter);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 888; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_jitter = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line889")'> 889:         self._full_cutoff_distance =  self._cutoff_distance + self._jitter</pre>
<pre id='line889' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":889
 *         self._cutoff_distance =  cutoff_distance
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose =  False
 *         self._simulation =  currentSimulation()
 */
  __pyx_v_self->_full_cutoff_distance = (__pyx_v_self->_cutoff_distance + __pyx_v_self->_jitter);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line890")'> 890:         self._verbose =  False</pre>
<pre id='line890' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":890
 *         self._jitter = jitter
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line891")'> 891:         self._simulation =  currentSimulation()</pre>
<pre id='line891' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":891
 *         self._full_cutoff_distance =  self._cutoff_distance + self._jitter
 *         self._verbose =  False
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_2set_simulation(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line892")'> 892: </pre>
<pre id='line892' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line893")'> 893:     def set_simulation(self):</pre>
<pre id='line893' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":893
 *         self._simulation =  currentSimulation()
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_2set_simulation(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_simulation", __pyx_f[0], 893);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line894")'> 894:         self._simulation = currentSimulation()</pre>
<pre id='line894' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":894
 * 
 *     def set_simulation(self):
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line895")'> 895: </pre>
<pre id='line895' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line896")'> 896:     def set_verbose(self,on):</pre>
<pre id='line896' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":896
 *         self._simulation = currentSimulation()
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose=on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_verbose", __pyx_f[0], 896);
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line897")'> 897:         self._verbose=on</pre>
<pre id='line897' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":897
 * 
 *     def set_verbose(self,on):
 *         self._verbose=on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 897; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line898")'> 898: </pre>
<pre id='line898' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line899")'> 899:     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):</pre>
<pre id='line899' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":899
 *         self._verbose=on
 * 
 *     cdef inline bint _filter_by_residue(self, char* seg_1, int residue_1, char* seg_2, int residue_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int sequence_distance
 *         cdef bint result
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, char *__pyx_v_seg_1, int __pyx_v_residue_1, char *__pyx_v_seg_2, int __pyx_v_residue_2) {
  int __pyx_v_sequence_distance;
  int __pyx_v_result;
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_filter_by_residue", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_filter_by_residue", __pyx_f[0], 899);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line900")'> 900:         cdef int sequence_distance</pre>
<pre id='line900' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line901")'> 901:         cdef bint result</pre>
<pre id='line901' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line902")'> 902: </pre>
<pre id='line902' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line903")'> 903:         result = False</pre>
<pre id='line903' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":903
 *         cdef bint result
 * 
 *         result = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if strcmp(seg_1, seg_2) == 0:
 */
  __pyx_v_result = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line904")'> 904: </pre>
<pre id='line904' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line905")'> 905:         if strcmp(seg_1, seg_2) == 0:</pre>
<pre id='line905' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":905
 *         result = False
 * 
 *         if strcmp(seg_1, seg_2) == 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 */
  __pyx_t_1 = (strcmp(__pyx_v_seg_1, __pyx_v_seg_2) == 0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line906")'> 906:             sequence_distance =abs(residue_1-residue_2)</pre>
<pre id='line906' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":906
 * 
 *         if strcmp(seg_1, seg_2) == 0:
 *             sequence_distance =abs(residue_1-residue_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True
 */
    __pyx_t_2 = __Pyx_abs_int((__pyx_v_residue_1 - __pyx_v_residue_2)); 
    __pyx_v_sequence_distance = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line907")'> 907:             if sequence_distance &lt; self._min_residue_seperation:</pre>
<pre id='line907' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":907
 *         if strcmp(seg_1, seg_2) == 0:
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result =True
 *         return result
 */
    __pyx_t_1 = (__pyx_v_sequence_distance <code><</code> __pyx_v_self->_min_residue_seperation);
    if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line908")'> 908:                 result =True</pre>
<pre id='line908' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":908
 *             sequence_distance =abs(residue_1-residue_2)
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
      __pyx_v_result = 1;
      goto __pyx_L4;
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line909")'> 909:         return result</pre>
<pre id='line909' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":909
 *             if sequence_distance <code><</code> self._min_residue_seperation:
 *                 result =True
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line910")'> 910: </pre>
<pre id='line910' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line911")'> 911:     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):</pre>
<pre id='line911' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":911
 *         return result
 * 
 *     cdef inline bint  _is_non_bonded(self, int atom_id_1, int atom_id_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Atom atom_1, atom_2
 */

static CYTHON_INLINE int __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, int __pyx_v_atom_id_1, int __pyx_v_atom_id_2) {
  Atom __pyx_v_atom_1;
  Atom __pyx_v_atom_2;
  char *__pyx_v_seg_1;
  char *__pyx_v_seg_2;
  int __pyx_v_residue_1;
  int __pyx_v_residue_2;
  int __pyx_v_is_non_bonded;
  float __pyx_v_distance;
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_is_non_bonded", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_is_non_bonded", __pyx_f[0], 911);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line912")'> 912: </pre>
<pre id='line912' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line913")'> 913:         cdef Atom atom_1, atom_2</pre>
<pre id='line913' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line914")'> 914:         cdef char *seg_1, *seg_2</pre>
<pre id='line914' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line915")'> 915:         cdef int residue_1, residue_2</pre>
<pre id='line915' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line916")'> 916:         cdef bint is_non_bonded</pre>
<pre id='line916' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line917")'> 917:         cdef float distance</pre>
<pre id='line917' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line918")'> 918: </pre>
<pre id='line918' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line919")'> 919:         atom_1 = currentSimulation().atomByID(atom_id_1)</pre>
<pre id='line919' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":919
 *         cdef float distance
 * 
 *         atom_1 = currentSimulation().atomByID(atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         atom_2 = currentSimulation().atomByID(atom_id_2)
 * 
 */
  __pyx_v_atom_1 = Simulation::currentSimulation()->atomByID(__pyx_v_atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line920")'> 920:         atom_2 = currentSimulation().atomByID(atom_id_2)</pre>
<pre id='line920' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":920
 * 
 *         atom_1 = currentSimulation().atomByID(atom_id_1)
 *         atom_2 = currentSimulation().atomByID(atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()
 */
  __pyx_v_atom_2 = Simulation::currentSimulation()->atomByID(__pyx_v_atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line921")'> 921: </pre>
<pre id='line921' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line922")'> 922:         seg_1 =  &lt;char *&gt;atom_1.segmentName()</pre>
<pre id='line922' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":922
 *         atom_2 = currentSimulation().atomByID(atom_id_2)
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         residue_1 = atom_1.residueNum()
 * 
 */
  __pyx_v_seg_1 = ((char *)__pyx_v_atom_1.segmentName());
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line923")'> 923:         residue_1 = atom_1.residueNum()</pre>
<pre id='line923' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":923
 * 
 *         seg_1 =  <code><</code>char *>atom_1.segmentName()
 *         residue_1 = atom_1.residueNum()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()
 */
  __pyx_v_residue_1 = __pyx_v_atom_1.residueNum();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line924")'> 924: </pre>
<pre id='line924' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line925")'> 925:         seg_2 = &lt;char*&gt;atom_2.segmentName()</pre>
<pre id='line925' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":925
 *         residue_1 = atom_1.residueNum()
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         residue_2 =  atom_2.residueNum()
 * 
 */
  __pyx_v_seg_2 = ((char *)__pyx_v_atom_2.segmentName());
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line926")'> 926:         residue_2 =  atom_2.residueNum()</pre>
<pre id='line926' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":926
 * 
 *         seg_2 = <code><</code>char*>atom_2.segmentName()
 *         residue_2 =  atom_2.residueNum()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         is_non_bonded = True
 */
  __pyx_v_residue_2 = __pyx_v_atom_2.residueNum();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line927")'> 927: </pre>
<pre id='line927' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line928")'> 928:         is_non_bonded = True</pre>
<pre id='line928' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":928
 *         residue_2 =  atom_2.residueNum()
 * 
 *         is_non_bonded = True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):
 *             is_non_bonded = False
 */
  __pyx_v_is_non_bonded = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line929")'> 929:         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):</pre>
<pre id='line929' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":929
 * 
 *         is_non_bonded = True
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             is_non_bonded = False
 *         else:
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__filter_by_residue(__pyx_v_self, __pyx_v_seg_1, __pyx_v_residue_1, __pyx_v_seg_2, __pyx_v_residue_2);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line930")'> 930:             is_non_bonded = False</pre>
<pre id='line930' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":930
 *         is_non_bonded = True
 *         if self._filter_by_residue(seg_1, residue_1, seg_2, residue_2):
 *             is_non_bonded = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())
 */
    __pyx_v_is_non_bonded = 0;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line931")'> 931:         else:</pre>
<pre id='line931' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line932")'> 932:             distance = norm(atom_1.pos() - atom_2.pos())</pre>
<pre id='line932' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":932
 *             is_non_bonded = False
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance
 *         return is_non_bonded
 */
    __pyx_v_distance = norm((__pyx_v_atom_1.pos() - __pyx_v_atom_2.pos()));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line933")'> 933:             is_non_bonded =  distance &lt; self._full_cutoff_distance</pre>
<pre id='line933' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":933
 *         else:
 *             distance = norm(atom_1.pos() - atom_2.pos())
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return is_non_bonded
 * 
 */
    __pyx_v_is_non_bonded = (__pyx_v_distance <code><</code> __pyx_v_self->_full_cutoff_distance);
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line934")'> 934:         return is_non_bonded</pre>
<pre id='line934' class='code' style='background-color: #FFFF38'>
  /* "Cython_shift_calculator.pyx":934
 *             distance = norm(atom_1.pos() - atom_2.pos())
 *             is_non_bonded =  distance <code><</code> self._full_cutoff_distance
 *         return is_non_bonded             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __call__(self, atom_list_1, atom_list_2):
 */
  __pyx_r = __pyx_v_is_non_bonded;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_non_bonded_calculator_7__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_atom_list_1 = 0;
  PyObject *__pyx_v_atom_list_2 = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__atom_list_1,&__pyx_n_s__atom_list_2,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_list_1);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_list_2);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 936; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 936; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_atom_list_1 = values[0];
    __pyx_v_atom_list_2 = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 936; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_6__call__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *)__pyx_v_self), __pyx_v_atom_list_1, __pyx_v_atom_list_2);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line935")'> 935: </pre>
<pre id='line935' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line936")'> 936:     def __call__(self, atom_list_1, atom_list_2):</pre>
<pre id='line936' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":936
 *         return is_non_bonded
 * 
 *     def __call__(self, atom_list_1, atom_list_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_non_bonded_calculator_6__call__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_calculator *__pyx_v_self, PyObject *__pyx_v_atom_list_1, PyObject *__pyx_v_atom_list_2) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_non_bonded_lists = NULL;
  PyObject *__pyx_v_atom_id_1 = NULL;
  PyObject *__pyx_v_non_bonded_list = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_atom_id_2 = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 936);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line937")'> 937: </pre>
<pre id='line937' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line938")'> 938:         if self._verbose:</pre>
<pre id='line938' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":938
 *     def __call__(self, atom_list_1, atom_list_2):
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '***** BUILD NON BONDED ******'
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line939")'> 939:             print '***** BUILD NON BONDED ******'</pre>
<pre id='line939' class='code' style='background-color: #FFFFd4'>
    /* "Cython_shift_calculator.pyx":939
 * 
 *         if self._verbose:
 *             print '***** BUILD NON BONDED ******'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time = 0.0
 */
    if (<span class='pyx_c_api'>__Pyx_PrintOne</span>(0, ((PyObject *)__pyx_kp_s_28)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line940")'> 940: </pre>
<pre id='line940' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line941")'> 941:         cdef double start_time = 0.0</pre>
<pre id='line941' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":941
 *             print '***** BUILD NON BONDED ******'
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line942")'> 942:         cdef double end_time = 0.0</pre>
<pre id='line942' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":942
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line943")'> 943:         if self._verbose:</pre>
<pre id='line943' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":943
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line944")'> 944:             start_time = time()</pre>
<pre id='line944' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":944
 *         cdef double end_time = 0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 944; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 944; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 944; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line945")'> 945: </pre>
<pre id='line945' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line946")'> 946: </pre>
<pre id='line946' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line947")'> 947:         self.set_simulation()</pre>
<pre id='line947' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":947
 * 
 * 
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         non_bonded_lists = []
 *         for atom_id_1 in atom_list_1:
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line948")'> 948:         non_bonded_lists = []</pre>
<pre id='line948' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":948
 * 
 *         self.set_simulation()
 *         non_bonded_lists = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for atom_id_1 in atom_list_1:
 *             non_bonded_list = []
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_non_bonded_lists = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line949")'> 949:         for atom_id_1 in atom_list_1:</pre>
<pre id='line949' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":949
 *         self.set_simulation()
 *         non_bonded_lists = []
 *         for atom_id_1 in atom_list_1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             non_bonded_list = []
 *             non_bonded_lists.append(non_bonded_list)
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_atom_list_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_atom_list_1)) {
    __pyx_t_1 = __pyx_v_atom_list_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_atom_list_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_id_1);
    __pyx_v_atom_id_1 = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line950")'> 950:             non_bonded_list = []</pre>
<pre id='line950' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":950
 *         non_bonded_lists = []
 *         for atom_id_1 in atom_list_1:
 *             non_bonded_list = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             non_bonded_lists.append(non_bonded_list)
 *             for i, atom_id_2 in enumerate(atom_list_2):
 */
    __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 950; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_v_non_bonded_list));
    __pyx_v_non_bonded_list = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line951")'> 951:             non_bonded_lists.append(non_bonded_list)</pre>
<pre id='line951' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":951
 *         for atom_id_1 in atom_list_1:
 *             non_bonded_list = []
 *             non_bonded_lists.append(non_bonded_list)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for i, atom_id_2 in enumerate(atom_list_2):
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 */
    __pyx_t_6 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_non_bonded_lists, ((PyObject *)__pyx_v_non_bonded_list));<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line952")'> 952:             for i, atom_id_2 in enumerate(atom_list_2):</pre>
<pre id='line952' class='code' style='background-color: #FFFF26'>
    /* "Cython_shift_calculator.pyx":952
 *             non_bonded_list = []
 *             non_bonded_lists.append(non_bonded_list)
 *             for i, atom_id_2 in enumerate(atom_list_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_list.append(i)
 */
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    __pyx_t_2 = __pyx_int_0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_atom_list_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_atom_list_2)) {
      __pyx_t_7 = __pyx_v_atom_list_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_7 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_atom_list_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_9 = Py_TYPE(__pyx_t_7)->tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_9 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_7)) {
        if (__pyx_t_8 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_7)) break;
        __pyx_t_10 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_7, __pyx_t_8); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_8++;
      } else if (!__pyx_t_9 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_7)) {
        if (__pyx_t_8 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_7)) break;
        __pyx_t_10 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_7, __pyx_t_8); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_8++;
      } else {
        __pyx_t_10 = __pyx_t_9(__pyx_t_7);
        if (unlikely(!__pyx_t_10)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_id_2);
      __pyx_v_atom_id_2 = __pyx_t_10;
      __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
      __pyx_v_i = __pyx_t_2;
      __pyx_t_10 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
      __pyx_t_2 = __pyx_t_10;
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line953")'> 953:                 if self._is_non_bonded(atom_id_1, atom_id_2):</pre>
<pre id='line953' class='code' style='background-color: #FFFF55'>
      /* "Cython_shift_calculator.pyx":953
 *             non_bonded_lists.append(non_bonded_list)
 *             for i, atom_id_2 in enumerate(atom_list_2):
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     non_bonded_list.append(i)
 *         if self._verbose:
 */
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_atom_id_1);<span class='error_goto'> if (unlikely((__pyx_t_11 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_atom_id_2);<span class='error_goto'> if (unlikely((__pyx_t_12 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_13 = __pyx_f_17shift_calculators_26Fast_non_bonded_calculator__is_non_bonded(__pyx_v_self, __pyx_t_11, __pyx_t_12);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line954")'> 954:                     non_bonded_list.append(i)</pre>
<pre id='line954' class='code' style='background-color: #FFFF8d'>
        /* "Cython_shift_calculator.pyx":954
 *             for i, atom_id_2 in enumerate(atom_list_2):
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_list.append(i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             end_time = time()
 */
        __pyx_t_6 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_non_bonded_list, __pyx_v_i);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        goto __pyx_L9;
      }
      __pyx_L9:;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line955")'> 955:         if self._verbose:</pre>
<pre id='line955' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":955
 *                 if self._is_non_bonded(atom_id_1, atom_id_2):
 *                     non_bonded_list.append(i)
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line956")'> 956:             end_time = time()</pre>
<pre id='line956' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":956
 *                     non_bonded_list.append(i)
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 *         return  non_bonded_lists
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line957")'> 957:             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line957' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":957
 *         if self._verbose:
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  non_bonded_lists
 * 
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_list_1);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_atom_list_2);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_29));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, ((PyObject *)__pyx_kp_s_29));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_29));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_2);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_30));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 2, ((PyObject *)__pyx_kp_s_30));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_30));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 3, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 4, ((PyObject *)__pyx_kp_s_31));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 5, ((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_10));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_2 = 0;
    __pyx_t_1 = 0;
    __pyx_t_10 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_7), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line958")'> 958:         return  non_bonded_lists</pre>
<pre id='line958' class='code' style='background-color: #FFFF41'>
  /* "Cython_shift_calculator.pyx":958
 *             end_time = time()
 *             print '   non bonded list targets: ',len(atom_list_1),' remotes: ', len(atom_list_2),' in', "%.17g" %  (end_time-start_time), "seconds"
 *         return  non_bonded_lists             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_non_bonded_lists));
  __pyx_r = ((PyObject *)__pyx_v_non_bonded_lists);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_non_bonded_lists);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_id_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_non_bonded_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom_id_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_22Fast_energy_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_22Fast_energy_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) > 0)) {
    <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); return -1;}
  if (unlikely(__pyx_kwds) && unlikely(<span class='py_c_api'>PyDict_Size</span>(__pyx_kwds) > 0) && unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "__init__", 0))) return -1;
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line959")'> 959: </pre>
<pre id='line959' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line960")'> 960: </pre>
<pre id='line960' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line961")'> 961: cdef class Fast_energy_calculator:</pre>
<pre id='line961' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":961
 * 
 * 
 * cdef class Fast_energy_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _energy_term_cache
 *     cdef object _theory_shifts
 */
struct __pyx_obj_17shift_calculators_Fast_energy_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *__pyx_vtab;
  PyObject *_energy_term_cache;
  PyObject *_theory_shifts;
  PyObject *_observed_shifts;
  int _verbose;
  Simulation *_simulation;
  int calls;
};


/* "Cython_shift_calculator.pyx":961
 * 
 * 
 * cdef class Fast_energy_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef object _energy_term_cache
 *     cdef object _theory_shifts
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator {
  PyObject *(*_get_energy_terms)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_calculated_atom_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_observed_atom_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_get_shift_difference)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
  float (*_adjust_shift)(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, float, float);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *__pyx_vtabptr_17shift_calculators_Fast_energy_calculator;
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *, float, float);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line962")'> 962:     cdef object _energy_term_cache</pre>
<pre id='line962' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line963")'> 963:     cdef object _theory_shifts</pre>
<pre id='line963' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line964")'> 964:     cdef object _observed_shifts</pre>
<pre id='line964' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line965")'> 965:     cdef bint _verbose</pre>
<pre id='line965' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line966")'> 966:     cdef Simulation* _simulation</pre>
<pre id='line966' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line967")'> 967:     cdef int calls</pre>
<pre id='line967' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line968")'> 968: </pre>
<pre id='line968' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line969")'> 969:     def __init__(self):</pre>
<pre id='line969' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":969
 *     cdef int calls
 * 
 *     def __init__(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._energy_term_cache =  None
 *         self._theory_shifts =   None
 */

static int __pyx_pf_17shift_calculators_22Fast_energy_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 969);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line970")'> 970:         self._energy_term_cache =  None</pre>
<pre id='line970' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":970
 * 
 *     def __init__(self):
 *         self._energy_term_cache =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._theory_shifts =   None
 *         self._observed_shifts =  None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_energy_term_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_energy_term_cache);
  __pyx_v_self->_energy_term_cache = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line971")'> 971:         self._theory_shifts =   None</pre>
<pre id='line971' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":971
 *     def __init__(self):
 *         self._energy_term_cache =  None
 *         self._theory_shifts =   None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._observed_shifts =  None
 *         self._verbose = False
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_theory_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_theory_shifts);
  __pyx_v_self->_theory_shifts = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line972")'> 972:         self._observed_shifts =  None</pre>
<pre id='line972' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":972
 *         self._energy_term_cache =  None
 *         self._theory_shifts =   None
 *         self._observed_shifts =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self._simulation = currentSimulation()
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_observed_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_observed_shifts);
  __pyx_v_self->_observed_shifts = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line973")'> 973:         self._verbose = False</pre>
<pre id='line973' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":973
 *         self._theory_shifts =   None
 *         self._observed_shifts =  None
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 *         self.calls = 0
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line974")'> 974:         self._simulation = currentSimulation()</pre>
<pre id='line974' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":974
 *         self._observed_shifts =  None
 *         self._verbose = False
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.calls = 0
 * 
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line975")'> 975:         self.calls = 0</pre>
<pre id='line975' class='code' style='background-color: #FFFFb6'>
  /* "Cython_shift_calculator.pyx":975
 *         self._verbose = False
 *         self._simulation = currentSimulation()
 *         self.calls = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_v_self->calls = 0;

  __pyx_r = 0;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_3set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_2set_simulation(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line976")'> 976: </pre>
<pre id='line976' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line977")'> 977:     def set_simulation(self):</pre>
<pre id='line977' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":977
 *         self.calls = 0
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation = currentSimulation()
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_2set_simulation(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_simulation", __pyx_f[0], 977);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line978")'> 978:         self._simulation = currentSimulation()</pre>
<pre id='line978' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":978
 * 
 *     def set_simulation(self):
 *         self._simulation = currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_5set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_4set_verbose(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line979")'> 979: </pre>
<pre id='line979' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line980")'> 980:     def set_verbose(self,on):</pre>
<pre id='line980' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":980
 *         self._simulation = currentSimulation()
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_4set_verbose(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_verbose", __pyx_f[0], 980);
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line981")'> 981:         self._verbose = on</pre>
<pre id='line981' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":981
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_observed_shifts(self, observed_shifts):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 981; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_7set_observed_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_observed_shifts); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_7set_observed_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_observed_shifts) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_observed_shifts (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_6set_observed_shifts(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_observed_shifts));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line982")'> 982: </pre>
<pre id='line982' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line983")'> 983:     def set_observed_shifts(self, observed_shifts):</pre>
<pre id='line983' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":983
 *         self._verbose = on
 * 
 *     def set_observed_shifts(self, observed_shifts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._observed_shifts =  observed_shifts
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_6set_observed_shifts(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_observed_shifts) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_observed_shifts", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_observed_shifts", __pyx_f[0], 983);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line984")'> 984:         self._observed_shifts =  observed_shifts</pre>
<pre id='line984' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":984
 * 
 *     def set_observed_shifts(self, observed_shifts):
 *         self._observed_shifts =  observed_shifts             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_calculated_shifts(self, calculated_shifts):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_observed_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_observed_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_observed_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_observed_shifts);
  __pyx_v_self->_observed_shifts = __pyx_v_observed_shifts;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_9set_calculated_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_calculated_shifts); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_9set_calculated_shifts(PyObject *__pyx_v_self, PyObject *__pyx_v_calculated_shifts) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_calculated_shifts (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_8set_calculated_shifts(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_calculated_shifts));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line985")'> 985: </pre>
<pre id='line985' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line986")'> 986:     def set_calculated_shifts(self, calculated_shifts):</pre>
<pre id='line986' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":986
 *         self._observed_shifts =  observed_shifts
 * 
 *     def set_calculated_shifts(self, calculated_shifts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._theory_shifts =  calculated_shifts
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_8set_calculated_shifts(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_calculated_shifts) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_calculated_shifts", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_calculated_shifts", __pyx_f[0], 986);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line987")'> 987:         self._theory_shifts =  calculated_shifts</pre>
<pre id='line987' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":987
 * 
 *     def set_calculated_shifts(self, calculated_shifts):
 *         self._theory_shifts =  calculated_shifts             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_calculated_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_calculated_shifts);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_theory_shifts);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_theory_shifts);
  __pyx_v_self->_theory_shifts = __pyx_v_calculated_shifts;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_11set_energy_term_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_energy_term_cache); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_11set_energy_term_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_energy_term_cache) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_energy_term_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_10set_energy_term_cache(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_energy_term_cache));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line988")'> 988: </pre>
<pre id='line988' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line989")'> 989:     def set_energy_term_cache(self, energy_term_cache ):</pre>
<pre id='line989' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":989
 *         self._theory_shifts =  calculated_shifts
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._energy_term_cache =  energy_term_cache
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_10set_energy_term_cache(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_energy_term_cache) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_energy_term_cache", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_energy_term_cache", __pyx_f[0], 989);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line990")'> 990:         self._energy_term_cache =  energy_term_cache</pre>
<pre id='line990' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":990
 * 
 *     def set_energy_term_cache(self, energy_term_cache ):
 *         self._energy_term_cache =  energy_term_cache             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _get_energy_terms(self, int target_atom_index):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_energy_term_cache);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_energy_term_cache);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_energy_term_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_energy_term_cache);
  __pyx_v_self->_energy_term_cache = __pyx_v_energy_term_cache;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line991")'> 991: </pre>
<pre id='line991' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line992")'> 992:     cdef _get_energy_terms(self, int target_atom_index):</pre>
<pre id='line992' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":992
 *         self._energy_term_cache =  energy_term_cache
 * 
 *     cdef _get_energy_terms(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._energy_term_cache[target_atom_index]
 * 
 */

static PyObject *__pyx_f_17shift_calculators_22Fast_energy_calculator__get_energy_terms(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_energy_terms", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_get_energy_terms", __pyx_f[0], 992);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line993")'> 993:         return self._energy_term_cache[target_atom_index]</pre>
<pre id='line993' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":993
 * 
 *     cdef _get_energy_terms(self, int target_atom_index):
 *         return self._energy_term_cache[target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_self->_energy_term_cache, __pyx_v_target_atom_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 993; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator._get_energy_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line994")'> 994: </pre>
<pre id='line994' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line995")'> 995:     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):</pre>
<pre id='line995' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":995
 *         return self._energy_term_cache[target_atom_index]
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._theory_shifts[target_atom_index]
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  float __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_calculated_atom_shift", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_get_calculated_atom_shift", __pyx_f[0], 995);
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line996")'> 996:         return self._theory_shifts[target_atom_index]</pre>
<pre id='line996' class='code' style='background-color: #FFFF57'>
  /* "Cython_shift_calculator.pyx":996
 * 
 *     cdef inline float  _get_calculated_atom_shift(self, int target_atom_index):
 *         return self._theory_shifts[target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float _get_observed_atom_shift(self, int target_atom_index):
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_self->_theory_shifts, __pyx_v_target_atom_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_energy_calculator._get_calculated_atom_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line997")'> 997: </pre>
<pre id='line997' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line998")'> 998:     cdef inline float _get_observed_atom_shift(self, int target_atom_index):</pre>
<pre id='line998' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":998
 *         return self._theory_shifts[target_atom_index]
 * 
 *     cdef inline float _get_observed_atom_shift(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._observed_shifts.get_chemical_shift(target_atom_index)
 * 
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  float __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_observed_atom_shift", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_get_observed_atom_shift", __pyx_f[0], 998);
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line999")'> 999:         return self._observed_shifts.get_chemical_shift(target_atom_index)</pre>
<pre id='line999' class='code' style='background-color: #FFFF31'>
  /* "Cython_shift_calculator.pyx":999
 * 
 *     cdef inline float _get_observed_atom_shift(self, int target_atom_index):
 *         return self._observed_shifts.get_chemical_shift(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float  _get_shift_difference(self, int target_atom_index):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_observed_shifts, __pyx_n_s__get_chemical_shift);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_target_atom_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 999; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_energy_calculator._get_observed_atom_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1000")'> 1000: </pre>
<pre id='line1000' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1001")'> 1001:     cdef inline float  _get_shift_difference(self, int target_atom_index):</pre>
<pre id='line1001' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1001
 *         return self._observed_shifts.get_chemical_shift(target_atom_index)
 * 
 *     cdef inline float  _get_shift_difference(self, int target_atom_index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float theory_shift
 *         cdef float observed_shift
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, int __pyx_v_target_atom_index) {
  float __pyx_v_theory_shift;
  float __pyx_v_observed_shift;
  float __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_shift_difference", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_get_shift_difference", __pyx_f[0], 1001);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1002")'> 1002:         cdef float theory_shift</pre>
<pre id='line1002' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1003")'> 1003:         cdef float observed_shift</pre>
<pre id='line1003' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1004")'> 1004:         theory_shift = self._get_calculated_atom_shift(target_atom_index)</pre>
<pre id='line1004' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1004
 *         cdef float theory_shift
 *         cdef float observed_shift
 *         theory_shift = self._get_calculated_atom_shift(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         observed_shift = self._get_observed_atom_shift(target_atom_index)
 */
  __pyx_v_theory_shift = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_calculated_atom_shift(__pyx_v_self, __pyx_v_target_atom_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1005")'> 1005: </pre>
<pre id='line1005' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1006")'> 1006:         observed_shift = self._get_observed_atom_shift(target_atom_index)</pre>
<pre id='line1006' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1006
 *         theory_shift = self._get_calculated_atom_shift(target_atom_index)
 * 
 *         observed_shift = self._get_observed_atom_shift(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return observed_shift - theory_shift
 */
  __pyx_v_observed_shift = __pyx_f_17shift_calculators_22Fast_energy_calculator__get_observed_atom_shift(__pyx_v_self, __pyx_v_target_atom_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1007")'> 1007: </pre>
<pre id='line1007' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1008")'> 1008:         return observed_shift - theory_shift</pre>
<pre id='line1008' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":1008
 *         observed_shift = self._get_observed_atom_shift(target_atom_index)
 * 
 *         return observed_shift - theory_shift             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):
 */
  __pyx_r = (__pyx_v_observed_shift - __pyx_v_theory_shift);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1009")'> 1009: </pre>
<pre id='line1009' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1010")'> 1010:     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):</pre>
<pre id='line1010' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1010
 *         return observed_shift - theory_shift
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = 0.0
 *         if (shift_diff > 0.0):
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, float __pyx_v_shift_diff, float __pyx_v_flat_bottom_shift_limit) {
  double __pyx_v_result;
  float __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_adjust_shift", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_adjust_shift", __pyx_f[0], 1010);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1011")'> 1011:         result  = 0.0</pre>
<pre id='line1011' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1011
 * 
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):
 *         result  = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if (shift_diff > 0.0):
 *             result = shift_diff-flat_bottom_shift_limit
 */
  __pyx_v_result = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1012")'> 1012:         if (shift_diff &gt; 0.0):</pre>
<pre id='line1012' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1012
 *     cdef inline float _adjust_shift(self, float shift_diff, float flat_bottom_shift_limit):
 *         result  = 0.0
 *         if (shift_diff > 0.0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result = shift_diff-flat_bottom_shift_limit
 *         else:
 */
  __pyx_t_1 = (__pyx_v_shift_diff > 0.0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1013")'> 1013:             result = shift_diff-flat_bottom_shift_limit</pre>
<pre id='line1013' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1013
 *         result  = 0.0
 *         if (shift_diff > 0.0):
 *             result = shift_diff-flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit
 */
    __pyx_v_result = (__pyx_v_shift_diff - __pyx_v_flat_bottom_shift_limit);
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1014")'> 1014:         else:</pre>
<pre id='line1014' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1015")'> 1015:             result = shift_diff + flat_bottom_shift_limit</pre>
<pre id='line1015' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1015
 *             result = shift_diff-flat_bottom_shift_limit
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
    __pyx_v_result = (__pyx_v_shift_diff + __pyx_v_flat_bottom_shift_limit);
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line1016")'> 1016:         return result</pre>
<pre id='line1016' class='code' style='background-color: #FFFF46'>
  /* "Cython_shift_calculator.pyx":1016
 *         else:
 *             result = shift_diff + flat_bottom_shift_limit
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __call__(self,target_atom_ids):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_13__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_22Fast_energy_calculator_13__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_target_atom_ids = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1018; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_target_atom_ids = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1018; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_22Fast_energy_calculator_12__call__(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_v_target_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1017")'> 1017: </pre>
<pre id='line1017' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1018")'> 1018:     def __call__(self,target_atom_ids):</pre>
<pre id='line1018' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1018
 *         return result
 * 
 *     def __call__(self,target_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 *         cdef float energy
 */

static PyObject *__pyx_pf_17shift_calculators_22Fast_energy_calculator_12__call__(struct __pyx_obj_17shift_calculators_Fast_energy_calculator *__pyx_v_self, PyObject *__pyx_v_target_atom_ids) {
  float __pyx_v_energy;
  float __pyx_v_flat_bottom_shift_limit;
  float __pyx_v_adjusted_shift_diff;
  float __pyx_v_end_harmonic;
  float __pyx_v_scale_harmonic;
  float __pyx_v_energy_component;
  float __pyx_v_tanh_amplitude;
  float __pyx_v_tanh_elongation;
  float __pyx_v_tanh_y_offset;
  float __pyx_v_tanh_argument;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_target_atom_index = NULL;
  PyObject *__pyx_v_shift_diff = NULL;
  PyObject *__pyx_v_energy_terms = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1018);
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1019")'> 1019:         self.set_simulation()</pre>
<pre id='line1019' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1019
 * 
 *     def __call__(self,target_atom_ids):
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float energy
 *         cdef float flat_bottom_shift_limit
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1020")'> 1020:         cdef float energy</pre>
<pre id='line1020' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1021")'> 1021:         cdef float flat_bottom_shift_limit</pre>
<pre id='line1021' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1022")'> 1022:         cdef float adjusted_shift_diff</pre>
<pre id='line1022' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1023")'> 1023:         cdef float end_harmonic</pre>
<pre id='line1023' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1024")'> 1024:         cdef float scale_harmonic</pre>
<pre id='line1024' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1025")'> 1025:         cdef float energy_component</pre>
<pre id='line1025' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1026")'> 1026:         cdef float tanh_amplitude</pre>
<pre id='line1026' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1027")'> 1027:         cdef float tanh_elongation</pre>
<pre id='line1027' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1028")'> 1028:         cdef float tanh_y_offset</pre>
<pre id='line1028' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1029")'> 1029:         cdef float tanh_argument</pre>
<pre id='line1029' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1030")'> 1030: </pre>
<pre id='line1030' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1031")'> 1031:         cdef double start_time = 0.0</pre>
<pre id='line1031' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1031
 *         cdef float tanh_argument
 * 
 *         cdef double start_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time = 0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1032")'> 1032:         cdef double end_time = 0.0</pre>
<pre id='line1032' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1032
 * 
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1033")'> 1033:         if self._verbose:</pre>
<pre id='line1033' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1033
 *         cdef double start_time = 0.0
 *         cdef double end_time = 0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1034")'> 1034:             start_time = time()</pre>
<pre id='line1034' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1034
 *         cdef double end_time = 0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         energy = 0.0
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1034; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1034; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1034; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1035")'> 1035: </pre>
<pre id='line1035' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1036")'> 1036:         energy = 0.0</pre>
<pre id='line1036' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1036
 *             start_time = time()
 * 
 *         energy = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for target_atom_index in target_atom_ids:
 */
  __pyx_v_energy = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1037")'> 1037: </pre>
<pre id='line1037' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line1038")'> 1038:         for target_atom_index in target_atom_ids:</pre>
<pre id='line1038' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":1038
 *         energy = 0.0
 * 
 *         for target_atom_index in target_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             shift_diff = self._get_shift_difference(target_atom_index)
 *             energy_terms = self._get_energy_terms(target_atom_index)
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_target_atom_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_target_atom_ids)) {
    __pyx_t_1 = __pyx_v_target_atom_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_target_atom_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1038; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1038; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_atom_index);
    __pyx_v_target_atom_index = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1039")'> 1039:             shift_diff = self._get_shift_difference(target_atom_index)</pre>
<pre id='line1039' class='code' style='background-color: #FFFF62'>
    /* "Cython_shift_calculator.pyx":1039
 * 
 *         for target_atom_index in target_atom_ids:
 *             shift_diff = self._get_shift_difference(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             energy_terms = self._get_energy_terms(target_atom_index)
 * 
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_target_atom_index);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(__pyx_v_self, __pyx_t_6));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_shift_diff);
    __pyx_v_shift_diff = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1040")'> 1040:             energy_terms = self._get_energy_terms(target_atom_index)</pre>
<pre id='line1040' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":1040
 *         for target_atom_index in target_atom_ids:
 *             shift_diff = self._get_shift_difference(target_atom_index)
 *             energy_terms = self._get_energy_terms(target_atom_index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_target_atom_index);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1040; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator *)__pyx_v_self->__pyx_vtab)->_get_energy_terms(__pyx_v_self, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1040; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
    __pyx_v_energy_terms = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1041")'> 1041: </pre>
<pre id='line1041' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1042")'> 1042: </pre>
<pre id='line1042' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1043")'> 1043:             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit</pre>
<pre id='line1043' class='code' style='background-color: #FFFF62'>
    /* "Cython_shift_calculator.pyx":1043
 * 
 * 
 *             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s_32);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_flat_bottom_shift_limit = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1044")'> 1044: </pre>
<pre id='line1044' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1045")'> 1045: </pre>
<pre id='line1045' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line1046")'> 1046:             if abs(shift_diff) &gt; flat_bottom_shift_limit:</pre>
<pre id='line1046' class='code' style='background-color: #FFFF4d'>
    /* "Cython_shift_calculator.pyx":1046
 * 
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 * 
 */
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Absolute</span>(__pyx_v_shift_diff);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_flat_bottom_shift_limit);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
    __pyx_t_9 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_t_8, Py_GT);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_10 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(__pyx_t_10 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1046; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1047")'> 1047:                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)</pre>
<pre id='line1047' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":1047
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 end_harmonic = energy_terms.end_harmonic
 */
      __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_shift_diff);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_v_adjusted_shift_diff = __pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(__pyx_v_self, __pyx_t_7, __pyx_v_flat_bottom_shift_limit);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1048")'> 1048: </pre>
<pre id='line1048' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1049")'> 1049:                 end_harmonic = energy_terms.end_harmonic</pre>
<pre id='line1049' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":1049
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 * 
 *                 end_harmonic = energy_terms.end_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 scale_harmonic = energy_terms.scale_harmonic
 * 
 */
      __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__end_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1049; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1049; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_v_end_harmonic = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1050")'> 1050:                 scale_harmonic = energy_terms.scale_harmonic</pre>
<pre id='line1050' class='code' style='background-color: #FFFF62'>
      /* "Cython_shift_calculator.pyx":1050
 * 
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__scale_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
      __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_v_scale_harmonic = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1051")'> 1051: </pre>
<pre id='line1051' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1052")'> 1052: </pre>
<pre id='line1052' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1053")'> 1053:                 energy_component = 0.0</pre>
<pre id='line1053' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1053
 * 
 * 
 *                 energy_component = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2
 */
      __pyx_v_energy_component = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1054")'> 1054:                 if adjusted_shift_diff &lt; end_harmonic:</pre>
<pre id='line1054' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1054
 * 
 *                 energy_component = 0.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2
 *                 else:
 */
      __pyx_t_10 = (__pyx_v_adjusted_shift_diff <code><</code> __pyx_v_end_harmonic);
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1055")'> 1055:                     energy_component = (adjusted_shift_diff/scale_harmonic)**2</pre>
<pre id='line1055' class='code' style='background-color: #FFFFaa'>
        /* "Cython_shift_calculator.pyx":1055
 *                 energy_component = 0.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 *                     tanh_amplitude = energy_terms.tanh_amplitude
 */
        if (unlikely(__pyx_v_scale_harmonic == 0)) {
          <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1055; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_v_energy_component = powf((__pyx_v_adjusted_shift_diff / __pyx_v_scale_harmonic), 2.0);
        goto __pyx_L7;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1056")'> 1056:                 else:</pre>
<pre id='line1056' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1057")'> 1057:                     tanh_amplitude = energy_terms.tanh_amplitude</pre>
<pre id='line1057' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":1057
 *                     energy_component = (adjusted_shift_diff/scale_harmonic)**2
 *                 else:
 *                     tanh_amplitude = energy_terms.tanh_amplitude             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     tanh_elongation = energy_terms.tanh_elongation
 *                     tanh_y_offset = energy_terms.tanh_y_offset
 */
        __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_amplitude);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
        __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_v_tanh_amplitude = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1058")'> 1058:                     tanh_elongation = energy_terms.tanh_elongation</pre>
<pre id='line1058' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":1058
 *                 else:
 *                     tanh_amplitude = energy_terms.tanh_amplitude
 *                     tanh_elongation = energy_terms.tanh_elongation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     tanh_y_offset = energy_terms.tanh_y_offset
 * 
 */
        __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_elongation);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
        __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_v_tanh_elongation = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1059")'> 1059:                     tanh_y_offset = energy_terms.tanh_y_offset</pre>
<pre id='line1059' class='code' style='background-color: #FFFF62'>
        /* "Cython_shift_calculator.pyx":1059
 *                     tanh_amplitude = energy_terms.tanh_amplitude
 *                     tanh_elongation = energy_terms.tanh_elongation
 *                     tanh_y_offset = energy_terms.tanh_y_offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)
 */
        __pyx_t_9 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_y_offset);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1059; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
        __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1059; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_v_tanh_y_offset = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1060")'> 1060: </pre>
<pre id='line1060' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1061")'> 1061:                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)</pre>
<pre id='line1061' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1061
 *                     tanh_y_offset = energy_terms.tanh_y_offset
 * 
 *                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;
 * 
 */
        __pyx_v_tanh_argument = (__pyx_v_tanh_elongation * (__pyx_v_adjusted_shift_diff - __pyx_v_end_harmonic));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1062")'> 1062:                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;</pre>
<pre id='line1062' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1062
 * 
 *                     tanh_argument = tanh_elongation * (adjusted_shift_diff - end_harmonic)
 *                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 energy += energy_component
 */
        __pyx_v_energy_component = ((__pyx_v_tanh_amplitude * tanh(__pyx_v_tanh_argument)) + __pyx_v_tanh_y_offset);
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1063")'> 1063: </pre>
<pre id='line1063' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1064")'> 1064:                 energy += energy_component</pre>
<pre id='line1064' class='code' style='background-color: #FFFFe7'>
      /* "Cython_shift_calculator.pyx":1064
 *                     energy_component = tanh_amplitude * tanh(tanh_argument) + tanh_y_offset;
 * 
 *                 energy += energy_component             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
      __pyx_v_energy = (__pyx_v_energy + __pyx_v_energy_component);
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1065")'> 1065: </pre>
<pre id='line1065' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1066")'> 1066:         if self._verbose:</pre>
<pre id='line1066' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1066
 *                 energy += energy_component
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1067")'> 1067:             end_time = time()</pre>
<pre id='line1067' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1067
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1067; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1067; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1067; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF36' onclick='toggleDiv("line1068")'> 1068:             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1068' class='code' style='background-color: #FFFF36'>
    /* "Cython_shift_calculator.pyx":1068
 *         if self._verbose:
 *             end_time = time()
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.calls += 1
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_target_atom_ids);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_9);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_8 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_8));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_33));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_33));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_33));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_9);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, ((PyObject *)__pyx_kp_s_31));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject *)__pyx_t_8));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_8));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_9 = 0;
    __pyx_t_8 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1069")'> 1069: </pre>
<pre id='line1069' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1070")'> 1070:         self.calls += 1</pre>
<pre id='line1070' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1070
 *             print '   energy calculator: ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 *         self.calls += 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return energy
 * 
 */
  __pyx_v_self->calls = (__pyx_v_self->calls + 1);
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line1071")'> 1071:         return energy</pre>
<pre id='line1071' class='code' style='background-color: #FFFF31'>
  /* "Cython_shift_calculator.pyx":1071
 * 
 *         self.calls += 1
 *         return energy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_energy_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_atom_index);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_shift_diff);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_28Fast_force_factor_calculator_1__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_28Fast_force_factor_calculator_1__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_target_atom_ids = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_ids,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_ids);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_target_atom_ids = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_force_factor_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_28Fast_force_factor_calculator___call__(((struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self), __pyx_v_target_atom_ids);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1072")'> 1072: </pre>
<pre id='line1072' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1073")'> 1073: cdef class Fast_force_factor_calculator(Fast_energy_calculator):</pre>
<pre id='line1073' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1073
 *         return energy
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __call__(self, target_atom_ids):
 */
struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator {
  struct __pyx_obj_17shift_calculators_Fast_energy_calculator __pyx_base;
};



/* "Cython_shift_calculator.pyx":1073
 *         return energy
 * 
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __call__(self, target_atom_ids):
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_energy_calculator __pyx_base;
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *__pyx_vtabptr_17shift_calculators_Fast_force_factor_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1074")'> 1074: </pre>
<pre id='line1074' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1075")'> 1075:     def __call__(self, target_atom_ids):</pre>
<pre id='line1075' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1075
 * cdef class Fast_force_factor_calculator(Fast_energy_calculator):
 * 
 *     def __call__(self, target_atom_ids):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 */

static PyObject *__pyx_pf_17shift_calculators_28Fast_force_factor_calculator___call__(struct __pyx_obj_17shift_calculators_Fast_force_factor_calculator *__pyx_v_self, PyObject *__pyx_v_target_atom_ids) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_target_atom_id = NULL;
  PyObject *__pyx_v_factor = NULL;
  PyObject *__pyx_v_shift_diff = NULL;
  PyObject *__pyx_v_energy_terms = NULL;
  PyObject *__pyx_v_flat_bottom_shift_limit = NULL;
  PyObject *__pyx_v_adjusted_shift_diff = NULL;
  PyObject *__pyx_v_end_harmonic = NULL;
  PyObject *__pyx_v_scale_harmonic = NULL;
  PyObject *__pyx_v_sqr_scale_harmonic = NULL;
  PyObject *__pyx_v_weight = NULL;
  PyObject *__pyx_v_tanh_amplitude = NULL;
  PyObject *__pyx_v_tanh_elongation = NULL;
  double __pyx_v_fact;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1075);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1076")'> 1076:         cdef double start_time =0.0</pre>
<pre id='line1076' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1076
 * 
 *     def __call__(self, target_atom_ids):
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1077")'> 1077:         cdef double end_time =0.0</pre>
<pre id='line1077' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1077
 *     def __call__(self, target_atom_ids):
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1078")'> 1078:         if self._verbose:</pre>
<pre id='line1078' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1078
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1079")'> 1079:             start_time = time()</pre>
<pre id='line1079' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1079
 *         cdef double end_time =0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.set_simulation()
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1080")'> 1080: </pre>
<pre id='line1080' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1081")'> 1081:         self.set_simulation()</pre>
<pre id='line1081' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1081
 *             start_time = time()
 * 
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = []
 *         for target_atom_id in target_atom_ids:
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1082")'> 1082:         result  = []</pre>
<pre id='line1082' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1082
 * 
 *         self.set_simulation()
 *         result  = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for target_atom_id in target_atom_ids:
 *             factor  = 0.0
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line1083")'> 1083:         for target_atom_id in target_atom_ids:</pre>
<pre id='line1083' class='code' style='background-color: #FFFF2b'>
  /* "Cython_shift_calculator.pyx":1083
 *         self.set_simulation()
 *         result  = []
 *         for target_atom_id in target_atom_ids:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor  = 0.0
 * 
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_target_atom_ids) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_target_atom_ids)) {
    __pyx_t_1 = __pyx_v_target_atom_ids; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_target_atom_ids);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1083; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1083; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_atom_id);
    __pyx_v_target_atom_id = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1084")'> 1084:             factor  = 0.0</pre>
<pre id='line1084' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":1084
 *         result  = []
 *         for target_atom_id in target_atom_ids:
 *             factor  = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1084; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_factor);
    __pyx_v_factor = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1085")'> 1085: </pre>
<pre id='line1085' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1086")'> 1086: </pre>
<pre id='line1086' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1087")'> 1087:             shift_diff = self._get_shift_difference(target_atom_id)</pre>
<pre id='line1087' class='code' style='background-color: #FFFF62'>
    /* "Cython_shift_calculator.pyx":1087
 * 
 * 
 *             shift_diff = self._get_shift_difference(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             energy_terms = self._get_energy_terms(target_atom_id)
 * 
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_target_atom_id);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1087; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_22Fast_energy_calculator__get_shift_difference(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_t_6));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1087; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_shift_diff);
    __pyx_v_shift_diff = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1088")'> 1088:             energy_terms = self._get_energy_terms(target_atom_id)</pre>
<pre id='line1088' class='code' style='background-color: #FFFF79'>
    /* "Cython_shift_calculator.pyx":1088
 * 
 *             shift_diff = self._get_shift_difference(target_atom_id)
 *             energy_terms = self._get_energy_terms(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_target_atom_id);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_2 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_force_factor_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base._get_energy_terms(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
    __pyx_v_energy_terms = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1089")'> 1089: </pre>
<pre id='line1089' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1090")'> 1090: </pre>
<pre id='line1090' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1091")'> 1091: </pre>
<pre id='line1091' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1092")'> 1092:             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit</pre>
<pre id='line1092' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":1092
 * 
 * 
 *             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s_32);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1092; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_flat_bottom_shift_limit);
    __pyx_v_flat_bottom_shift_limit = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1093")'> 1093: </pre>
<pre id='line1093' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1094")'> 1094:             if abs(shift_diff) &gt; flat_bottom_shift_limit:</pre>
<pre id='line1094' class='code' style='background-color: #FFFF5e'>
    /* "Cython_shift_calculator.pyx":1094
 *             flat_bottom_shift_limit = energy_terms.flat_bottom_shift_limit
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *                 end_harmonic = energy_terms.end_harmonic
 */
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Absolute</span>(__pyx_v_shift_diff);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_v_flat_bottom_shift_limit, Py_GT);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_8 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1094; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line1095")'> 1095:                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)</pre>
<pre id='line1095' class='code' style='background-color: #FFFF46'>
      /* "Cython_shift_calculator.pyx":1095
 * 
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic
 */
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_shift_diff);<span class='error_goto'> if (unlikely((__pyx_t_9 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_flat_bottom_shift_limit);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_22Fast_energy_calculator__adjust_shift(((struct __pyx_obj_17shift_calculators_Fast_energy_calculator *)__pyx_v_self), __pyx_t_9, __pyx_t_10));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1095; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adjusted_shift_diff);
      __pyx_v_adjusted_shift_diff = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1096")'> 1096:                 end_harmonic = energy_terms.end_harmonic</pre>
<pre id='line1096' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1096
 *             if abs(shift_diff) > flat_bottom_shift_limit:
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *                 end_harmonic = energy_terms.end_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 scale_harmonic = energy_terms.scale_harmonic
 *                 sqr_scale_harmonic = scale_harmonic**2
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__end_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_end_harmonic);
      __pyx_v_end_harmonic = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1097")'> 1097:                 scale_harmonic = energy_terms.scale_harmonic</pre>
<pre id='line1097' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1097
 *                 adjusted_shift_diff = self._adjust_shift(shift_diff, flat_bottom_shift_limit)
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sqr_scale_harmonic = scale_harmonic**2
 * 
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__scale_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_scale_harmonic);
      __pyx_v_scale_harmonic = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1098")'> 1098:                 sqr_scale_harmonic = scale_harmonic**2</pre>
<pre id='line1098' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1098
 *                 end_harmonic = energy_terms.end_harmonic
 *                 scale_harmonic = energy_terms.scale_harmonic
 *                 sqr_scale_harmonic = scale_harmonic**2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 weight = energy_terms.weight
 */
      __pyx_t_7 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_scale_harmonic, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sqr_scale_harmonic);
      __pyx_v_sqr_scale_harmonic = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1099")'> 1099: </pre>
<pre id='line1099' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1100")'> 1100:                 weight = energy_terms.weight</pre>
<pre id='line1100' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1100
 *                 sqr_scale_harmonic = scale_harmonic**2
 * 
 *                 weight = energy_terms.weight             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 tanh_amplitude = energy_terms.tanh_amplitude
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__weight);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_weight);
      __pyx_v_weight = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1101")'> 1101: </pre>
<pre id='line1101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1102")'> 1102:                 tanh_amplitude = energy_terms.tanh_amplitude</pre>
<pre id='line1102' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1102
 *                 weight = energy_terms.weight
 * 
 *                 tanh_amplitude = energy_terms.tanh_amplitude             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 tanh_elongation = energy_terms.tanh_elongation
 * 
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_amplitude);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_amplitude);
      __pyx_v_tanh_amplitude = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1103")'> 1103:                 tanh_elongation = energy_terms.tanh_elongation</pre>
<pre id='line1103' class='code' style='background-color: #FFFF9f'>
      /* "Cython_shift_calculator.pyx":1103
 * 
 *                 tanh_amplitude = energy_terms.tanh_amplitude
 *                 tanh_elongation = energy_terms.tanh_elongation             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 # TODO: add factor and lambda to give fact
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_energy_terms, __pyx_n_s__tanh_elongation);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_elongation);
      __pyx_v_tanh_elongation = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1104")'> 1104: </pre>
<pre id='line1104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1105")'> 1105:                 # TODO: add factor and lambda to give fact</pre>
<pre id='line1105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1106")'> 1106:                 fact =1.0</pre>
<pre id='line1106' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1106
 * 
 *                 # TODO: add factor and lambda to give fact
 *                 fact =1.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 */
      __pyx_v_fact = 1.0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1107")'> 1107:                 if adjusted_shift_diff &lt; end_harmonic:</pre>
<pre id='line1107' class='code' style='background-color: #FFFF79'>
      /* "Cython_shift_calculator.pyx":1107
 *                 # TODO: add factor and lambda to give fact
 *                 fact =1.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 *                 else:
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_adjusted_shift_diff, __pyx_v_end_harmonic, Py_LT);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_8 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line1108")'> 1108:                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;</pre>
<pre id='line1108' class='code' style='background-color: #FFFF37'>
        /* "Cython_shift_calculator.pyx":1108
 *                 fact =1.0
 *                 if adjusted_shift_diff <code><</code> end_harmonic:
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 *                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;
 */
        __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(2.0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_v_weight);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_v_adjusted_shift_diff);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_fact);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_11, __pyx_v_sqr_scale_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_factor);
        __pyx_v_factor = __pyx_t_2;
        __pyx_t_2 = 0;
        goto __pyx_L7;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1109")'> 1109:                 else:</pre>
<pre id='line1109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line1110")'> 1110:                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;</pre>
<pre id='line1110' class='code' style='background-color: #FFFF25'>
        /* "Cython_shift_calculator.pyx":1110
 *                     factor = 2.0 * weight * adjusted_shift_diff * fact / sqr_scale_harmonic;
 *                 else:
 *                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             result.append(factor)
 */
        __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_weight, __pyx_v_tanh_amplitude);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_v_tanh_elongation);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_adjusted_shift_diff, __pyx_v_end_harmonic);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_tanh_elongation, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(pow(cosh(__pyx_t_3), 2.0));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        __pyx_t_2 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_11, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_fact);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_factor);
        __pyx_v_factor = __pyx_t_11;
        __pyx_t_11 = 0;
      }
      __pyx_L7:;
      goto __pyx_L6;
    }
    __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1111")'> 1111: </pre>
<pre id='line1111' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1112")'> 1112:             result.append(factor)</pre>
<pre id='line1112' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":1112
 *                     factor = weight * tanh_amplitude * tanh_elongation / (cosh(tanh_elongation * (adjusted_shift_diff - end_harmonic)))**2.0 * fact;
 * 
 *             result.append(factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
    __pyx_t_12 = <span class='py_c_api'>PyList_Append</span>(__pyx_v_result, __pyx_v_factor);<span class='error_goto'> if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1113")'> 1113: </pre>
<pre id='line1113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1114")'> 1114:         if self._verbose:</pre>
<pre id='line1114' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1114
 *             result.append(factor)
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1115")'> 1115:             end_time = time()</pre>
<pre id='line1115' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1115
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_11 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF36' onclick='toggleDiv("line1116")'> 1116:             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1116' class='code' style='background-color: #FFFF36'>
    /* "Cython_shift_calculator.pyx":1116
 *         if self._verbose:
 *             end_time = time()
 *             print '   force factors : ',len(target_atom_ids),' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_target_atom_ids);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_11 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_7));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_34));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_34));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_34));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_11);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, ((PyObject *)__pyx_kp_s_31));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject *)__pyx_t_7));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_7));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_11 = 0;
    __pyx_t_7 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1117")'> 1117: </pre>
<pre id='line1117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1118")'> 1118: </pre>
<pre id='line1118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line1119")'> 1119:         return  result</pre>
<pre id='line1119' class='code' style='background-color: #FFFF48'>
  /* "Cython_shift_calculator.pyx":1119
 * 
 * 
 *         return  result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cdef class Base_force_calculator:
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_force_factor_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_atom_id);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_factor);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_shift_diff);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_energy_terms);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_flat_bottom_shift_limit);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adjusted_shift_diff);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_end_harmonic);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_scale_harmonic);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sqr_scale_harmonic);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_weight);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_amplitude);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tanh_elongation);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_21Base_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_21Base_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_potential = 0;
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__potential,&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[2] = {0,0};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1120")'> 1120: cdef class Base_force_calculator:</pre>
<pre id='line1120' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1120
 * 
 *         return  result
 * cdef class Base_force_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef object _components
 */
struct __pyx_obj_17shift_calculators_Base_force_calculator {
  PyObject_HEAD
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *__pyx_vtab;
  PyObject *_components;
  int _verbose;
  Simulation *_simulation;
  PyObject *_name;
};


/* "Cython_shift_calculator.pyx":1120
 * 
 *         return  result
 * cdef class Base_force_calculator:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef object _components
 */

struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator {
  PyObject *(*_get_component)(struct __pyx_obj_17shift_calculators_Base_force_calculator *, int);
  PyObject *(*_do_calc_components)(struct __pyx_obj_17shift_calculators_Base_force_calculator *, PyObject *, PyObject *, struct __pyx_obj_17shift_calculators_Out_array *);
  PyObject *(*_get_or_make_target_force_triplet)(struct __pyx_obj_17shift_calculators_Base_force_calculator *, PyObject *, PyObject *);
};
static struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *__pyx_vtabptr_17shift_calculators_Base_force_calculator;
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_21Base_force_calculator__get_component(struct __pyx_obj_17shift_calculators_Base_force_calculator *, int);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_21Base_force_calculator__get_or_make_target_force_triplet(struct __pyx_obj_17shift_calculators_Base_force_calculator *, PyObject *, PyObject *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1121")'> 1121: </pre>
<pre id='line1121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1122")'> 1122:     cdef object _components</pre>
<pre id='line1122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1123")'> 1123:     cdef bint _verbose</pre>
<pre id='line1123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1124")'> 1124:     cdef Simulation* _simulation</pre>
<pre id='line1124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1125")'> 1125:     cdef str _name</pre>
<pre id='line1125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1126")'> 1126: </pre>
<pre id='line1126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line1127")'> 1127:     def __init__(self,potential=None, name= "not set"):</pre>
<pre id='line1127' class='code' style='background-color: #FFFF3c'>
    /* "Cython_shift_calculator.pyx":1127
 *     cdef str _name
 * 
 *     def __init__(self,potential=None, name= "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components =  None
 *         self._verbose = False
 */
    values[0] = ((PyObject *)Py_None);
    values[1] = ((PyObject *)__pyx_kp_s_14);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__potential);
          if (value) { values[0] = value; kw_args--; }
        }
        case  1:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1127; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_potential = values[0];
    __pyx_v_name = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1127; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_potential, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

static int __pyx_pf_17shift_calculators_21Base_force_calculator___init__(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_potential, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 1127);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1128")'> 1128:         self._components =  None</pre>
<pre id='line1128' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1128
 * 
 *     def __init__(self,potential=None, name= "not set"):
 *         self._components =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = False
 *         self._simulation =  currentSimulation()
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1129")'> 1129:         self._verbose = False</pre>
<pre id='line1129' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1129
 *     def __init__(self,potential=None, name= "not set"):
 *         self._components =  None
 *         self._verbose = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 * 
 */
  __pyx_v_self->_verbose = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1130")'> 1130:         self._simulation =  currentSimulation()</pre>
<pre id='line1130' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1130
 *         self._components =  None
 *         self._verbose = False
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._name = name
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1131")'> 1131: </pre>
<pre id='line1131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line1132")'> 1132:         self._name = name</pre>
<pre id='line1132' class='code' style='background-color: #FFFF5b'>
  /* "Cython_shift_calculator.pyx":1132
 *         self._simulation =  currentSimulation()
 * 
 *         self._name = name             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  if (!(likely(<span class='py_c_api'>PyString_CheckExact</span>(__pyx_v_name))||((__pyx_v_name) == Py_None)||(<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected str, got %.200s", Py_TYPE(__pyx_v_name)->tp_name), 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_name);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_name);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_name);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self->_name));
  __pyx_v_self->_name = ((PyObject*)__pyx_v_name);

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1133")'> 1133: </pre>
<pre id='line1133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1134")'> 1134:     def set_verbose(self,on):</pre>
<pre id='line1134' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1134
 *         self._name = name
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_verbose", __pyx_f[0], 1134);
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1135")'> 1135:         self._verbose = on</pre>
<pre id='line1135' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":1135
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_simulation(self):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_5set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_5set_simulation(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_4set_simulation(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1136")'> 1136: </pre>
<pre id='line1136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1137")'> 1137:     def set_simulation(self):</pre>
<pre id='line1137' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1137
 *         self._verbose = on
 * 
 *     def set_simulation(self):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._simulation =  currentSimulation()
 *     def _set_components(self,components):
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_4set_simulation(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_simulation", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_simulation", __pyx_f[0], 1137);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1138")'> 1138:         self._simulation =  currentSimulation()</pre>
<pre id='line1138' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1138
 * 
 *     def set_simulation(self):
 *         self._simulation =  currentSimulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     def _set_components(self,components):
 *         self._components = components
 */
  __pyx_v_self->_simulation = Simulation::currentSimulation();

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_6_set_components(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1139")'> 1139:     def _set_components(self,components):</pre>
<pre id='line1139' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1139
 *     def set_simulation(self):
 *         self._simulation =  currentSimulation()
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components = components
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_6_set_components(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_components", __pyx_f[0], 1139);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1140")'> 1140:         self._components = components</pre>
<pre id='line1140' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1140
 *         self._simulation =  currentSimulation()
 *     def _set_components(self,components):
 *         self._components = components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline object _get_component(self,int index):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = __pyx_v_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1141")'> 1141: </pre>
<pre id='line1141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1142")'> 1142:     cdef inline object _get_component(self,int index):</pre>
<pre id='line1142' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1142
 *         self._components = components
 * 
 *     cdef inline object _get_component(self,int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._components.get_component(index)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_21Base_force_calculator__get_component(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_component", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_get_component", __pyx_f[0], 1142);
</pre><pre class='line' style='background-color: #FFFF18' onclick='toggleDiv("line1143")'> 1143:         return self._components.get_component(index)</pre>
<pre id='line1143' class='code' style='background-color: #FFFF18'>
  /* "Cython_shift_calculator.pyx":1143
 * 
 *     cdef inline object _get_component(self,int index):
 *         return self._components.get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_components, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator._get_component", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_9_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_9_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,&__pyx_n_s__forces,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_set") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_8_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1144")'> 1144: </pre>
<pre id='line1144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1145")'> 1145:     def _calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1145' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1145
 *         return self._components.get_component(index)
 * 
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO tidy this up a hack for the test suite
 *         saved_component_list = self._components
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_8_calc_single_force_set(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  PyObject *__pyx_v_saved_component_list = NULL;
  PyObject *__pyx_v_component_list = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calc_single_force_set", __pyx_f[0], 1145);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1146")'> 1146:         #TODO tidy this up a hack for the test suite</pre>
<pre id='line1146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1147")'> 1147:         saved_component_list = self._components</pre>
<pre id='line1147' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1147
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 *         #TODO tidy this up a hack for the test suite
 *         saved_component_list = self._components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component_list = Component_list()
 *         component_list.add_component(self._components[index])
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self->_components);
  __pyx_v_saved_component_list = __pyx_v_self->_components;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1148")'> 1148:         component_list = Component_list()</pre>
<pre id='line1148' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":1148
 *         #TODO tidy this up a hack for the test suite
 *         saved_component_list = self._components
 *         component_list = Component_list()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component_list.add_component(self._components[index])
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__Component_list);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_component_list = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line1149")'> 1149:         component_list.add_component(self._components[index])</pre>
<pre id='line1149' class='code' style='background-color: #FFFF52'>
  /* "Cython_shift_calculator.pyx":1149
 *         saved_component_list = self._components
 *         component_list = Component_list()
 *         component_list.add_component(self._components[index])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self.__call__(component_list,[0], [factor], forces)
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_component_list, __pyx_n_s__add_component);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_self->_components, __pyx_v_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1150")'> 1150: </pre>
<pre id='line1150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line1151")'> 1151:         self.__call__(component_list,[0], [factor], forces)</pre>
<pre id='line1151' class='code' style='background-color: #FFFF31'>
  /* "Cython_shift_calculator.pyx":1151
 *         component_list.add_component(self._components[index])
 * 
 *         self.__call__(component_list,[0], [factor], forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components =  saved_component_list
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s____call__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_int_0);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_0);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_factor);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_component_list);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_component_list);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_t_3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_forces));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, ((PyObject *)__pyx_v_forces));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_forces));
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line1152")'> 1152:         self._components =  saved_component_list</pre>
<pre id='line1152' class='code' style='background-color: #FFFF21'>
  /* "Cython_shift_calculator.pyx":1152
 * 
 *         self.__call__(component_list,[0], [factor], forces)
 *         self._components =  saved_component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_saved_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_saved_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_components);
  __pyx_v_self->_components = __pyx_v_saved_component_list;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_saved_component_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_21Base_force_calculator_11__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  PyObject *__pyx_v_component_to_result = 0;
  PyObject *__pyx_v_force_factors = 0;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__component_to_result,&__pyx_n_s__force_factors,&__pyx_n_s__forces,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_result);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factors);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_components = values[0];
    __pyx_v_component_to_result = values[1];
    __pyx_v_force_factors = values[2];
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_21Base_force_calculator_10__call__(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1153")'> 1153: </pre>
<pre id='line1153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1154")'> 1154: </pre>
<pre id='line1154' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1155")'> 1155: #    TODO should most probably be a fixed array</pre>
<pre id='line1155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1156")'> 1156:     def __call__(self, object components, object component_to_result, object force_factors, Out_array forces):</pre>
<pre id='line1156' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1156
 * 
 * #    TODO should most probably be a fixed array
 *     def __call__(self, object components, object component_to_result, object force_factors, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef double start_time =0.0
 */

static PyObject *__pyx_pf_17shift_calculators_21Base_force_calculator_10__call__(struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_components, PyObject *__pyx_v_component_to_result, PyObject *__pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1156);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1157")'> 1157: </pre>
<pre id='line1157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1158")'> 1158:         cdef double start_time =0.0</pre>
<pre id='line1158' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1158
 *     def __call__(self, object components, object component_to_result, object force_factors, Out_array forces):
 * 
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1159")'> 1159:         cdef double end_time =0.0</pre>
<pre id='line1159' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1159
 * 
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1160")'> 1160:         if self._verbose:</pre>
<pre id='line1160' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1160
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1161")'> 1161:             start_time = time()</pre>
<pre id='line1161' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1161
 *         cdef double end_time =0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._set_components(components)
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1162")'> 1162: </pre>
<pre id='line1162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line1163")'> 1163:         self._set_components(components)</pre>
<pre id='line1163' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":1163
 *             start_time = time()
 * 
 *         self._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 * #        TODO rename component to result to something better
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1164")'> 1164:         self.set_simulation()</pre>
<pre id='line1164' class='code' style='background-color: #FFFF73'>
  /* "Cython_shift_calculator.pyx":1164
 * 
 *         self._set_components(components)
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        TODO rename component to result to something better
 *         self._do_calc_components(component_to_result, force_factors, forces)
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s__set_simulation);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1165")'> 1165: #        TODO rename component to result to something better</pre>
<pre id='line1165' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1166")'> 1166:         self._do_calc_components(component_to_result, force_factors, forces)</pre>
<pre id='line1166' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1166
 *         self.set_simulation()
 * #        TODO rename component to result to something better
 *         self._do_calc_components(component_to_result, force_factors, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        component_target_atom_ids = components.get_component_atom_ids()
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator *)__pyx_v_self->__pyx_vtab)->_do_calc_components(__pyx_v_self, __pyx_v_component_to_result, __pyx_v_force_factors, __pyx_v_forces);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1167")'> 1167: </pre>
<pre id='line1167' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1168")'> 1168: #        component_target_atom_ids = components.get_component_atom_ids()</pre>
<pre id='line1168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1169")'> 1169: #        for i,target_atom_id in enumerate(target_atom_ids):</pre>
<pre id='line1169' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1170")'> 1170: #            if target_atom_id in component_target_atom_ids:</pre>
<pre id='line1170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1171")'> 1171: #                try:</pre>
<pre id='line1171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1172")'> 1172: #                    index_range = components.get_component_range(target_atom_id)</pre>
<pre id='line1172' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1173")'> 1173: #                except ValueError:</pre>
<pre id='line1173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1174")'> 1174: #                    print "warning atom is not in list", target_atom_id, Atom_utils._get_atom_info_from_index(target_atom_id),self._name</pre>
<pre id='line1174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1175")'> 1175: #                    index_range = []</pre>
<pre id='line1175' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1176")'> 1176: #                for index in range(*index_range):</pre>
<pre id='line1176' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1177")'> 1177: </pre>
<pre id='line1177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1178")'> 1178:         if self._verbose:</pre>
<pre id='line1178' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1178
 * #                for index in range(*index_range):
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->_verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1179")'> 1179:             end_time = time()</pre>
<pre id='line1179' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1179
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1180")'> 1180:             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"</pre>
<pre id='line1180' class='code' style='background-color: #FFFF2a'>
    /* "Cython_shift_calculator.pyx":1180
 *         if self._verbose:
 *             end_time = time()
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _do_calc_components(self, object component_to_result,  object force_factors, Out_array force):
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_35));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_35));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_35));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->_name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self->_name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->_name));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, ((PyObject *)__pyx_kp_s_36));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_36));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, __pyx_t_4);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_kp_s_31));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_31));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 5, ((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 6, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_4 = 0;
    __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1181")'> 1181: </pre>
<pre id='line1181' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1182")'> 1182:     cdef _do_calc_components(self, object component_to_result,  object force_factors, Out_array force):</pre>
<pre id='line1182' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1182
 *             print '   force calculator: ', self._name ,' ',len(components), ' in', "%.17g" %  (end_time-start_time), "seconds"
 * 
 *     cdef _do_calc_components(self, object component_to_result,  object force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise Exception("this should not be called!")
 * 
 */

static PyObject *__pyx_f_17shift_calculators_21Base_force_calculator__do_calc_components(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_component_to_result, CYTHON_UNUSED PyObject *__pyx_v_force_factors, CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_do_calc_components", __pyx_f[0], 1182);
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line1183")'> 1183:         raise Exception("this should not be called!")</pre>
<pre id='line1183' class='code' style='background-color: #FFFF66'>
  /* "Cython_shift_calculator.pyx":1183
 * 
 *     cdef _do_calc_components(self, object component_to_result,  object force_factors, Out_array force):
 *         raise Exception("this should not be called!")             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline _get_or_make_target_force_triplet(self, object forces, object target_offset):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_k_tuple_38), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
 <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1184")'> 1184: </pre>
<pre id='line1184' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1185")'> 1185:     cdef inline _get_or_make_target_force_triplet(self, object forces, object target_offset):</pre>
<pre id='line1185' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1185
 *         raise Exception("this should not be called!")
 * 
 *     cdef inline _get_or_make_target_force_triplet(self, object forces, object target_offset):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         target_forces = forces[target_offset]
 *         if target_forces == None:
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_21Base_force_calculator__get_or_make_target_force_triplet(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Base_force_calculator *__pyx_v_self, PyObject *__pyx_v_forces, PyObject *__pyx_v_target_offset) {
  PyObject *__pyx_v_target_forces = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_or_make_target_force_triplet", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_get_or_make_target_force_triplet", __pyx_f[0], 1185);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1186")'> 1186:         target_forces = forces[target_offset]</pre>
<pre id='line1186' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1186
 * 
 *     cdef inline _get_or_make_target_force_triplet(self, object forces, object target_offset):
 *         target_forces = forces[target_offset]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if target_forces == None:
 *             target_forces = [0.0] * 3
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_forces, __pyx_v_target_offset);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_target_forces = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1187")'> 1187:         if target_forces == None:</pre>
<pre id='line1187' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1187
 *     cdef inline _get_or_make_target_force_triplet(self, object forces, object target_offset):
 *         target_forces = forces[target_offset]
 *         if target_forces == None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             target_forces = [0.0] * 3
 *             forces[target_offset] = target_forces
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_target_forces, Py_None, Py_EQ);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line1188")'> 1188:             target_forces = [0.0] * 3</pre>
<pre id='line1188' class='code' style='background-color: #FFFF6a'>
    /* "Cython_shift_calculator.pyx":1188
 *         target_forces = forces[target_offset]
 *         if target_forces == None:
 *             target_forces = [0.0] * 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             forces[target_offset] = target_forces
 *         return target_forces
 */
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1 * 3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp <code><</code> 3; __pyx_temp++) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, __pyx_temp, __pyx_t_1);
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_target_forces);
    __pyx_v_target_forces = ((PyObject *)__pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1189")'> 1189:             forces[target_offset] = target_forces</pre>
<pre id='line1189' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1189
 *         if target_forces == None:
 *             target_forces = [0.0] * 3
 *             forces[target_offset] = target_forces             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return target_forces
 * 
 */
    if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_forces, __pyx_v_target_offset, __pyx_v_target_forces) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line1190")'> 1190:         return target_forces</pre>
<pre id='line1190' class='code' style='background-color: #FFFF24'>
  /* "Cython_shift_calculator.pyx":1190
 *             target_forces = [0.0] * 3
 *             forces[target_offset] = target_forces
 *         return target_forces             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    TODO make abstract
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_target_forces);
  __pyx_r = __pyx_v_target_forces;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Base_force_calculator._get_or_make_target_force_triplet", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_forces);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)__pyx_kp_s_39);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1219; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1219; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1219; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1219; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1191")'> 1191: </pre>
<pre id='line1191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1192")'> 1192: #    TODO make abstract</pre>
<pre id='line1192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1193")'> 1193: #    cdef _cython_calc_single_force_set(self, int index, float force_factor, object forces):</pre>
<pre id='line1193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1194")'> 1194: #        raise Exception("unexpected! this method should be implemented")</pre>
<pre id='line1194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1195")'> 1195: </pre>
<pre id='line1195' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1196")'> 1196: cdef struct Distance_component:</pre>
<pre id='line1196' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1196
 * #        raise Exception("unexpected! this method should be implemented")
 * 
 * cdef struct Distance_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom
 *       int remote_atom_1
 */
struct __pyx_t_17shift_calculators_Distance_component {
  int target_atom;
  int remote_atom_1;
  int remote_atom_2;
  float coefficient;
  float exponent;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1197")'> 1197:       int target_atom</pre>
<pre id='line1197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1198")'> 1198:       int remote_atom_1</pre>
<pre id='line1198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1199")'> 1199:       int remote_atom_2</pre>
<pre id='line1199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1200")'> 1200:       float coefficient</pre>
<pre id='line1200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1201")'> 1201:       float exponent</pre>
<pre id='line1201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1202")'> 1202: </pre>
<pre id='line1202' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1203")'> 1203: </pre>
<pre id='line1203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1204")'> 1204: cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):</pre>
<pre id='line1204' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1204
 * 
 * 
 * cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  int _target_atom_index;
  int _distance_atom_index_1;
  int _distance_atom_index_2;
  int _exponent_index;
  int _coefficient_index;
  int _smoothed;
  float _smoothing_factor;
  float _cutoff;
  struct __pyx_t_17shift_calculators_Distance_component *_compiled_components;
  int _num_components;
};


/* "Cython_shift_calculator.pyx":1204
 * 
 * 
 * cdef class Fast_distance_based_potential_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  PyObject *(*_compile_components)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, PyObject *);
  struct __pyx_t_17shift_calculators_target_distant_atom (*_get_target_and_distant_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int);
  Vec3 (*_xyz_distances)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
  float (*_sum_xyz_distances_2)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
  float (*_cython_calc_single_force_factor)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float);
  PyObject *(*_distance_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_distance_based_potential_force_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int);
static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1205")'> 1205: </pre>
<pre id='line1205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1206")'> 1206: </pre>
<pre id='line1206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1207")'> 1207: </pre>
<pre id='line1207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1208")'> 1208:     cdef int  _target_atom_index</pre>
<pre id='line1208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1209")'> 1209:     cdef int  _distance_atom_index_1</pre>
<pre id='line1209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1210")'> 1210:     cdef int  _distance_atom_index_2</pre>
<pre id='line1210' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1211")'> 1211:     cdef int  _exponent_index</pre>
<pre id='line1211' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1212")'> 1212:     cdef int  _coefficient_index</pre>
<pre id='line1212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1213")'> 1213:     cdef bint  _smoothed</pre>
<pre id='line1213' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1214")'> 1214:     cdef float _smoothing_factor</pre>
<pre id='line1214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1215")'> 1215:     cdef float _cutoff</pre>
<pre id='line1215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1216")'> 1216:     cdef Distance_component* _compiled_components</pre>
<pre id='line1216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1217")'> 1217:     cdef int _num_components</pre>
<pre id='line1217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1218")'> 1218: </pre>
<pre id='line1218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1219")'> 1219:     def __init__(self, object indices, bint smoothed, name="Not set"):</pre>
<pre id='line1219' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1219
 *     cdef int _num_components
 * 
 *     def __init__(self, object indices, bint smoothed, name="Not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._target_atom_index = indices.target_atom_index
 */

static int __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_indices, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 1219);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line1220")'> 1220:         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)</pre>
<pre id='line1220' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":1220
 * 
 *     def __init__(self, object indices, bint smoothed, name="Not set"):
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1221")'> 1221:         self._target_atom_index = indices.target_atom_index</pre>
<pre id='line1221' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1221
 *     def __init__(self, object indices, bint smoothed, name="Not set"):
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._target_atom_index = indices.target_atom_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__target_atom_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_target_atom_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1222")'> 1222:         self._distance_atom_index_1 =  indices.distance_atom_index_1</pre>
<pre id='line1222' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1222
 *         super(Fast_distance_based_potential_force_calculator, self).__init__(name=name)
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_15);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_1 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1223")'> 1223:         self._distance_atom_index_2 =  indices .distance_atom_index_2</pre>
<pre id='line1223' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1223
 *         self._target_atom_index = indices.target_atom_index
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s_16);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_distance_atom_index_2 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1224")'> 1224:         self._exponent_index  = indices.exponent_index</pre>
<pre id='line1224' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1224
 *         self._distance_atom_index_1 =  indices.distance_atom_index_1
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coefficient_index  = indices.coefficient_index
 *         self._components =  None
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__exponent_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_exponent_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1225")'> 1225:         self._coefficient_index  = indices.coefficient_index</pre>
<pre id='line1225' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1225
 *         self._distance_atom_index_2 =  indices .distance_atom_index_2
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components =  None
 *         self._smoothed =  smoothed
 */
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_indices, __pyx_n_s__coefficient_index);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self->_coefficient_index = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1226")'> 1226:         self._components =  None</pre>
<pre id='line1226' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1226
 *         self._exponent_index  = indices.exponent_index
 *         self._coefficient_index  = indices.coefficient_index
 *         self._components =  None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->__pyx_base._components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->__pyx_base._components);
  __pyx_v_self->__pyx_base._components = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1227")'> 1227:         self._smoothed =  smoothed</pre>
<pre id='line1227' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1227
 *         self._coefficient_index  = indices.coefficient_index
 *         self._components =  None
 *         self._smoothed =  smoothed             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 *         self._cutoff =  DEFAULT_CUTOFF
 */
  __pyx_v_self->_smoothed = __pyx_v_smoothed;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1228")'> 1228:         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR</pre>
<pre id='line1228' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1228
 *         self._components =  None
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff =  DEFAULT_CUTOFF
 *         self._compiled_components
 */
  __pyx_v_self->_smoothing_factor = __pyx_v_17shift_calculators_DEFAULT_SMOOTHING_FACTOR;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1229")'> 1229:         self._cutoff =  DEFAULT_CUTOFF</pre>
<pre id='line1229' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1229
 *         self._smoothed =  smoothed
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 *         self._cutoff =  DEFAULT_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components
 *         self._num_components
 */
  __pyx_v_self->_cutoff = __pyx_v_17shift_calculators_DEFAULT_CUTOFF;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1230")'> 1230:         self._compiled_components</pre>
<pre id='line1230' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1230
 *         self._smoothing_factor =  DEFAULT_SMOOTHING_FACTOR
 *         self._cutoff =  DEFAULT_CUTOFF
 *         self._compiled_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components
 * 
 */
  __pyx_v_self->_compiled_components;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line1231")'> 1231:         self._num_components</pre>
<pre id='line1231' class='code' style='background-color: #FFFF86'>
  /* "Cython_shift_calculator.pyx":1231
 *         self._cutoff =  DEFAULT_CUTOFF
 *         self._compiled_components
 *         self._num_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_cutoff(self, cutoff):
 */
  __pyx_v_self->_num_components;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_3set_cutoff(PyObject *__pyx_v_self, PyObject *__pyx_v_cutoff); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_3set_cutoff(PyObject *__pyx_v_self, PyObject *__pyx_v_cutoff) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_cutoff (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_2set_cutoff(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_cutoff));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1232")'> 1232: </pre>
<pre id='line1232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1233")'> 1233:     def set_cutoff(self, cutoff):</pre>
<pre id='line1233' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1233
 *         self._num_components
 * 
 *     def set_cutoff(self, cutoff):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cutoff =  cutoff
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_2set_cutoff(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_cutoff) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_cutoff", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_cutoff", __pyx_f[0], 1233);
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1234")'> 1234:         self._cutoff =  cutoff</pre>
<pre id='line1234' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":1234
 * 
 *     def set_cutoff(self, cutoff):
 *         self._cutoff =  cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_smoothing_factor(self,smoothing_factor):
 */
  __pyx_t_1 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_cutoff);<span class='error_goto'> if (unlikely((__pyx_t_1 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_cutoff = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.set_cutoff", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_5set_smoothing_factor(PyObject *__pyx_v_self, PyObject *__pyx_v_smoothing_factor); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_5set_smoothing_factor(PyObject *__pyx_v_self, PyObject *__pyx_v_smoothing_factor) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_smoothing_factor (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_4set_smoothing_factor(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_smoothing_factor));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1235")'> 1235: </pre>
<pre id='line1235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1236")'> 1236:     def set_smoothing_factor(self,smoothing_factor):</pre>
<pre id='line1236' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1236
 *         self._cutoff =  cutoff
 * 
 *     def set_smoothing_factor(self,smoothing_factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._smoothing_factor = smoothing_factor
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_4set_smoothing_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_smoothing_factor) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_smoothing_factor", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_smoothing_factor", __pyx_f[0], 1236);
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1237")'> 1237:         self._smoothing_factor = smoothing_factor</pre>
<pre id='line1237' class='code' style='background-color: #FFFF5e'>
  /* "Cython_shift_calculator.pyx":1237
 * 
 *     def set_smoothing_factor(self,smoothing_factor):
 *         self._smoothing_factor = smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_components(self,components):
 */
  __pyx_t_1 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_smoothing_factor);<span class='error_goto'> if (unlikely((__pyx_t_1 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_smoothing_factor = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator.set_smoothing_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_7_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_6_set_components(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1238")'> 1238: </pre>
<pre id='line1238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1239")'> 1239:     def _set_components(self,components):</pre>
<pre id='line1239' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1239
 *         self._smoothing_factor = smoothing_factor
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_distance_based_potential_force_calculator, self)._set_components(components)
 *         if  self._compiled_components ==  NULL:
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_6_set_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_components", __pyx_f[0], 1239);
</pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line1240")'> 1240:         super(Fast_distance_based_potential_force_calculator, self)._set_components(components)</pre>
<pre id='line1240' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":1240
 * 
 *     def _set_components(self,components):
 *         super(Fast_distance_based_potential_force_calculator, self)._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_distance_based_potential_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1241")'> 1241:         if  self._compiled_components ==  NULL:</pre>
<pre id='line1241' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1241
 *     def _set_components(self,components):
 *         super(Fast_distance_based_potential_force_calculator, self)._set_components(components)
 *         if  self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_4 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1242")'> 1242:             self._compile_components(components)</pre>
<pre id='line1242' class='code' style='background-color: #FFFF7f'>
    /* "Cython_shift_calculator.pyx":1242
 *         super(Fast_distance_based_potential_force_calculator, self)._set_components(components)
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _compile_components(self,components):
 */
    __pyx_t_3 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_compile_components(__pyx_v_self, __pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1243")'> 1243: </pre>
<pre id='line1243' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1244")'> 1244:     cdef _compile_components(self,components):</pre>
<pre id='line1244' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1244
 *             self._compile_components(components)
 * 
 *     cdef _compile_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)
 */

static PyObject *__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__compile_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_compile_components", __pyx_f[0], 1244);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1245")'> 1245:         self._compiled_components = &lt;Distance_component*&gt;malloc(len(components) * sizeof(Distance_component))</pre>
<pre id='line1245' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1245
 * 
 *     cdef _compile_components(self,components):
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Distance_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Distance_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1246")'> 1246:         self._num_components = len(components)</pre>
<pre id='line1246' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1246
 *     cdef _compile_components(self,components):
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line1247")'> 1247:         for i,component in enumerate(components):</pre>
<pre id='line1247' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":1247
 *         self._compiled_components = <code><</code>Distance_component*>malloc(len(components) * sizeof(Distance_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1248")'> 1248:             self._compiled_components[i].target_atom = components[i][self._target_atom_index]</pre>
<pre id='line1248' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":1248
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_target_atom_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).target_atom = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1249")'> 1249:             if len(component) == 4:</pre>
<pre id='line1249' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1249
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = (__pyx_t_8 == 4);
    if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1250")'> 1250:                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]</pre>
<pre id='line1250' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1250
 *             self._compiled_components[i].target_atom = components[i][self._target_atom_index]
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_1 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1251")'> 1251:                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]</pre>
<pre id='line1251' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1251
 *             if len(component) == 4:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_2 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1252")'> 1252:                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]</pre>
<pre id='line1252' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1252
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_coefficient_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1253")'> 1253:                 self._compiled_components[i].exponent      = components[i][self._exponent_index]</pre>
<pre id='line1253' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1253
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_exponent_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).exponent = __pyx_t_10;
      goto __pyx_L5;
    }
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1254")'> 1254:             elif len(component) == 5:</pre>
<pre id='line1254' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1254
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 */
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = (__pyx_t_8 == 5);
    if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1255")'> 1255:                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]</pre>
<pre id='line1255' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1255
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_1 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1256")'> 1256:                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]</pre>
<pre id='line1256' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1256
 *             elif len(component) == 5:
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).remote_atom_2 = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1257")'> 1257:                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]</pre>
<pre id='line1257' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1257
 *                 self._compiled_components[i].remote_atom_1 = components[i][self._distance_atom_index_1]
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             else:
 */
      __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, __pyx_v_self->_coefficient_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).coefficient = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1258")'> 1258:                 self._compiled_components[i].exponent      = components[i][self._exponent_index]</pre>
<pre id='line1258' class='code' style='background-color: #FFFF41'>
      /* "Cython_shift_calculator.pyx":1258
 *                 self._compiled_components[i].remote_atom_2 = components[i][self._distance_atom_index_2]
 *                 self._compiled_components[i].coefficient   = components[i][self._coefficient_index]
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))
 */
      __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, __pyx_v_self->_exponent_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_10 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_self->_compiled_components[__pyx_t_8]).exponent = __pyx_t_10;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1259")'> 1259:             else:</pre>
<pre id='line1259' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF15' onclick='toggleDiv("line1260")'> 1260:                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))</pre>
<pre id='line1260' class='code' style='background-color: #FFFF15'>
      /* "Cython_shift_calculator.pyx":1260
 *                 self._compiled_components[i].exponent      = components[i][self._exponent_index]
 *             else:
 *                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 */
      __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_component);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_40), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_Exception, ((PyObject *)__pyx_t_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_L5:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_9_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_9_calc_single_force_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,&__pyx_n_s__forces,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_set") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_set", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_8_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1261")'> 1261: </pre>
<pre id='line1261' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1262")'> 1262:     def _calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1262' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1262
 *                 raise Exception("bad distance component length %i should be either 4 or 5 " % len(component))
 * 
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO tidy this up a hack for the test suite
 *         saved_component_list = self._components
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_8_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  PyObject *__pyx_v_saved_component_list = NULL;
  PyObject *__pyx_v_component_list = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_set", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calc_single_force_set", __pyx_f[0], 1262);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1263")'> 1263:         #TODO tidy this up a hack for the test suite</pre>
<pre id='line1263' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1264")'> 1264:         saved_component_list = self._components</pre>
<pre id='line1264' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1264
 *     def _calc_single_force_set(self, int index, float factor, Out_array forces):
 *         #TODO tidy this up a hack for the test suite
 *         saved_component_list = self._components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component_list = Component_list()
 *         component_list.add_component(self._components[index])
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self->__pyx_base._components);
  __pyx_v_saved_component_list = __pyx_v_self->__pyx_base._components;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1265")'> 1265:         component_list = Component_list()</pre>
<pre id='line1265' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":1265
 *         #TODO tidy this up a hack for the test suite
 *         saved_component_list = self._components
 *         component_list = Component_list()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component_list.add_component(self._components[index])
 *         self._compiled_components = NULL
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__Component_list);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_component_list = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line1266")'> 1266:         component_list.add_component(self._components[index])</pre>
<pre id='line1266' class='code' style='background-color: #FFFF52'>
  /* "Cython_shift_calculator.pyx":1266
 *         saved_component_list = self._components
 *         component_list = Component_list()
 *         component_list.add_component(self._components[index])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = NULL
 *         self._set_components(component_list)
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_component_list, __pyx_n_s__add_component);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_self->__pyx_base._components, __pyx_v_index, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1267")'> 1267:         self._compiled_components = NULL</pre>
<pre id='line1267' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1267
 *         component_list = Component_list()
 *         component_list.add_component(self._components[index])
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._set_components(component_list)
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line1268")'> 1268:         self._set_components(component_list)</pre>
<pre id='line1268' class='code' style='background-color: #FFFF55'>
  /* "Cython_shift_calculator.pyx":1268
 *         component_list.add_component(self._components[index])
 *         self._compiled_components = NULL
 *         self._set_components(component_list)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_component_list);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_component_list);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1269")'> 1269: </pre>
<pre id='line1269' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1270")'> 1270: </pre>
<pre id='line1270' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line1271")'> 1271:         self.__call__(component_list,[0], [factor], forces)</pre>
<pre id='line1271' class='code' style='background-color: #FFFF31'>
  /* "Cython_shift_calculator.pyx":1271
 * 
 * 
 *         self.__call__(component_list,[0], [factor], forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components =  saved_component_list
 *         self._compiled_components =  NULL
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s____call__);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_int_0);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_0);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_factor);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_component_list);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_component_list);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_t_3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, ((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_forces));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject *)__pyx_v_forces));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_forces));
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1272")'> 1272:         self._components =  saved_component_list</pre>
<pre id='line1272' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1272
 * 
 *         self.__call__(component_list,[0], [factor], forces)
 *         self._components =  saved_component_list             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components =  NULL
 *         self._set_components(saved_component_list)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_saved_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_saved_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->__pyx_base._components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->__pyx_base._components);
  __pyx_v_self->__pyx_base._components = __pyx_v_saved_component_list;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1273")'> 1273:         self._compiled_components =  NULL</pre>
<pre id='line1273' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1273
 *         self.__call__(component_list,[0], [factor], forces)
 *         self._components =  saved_component_list
 *         self._compiled_components =  NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._set_components(saved_component_list)
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line1274")'> 1274:         self._set_components(saved_component_list)</pre>
<pre id='line1274' class='code' style='background-color: #FFFF3c'>
  /* "Cython_shift_calculator.pyx":1274
 *         self._components =  saved_component_list
 *         self._compiled_components =  NULL
 *         self._set_components(saved_component_list)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_saved_component_list);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_saved_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_saved_component_list);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_saved_component_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component_list);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1275")'> 1275: </pre>
<pre id='line1275' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1276")'> 1276: </pre>
<pre id='line1276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1277")'> 1277:     @cython.profile(False)</pre>
<pre id='line1277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1278")'> 1278:     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index):</pre>
<pre id='line1278' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1278
 * 
 *     @cython.profile(False)
 *     cdef inline target_distant_atom _get_target_and_distant_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef object values
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_target_distant_atom __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__get_target_and_distant_atom_ids(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_v_values = 0;
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_v_result;
  struct __pyx_t_17shift_calculators_target_distant_atom __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_target_and_distant_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1279")'> 1279: </pre>
<pre id='line1279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1280")'> 1280:         cdef object values</pre>
<pre id='line1280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1281")'> 1281:         cdef int target_atom_id</pre>
<pre id='line1281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1282")'> 1282:         cdef int distant_atom_id</pre>
<pre id='line1282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1283")'> 1283:         cdef target_distant_atom result</pre>
<pre id='line1283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1284")'> 1284: </pre>
<pre id='line1284' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line1285")'> 1285:         values  = self._components.get_component(index)</pre>
<pre id='line1285' class='code' style='background-color: #FFFF4d'>
  /* "Cython_shift_calculator.pyx":1285
 *         cdef target_distant_atom result
 * 
 *         values  = self._components.get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.target_atom_id = values[self._distance_atom_index_1]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->__pyx_base._components, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_v_values = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1286")'> 1286: </pre>
<pre id='line1286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1287")'> 1287:         result.target_atom_id = values[self._distance_atom_index_1]</pre>
<pre id='line1287' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1287
 *         values  = self._components.get_component(index)
 * 
 *         result.target_atom_id = values[self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.distant_atom_id = values[self._distance_atom_index_2]
 * 
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_values, __pyx_v_self->_distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result.target_atom_id = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1288")'> 1288:         result.distant_atom_id = values[self._distance_atom_index_2]</pre>
<pre id='line1288' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1288
 * 
 *         result.target_atom_id = values[self._distance_atom_index_1]
 *         result.distant_atom_id = values[self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_values, __pyx_v_self->_distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result.distant_atom_id = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1289")'> 1289: </pre>
<pre id='line1289' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1290")'> 1290:         return result</pre>
<pre id='line1290' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1290
 *         result.distant_atom_id = values[self._distance_atom_index_2]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_distance_based_potential_force_calculator._get_target_and_distant_atom_ids", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_values);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1291")'> 1291: </pre>
<pre id='line1291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1292")'> 1292: </pre>
<pre id='line1292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1293")'> 1293: </pre>
<pre id='line1293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1294")'> 1294: #    cdef inline float _distance(self, int target_atom, int distance_atom):</pre>
<pre id='line1294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1295")'> 1295: #        cdef Vec3 target_pos, distant_pos, distance</pre>
<pre id='line1295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1296")'> 1296: #        cdef float result</pre>
<pre id='line1296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1297")'> 1297: #</pre>
<pre id='line1297' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1298")'> 1298: #        target_pos = currentSimulation().atomPosArr().data(target_atom)</pre>
<pre id='line1298' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1299")'> 1299: #        distant_pos =  currentSimulation().atomPosArr().data(distance_atom)</pre>
<pre id='line1299' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1300")'> 1300: #</pre>
<pre id='line1300' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1301")'> 1301: #        return  norm(target_pos - distant_pos)</pre>
<pre id='line1301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1302")'> 1302: </pre>
<pre id='line1302' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1303")'> 1303:     @cython.profile(False)</pre>
<pre id='line1303' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1304")'> 1304:     cdef inline Vec3 _xyz_distances(self, int target_atom, int distance_atom):</pre>
<pre id='line1304' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1304
 * 
 *     @cython.profile(False)
 *     cdef inline Vec3 _xyz_distances(self, int target_atom, int distance_atom):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_pos, distant_pos
 * 
 */

static CYTHON_INLINE Vec3 __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_target_atom, int __pyx_v_distance_atom) {
  Vec3 __pyx_v_target_pos;
  Vec3 __pyx_v_distant_pos;
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_xyz_distances", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1305")'> 1305:         cdef Vec3 target_pos, distant_pos</pre>
<pre id='line1305' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1306")'> 1306: </pre>
<pre id='line1306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1307")'> 1307: </pre>
<pre id='line1307' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1308")'> 1308:         target_pos = self._simulation[0].atomPos(target_atom)</pre>
<pre id='line1308' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1308
 * 
 * 
 *         target_pos = self._simulation[0].atomPos(target_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)
 * 
 */
  __pyx_v_target_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1309")'> 1309:         distant_pos =   self._simulation[0].atomPos(distance_atom)</pre>
<pre id='line1309' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1309
 * 
 *         target_pos = self._simulation[0].atomPos(target_atom)
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return target_pos - distant_pos
 */
  __pyx_v_distant_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_distance_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1310")'> 1310: </pre>
<pre id='line1310' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1311")'> 1311:         return target_pos - distant_pos</pre>
<pre id='line1311' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1311
 *         distant_pos =   self._simulation[0].atomPos(distance_atom)
 * 
 *         return target_pos - distant_pos             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = (__pyx_v_target_pos - __pyx_v_distant_pos);
  goto __pyx_L0;

  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1312")'> 1312: </pre>
<pre id='line1312' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1313")'> 1313:     @cython.profile(False)</pre>
<pre id='line1313' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1314")'> 1314:     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):</pre>
<pre id='line1314' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1314
 * 
 *     @cython.profile(False)
 *     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 target_pos, distant_pos, distance
 *         cdef float result =0.0
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_target_atom, int __pyx_v_distance_atom) {
  Vec3 __pyx_v_target_pos;
  Vec3 __pyx_v_distant_pos;
  Vec3 __pyx_v_distance;
  float __pyx_v_result;
  long __pyx_v_i;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_sum_xyz_distances_2", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1315")'> 1315:         cdef Vec3 target_pos, distant_pos, distance</pre>
<pre id='line1315' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1316")'> 1316:         cdef float result =0.0</pre>
<pre id='line1316' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1316
 *     cdef inline float _sum_xyz_distances_2(self, int target_atom, int distance_atom):
 *         cdef Vec3 target_pos, distant_pos, distance
 *         cdef float result =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         target_pos =   self._simulation[0].atomPos(target_atom)
 */
  __pyx_v_result = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1317")'> 1317: </pre>
<pre id='line1317' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1318")'> 1318:         target_pos =   self._simulation[0].atomPos(target_atom)</pre>
<pre id='line1318' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1318
 *         cdef float result =0.0
 * 
 *         target_pos =   self._simulation[0].atomPos(target_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)
 * 
 */
  __pyx_v_target_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1319")'> 1319:         distant_pos =  self._simulation[0].atomPos(distance_atom)</pre>
<pre id='line1319' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1319
 * 
 *         target_pos =   self._simulation[0].atomPos(target_atom)
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         distance = Vec3(target_pos - distant_pos)
 */
  __pyx_v_distant_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_distance_atom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1320")'> 1320: </pre>
<pre id='line1320' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1321")'> 1321:         distance = Vec3(target_pos - distant_pos)</pre>
<pre id='line1321' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1321
 *         distant_pos =  self._simulation[0].atomPos(distance_atom)
 * 
 *         distance = Vec3(target_pos - distant_pos)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for i in range(3):
 */
  __pyx_v_distance = Vec3((__pyx_v_target_pos - __pyx_v_distant_pos));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1322")'> 1322: </pre>
<pre id='line1322' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1323")'> 1323:         for i in range(3):</pre>
<pre id='line1323' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1323
 *         distance = Vec3(target_pos - distant_pos)
 * 
 *         for i in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result += distance[i] * distance[i]
 * 
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1324")'> 1324:             result += distance[i] * distance[i]</pre>
<pre id='line1324' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1324
 * 
 *         for i in range(3):
 *             result += distance[i] * distance[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
    __pyx_v_result = (__pyx_v_result + ((__pyx_v_distance[__pyx_v_i]) * (__pyx_v_distance[__pyx_v_i])));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1325")'> 1325: </pre>
<pre id='line1325' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line1326")'> 1326:         return result</pre>
<pre id='line1326' class='code' style='background-color: #FFFF28'>
  /* "Cython_shift_calculator.pyx":1326
 *             result += distance[i] * distance[i]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calc_single_force_factor(self, int index, float factor):
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_11_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_46Fast_distance_based_potential_force_calculator_11_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_index;
  float __pyx_v_factor;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__factor,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor (wrapper)", 0);
  {
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__index);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__factor);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_factor", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_single_force_factor") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_single_force_factor", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1328; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_10_calc_single_force_factor(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1327")'> 1327: </pre>
<pre id='line1327' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1328")'> 1328:     def _calc_single_force_factor(self, int index, float factor):</pre>
<pre id='line1328' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1328
 *         return result
 * 
 *     def _calc_single_force_factor(self, int index, float factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._cython_calc_single_force_factor(index, factor)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_46Fast_distance_based_potential_force_calculator_10_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calc_single_force_factor", __pyx_f[0], 1328);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1329")'> 1329:         return self._cython_calc_single_force_factor(index, factor)</pre>
<pre id='line1329' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1329
 * 
 *     def _calc_single_force_factor(self, int index, float factor):
 *         return self._cython_calc_single_force_factor(index, factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index, __pyx_v_factor));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1330")'> 1330: </pre>
<pre id='line1330' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1331")'> 1331:     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):</pre>
<pre id='line1331' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1331
 *         return self._cython_calc_single_force_factor(index, factor)
 * 
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._num_components):
 *             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 */

static PyObject *__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, PyObject *__pyx_v_component_to_result, PyObject *__pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_do_calc_components", __pyx_f[0], 1331);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1332")'> 1332:         for i in range(self._num_components):</pre>
<pre id='line1332' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1332
 * 
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 *         for i in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->_num_components;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1333")'> 1333:             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1333' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":1333
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 *         for i in range(self._num_components):
 *             self._distance_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component_to_result, __pyx_v_i, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_force_factors, __pyx_t_3);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(__pyx_v_self, __pyx_v_i, __pyx_t_5, __pyx_v_force);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_distance_based_potential_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1334")'> 1334: </pre>
<pre id='line1334' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1335")'> 1335: </pre>
<pre id='line1335' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1336")'> 1336:     @cython.profile(False)</pre>
<pre id='line1336' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1337")'> 1337:     cdef inline float _cython_calc_single_force_factor(self, int index, float factor):</pre>
<pre id='line1337' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1337
 * 
 *     @cython.profile(False)
 *     cdef inline float _cython_calc_single_force_factor(self, int index, float factor):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef target_distant_atom atom_ids
 * #        cdef coefficient_exponent coef_exp
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor) {
  float __pyx_v_exponent;
  float __pyx_v_full_factor;
  float __pyx_v_force_factor;
  float __pyx_v_ratio;
  float __pyx_v_pre_exponent;
  float __pyx_v_reduced_exponent;
  float __pyx_v_sum_xyz_distances_2;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_single_force_factor", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1338")'> 1338:         cdef target_distant_atom atom_ids</pre>
<pre id='line1338' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1339")'> 1339: #        cdef coefficient_exponent coef_exp</pre>
<pre id='line1339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1340")'> 1340:         cdef float exponent</pre>
<pre id='line1340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1341")'> 1341: </pre>
<pre id='line1341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1342")'> 1342:         cdef float full_factor, force_factor</pre>
<pre id='line1342' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1343")'> 1343:         cdef float ratio, pre_exponent, reduced_exponent, sum_xyz_distances_2</pre>
<pre id='line1343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1344")'> 1344: </pre>
<pre id='line1344' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1345")'> 1345: #        atom_ids = self._get_target_and_distant_atom_ids(index)</pre>
<pre id='line1345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1346")'> 1346: </pre>
<pre id='line1346' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1347")'> 1347:         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)</pre>
<pre id='line1347' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1347
 * #        atom_ids = self._get_target_and_distant_atom_ids(index)
 * 
 *         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         full_factor= factor *  self._compiled_components[index].coefficient
 */
  __pyx_v_sum_xyz_distances_2 = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__sum_xyz_distances_2(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1348")'> 1348: #</pre>
<pre id='line1348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1349")'> 1349:         full_factor= factor *  self._compiled_components[index].coefficient</pre>
<pre id='line1349' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1349
 *         sum_xyz_distances_2 = self._sum_xyz_distances_2(self._compiled_components[index].remote_atom_1, self._compiled_components[index].remote_atom_2)
 * #
 *         full_factor= factor *  self._compiled_components[index].coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         exponent =  self._compiled_components[index].exponent
 */
  __pyx_v_full_factor = (__pyx_v_factor * (__pyx_v_self->_compiled_components[__pyx_v_index]).coefficient);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1350")'> 1350: </pre>
<pre id='line1350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1351")'> 1351:         exponent =  self._compiled_components[index].exponent</pre>
<pre id='line1351' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1351
 *         full_factor= factor *  self._compiled_components[index].coefficient
 * 
 *         exponent =  self._compiled_components[index].exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 */
  __pyx_v_exponent = (__pyx_v_self->_compiled_components[__pyx_v_index]).exponent;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1352")'> 1352:         if self._smoothed:</pre>
<pre id='line1352' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1352
 * 
 *         exponent =  self._compiled_components[index].exponent
 *         if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4
 */
  if (__pyx_v_self->_smoothed) {
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1353")'> 1353:             ratio = sum_xyz_distances_2 / (self._cutoff**2)</pre>
<pre id='line1353' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1353
 *         exponent =  self._compiled_components[index].exponent
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ratio =  ratio**4
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 */
    __pyx_t_1 = powf(__pyx_v_self->_cutoff, 2.0);
    if (unlikely(__pyx_t_1 == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_ratio = (__pyx_v_sum_xyz_distances_2 / __pyx_t_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1354")'> 1354:             ratio =  ratio**4</pre>
<pre id='line1354' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1354
 *         if self._smoothed:
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 *         else:
 */
    __pyx_v_ratio = powf(__pyx_v_ratio, 4.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1355")'> 1355:             pre_exponent = exponent - (exponent + 8.0) * ratio</pre>
<pre id='line1355' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1355
 *             ratio = sum_xyz_distances_2 / (self._cutoff**2)
 *             ratio =  ratio**4
 *             pre_exponent = exponent - (exponent + 8.0) * ratio             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             pre_exponent = exponent
 */
    __pyx_v_pre_exponent = (__pyx_v_exponent - ((__pyx_v_exponent + 8.0) * __pyx_v_ratio));
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1356")'> 1356:         else:</pre>
<pre id='line1356' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1357")'> 1357:             pre_exponent = exponent</pre>
<pre id='line1357' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1357
 *             pre_exponent = exponent - (exponent + 8.0) * ratio
 *         else:
 *             pre_exponent = exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         reduced_exponent = (exponent - 2.0) / 2.0
 */
    __pyx_v_pre_exponent = __pyx_v_exponent;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1358")'> 1358: </pre>
<pre id='line1358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1359")'> 1359:         reduced_exponent = (exponent - 2.0) / 2.0</pre>
<pre id='line1359' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1359
 *             pre_exponent = exponent
 * 
 *         reduced_exponent = (exponent - 2.0) / 2.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent
 */
  __pyx_v_reduced_exponent = ((__pyx_v_exponent - 2.0) / 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1360")'> 1360: </pre>
<pre id='line1360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1361")'> 1361:         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent</pre>
<pre id='line1361' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1361
 *         reduced_exponent = (exponent - 2.0) / 2.0
 * 
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return force_factor
 */
  __pyx_v_force_factor = ((__pyx_v_full_factor * __pyx_v_pre_exponent) * powf(__pyx_v_sum_xyz_distances_2, __pyx_v_reduced_exponent));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1362")'> 1362: </pre>
<pre id='line1362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1363")'> 1363:         return force_factor</pre>
<pre id='line1363' class='code' style='background-color: #FFFFc4'>
  /* "Cython_shift_calculator.pyx":1363
 *         force_factor = full_factor *  pre_exponent * sum_xyz_distances_2 ** reduced_exponent
 * 
 *         return force_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_force_factor;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_distance_based_potential_force_calculator._cython_calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1364")'> 1364: </pre>
<pre id='line1364' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1365")'> 1365: </pre>
<pre id='line1365' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1366")'> 1366: </pre>
<pre id='line1366' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1367")'> 1367: </pre>
<pre id='line1367' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1368")'> 1368: </pre>
<pre id='line1368' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1369")'> 1369: #    def _calc_single_force_set(self, int index, float factor, object forces):</pre>
<pre id='line1369' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1370")'> 1370: #        self._cython_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1370' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1371")'> 1371: </pre>
<pre id='line1371' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1372")'> 1372:     @cython.profile(False)</pre>
<pre id='line1372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1373")'> 1373:     cdef inline _distance_calc_single_force_set(self,int index, float factor, Out_array forces):</pre>
<pre id='line1373' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1373
 * 
 *     @cython.profile(False)
 *     cdef inline _distance_calc_single_force_set(self,int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        cdef target_distant_atom atom_ids
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_xyz_distances;
  float __pyx_v_force_factor;
  Vec3 __pyx_v_target_forces;
  Vec3 __pyx_v_distant_forces;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_distance_calc_single_force_set", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1374")'> 1374: </pre>
<pre id='line1374' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1375")'> 1375: #        cdef target_distant_atom atom_ids</pre>
<pre id='line1375' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1376")'> 1376:         cdef Vec3 xyz_distances</pre>
<pre id='line1376' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1377")'> 1377:         cdef float force_factor, distance</pre>
<pre id='line1377' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1378")'> 1378:         cdef Vec3 result</pre>
<pre id='line1378' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1379")'> 1379: </pre>
<pre id='line1379' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1380")'> 1380: #        atom_ids =  self._get_target_and_distant_atom_ids(index)</pre>
<pre id='line1380' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1381")'> 1381: #</pre>
<pre id='line1381' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1382")'> 1382: ##        print atom_ids.target_atom_id,atom_ids.distant_atom_id</pre>
<pre id='line1382' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1383")'> 1383:         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)</pre>
<pre id='line1383' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1383
 * #
 * ##        print atom_ids.target_atom_id,atom_ids.distant_atom_id
 *         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)
 */
  __pyx_v_xyz_distances = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__xyz_distances(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1384")'> 1384: </pre>
<pre id='line1384' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1385")'> 1385:         force_factor  = self._cython_calc_single_force_factor(index, factor)</pre>
<pre id='line1385' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1385
 *         xyz_distances  = self._xyz_distances(self._compiled_components[index].remote_atom_1,self._compiled_components[index].remote_atom_2)
 * 
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 target_forces = xyz_distances
 */
  __pyx_v_force_factor = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index, __pyx_v_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1386")'> 1386: </pre>
<pre id='line1386' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1387")'> 1387:         cdef Vec3 target_forces = xyz_distances</pre>
<pre id='line1387' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1387
 *         force_factor  = self._cython_calc_single_force_factor(index, factor)
 * 
 *         cdef Vec3 target_forces = xyz_distances             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(target_forces, -force_factor)
 * 
 */
  __pyx_v_target_forces = __pyx_v_xyz_distances;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1388")'> 1388:         operator_times(target_forces, -force_factor)</pre>
<pre id='line1388' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1388
 * 
 *         cdef Vec3 target_forces = xyz_distances
 *         operator_times(target_forces, -force_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 distant_forces = xyz_distances
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_target_forces, (-__pyx_v_force_factor));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1389")'> 1389: </pre>
<pre id='line1389' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1390")'> 1390:         cdef Vec3 distant_forces = xyz_distances</pre>
<pre id='line1390' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1390
 *         operator_times(target_forces, -force_factor)
 * 
 *         cdef Vec3 distant_forces = xyz_distances             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(distant_forces, force_factor)
 * #
 */
  __pyx_v_distant_forces = __pyx_v_xyz_distances;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1391")'> 1391:         operator_times(distant_forces, force_factor)</pre>
<pre id='line1391' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1391
 * 
 *         cdef Vec3 distant_forces = xyz_distances
 *         operator_times(distant_forces, force_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_distant_forces, __pyx_v_force_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1392")'> 1392: #</pre>
<pre id='line1392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1393")'> 1393:         forces.add(self._compiled_components[index].remote_atom_1,target_forces)</pre>
<pre id='line1393' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1393
 *         operator_times(distant_forces, force_factor)
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_1, __pyx_v_target_forces);
</pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line1394")'> 1394:         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)</pre>
<pre id='line1394' class='code' style='background-color: #FFFF29'>
  /* "Cython_shift_calculator.pyx":1394
 * #
 *         forces.add(self._compiled_components[index].remote_atom_1,target_forces)
 *         forces.add(self._compiled_components[index].remote_atom_2,distant_forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, (__pyx_v_self->_compiled_components[__pyx_v_index]).remote_atom_2, __pyx_v_distant_forces);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)__pyx_kp_s_14);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1400; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1395")'> 1395: </pre>
<pre id='line1395' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1396")'> 1396: </pre>
<pre id='line1396' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1397")'> 1397: cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):</pre>
<pre id='line1397' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1397
 * 
 * 
 * cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float _non_bonded_cutoff
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator {
  struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator __pyx_base;
  float _non_bonded_cutoff;
};


/* "Cython_shift_calculator.pyx":1397
 * 
 * 
 * cdef class Fast_non_bonded_force_calculator(Fast_distance_based_potential_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float _non_bonded_cutoff
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_distance_based_potential_force_calculator __pyx_base;
  PyObject *(*_non_bonded_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_force_calculator;
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__non_bonded_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1398")'> 1398:     cdef float _non_bonded_cutoff</pre>
<pre id='line1398' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1399")'> 1399: </pre>
<pre id='line1399' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1400")'> 1400:     def __init__(self, object indices, bint smoothed, name = "not set"):</pre>
<pre id='line1400' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1400
 *     cdef float _non_bonded_cutoff
 * 
 *     def __init__(self, object indices, bint smoothed, name = "not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         global DEFAULT_NB_CUTOFF
 *         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_force_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_indices, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 1400);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1401")'> 1401:         global DEFAULT_NB_CUTOFF</pre>
<pre id='line1401' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line1402")'> 1402:         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)</pre>
<pre id='line1402' class='code' style='background-color: #FFFF28'>
  /* "Cython_shift_calculator.pyx":1402
 *     def __init__(self, object indices, bint smoothed, name = "not set"):
 *         global DEFAULT_NB_CUTOFF
 *         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._non_bonded_cutoff = DEFAULT_NB_CUTOFF
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_indices);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line1403")'> 1403:         self._non_bonded_cutoff = DEFAULT_NB_CUTOFF</pre>
<pre id='line1403' class='code' style='background-color: #FFFF86'>
  /* "Cython_shift_calculator.pyx":1403
 *         global DEFAULT_NB_CUTOFF
 *         super(Fast_non_bonded_force_calculator, self).__init__(indices,smoothed,name=name)
 *         self._non_bonded_cutoff = DEFAULT_NB_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    def _calc_single_force_set(self, int index, float factor, object forces):
 */
  __pyx_v_self->_non_bonded_cutoff = __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1404")'> 1404: </pre>
<pre id='line1404' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1405")'> 1405: #    def _calc_single_force_set(self, int index, float factor, object forces):</pre>
<pre id='line1405' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1406")'> 1406: #        self._cython_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1407")'> 1407:     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):</pre>
<pre id='line1407' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1407
 * #    def _calc_single_force_set(self, int index, float factor, object forces):
 * #        self._cython_calc_single_force_set(index, factor, forces)
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._num_components):
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 */

static PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, PyObject *__pyx_v_component_to_result, PyObject *__pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_do_calc_components", __pyx_f[0], 1407);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1408")'> 1408:         for i in range(self._num_components):</pre>
<pre id='line1408' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1408
 * #        self._cython_calc_single_force_set(index, factor, forces)
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 *         for i in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base._num_components;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1409")'> 1409:             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1409' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":1409
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 *         for i in range(self._num_components):
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component_to_result, __pyx_v_i, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_force_factors, __pyx_t_3);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__non_bonded_calc_single_force_set(__pyx_v_self, __pyx_v_i, __pyx_t_5, __pyx_v_force);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1410")'> 1410: </pre>
<pre id='line1410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1411")'> 1411:     cdef inline  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1411' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1411
 *             self._non_bonded_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 *     cdef inline  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float distance  = calc_distance_simulation(self._simulation, self._compiled_components[index].target_atom,self._compiled_components[index].remote_atom_1)
 * #        TODO: this should be the non bonded distance cutoff
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_32Fast_non_bonded_force_calculator__non_bonded_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_non_bonded_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  float __pyx_v_distance;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_non_bonded_calc_single_force_set", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_non_bonded_calc_single_force_set", __pyx_f[0], 1411);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1412")'> 1412:         cdef float distance  = calc_distance_simulation(self._simulation, self._compiled_components[index].target_atom,self._compiled_components[index].remote_atom_1)</pre>
<pre id='line1412' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1412
 * 
 *     cdef inline  _non_bonded_calc_single_force_set(self, int index, float factor, Out_array forces):
 *         cdef float distance  = calc_distance_simulation(self._simulation, self._compiled_components[index].target_atom,self._compiled_components[index].remote_atom_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        TODO: this should be the non bonded distance cutoff
 * #TODO class variable of self are not being looked up!
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_self->__pyx_base._compiled_components[__pyx_v_index]).remote_atom_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_distance = __pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base.__pyx_base._simulation, (__pyx_v_self->__pyx_base._compiled_components[__pyx_v_index]).target_atom, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1413")'> 1413: #        TODO: this should be the non bonded distance cutoff</pre>
<pre id='line1413' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1414")'> 1414: #TODO class variable of self are not being looked up!</pre>
<pre id='line1414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1415")'> 1415:         if distance &lt; 5.0:</pre>
<pre id='line1415' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1415
 * #        TODO: this should be the non bonded distance cutoff
 * #TODO class variable of self are not being looked up!
 *         if distance <code><</code> 5.0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._distance_calc_single_force_set(index, factor, forces)
 * 
 */
  __pyx_t_2 = (__pyx_v_distance <code><</code> 5.0);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line1416")'> 1416:             self._distance_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1416' class='code' style='background-color: #FFFF3e'>
    /* "Cython_shift_calculator.pyx":1416
 * #TODO class variable of self are not being looked up!
 *         if distance <code><</code> 5.0:
 *             self._distance_calc_single_force_set(index, factor, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_1 = __pyx_f_17shift_calculators_46Fast_distance_based_potential_force_calculator__distance_calc_single_force_set(((struct __pyx_obj_17shift_calculators_Fast_distance_based_potential_force_calculator *)__pyx_v_self), __pyx_v_index, __pyx_v_factor, __pyx_v_forces);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_force_calculator._non_bonded_calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_14);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1422; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1422; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1417")'> 1417: </pre>
<pre id='line1417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1418")'> 1418: </pre>
<pre id='line1418' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1419")'> 1419: </pre>
<pre id='line1419' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1420")'> 1420: cdef class Fast_dihedral_force_calculator(Base_force_calculator):</pre>
<pre id='line1420' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1420
 * 
 * 
 * cdef class Fast_dihedral_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self,name="not set"):
 */
struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
};


/* "Cython_shift_calculator.pyx":1420
 * 
 * 
 * cdef class Fast_dihedral_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __init__(self,name="not set"):
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  struct __pyx_t_17shift_calculators_dihedral_ids (*_get_dihedral_atom_ids)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  struct __pyx_t_17shift_calculators_dihedral_parameters (*_get_parameters)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  float (*_get_coefficient)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  PyObject *(*_cython_calc_single_force_factor)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
  PyObject *(*_dihedral_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_dihedral_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_dihedral_force_calculator;
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *, int, float, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1421")'> 1421: </pre>
<pre id='line1421' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1422")'> 1422:     def __init__(self,name="not set"):</pre>
<pre id='line1422' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1422
 * cdef class Fast_dihedral_force_calculator(Base_force_calculator):
 * 
 *     def __init__(self,name="not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         Base_force_calculator.__init__(self,name=name)
 * 
 */

static int __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 1422);
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line1423")'> 1423:         Base_force_calculator.__init__(self,name=name)</pre>
<pre id='line1423' class='code' style='background-color: #FFFF33'>
  /* "Cython_shift_calculator.pyx":1423
 * 
 *     def __init__(self,name="not set"):
 *         Base_force_calculator.__init__(self,name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Base_force_calculator)), __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1424")'> 1424: </pre>
<pre id='line1424' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1425")'> 1425:     @cython.profile(False)</pre>
<pre id='line1425' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1426")'> 1426:     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):</pre>
<pre id='line1426' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1426
 * 
 *     @cython.profile(False)
 *     cdef inline dihedral_ids _get_dihedral_atom_ids(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids result
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_ids __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_result;
  PyObject *__pyx_v_component = NULL;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_dihedral_atom_ids", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1427")'> 1427:         cdef dihedral_ids result</pre>
<pre id='line1427' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1428")'> 1428: </pre>
<pre id='line1428' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1429")'> 1429:         component = self._get_component(index)</pre>
<pre id='line1429' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1429
 *         cdef dihedral_ids result
 * 
 *         component = self._get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.atom_id_1= component[1]
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_21Base_force_calculator__get_component(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_component = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1430")'> 1430: </pre>
<pre id='line1430' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1431")'> 1431:         result.atom_id_1= component[1]</pre>
<pre id='line1431' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1431
 *         component = self._get_component(index)
 * 
 *         result.atom_id_1= component[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_2= component[2]
 *         result.atom_id_3= component[3]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_1 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1432")'> 1432:         result.atom_id_2= component[2]</pre>
<pre id='line1432' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1432
 * 
 *         result.atom_id_1= component[1]
 *         result.atom_id_2= component[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_3= component[3]
 *         result.atom_id_4= component[4]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_2 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1433")'> 1433:         result.atom_id_3= component[3]</pre>
<pre id='line1433' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1433
 *         result.atom_id_1= component[1]
 *         result.atom_id_2= component[2]
 *         result.atom_id_3= component[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.atom_id_4= component[4]
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 3, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_3 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1434")'> 1434:         result.atom_id_4= component[4]</pre>
<pre id='line1434' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1434
 *         result.atom_id_2= component[2]
 *         result.atom_id_3= component[3]
 *         result.atom_id_4= component[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 4, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.atom_id_4 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1435")'> 1435: </pre>
<pre id='line1435' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1436")'> 1436:         return result</pre>
<pre id='line1436' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1436
 *         result.atom_id_4= component[4]
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_dihedral_force_calculator._get_dihedral_atom_ids", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1437")'> 1437: </pre>
<pre id='line1437' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1438")'> 1438:     @cython.profile(False)</pre>
<pre id='line1438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1439")'> 1439:     cdef inline dihedral_parameters _get_parameters(self, int index):</pre>
<pre id='line1439' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1439
 * 
 *     @cython.profile(False)
 *     cdef inline dihedral_parameters _get_parameters(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component = self._get_component(index)
 * 
 */

static CYTHON_INLINE struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_v_component = NULL;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_result;
  PyObject *__pyx_v_parameters = NULL;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_parameters", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1440")'> 1440:         component = self._get_component(index)</pre>
<pre id='line1440' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1440
 *     @cython.profile(False)
 *     cdef inline dihedral_parameters _get_parameters(self, int index):
 *         component = self._get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_parameters result
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_21Base_force_calculator__get_component(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_component = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1441")'> 1441: </pre>
<pre id='line1441' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1442")'> 1442:         cdef dihedral_parameters result</pre>
<pre id='line1442' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1443")'> 1443: </pre>
<pre id='line1443' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1444")'> 1444:         parameters = component[6:11]</pre>
<pre id='line1444' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1444
 *         cdef dihedral_parameters result
 * 
 *         parameters = component[6:11]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.param_0 =  parameters[0]
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_component, 6, 11);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_parameters = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1445")'> 1445: </pre>
<pre id='line1445' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1446")'> 1446:         result.param_0 =  parameters[0]</pre>
<pre id='line1446' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1446
 *         parameters = component[6:11]
 * 
 *         result.param_0 =  parameters[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_1 =  parameters[3]
 *         result.param_2 =  parameters[1]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_0 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1447")'> 1447:         result.param_1 =  parameters[3]</pre>
<pre id='line1447' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1447
 * 
 *         result.param_0 =  parameters[0]
 *         result.param_1 =  parameters[3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_2 =  parameters[1]
 *         result.param_3 =  parameters[4]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 3, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_1 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1448")'> 1448:         result.param_2 =  parameters[1]</pre>
<pre id='line1448' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1448
 *         result.param_0 =  parameters[0]
 *         result.param_1 =  parameters[3]
 *         result.param_2 =  parameters[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_3 =  parameters[4]
 *         result.param_4 =  parameters[2]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_2 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1449")'> 1449:         result.param_3 =  parameters[4]</pre>
<pre id='line1449' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1449
 *         result.param_1 =  parameters[3]
 *         result.param_2 =  parameters[1]
 *         result.param_3 =  parameters[4]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.param_4 =  parameters[2]
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 4, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_3 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1450")'> 1450:         result.param_4 =  parameters[2]</pre>
<pre id='line1450' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1450
 *         result.param_2 =  parameters[1]
 *         result.param_3 =  parameters[4]
 *         result.param_4 =  parameters[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_parameters, 2, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result.param_4 = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1451")'> 1451: </pre>
<pre id='line1451' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1452")'> 1452: </pre>
<pre id='line1452' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1453")'> 1453:         return result</pre>
<pre id='line1453' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1453
 * 
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_dihedral_force_calculator._get_parameters", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_parameters);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1454")'> 1454: </pre>
<pre id='line1454' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1455")'> 1455:     @cython.profile(False)</pre>
<pre id='line1455' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1456")'> 1456:     cdef inline float _get_coefficient(self, int index):</pre>
<pre id='line1456' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1456
 * 
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         component = self._get_component(index)
 *         coefficient = component[5]
 */

static CYTHON_INLINE float __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_v_coefficient = NULL;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coefficient", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1457")'> 1457:         component = self._get_component(index)</pre>
<pre id='line1457' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1457
 *     @cython.profile(False)
 *     cdef inline float _get_coefficient(self, int index):
 *         component = self._get_component(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         coefficient = component[5]
 *         return coefficient
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_21Base_force_calculator__get_component(((struct __pyx_obj_17shift_calculators_Base_force_calculator *)__pyx_v_self), __pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1457; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_component = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1458")'> 1458:         coefficient = component[5]</pre>
<pre id='line1458' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1458
 *     cdef inline float _get_coefficient(self, int index):
 *         component = self._get_component(index)
 *         coefficient = component[5]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return coefficient
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, 5, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_coefficient = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line1459")'> 1459:         return coefficient</pre>
<pre id='line1459' class='code' style='background-color: #FFFF3f'>
  /* "Cython_shift_calculator.pyx":1459
 *         component = self._get_component(index)
 *         coefficient = component[5]
 *         return coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    TODO make this consistent with the distance forces factor
 */
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_coefficient);<span class='error_goto'> if (unlikely((__pyx_t_2 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1459; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_dihedral_force_calculator._get_coefficient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coefficient);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_3_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_arg_index); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_30Fast_dihedral_force_calculator_3_calc_single_force_factor(PyObject *__pyx_v_self, PyObject *__pyx_arg_index) {
  int __pyx_v_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor (wrapper)", 0);
  assert(__pyx_arg_index); {
    __pyx_v_index = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_arg_index);<span class='error_goto'> if (unlikely((__pyx_v_index == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1462; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_2_calc_single_force_factor(((struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *)__pyx_v_self), ((int)__pyx_v_index));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1460")'> 1460: </pre>
<pre id='line1460' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1461")'> 1461: #    TODO make this consistent with the distance forces factor</pre>
<pre id='line1461' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1462")'> 1462:     def _calc_single_force_factor(self, int index):</pre>
<pre id='line1462' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1462
 * 
 * #    TODO make this consistent with the distance forces factor
 *     def _calc_single_force_factor(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return self._cython_calc_single_force_factor(index)
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_30Fast_dihedral_force_calculator_2_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_single_force_factor", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calc_single_force_factor", __pyx_f[0], 1462);
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1463")'> 1463:         return self._cython_calc_single_force_factor(index)</pre>
<pre id='line1463' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":1463
 * #    TODO make this consistent with the distance forces factor
 *     def _calc_single_force_factor(self, int index):
 *         return self._cython_calc_single_force_factor(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(__pyx_v_self, __pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1464")'> 1464: </pre>
<pre id='line1464' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1465")'> 1465:     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):</pre>
<pre id='line1465' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1465
 *         return self._cython_calc_single_force_factor(index)
 * 
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(len(self._components)):
 *             self._dihedral_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 */

static PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, PyObject *__pyx_v_component_to_result, PyObject *__pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_do_calc_components", __pyx_f[0], 1465);
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line1466")'> 1466:         for i in range(len(self._components)):</pre>
<pre id='line1466' class='code' style='background-color: #FFFF1e'>
  /* "Cython_shift_calculator.pyx":1466
 * 
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 *         for i in range(len(self._components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._dihedral_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->__pyx_base._components;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_2 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2++;
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_2 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2++;
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line1467")'> 1467:             self._dihedral_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1467' class='code' style='background-color: #FFFF2f'>
    /* "Cython_shift_calculator.pyx":1467
 *     cdef _do_calc_components(self, object component_to_result, object force_factors, Out_array force):
 *         for i in range(len(self._components)):
 *             self._dihedral_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component_to_result, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_force_factors, __pyx_t_1);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(__pyx_v_self, __pyx_t_5, __pyx_t_7, __pyx_v_force);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1468")'> 1468: </pre>
<pre id='line1468' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1469")'> 1469: </pre>
<pre id='line1469' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1470")'> 1470:     cdef inline _cython_calc_single_force_factor(self, int index):</pre>
<pre id='line1470' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1470
 * 
 * 
 *     cdef inline _cython_calc_single_force_factor(self, int index):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef dihedral_ids dihedral_atom_ids
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__cython_calc_single_force_factor(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index) {
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_dihedral_atom_ids;
  struct __pyx_t_17shift_calculators_dihedral_parameters __pyx_v_params;
  PyObject *__pyx_v_angle = NULL;
  double __pyx_v_result;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_single_force_factor", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_cython_calc_single_force_factor", __pyx_f[0], 1470);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1471")'> 1471: </pre>
<pre id='line1471' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1472")'> 1472:         cdef dihedral_ids dihedral_atom_ids</pre>
<pre id='line1472' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1473")'> 1473:         cdef dihedral_parameters params</pre>
<pre id='line1473' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1474")'> 1474: </pre>
<pre id='line1474' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1475")'> 1475: </pre>
<pre id='line1475' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1476")'> 1476:         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)</pre>
<pre id='line1476' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1476
 * 
 * 
 *         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         params = self._get_parameters(index)
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_index);
  __pyx_v_dihedral_atom_ids = __pyx_t_1;
  __pyx_v_dihedral_atom_ids = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1477")'> 1477: </pre>
<pre id='line1477' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1478")'> 1478:         params = self._get_parameters(index)</pre>
<pre id='line1478' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1478
 *         dihedral_atom_ids  = dihedral_atom_ids= self._get_dihedral_atom_ids(index)
 * 
 *         params = self._get_parameters(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)
 */
  __pyx_v_params = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_parameters(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1479")'> 1479: </pre>
<pre id='line1479' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1480")'> 1480:         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)</pre>
<pre id='line1480' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1480
 *         params = self._get_parameters(index)
 * 
 *         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 */
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_calc_dihedral_angle_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_dihedral_atom_ids));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_v_angle = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1481")'> 1481: </pre>
<pre id='line1481' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1482")'> 1482:         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \</pre>
<pre id='line1482' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":1482
 *         angle = calc_dihedral_angle_simulation(self._simulation, dihedral_atom_ids)
 * 
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         params.param_2 * sin(angle + params.param_3)
 *         return result
 */
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(3.0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_v_angle);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_params.param_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1483")'> 1483:                         params.param_2 * sin(angle + params.param_3)</pre>
<pre id='line1483' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":1483
 * 
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 *                         params.param_2 * sin(angle + params.param_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_params.param_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_angle, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_6 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result = (((-3.0 * __pyx_v_params.param_0) * sin(__pyx_t_5)) - (__pyx_v_params.param_2 * sin(__pyx_t_6)));
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1484")'> 1484:         return result</pre>
<pre id='line1484' class='code' style='background-color: #FFFF62'>
  /* "Cython_shift_calculator.pyx":1484
 *         result = -3.0 * params.param_0 * sin(3.0 * angle + params.param_1) - \
 *                         params.param_2 * sin(angle + params.param_3)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._cython_calc_single_force_factor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_angle);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1485")'> 1485: </pre>
<pre id='line1485' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1486")'> 1486: </pre>
<pre id='line1486' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1487")'> 1487: </pre>
<pre id='line1487' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1488")'> 1488: #    def _calc_single_force_set(self, int index, float factor, object forces):</pre>
<pre id='line1488' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1489")'> 1489: #        self._cython_calc_single_force_set(index, factor, forces)</pre>
<pre id='line1489' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1490")'> 1490: </pre>
<pre id='line1490' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1491")'> 1491:     cdef inline _dihedral_calc_single_force_set(self, int index, float factor, Out_array forces):</pre>
<pre id='line1491' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1491
 * #        self._cython_calc_single_force_set(index, factor, forces)
 * 
 *     cdef inline _dihedral_calc_single_force_set(self, int index, float factor, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 r1, r2, r4, temp
 *         cdef Vec3 n1, n2
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__dihedral_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_dihedral_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_factor, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_r1;
  Vec3 __pyx_v_r2;
  Vec3 __pyx_v_r4;
  Vec3 __pyx_v_n1;
  Vec3 __pyx_v_n2;
  float __pyx_v_weight;
  float __pyx_v_factor_1;
  float __pyx_v_factor_2;
  float __pyx_v_factor_3;
  Vec3 __pyx_v_F2;
  Vec3 __pyx_v_F3;
  float __pyx_v_dihedral_factor;
  struct __pyx_t_17shift_calculators_dihedral_ids __pyx_v_atom_ids;
  Vec3 __pyx_v_v1;
  Vec3 __pyx_v_v2;
  Vec3 __pyx_v_v3;
  Vec3 __pyx_v_v4;
  Vec3 __pyx_v_r3;
  PyObject *__pyx_v_r2_length = NULL;
  PyObject *__pyx_v_r2_length_2 = NULL;
  Vec3 __pyx_v_F1;
  Vec3 __pyx_v_F4;
  Vec3 __pyx_v_T1;
  Vec3 __pyx_v_T2;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_dihedral_calc_single_force_set", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_dihedral_calc_single_force_set", __pyx_f[0], 1491);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1492")'> 1492:         cdef Vec3 r1, r2, r4, temp</pre>
<pre id='line1492' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1493")'> 1493:         cdef Vec3 n1, n2</pre>
<pre id='line1493' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1494")'> 1494:         cdef float weight</pre>
<pre id='line1494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1495")'> 1495:         cdef float factor_1, factor_2, factor_3</pre>
<pre id='line1495' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1496")'> 1496:         cdef Vec3 F2, F3,</pre>
<pre id='line1496' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1497")'> 1497:         cdef Vec3 T3, T4</pre>
<pre id='line1497' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1498")'> 1498: </pre>
<pre id='line1498' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1499")'> 1499:         cdef float dihedral_factor = self._calc_single_force_factor(index)</pre>
<pre id='line1499' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":1499
 *         cdef Vec3 T3, T4
 * 
 *         cdef float dihedral_factor = self._calc_single_force_factor(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_41);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_index);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dihedral_factor = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1500")'> 1500:         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)</pre>
<pre id='line1500' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1500
 * 
 *         cdef float dihedral_factor = self._calc_single_force_factor(index)
 *         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)
 */
  __pyx_v_atom_ids = __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_dihedral_atom_ids(__pyx_v_self, __pyx_v_index);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1501")'> 1501: </pre>
<pre id='line1501' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1502")'> 1502:         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)</pre>
<pre id='line1502' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1502
 *         cdef dihedral_ids atom_ids = self._get_dihedral_atom_ids(index)
 * 
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 */
  __pyx_v_v1 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1503")'> 1503:         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)</pre>
<pre id='line1503' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1503
 * 
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 */
  __pyx_v_v2 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1504")'> 1504:         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)</pre>
<pre id='line1504' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1504
 *         v1 = self._simulation[0].atomPos(atom_ids.atom_id_1)
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 * 
 */
  __pyx_v_v3 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1505")'> 1505:         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)</pre>
<pre id='line1505' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1505
 *         v2 = self._simulation[0].atomPos(atom_ids.atom_id_2)
 *         v3 = self._simulation[0].atomPos(atom_ids.atom_id_3)
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r1 = v1 - v2
 */
  __pyx_v_v4 = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_atom_ids.atom_id_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1506")'> 1506: </pre>
<pre id='line1506' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1507")'> 1507:         r1 = v1 - v2</pre>
<pre id='line1507' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1507
 *         v4 = self._simulation[0].atomPos(atom_ids.atom_id_4)
 * 
 *         r1 = v1 - v2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         r2 = v3 - v2
 * 
 */
  __pyx_v_r1 = (__pyx_v_v1 - __pyx_v_v2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1508")'> 1508:         r2 = v3 - v2</pre>
<pre id='line1508' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1508
 * 
 *         r1 = v1 - v2
 *         r2 = v3 - v2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 r3 = r2
 */
  __pyx_v_r2 = (__pyx_v_v3 - __pyx_v_v2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1509")'> 1509: </pre>
<pre id='line1509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1510")'> 1510:         cdef Vec3 r3 = r2</pre>
<pre id='line1510' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1510
 *         r2 = v3 - v2
 * 
 *         cdef Vec3 r3 = r2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(r3, -1)
 * 
 */
  __pyx_v_r3 = __pyx_v_r2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1511")'> 1511:         operator_times(r3, -1)</pre>
<pre id='line1511' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1511
 * 
 *         cdef Vec3 r3 = r2
 *         operator_times(r3, -1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r4 = v4 - v3
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_r3, -1.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1512")'> 1512: </pre>
<pre id='line1512' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1513")'> 1513:         r4 = v4 - v3</pre>
<pre id='line1513' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1513
 *         operator_times(r3, -1)
 * 
 *         r4 = v4 - v3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        print vec3_as_tuple(r1), vec3_as_tuple(r2), vec3_as_tuple(r3), vec3_as_tuple(r4)
 */
  __pyx_v_r4 = (__pyx_v_v4 - __pyx_v_v3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1514")'> 1514: </pre>
<pre id='line1514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1515")'> 1515: #        print vec3_as_tuple(r1), vec3_as_tuple(r2), vec3_as_tuple(r3), vec3_as_tuple(r4)</pre>
<pre id='line1515' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1516")'> 1516: </pre>
<pre id='line1516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1517")'> 1517:         # compute normal vector to plane containing v1, v2, and v3</pre>
<pre id='line1517' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1518")'> 1518:         n1 = cross(r1, r2)</pre>
<pre id='line1518' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1518
 * 
 *         # compute normal vector to plane containing v1, v2, and v3
 *         n1 = cross(r1, r2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # compute normal vector to plane containing v2, v3, and v4
 *         n2 = cross(r3, r4)
 */
  __pyx_v_n1 = cross(__pyx_v_r1, __pyx_v_r2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1519")'> 1519:         # compute normal vector to plane containing v2, v3, and v4</pre>
<pre id='line1519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1520")'> 1520:         n2 = cross(r3, r4)</pre>
<pre id='line1520' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1520
 *         n1 = cross(r1, r2)
 *         # compute normal vector to plane containing v2, v3, and v4
 *         n2 = cross(r3, r4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)
 */
  __pyx_v_n2 = cross(__pyx_v_r3, __pyx_v_r4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1521")'> 1521: </pre>
<pre id='line1521' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1522")'> 1522:         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)</pre>
<pre id='line1522' class='code' style='background-color: #FFFF79'>
  /* "Cython_shift_calculator.pyx":1522
 *         n2 = cross(r3, r4)
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         r2_length_2 = r2_length*r2_length
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_atom_ids.atom_id_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base._simulation, __pyx_v_atom_ids.atom_id_2, __pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_r2_length = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1523")'> 1523:         r2_length_2 = r2_length*r2_length</pre>
<pre id='line1523' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1523
 * 
 *         r2_length = calc_distance_simulation(self._simulation, atom_ids.atom_id_2,atom_ids.atom_id_3)
 *         r2_length_2 = r2_length*r2_length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_r2_length, __pyx_v_r2_length);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_v_r2_length_2 = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1524")'> 1524: </pre>
<pre id='line1524' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1525")'> 1525: </pre>
<pre id='line1525' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1526")'> 1526:         weight = factor * self._get_coefficient(index)</pre>
<pre id='line1526' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1526
 * 
 * 
 *         weight = factor * self._get_coefficient(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_v_weight = (__pyx_v_factor * __pyx_f_17shift_calculators_30Fast_dihedral_force_calculator__get_coefficient(__pyx_v_self, __pyx_v_index));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1527")'> 1527: </pre>
<pre id='line1527' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1528")'> 1528: </pre>
<pre id='line1528' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1529")'> 1529: </pre>
<pre id='line1529' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1530")'> 1530: #        // force calculation according to Bekker, Berendsen and van Gunsteren (1995),</pre>
<pre id='line1530' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1531")'> 1531: #        // Journal of Computational Chemistry 16, pp. 527-533:</pre>
<pre id='line1531' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1532")'> 1532: ##        // Force and virial of torsional-angle-dependent potentials.</pre>
<pre id='line1532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1533")'> 1533:         factor_1 = dihedral_factor * r2_length</pre>
<pre id='line1533' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":1533
 * #        // Journal of Computational Chemistry 16, pp. 527-533:
 * ##        // Force and virial of torsional-angle-dependent potentials.
 *         factor_1 = dihedral_factor * r2_length             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 F1 = n1
 */
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_dihedral_factor);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_v_r2_length);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_factor_1 = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1534")'> 1534: </pre>
<pre id='line1534' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1535")'> 1535:         cdef Vec3 F1 = n1</pre>
<pre id='line1535' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1535
 *         factor_1 = dihedral_factor * r2_length
 * 
 *         cdef Vec3 F1 = n1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F1, (-factor_1 / norm(n1)**2))
 * 
 */
  __pyx_v_F1 = __pyx_v_n1;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1536")'> 1536:         operator_times(F1, (-factor_1 / norm(n1)**2))</pre>
<pre id='line1536' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1536
 * 
 *         cdef Vec3 F1 = n1
 *         operator_times(F1, (-factor_1 / norm(n1)**2))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 F4 = n2
 */
  __pyx_t_4 = (-__pyx_v_factor_1);
  __pyx_t_5 = powf(norm(__pyx_v_n1), 2.0);
  if (unlikely(__pyx_t_5 == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1536; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F1, (__pyx_t_4 / __pyx_t_5));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1537")'> 1537: </pre>
<pre id='line1537' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1538")'> 1538:         cdef Vec3 F4 = n2</pre>
<pre id='line1538' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1538
 *         operator_times(F1, (-factor_1 / norm(n1)**2))
 * 
 *         cdef Vec3 F4 = n2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F4, ( factor_1 / norm(n2)**2))
 * 
 */
  __pyx_v_F4 = __pyx_v_n2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1539")'> 1539:         operator_times(F4, ( factor_1 / norm(n2)**2))</pre>
<pre id='line1539' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1539
 * 
 *         cdef Vec3 F4 = n2
 *         operator_times(F4, ( factor_1 / norm(n2)**2))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2
 */
  __pyx_t_5 = powf(norm(__pyx_v_n2), 2.0);
  if (unlikely(__pyx_t_5 == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F4, (__pyx_v_factor_1 / __pyx_t_5));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1540")'> 1540: </pre>
<pre id='line1540' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1541")'> 1541:         factor_2 = dot(r1, r2) / r2_length_2</pre>
<pre id='line1541' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":1541
 *         operator_times(F4, ( factor_1 / norm(n2)**2))
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         factor_3 = dot(r3, r4) / r2_length_2
 * 
 */
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(dot(__pyx_v_r1, __pyx_v_r2));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_2, __pyx_v_r2_length_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_5 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_factor_2 = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1542")'> 1542:         factor_3 = dot(r3, r4) / r2_length_2</pre>
<pre id='line1542' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":1542
 * 
 *         factor_2 = dot(r1, r2) / r2_length_2
 *         factor_3 = dot(r3, r4) / r2_length_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 T1 = F1
 */
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(dot(__pyx_v_r3, __pyx_v_r4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_3, __pyx_v_r2_length_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_5 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_factor_3 = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1543")'> 1543: </pre>
<pre id='line1543' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1544")'> 1544:         cdef Vec3 T1 = F1</pre>
<pre id='line1544' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1544
 *         factor_3 = dot(r3, r4) / r2_length_2
 * 
 *         cdef Vec3 T1 = F1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T1,  (factor_2-1))
 * 
 */
  __pyx_v_T1 = __pyx_v_F1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1545")'> 1545:         operator_times(T1,  (factor_2-1))</pre>
<pre id='line1545' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1545
 * 
 *         cdef Vec3 T1 = F1
 *         operator_times(T1,  (factor_2-1))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 T2 = F4
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T1, (__pyx_v_factor_2 - 1.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1546")'> 1546: </pre>
<pre id='line1546' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1547")'> 1547:         cdef Vec3 T2 = F4</pre>
<pre id='line1547' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1547
 *         operator_times(T1,  (factor_2-1))
 * 
 *         cdef Vec3 T2 = F4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T2,  -factor_3)
 * 
 */
  __pyx_v_T2 = __pyx_v_F4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1548")'> 1548:         operator_times(T2,  -factor_3)</pre>
<pre id='line1548' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1548
 * 
 *         cdef Vec3 T2 = F4
 *         operator_times(T2,  -factor_3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         F2 = T1 + T2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T2, (-__pyx_v_factor_3));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1549")'> 1549: </pre>
<pre id='line1549' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1550")'> 1550:         F2 = T1 + T2</pre>
<pre id='line1550' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1550
 *         operator_times(T2,  -factor_3)
 * 
 *         F2 = T1 + T2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         T1 = F1
 */
  __pyx_v_F2 = (__pyx_v_T1 + __pyx_v_T2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1551")'> 1551: </pre>
<pre id='line1551' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1552")'> 1552:         T1 = F1</pre>
<pre id='line1552' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1552
 *         F2 = T1 + T2
 * 
 *         T1 = F1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T1,  -factor_2)
 * 
 */
  __pyx_v_T1 = __pyx_v_F1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1553")'> 1553:         operator_times(T1,  -factor_2)</pre>
<pre id='line1553' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1553
 * 
 *         T1 = F1
 *         operator_times(T1,  -factor_2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         T2 = F4
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T1, (-__pyx_v_factor_2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1554")'> 1554: </pre>
<pre id='line1554' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1555")'> 1555:         T2 = F4</pre>
<pre id='line1555' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1555
 *         operator_times(T1,  -factor_2)
 * 
 *         T2 = F4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(T2, (factor_3 -1))
 * 
 */
  __pyx_v_T2 = __pyx_v_F4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1556")'> 1556:         operator_times(T2, (factor_3 -1))</pre>
<pre id='line1556' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1556
 * 
 *         T2 = F4
 *         operator_times(T2, (factor_3 -1))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         F3 = T1 + T2
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_T2, (__pyx_v_factor_3 - 1.0));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1557")'> 1557: </pre>
<pre id='line1557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1558")'> 1558:         F3 = T1 + T2</pre>
<pre id='line1558' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1558
 *         operator_times(T2, (factor_3 -1))
 * 
 *         F3 = T1 + T2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        print vec3_as_tuple(F1), vec3_as_tuple(F2), vec3_as_tuple(F3), vec3_as_tuple(F4)
 */
  __pyx_v_F3 = (__pyx_v_T1 + __pyx_v_T2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1559")'> 1559: </pre>
<pre id='line1559' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1560")'> 1560: #        print vec3_as_tuple(F1), vec3_as_tuple(F2), vec3_as_tuple(F3), vec3_as_tuple(F4)</pre>
<pre id='line1560' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1561")'> 1561: #        // assign forces</pre>
<pre id='line1561' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1562")'> 1562: #        force_triplet_1 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_1)</pre>
<pre id='line1562' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1563")'> 1563: #        force_triplet_2 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_2)</pre>
<pre id='line1563' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1564")'> 1564: #        force_triplet_3 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_3)</pre>
<pre id='line1564' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1565")'> 1565: #        force_triplet_4 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_4)</pre>
<pre id='line1565' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1566")'> 1566: </pre>
<pre id='line1566' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1567")'> 1567:         operator_times(F1, weight)</pre>
<pre id='line1567' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1567
 * #        force_triplet_4 = self._get_or_make_target_force_triplet(forces, atom_ids.atom_id_4)
 * 
 *         operator_times(F1, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F1, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1568")'> 1568:         operator_times(F2, weight)</pre>
<pre id='line1568' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1568
 * 
 *         operator_times(F1, weight)
 *         operator_times(F2, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F3, weight)
 *         operator_times(F4, weight)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F2, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1569")'> 1569:         operator_times(F3, weight)</pre>
<pre id='line1569' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1569
 *         operator_times(F1, weight)
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(F4, weight)
 * 
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F3, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1570")'> 1570:         operator_times(F4, weight)</pre>
<pre id='line1570' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1570
 *         operator_times(F2, weight)
 *         operator_times(F3, weight)
 *         operator_times(F4, weight)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         forces.add(atom_ids.atom_id_1,F1)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_F4, __pyx_v_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1571")'> 1571: </pre>
<pre id='line1571' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1572")'> 1572:         forces.add(atom_ids.atom_id_1,F1)</pre>
<pre id='line1572' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1572
 *         operator_times(F4, weight)
 * 
 *         forces.add(atom_ids.atom_id_1,F1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_1, __pyx_v_F1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1573")'> 1573:         forces.add(atom_ids.atom_id_2,F2)</pre>
<pre id='line1573' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1573
 * 
 *         forces.add(atom_ids.atom_id_1,F1)
 *         forces.add(atom_ids.atom_id_2,F2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_3,F3)
 *         forces.add(atom_ids.atom_id_4,F4)
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_2, __pyx_v_F2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1574")'> 1574:         forces.add(atom_ids.atom_id_3,F3)</pre>
<pre id='line1574' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1574
 *         forces.add(atom_ids.atom_id_1,F1)
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         forces.add(atom_ids.atom_id_4,F4)
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_3, __pyx_v_F3);
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line1575")'> 1575:         forces.add(atom_ids.atom_id_4,F4)</pre>
<pre id='line1575' class='code' style='background-color: #FFFF39'>
  /* "Cython_shift_calculator.pyx":1575
 *         forces.add(atom_ids.atom_id_2,F2)
 *         forces.add(atom_ids.atom_id_3,F3)
 *         forces.add(atom_ids.atom_id_4,F4)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_atom_ids.atom_id_4, __pyx_v_F4);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_dihedral_force_calculator._dihedral_calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_r2_length);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_r2_length_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_26Fast_ring_force_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_14);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1603; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_name = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1603; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_name);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1576")'> 1576: </pre>
<pre id='line1576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1577")'> 1577: </pre>
<pre id='line1577' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1578")'> 1578: cdef struct Ring_target_component:</pre>
<pre id='line1578' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1578
 * 
 * 
 * cdef struct Ring_target_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *       int target_atom_id
 *       int atom_type_id
 */
struct __pyx_t_17shift_calculators_Ring_target_component {
  int target_atom_id;
  int atom_type_id;
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1579")'> 1579:       int target_atom_id</pre>
<pre id='line1579' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1580")'> 1580:       int atom_type_id</pre>
<pre id='line1580' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1581")'> 1581: </pre>
<pre id='line1581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1582")'> 1582: cdef struct Ring_component:</pre>
<pre id='line1582' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1582
 *       int atom_type_id
 * 
 * cdef struct Ring_component:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int ring_id
 *     int num_atoms
 */
struct __pyx_t_17shift_calculators_Ring_component {
  int ring_id;
  int num_atoms;
  int atom_ids[6];
};
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1583")'> 1583:     int ring_id</pre>
<pre id='line1583' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1584")'> 1584:     int num_atoms</pre>
<pre id='line1584' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1585")'> 1585:     int[6] atom_ids</pre>
<pre id='line1585' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1586")'> 1586: </pre>
<pre id='line1586' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1587")'> 1587: #cdef int RING_ATOM_IDS = 1</pre>
<pre id='line1587' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1588")'> 1588: cdef class Fast_ring_force_calculator(Base_force_calculator):</pre>
<pre id='line1588' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1588
 * 
 * #cdef int RING_ATOM_IDS = 1
 * cdef class Fast_ring_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator {
  struct __pyx_obj_17shift_calculators_Base_force_calculator __pyx_base;
  PyObject *_coef_components;
  PyObject *_ring_components;
  PyObject *_centre_cache;
  PyObject *_normal_cache;
  struct __pyx_t_17shift_calculators_Ring_target_component *_compiled_components;
  int _num_components;
  struct __pyx_t_17shift_calculators_Ring_component *_compiled_ring_components;
  int _num_ring_components;
};


/* "Cython_shift_calculator.pyx":1588
 * 
 * #cdef int RING_ATOM_IDS = 1
 * cdef class Fast_ring_force_calculator(Base_force_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Base_force_calculator __pyx_base;
  Vec3 (*_get_ring_normal)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
  Vec3 (*_get_ring_centre)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
  struct __pyx_obj_17shift_calculators_Coef_components *(*_get_coef_components)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
  PyObject *(*_ring_calc_single_force_set)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, PyObject *);
  PyObject *(*_calculate_single_ring_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, struct __pyx_t_17shift_calculators_Coef_component *, float, PyObject *);
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms (*_build_cython_force_terms)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int);
  PyObject *(*_cython_calc_target_atom_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &, struct __pyx_obj_17shift_calculators_Out_array *);
  PyObject *(*_cython_calculate_ring_forces)(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *);
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *__pyx_vtabptr_17shift_calculators_Fast_ring_force_calculator;
static CYTHON_INLINE struct __pyx_obj_17shift_calculators_Coef_components *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, PyObject *);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &, struct __pyx_obj_17shift_calculators_Out_array *);
static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *, int, int, float, struct __pyx_t_17shift_calculators_Ring_force_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *);

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1589")'> 1589: </pre>
<pre id='line1589' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1590")'> 1590: </pre>
<pre id='line1590' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1591")'> 1591:     cdef object _coef_components</pre>
<pre id='line1591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1592")'> 1592:     cdef object _ring_components</pre>
<pre id='line1592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1593")'> 1593:     cdef object _centre_cache</pre>
<pre id='line1593' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1594")'> 1594:     cdef object _normal_cache</pre>
<pre id='line1594' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1595")'> 1595: </pre>
<pre id='line1595' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1596")'> 1596:     cdef Ring_target_component* _compiled_components</pre>
<pre id='line1596' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1597")'> 1597:     cdef int _num_components</pre>
<pre id='line1597' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1598")'> 1598: </pre>
<pre id='line1598' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1599")'> 1599:     cdef Ring_component* _compiled_ring_components</pre>
<pre id='line1599' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1600")'> 1600:     cdef int _num_ring_components</pre>
<pre id='line1600' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1601")'> 1601: </pre>
<pre id='line1601' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1602")'> 1602: </pre>
<pre id='line1602' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1603")'> 1603:     def __init__(self,name="not set"):</pre>
<pre id='line1603' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1603
 * 
 * 
 *     def __init__(self,name="not set"):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_ring_force_calculator, self).__init__(name=name)
 *         self._coef_components = None
 */

static int __pyx_pf_17shift_calculators_26Fast_ring_force_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 1603);
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line1604")'> 1604:         super(Fast_ring_force_calculator, self).__init__(name=name)</pre>
<pre id='line1604' class='code' style='background-color: #FFFF34'>
  /* "Cython_shift_calculator.pyx":1604
 * 
 *     def __init__(self,name="not set"):
 *         super(Fast_ring_force_calculator, self).__init__(name=name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coef_components = None
 *         self._ring_components = None
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_v_name) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1605")'> 1605:         self._coef_components = None</pre>
<pre id='line1605' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1605
 *     def __init__(self,name="not set"):
 *         super(Fast_ring_force_calculator, self).__init__(name=name)
 *         self._coef_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._ring_components = None
 *         self._centre_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_coef_components);
  __pyx_v_self->_coef_components = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1606")'> 1606:         self._ring_components = None</pre>
<pre id='line1606' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1606
 *         super(Fast_ring_force_calculator, self).__init__(name=name)
 *         self._coef_components = None
 *         self._ring_components = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = None
 *         self._normal_cache = None
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_ring_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_ring_components);
  __pyx_v_self->_ring_components = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1607")'> 1607:         self._centre_cache = None</pre>
<pre id='line1607' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1607
 *         self._coef_components = None
 *         self._ring_components = None
 *         self._centre_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = None
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_centre_cache);
  __pyx_v_self->_centre_cache = Py_None;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1608")'> 1608:         self._normal_cache = None</pre>
<pre id='line1608' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1608
 *         self._ring_components = None
 *         self._centre_cache = None
 *         self._normal_cache = None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_components = NULL
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_normal_cache);
  __pyx_v_self->_normal_cache = Py_None;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1609")'> 1609: </pre>
<pre id='line1609' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1610")'> 1610:         self._compiled_components = NULL</pre>
<pre id='line1610' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1610
 *         self._normal_cache = None
 * 
 *         self._compiled_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = 0
 * 
 */
  __pyx_v_self->_compiled_components = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1611")'> 1611:         self._num_components = 0</pre>
<pre id='line1611' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1611
 * 
 *         self._compiled_components = NULL
 *         self._num_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         self._compiled_ring_components = NULL
 */
  __pyx_v_self->_num_components = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1612")'> 1612: </pre>
<pre id='line1612' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1613")'> 1613:         self._compiled_ring_components = NULL</pre>
<pre id='line1613' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1613
 *         self._num_components = 0
 * 
 *         self._compiled_ring_components = NULL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = 0
 * 
 */
  __pyx_v_self->_compiled_ring_components = NULL;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line1614")'> 1614:         self._num_ring_components = 0</pre>
<pre id='line1614' class='code' style='background-color: #FFFF86'>
  /* "Cython_shift_calculator.pyx":1614
 * 
 *         self._compiled_ring_components = NULL
 *         self._num_ring_components = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_components(self,components):
 */
  __pyx_v_self->_num_ring_components = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_3_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_3_set_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_2_set_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1615")'> 1615: </pre>
<pre id='line1615' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1616")'> 1616:     def _set_components(self,components):</pre>
<pre id='line1616' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1616
 *         self._num_ring_components = 0
 * 
 *     def _set_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_ring_force_calculator, self)._set_components(components)
 *         if  self._compiled_components ==  NULL:
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_2_set_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_components", __pyx_f[0], 1616);
</pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line1617")'> 1617:         super(Fast_ring_force_calculator, self)._set_components(components)</pre>
<pre id='line1617' class='code' style='background-color: #FFFF37'>
  /* "Cython_shift_calculator.pyx":1617
 * 
 *     def _set_components(self,components):
 *         super(Fast_ring_force_calculator, self)._set_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_ring_force_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s___set_components);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1618")'> 1618:         if  self._compiled_components ==  NULL:</pre>
<pre id='line1618' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1618
 *     def _set_components(self,components):
 *         super(Fast_ring_force_calculator, self)._set_components(components)
 *         if  self._compiled_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_components(components)
 * 
 */
  __pyx_t_4 = (__pyx_v_self->_compiled_components == NULL);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line1619")'> 1619:             self._compile_components(components)</pre>
<pre id='line1619' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":1619
 *         super(Fast_ring_force_calculator, self)._set_components(components)
 *         if  self._compiled_components ==  NULL:
 *             self._compile_components(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_components(self,components):
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s___compile_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._set_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_5_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_5_compile_components(PyObject *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_4_compile_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1620")'> 1620: </pre>
<pre id='line1620' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1621")'> 1621:     def _compile_components(self,components):</pre>
<pre id='line1621' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1621
 *             self._compile_components(components)
 * 
 *     def _compile_components(self,components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_4_compile_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_components) {
  PyObject *__pyx_v_i = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_component = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_compile_components", __pyx_f[0], 1621);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1622")'> 1622:         self._compiled_components = &lt;Ring_target_component*&gt;malloc(len(components) * sizeof(Ring_target_component))</pre>
<pre id='line1622' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1622
 * 
 *     def _compile_components(self,components):
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_components = ((struct __pyx_t_17shift_calculators_Ring_target_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Ring_target_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1623")'> 1623:         self._num_components = len(components)</pre>
<pre id='line1623' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1623
 *     def _compile_components(self,components):
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line1624")'> 1624:         for i,component in enumerate(components):</pre>
<pre id='line1624' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":1624
 *         self._compiled_components = <code><</code>Ring_target_component*>malloc(len(components) * sizeof(Ring_target_component))
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].target_atom_id = components[i][0]
 *             self._compiled_components[i].atom_type_id = components[i][1]
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_components)) {
    __pyx_t_3 = __pyx_v_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1625")'> 1625:             self._compiled_components[i].target_atom_id = components[i][0]</pre>
<pre id='line1625' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":1625
 *         self._num_components = len(components)
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_components[i].atom_type_id = components[i][1]
 * 
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).target_atom_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line1626")'> 1626:             self._compiled_components[i].atom_type_id = components[i][1]</pre>
<pre id='line1626' class='code' style='background-color: #FFFF2f'>
    /* "Cython_shift_calculator.pyx":1626
 *         for i,component in enumerate(components):
 *             self._compiled_components[i].target_atom_id = components[i][0]
 *             self._compiled_components[i].atom_type_id = components[i][1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_components[__pyx_t_8]).atom_type_id = __pyx_t_7;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._compile_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_7_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_7_set_coef_components(PyObject *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_6_set_coef_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_coef_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1627")'> 1627: </pre>
<pre id='line1627' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1628")'> 1628: </pre>
<pre id='line1628' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1629")'> 1629: </pre>
<pre id='line1629' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1630")'> 1630:     def _set_coef_components(self,coef_components):</pre>
<pre id='line1630' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1630
 * 
 * 
 *     def _set_coef_components(self,coef_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._coef_components =  coef_components
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_6_set_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_coef_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_coef_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_coef_components", __pyx_f[0], 1630);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1631")'> 1631:         self._coef_components =  coef_components</pre>
<pre id='line1631' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1631
 * 
 *     def _set_coef_components(self,coef_components):
 *         self._coef_components =  coef_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_ring_components(self,ring_components):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_coef_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_coef_components);
  __pyx_v_self->_coef_components = __pyx_v_coef_components;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_9_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_9_set_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_8_set_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1632")'> 1632: </pre>
<pre id='line1632' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1633")'> 1633:     def _set_ring_components(self,ring_components):</pre>
<pre id='line1633' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1633
 *         self._coef_components =  coef_components
 * 
 *     def _set_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._ring_components =  ring_components
 *         if  self._compiled_ring_components ==  NULL:
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_8_set_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_ring_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_ring_components", __pyx_f[0], 1633);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1634")'> 1634:         self._ring_components =  ring_components</pre>
<pre id='line1634' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1634
 * 
 *     def _set_ring_components(self,ring_components):
 *         self._ring_components =  ring_components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if  self._compiled_ring_components ==  NULL:
 *             self._compile_ring_components(ring_components)
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ring_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_ring_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_ring_components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_ring_components);
  __pyx_v_self->_ring_components = __pyx_v_ring_components;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1635")'> 1635:         if  self._compiled_ring_components ==  NULL:</pre>
<pre id='line1635' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1635
 *     def _set_ring_components(self,ring_components):
 *         self._ring_components =  ring_components
 *         if  self._compiled_ring_components ==  NULL:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compile_ring_components(ring_components)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->_compiled_ring_components == NULL);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line1636")'> 1636:             self._compile_ring_components(ring_components)</pre>
<pre id='line1636' class='code' style='background-color: #FFFF3f'>
    /* "Cython_shift_calculator.pyx":1636
 *         self._ring_components =  ring_components
 *         if  self._compiled_ring_components ==  NULL:
 *             self._compile_ring_components(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _compile_ring_components(self,ring_components):
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_42);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ring_components);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_ring_components);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_ring_components);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._set_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_11_compile_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_11_compile_ring_components(PyObject *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_ring_components (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_10_compile_ring_components(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_ring_components));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1637")'> 1637: </pre>
<pre id='line1637' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1638")'> 1638:     def _compile_ring_components(self,ring_components):</pre>
<pre id='line1638' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1638
 *             self._compile_ring_components(ring_components)
 * 
 *     def _compile_ring_components(self,ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_10_compile_ring_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_ring_components) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_ring_component = NULL;
  PyObject *__pyx_v_j = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_compile_ring_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_compile_ring_components", __pyx_f[0], 1638);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1639")'> 1639:         self._compiled_ring_components = &lt;Ring_component*&gt;malloc(len(ring_components) * sizeof(Ring_component))</pre>
<pre id='line1639' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1639
 * 
 *     def _compile_ring_components(self,ring_components):
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1639; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_compiled_ring_components = ((struct __pyx_t_17shift_calculators_Ring_component *)malloc((__pyx_t_1 * (sizeof(struct __pyx_t_17shift_calculators_Ring_component)))));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1640")'> 1640:         self._num_ring_components = len(ring_components)</pre>
<pre id='line1640' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1640
 *     def _compile_ring_components(self,ring_components):
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->_num_ring_components = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line1641")'> 1641:         for i,ring_component in enumerate(ring_components):</pre>
<pre id='line1641' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":1641
 *         self._compiled_ring_components = <code><</code>Ring_component*>malloc(len(ring_components) * sizeof(Ring_component))
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_ring_components) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_ring_components)) {
    __pyx_t_3 = __pyx_v_ring_components; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_ring_components);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else if (!__pyx_t_4 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_1 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_1++;
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
      if (unlikely(!__pyx_t_5)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
    __pyx_v_ring_component = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
    __pyx_v_i = __pyx_t_2;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line1642")'> 1642:             self._compiled_ring_components[i].ring_id  = ring_components[i][0]</pre>
<pre id='line1642' class='code' style='background-color: #FFFF41'>
    /* "Cython_shift_calculator.pyx":1642
 *         self._num_ring_components = len(ring_components)
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):
 */
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_ring_components, __pyx_v_i);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_ring_components[__pyx_t_8]).ring_id = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line1643")'> 1643:             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])</pre>
<pre id='line1643' class='code' style='background-color: #FFFF5b'>
    /* "Cython_shift_calculator.pyx":1643
 *         for i,ring_component in enumerate(ring_components):
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(len(ring_component[1])):
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_8 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_9 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_self->_compiled_ring_components[__pyx_t_9]).num_atoms = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line1644")'> 1644:             for j in range(len(ring_component[1])):</pre>
<pre id='line1644' class='code' style='background-color: #FFFF1e'>
    /* "Cython_shift_calculator.pyx":1644
 *             self._compiled_ring_components[i].ring_id  = ring_components[i][0]
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 * 
 */
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_6) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_6)) {
      __pyx_t_5 = __pyx_t_6; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    for (;;) {
      if (!__pyx_t_10 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) {
        if (__pyx_t_9 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
        __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_9++;
      } else if (!__pyx_t_10 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
        if (__pyx_t_9 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
        __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_9++;
      } else {
        __pyx_t_6 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_6)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
      __pyx_v_j = __pyx_t_6;
      __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line1645")'> 1645:                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]</pre>
<pre id='line1645' class='code' style='background-color: #FFFF26'>
      /* "Cython_shift_calculator.pyx":1645
 *             self._compiled_ring_components[i].num_atoms  = len(ring_component[1])
 *             for j in range(len(ring_component[1])):
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_normal_cache(self,normals):
 */
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_ring_component, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_11 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, __pyx_v_j);<span class='error_goto'> if (!__pyx_t_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyIndex_AsSsize_t</span>(__pyx_v_j);<span class='error_goto'> if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      ((__pyx_v_self->_compiled_ring_components[__pyx_t_8]).atom_ids[__pyx_t_12]) = __pyx_t_7;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._compile_ring_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ring_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_j);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_13_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_13_set_normal_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_12_set_normal_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_normals));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1646")'> 1646: </pre>
<pre id='line1646' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1647")'> 1647:     def _set_normal_cache(self,normals):</pre>
<pre id='line1647' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1647
 *                 self._compiled_ring_components[i].atom_ids[j] =ring_component[1][j]
 * 
 *     def _set_normal_cache(self,normals):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._normal_cache = normals
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_12_set_normal_cache(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_normals) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_normal_cache", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_normal_cache", __pyx_f[0], 1647);
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1648")'> 1648:         self._normal_cache = normals</pre>
<pre id='line1648' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1648
 * 
 *     def _set_normal_cache(self,normals):
 *         self._normal_cache = normals             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _set_centre_cache(self,centres):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_normals);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_normal_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_normal_cache);
  __pyx_v_self->_normal_cache = __pyx_v_normals;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_15_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_15_set_centre_cache(PyObject *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_14_set_centre_cache(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_centres));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1649")'> 1649: </pre>
<pre id='line1649' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1650")'> 1650:     def _set_centre_cache(self,centres):</pre>
<pre id='line1650' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1650
 *         self._normal_cache = normals
 * 
 *     def _set_centre_cache(self,centres):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._centre_cache = centres
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_14_set_centre_cache(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_centres) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_set_centre_cache", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_set_centre_cache", __pyx_f[0], 1650);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1651")'> 1651:         self._centre_cache = centres</pre>
<pre id='line1651' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1651
 * 
 *     def _set_centre_cache(self,centres):
 *         self._centre_cache = centres             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    cdef _get_coef_components(self, int atom_type_id):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_centres);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->_centre_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->_centre_cache);
  __pyx_v_self->_centre_cache = __pyx_v_centres;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1652")'> 1652: </pre>
<pre id='line1652' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1653")'> 1653: #    cdef _get_coef_components(self, int atom_type_id):</pre>
<pre id='line1653' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1654")'> 1654: #        return self._coef_components.get_components_for_atom_id(atom_type_id)</pre>
<pre id='line1654' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1655")'> 1655: </pre>
<pre id='line1655' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1656")'> 1656:     @cython.profile(False)</pre>
<pre id='line1656' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1657")'> 1657:     cdef Vec3 _get_ring_normal(self, int ring_id):</pre>
<pre id='line1657' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1657
 * 
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_normal(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()
 */

static Vec3 __pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_normal(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_container = 0;
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_normal", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1658")'> 1658:         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]</pre>
<pre id='line1658' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":1658
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_normal(self, int ring_id):
 *         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  container.get_vec3()
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_normal_cache, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_ring_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_17shift_calculators_Vec3_container)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_container = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1659")'> 1659:         return  container.get_vec3()</pre>
<pre id='line1659' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1659
 *     cdef Vec3 _get_ring_normal(self, int ring_id):
 *         cdef Vec3_container container =  self._normal_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     @cython.profile(False)
 */
  __pyx_r = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_container *)__pyx_v_container->__pyx_vtab)->get_vec3(__pyx_v_container);
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_force_calculator._get_ring_normal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_container);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1660")'> 1660: </pre>
<pre id='line1660' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1661")'> 1661:     @cython.profile(False)</pre>
<pre id='line1661' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1662")'> 1662:     cdef Vec3 _get_ring_centre(self, int ring_id):</pre>
<pre id='line1662' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1662
 * 
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_centre(self, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3_container container = self._centre_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()
 */

static Vec3 __pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_ring_centre(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_ring_id) {
  struct __pyx_obj_17shift_calculators_Vec3_container *__pyx_v_container = 0;
  Vec3 __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_ring_centre", 0);
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1663")'> 1663:         cdef Vec3_container container = self._centre_cache.get_component(ring_id)[1]</pre>
<pre id='line1663' class='code' style='background-color: #FFFF43'>
  /* "Cython_shift_calculator.pyx":1663
 *     @cython.profile(False)
 *     cdef Vec3 _get_ring_centre(self, int ring_id):
 *         cdef Vec3_container container = self._centre_cache.get_component(ring_id)[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return  container.get_vec3()
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_centre_cache, __pyx_n_s__get_component);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_ring_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_17shift_calculators_Vec3_container)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_container = ((struct __pyx_obj_17shift_calculators_Vec3_container *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line1664")'> 1664:         return  container.get_vec3()</pre>
<pre id='line1664' class='code' style='background-color: #FFFF96'>
  /* "Cython_shift_calculator.pyx":1664
 *     cdef Vec3 _get_ring_centre(self, int ring_id):
 *         cdef Vec3_container container = self._centre_cache.get_component(ring_id)[1]
 *         return  container.get_vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = ((struct __pyx_vtabstruct_17shift_calculators_Vec3_container *)__pyx_v_container->__pyx_vtab)->get_vec3(__pyx_v_container);
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_force_calculator._get_ring_centre", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_container);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1665")'> 1665: </pre>
<pre id='line1665' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1666")'> 1666: </pre>
<pre id='line1666' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1667")'> 1667: </pre>
<pre id='line1667' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1668")'> 1668: </pre>
<pre id='line1668' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1669")'> 1669: </pre>
<pre id='line1669' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1670")'> 1670: </pre>
<pre id='line1670' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1671")'> 1671: </pre>
<pre id='line1671' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1672")'> 1672: </pre>
<pre id='line1672' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1673")'> 1673: </pre>
<pre id='line1673' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1674")'> 1674: #    @cython.profile(False)</pre>
<pre id='line1674' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1675")'> 1675: #    cdef inline target_type _get_target_and_type(self,int index):</pre>
<pre id='line1675' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1676")'> 1676: #        component = self._get_component(index)</pre>
<pre id='line1676' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1677")'> 1677: ##        TODO: this needs to contain better names a union?</pre>
<pre id='line1677' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1678")'> 1678: #        cdef target_type result</pre>
<pre id='line1678' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1679")'> 1679: #        result.target_atom_id = component[0]</pre>
<pre id='line1679' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1680")'> 1680: #        result.atom_type_id = component[1]</pre>
<pre id='line1680' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1681")'> 1681: #</pre>
<pre id='line1681' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1682")'> 1682: #        return result#</pre>
<pre id='line1682' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1683")'> 1683: </pre>
<pre id='line1683' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1684")'> 1684:     @cython.profile(False)</pre>
<pre id='line1684' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1685")'> 1685:     cdef inline  Coef_components _get_coef_components(self, int atom_type_id):</pre>
<pre id='line1685' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1685
 * 
 *     @cython.profile(False)
 *     cdef inline  Coef_components _get_coef_components(self, int atom_type_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef object python_coef_components = self._coef_components.get_components_for_atom_id(atom_type_id)
 *         return Coef_components(python_coef_components)
 */

static CYTHON_INLINE struct __pyx_obj_17shift_calculators_Coef_components *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_coef_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_atom_type_id) {
  PyObject *__pyx_v_python_coef_components = 0;
  struct __pyx_obj_17shift_calculators_Coef_components *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_get_coef_components", 0);
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line1686")'> 1686:         cdef object python_coef_components = self._coef_components.get_components_for_atom_id(atom_type_id)</pre>
<pre id='line1686' class='code' style='background-color: #FFFF4d'>
  /* "Cython_shift_calculator.pyx":1686
 *     @cython.profile(False)
 *     cdef inline  Coef_components _get_coef_components(self, int atom_type_id):
 *         cdef object python_coef_components = self._coef_components.get_components_for_atom_id(atom_type_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return Coef_components(python_coef_components)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_self->_coef_components, __pyx_n_s_20);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_atom_type_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_v_python_coef_components = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1687")'> 1687:         return Coef_components(python_coef_components)</pre>
<pre id='line1687' class='code' style='background-color: #FFFF4f'>
  /* "Cython_shift_calculator.pyx":1687
 *     cdef inline  Coef_components _get_coef_components(self, int atom_type_id):
 *         cdef object python_coef_components = self._coef_components.get_components_for_atom_id(atom_type_id)
 *         return Coef_components(python_coef_components)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _do_calc_components(self, object component_to_result,object force_factors, Out_array force):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_python_coef_components);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_python_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_python_coef_components);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Coef_components)), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = ((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_t_3);
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = ((struct __pyx_obj_17shift_calculators_Coef_components *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._get_coef_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_python_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1688")'> 1688: </pre>
<pre id='line1688' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1689")'> 1689:     cdef _do_calc_components(self, object component_to_result,object force_factors, Out_array force):</pre>
<pre id='line1689' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1689
 *         return Coef_components(python_coef_components)
 * 
 *     cdef _do_calc_components(self, object component_to_result,object force_factors, Out_array force):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(self._num_components):
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 */

static PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__do_calc_components(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, PyObject *__pyx_v_component_to_result, PyObject *__pyx_v_force_factors, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_force) {
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_do_calc_components", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_do_calc_components", __pyx_f[0], 1689);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1690")'> 1690:         for i in range(self._num_components):</pre>
<pre id='line1690' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1690
 * 
 *     cdef _do_calc_components(self, object component_to_result,object force_factors, Out_array force):
 *         for i in range(self._num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 */
  __pyx_t_1 = __pyx_v_self->_num_components;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line1691")'> 1691:             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)</pre>
<pre id='line1691' class='code' style='background-color: #FFFF43'>
    /* "Cython_shift_calculator.pyx":1691
 *     cdef _do_calc_components(self, object component_to_result,object force_factors, Out_array force):
 *         for i in range(self._num_components):
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline _ring_calc_single_force_set(self,  int index, float force_factor, object forces):
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component_to_result, __pyx_v_i, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_force_factors, __pyx_t_3);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(__pyx_v_self, __pyx_v_i, __pyx_t_5, ((PyObject *)__pyx_v_force));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1691; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._do_calc_components", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1692")'> 1692: </pre>
<pre id='line1692' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1693")'> 1693:     cdef inline _ring_calc_single_force_set(self,  int index, float force_factor, object forces):</pre>
<pre id='line1693' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1693
 *             self._ring_calc_single_force_set(i,force_factors[component_to_result[i]],force)
 * 
 *     cdef inline _ring_calc_single_force_set(self,  int index, float force_factor, object forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #TODO: make array a union
 *         cdef Coef_components coef_components = self._get_coef_components(self._compiled_components[index].atom_type_id)
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__ring_calc_single_force_set(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_index, float __pyx_v_force_factor, PyObject *__pyx_v_forces) {
  struct __pyx_obj_17shift_calculators_Coef_components *__pyx_v_coef_components = 0;
  struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component;
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_ring_calc_single_force_set", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_ring_calc_single_force_set", __pyx_f[0], 1693);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1694")'> 1694:         #TODO: make array a union</pre>
<pre id='line1694' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1695")'> 1695:         cdef Coef_components coef_components = self._get_coef_components(self._compiled_components[index].atom_type_id)</pre>
<pre id='line1695' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1695
 *     cdef inline _ring_calc_single_force_set(self,  int index, float force_factor, object forces):
 *         #TODO: make array a union
 *         cdef Coef_components coef_components = self._get_coef_components(self._compiled_components[index].atom_type_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Coef_component* coef_component
 *         for i in range(coef_components.num_components):
 */
  __pyx_t_1 = ((PyObject *)__pyx_f_17shift_calculators_26Fast_ring_force_calculator__get_coef_components(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).atom_type_id));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1695; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_coef_components = ((struct __pyx_obj_17shift_calculators_Coef_components *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1696")'> 1696:         cdef Coef_component* coef_component</pre>
<pre id='line1696' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1697")'> 1697:         for i in range(coef_components.num_components):</pre>
<pre id='line1697' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1697
 *         cdef Coef_components coef_components = self._get_coef_components(self._compiled_components[index].atom_type_id)
 *         cdef Coef_component* coef_component
 *         for i in range(coef_components.num_components):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             coef_component = coef_components.get_component(i)
 * #            print coef_component.atom_type_id, coef_component.ring_id, coef_component.coefficient
 */
  __pyx_t_2 = __pyx_v_coef_components->num_components;
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1698")'> 1698:             coef_component = coef_components.get_component(i)</pre>
<pre id='line1698' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1698
 *         cdef Coef_component* coef_component
 *         for i in range(coef_components.num_components):
 *             coef_component = coef_components.get_component(i)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #            print coef_component.atom_type_id, coef_component.ring_id, coef_component.coefficient
 *     #                print 'coef_component', i, coef_component
 */
    __pyx_v_coef_component = __pyx_f_17shift_calculators_15Coef_components_get_component(__pyx_v_coef_components, __pyx_v_i);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1699")'> 1699: #            print coef_component.atom_type_id, coef_component.ring_id, coef_component.coefficient</pre>
<pre id='line1699' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1700")'> 1700:     #                print 'coef_component', i, coef_component</pre>
<pre id='line1700' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1701")'> 1701:     #                 print 'here', target_atom_id, atom_type_id,</pre>
<pre id='line1701' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1702")'> 1702:     #                coef_component, force_factor</pre>
<pre id='line1702' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF17' onclick='toggleDiv("line1703")'> 1703:             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)</pre>
<pre id='line1703' class='code' style='background-color: #FFFF17'>
    /* "Cython_shift_calculator.pyx":1703
 *     #                 print 'here', target_atom_id, atom_type_id,
 *     #                coef_component, force_factor
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, object forces):
 */
    __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_calculate_single_ring_forces(__pyx_v_self, (__pyx_v_self->_compiled_components[__pyx_v_index]).target_atom_id, (__pyx_v_self->_compiled_components[__pyx_v_index]).atom_type_id, __pyx_v_coef_component, __pyx_v_force_factor, __pyx_v_forces);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._ring_calc_single_force_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_coef_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_17_calculate_ring_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_17_calculate_ring_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_atom_type_id;
  int __pyx_v_ring_id;
  float __pyx_v_force_factor;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms = 0;
  PyObject *__pyx_v_forces = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__atom_type_id,&__pyx_n_s__ring_id,&__pyx_n_s__force_factor,&__pyx_n_s__python_sub_terms,&__pyx_n_s__forces,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_ring_forces (wrapper)", 0);
  {
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__atom_type_id);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factor);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__python_sub_terms);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces);
        if (likely(values[4])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calculate_ring_forces") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_atom_type_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_atom_type_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_force_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_python_sub_terms = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)values[3]);
    __pyx_v_forces = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calculate_ring_forces", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calculate_ring_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_python_sub_terms), __pyx_ptype_17shift_calculators_Python_ring_force_sub_terms, 1, "python_sub_terms", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_16_calculate_ring_forces(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_atom_type_id, __pyx_v_ring_id, __pyx_v_force_factor, __pyx_v_python_sub_terms, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1704")'> 1704: </pre>
<pre id='line1704' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1705")'> 1705:     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, object forces):</pre>
<pre id='line1705' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1705
 *             self._calculate_single_ring_forces(self._compiled_components[index].target_atom_id, self._compiled_components[index].atom_type_id, coef_component, force_factor, forces)
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, object forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_16_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_atom_type_id, int __pyx_v_ring_id, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms, PyObject *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_ring_forces", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calculate_ring_forces", __pyx_f[0], 1705);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1706")'> 1706:         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()</pre>
<pre id='line1706' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1706
 * 
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, object forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 * 
 */
  __pyx_v_terms = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_python_sub_terms->__pyx_vtab)->get_terms(__pyx_v_python_sub_terms);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1707")'> 1707:         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)</pre>
<pre id='line1707' class='code' style='background-color: #FFFF6e'>
  /* "Cython_shift_calculator.pyx":1707
 *     def _calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, object forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor, object forces):
 */
  if (!(likely(((__pyx_v_forces) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_forces, __pyx_ptype_17shift_calculators_Out_array)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = __pyx_v_forces;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_t_2 = __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(__pyx_v_self, __pyx_v_atom_type_id, __pyx_v_ring_id, __pyx_v_force_factor, __pyx_v_terms, ((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_t_1));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calculate_ring_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1708")'> 1708: </pre>
<pre id='line1708' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1709")'> 1709:     cdef _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor, object forces):</pre>
<pre id='line1709' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1709
 *         self._cython_calculate_ring_forces(atom_type_id, ring_id, force_factor, terms, forces)
 * 
 *     cdef _calculate_single_ring_forces(self, int target_atom_id, int atom_type_id, Coef_component* coef_component, float force_factor, object forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #    print atom_type_id, ring_id, coefficient, self._get_component_list('RING').get_components_for_atom_id(ring_id)
 */

static PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__calculate_single_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_atom_type_id, struct __pyx_t_17shift_calculators_Coef_component *__pyx_v_coef_component, float __pyx_v_force_factor, PyObject *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_force_terms;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calculate_single_ring_forces", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calculate_single_ring_forces", __pyx_f[0], 1709);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1710")'> 1710: </pre>
<pre id='line1710' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1711")'> 1711: #    print atom_type_id, ring_id, coefficient, self._get_component_list('RING').get_components_for_atom_id(ring_id)</pre>
<pre id='line1711' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1712")'> 1712:         cdef Ring_force_sub_terms force_terms = self._build_cython_force_terms(target_atom_id, coef_component.ring_id)</pre>
<pre id='line1712' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1712
 * 
 * #    print atom_type_id, ring_id, coefficient, self._get_component_list('RING').get_components_for_atom_id(ring_id)
 *         cdef Ring_force_sub_terms force_terms = self._build_cython_force_terms(target_atom_id, coef_component.ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        print coef_component
 * 
 */
  __pyx_v_force_terms = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_build_cython_force_terms(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_coef_component->ring_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1713")'> 1713: #        print coef_component</pre>
<pre id='line1713' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1714")'> 1714: </pre>
<pre id='line1714' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1715")'> 1715: #        print vec3_as_tuple(force_terms.gradUQ), force_terms.dL3, force_terms.u, vec3_as_tuple(force_terms.gradVQ), force_terms.dL6</pre>
<pre id='line1715' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1716")'> 1716: #        print Atom_utils._get_atom_info_from_index(target_atom_id)</pre>
<pre id='line1716' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1717")'> 1717: </pre>
<pre id='line1717' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1718")'> 1718:         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)</pre>
<pre id='line1718' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1718
 * #        print Atom_utils._get_atom_info_from_index(target_atom_id)
 * 
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals
 *         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)
 */
  if (!(likely(((__pyx_v_forces) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_forces, __pyx_ptype_17shift_calculators_Out_array)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = __pyx_v_forces;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_t_2 = __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(__pyx_v_self, __pyx_v_target_atom_id, (__pyx_v_force_factor * __pyx_v_coef_component->coefficient), __pyx_v_force_terms, ((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_t_1));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1719")'> 1719: #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals</pre>
<pre id='line1719' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line1720")'> 1720:         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)</pre>
<pre id='line1720' class='code' style='background-color: #FFFF22'>
  /* "Cython_shift_calculator.pyx":1720
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor * coef_component.coefficient, force_terms, forces)
 * #        #            #TODO: this is not how camshift does it, it uses the sum of the two ring normals
 *         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def _build_force_terms(self, int target_atom_id, int ring_id):
 */
  if (!(likely(((__pyx_v_forces) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_forces, __pyx_ptype_17shift_calculators_Out_array)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __pyx_v_forces;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_1 = __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(__pyx_v_self, __pyx_v_atom_type_id, __pyx_v_coef_component->ring_id, (__pyx_v_force_factor * __pyx_v_coef_component->coefficient), __pyx_v_force_terms, ((struct __pyx_obj_17shift_calculators_Out_array *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calculate_single_ring_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_19_build_force_terms(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_19_build_force_terms(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  int __pyx_v_ring_id;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__ring_id,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_force_terms (wrapper)", 0);
  {
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ring_id);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_force_terms", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_build_force_terms") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_ring_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_ring_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_build_force_terms", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._build_force_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_18_build_force_terms(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_ring_id);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1721")'> 1721: </pre>
<pre id='line1721' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1722")'> 1722:     def _build_force_terms(self, int target_atom_id, int ring_id):</pre>
<pre id='line1722' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1722
 *         self._cython_calculate_ring_forces(atom_type_id, coef_component.ring_id, force_factor * coef_component.coefficient, force_terms, forces)
 * 
 *     def _build_force_terms(self, int target_atom_id, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms terms  = self._build_cython_force_terms(target_atom_id, ring_id)
 *         result  = Python_ring_force_sub_terms()
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_18_build_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_result = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_force_terms", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_build_force_terms", __pyx_f[0], 1722);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1723")'> 1723:         cdef Ring_force_sub_terms terms  = self._build_cython_force_terms(target_atom_id, ring_id)</pre>
<pre id='line1723' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1723
 * 
 *     def _build_force_terms(self, int target_atom_id, int ring_id):
 *         cdef Ring_force_sub_terms terms  = self._build_cython_force_terms(target_atom_id, ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)
 */
  __pyx_v_terms = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_build_cython_force_terms(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_ring_id);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1724")'> 1724:         result  = Python_ring_force_sub_terms()</pre>
<pre id='line1724' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1724
 *     def _build_force_terms(self, int target_atom_id, int ring_id):
 *         cdef Ring_force_sub_terms terms  = self._build_cython_force_terms(target_atom_id, ring_id)
 *         result  = Python_ring_force_sub_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.setup(terms)
 *         return result
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Python_ring_force_sub_terms)), ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1724; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_result = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1725")'> 1725:         result.setup(terms)</pre>
<pre id='line1725' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1725
 *         cdef Ring_force_sub_terms terms  = self._build_cython_force_terms(target_atom_id, ring_id)
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         return result
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_result->__pyx_vtab)->setup(__pyx_v_result, __pyx_v_terms);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1726")'> 1726:         return result</pre>
<pre id='line1726' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1726
 *         result  = Python_ring_force_sub_terms()
 *         result.setup(terms)
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef Ring_force_sub_terms _build_cython_force_terms(self, int target_atom_id, int ring_id):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._build_force_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_result);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1727")'> 1727: </pre>
<pre id='line1727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1728")'> 1728:     cdef Ring_force_sub_terms _build_cython_force_terms(self, int target_atom_id, int ring_id):</pre>
<pre id='line1728' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1728
 *         return result
 * 
 *     cdef Ring_force_sub_terms _build_cython_force_terms(self, int target_atom_id, int ring_id):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms result
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)
 */

static struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_f_17shift_calculators_26Fast_ring_force_calculator__build_cython_force_terms(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, int __pyx_v_ring_id) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_result;
  Vec3 __pyx_v_target_atom_pos;
  Vec3 __pyx_v_ring_centre;
  Vec3 __pyx_v_ring_normal;
  Vec3 __pyx_v_d;
  float __pyx_v_dL;
  float __pyx_v_dL2;
  float __pyx_v_dL4;
  float __pyx_v_dL3;
  float __pyx_v_dL6;
  float __pyx_v_nL;
  float __pyx_v_nL2;
  float __pyx_v_dLnL;
  PyObject *__pyx_v_dL3nL3 = 0;
  float __pyx_v_dn;
  float __pyx_v_dn2;
  float __pyx_v_u;
  float __pyx_v_gradUQ_factor;
  Vec3 __pyx_v_scaled_d;
  Vec3 __pyx_v_scaled_normal;
  Vec3 __pyx_v_gradUQ;
  float __pyx_v_gradVQ_factor;
  Vec3 __pyx_v_gradVQ;
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_cython_force_terms", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_build_cython_force_terms", __pyx_f[0], 1728);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1729")'> 1729:         cdef Ring_force_sub_terms result</pre>
<pre id='line1729' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1730")'> 1730:         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)</pre>
<pre id='line1730' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1730
 *     cdef Ring_force_sub_terms _build_cython_force_terms(self, int target_atom_id, int ring_id):
 *         cdef Ring_force_sub_terms result
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)
 */
  __pyx_v_target_atom_pos = (__pyx_v_self->__pyx_base._simulation[0]).atomPos(__pyx_v_target_atom_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1731")'> 1731: </pre>
<pre id='line1731' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1732")'> 1732:         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)</pre>
<pre id='line1732' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1732
 *         cdef Vec3 target_atom_pos  = self._simulation[0].atomPos(target_atom_id)
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 ring_normal = self._get_ring_normal(ring_id)
 * 
 */
  __pyx_v_ring_centre = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_get_ring_centre(__pyx_v_self, __pyx_v_ring_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1733")'> 1733:         cdef Vec3 ring_normal = self._get_ring_normal(ring_id)</pre>
<pre id='line1733' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1733
 * 
 *         cdef Vec3 ring_centre = self._get_ring_centre(ring_id)
 *         cdef Vec3 ring_normal = self._get_ring_normal(ring_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # distance vector between atom of interest and ring center
 */
  __pyx_v_ring_normal = ((struct __pyx_vtabstruct_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self->__pyx_base.__pyx_vtab)->_get_ring_normal(__pyx_v_self, __pyx_v_ring_id);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1734")'> 1734: </pre>
<pre id='line1734' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1735")'> 1735:         # distance vector between atom of interest and ring center</pre>
<pre id='line1735' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1736")'> 1736:         cdef Vec3 d = target_atom_pos - ring_centre</pre>
<pre id='line1736' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1736
 * 
 *         # distance vector between atom of interest and ring center
 *         cdef Vec3 d = target_atom_pos - ring_centre             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL = norm(d)
 * 
 */
  __pyx_v_d = (__pyx_v_target_atom_pos - __pyx_v_ring_centre);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1737")'> 1737:         cdef float dL = norm(d)</pre>
<pre id='line1737' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1737
 *         # distance vector between atom of interest and ring center
 *         cdef Vec3 d = target_atom_pos - ring_centre
 *         cdef float dL = norm(d)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # squared distance of atom of interest from ring center
 */
  __pyx_v_dL = norm(__pyx_v_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1738")'> 1738: </pre>
<pre id='line1738' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1739")'> 1739:         # squared distance of atom of interest from ring center</pre>
<pre id='line1739' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1740")'> 1740:         cdef float dL2 = dot(d, d) #            if (dL2 &lt; 0.5) cout &lt;&lt; "CAMSHIFT WARNING: Distance between atom and center of ring alarmingly small at " &lt;&lt; sqrt(dL2) &lt;&lt; " Angstrom!" &lt;&lt; endl;</pre>
<pre id='line1740' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1740
 * 
 *         # squared distance of atom of interest from ring center
 *         cdef float dL2 = dot(d, d) #            if (dL2 <code><</code> 0.5) cout <code><</code><code><</code> "CAMSHIFT WARNING: Distance between atom and center of ring alarmingly small at " <code><</code><code><</code> sqrt(dL2) <code><</code><code><</code> " Angstrom!" <code><</code><code><</code> endl;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 */
  __pyx_v_dL2 = dot(__pyx_v_d, __pyx_v_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1741")'> 1741: </pre>
<pre id='line1741' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1742")'> 1742:         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates</pre>
<pre id='line1742' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1743")'> 1743:         cdef float dL4 = dL ** 4</pre>
<pre id='line1743' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1743
 * 
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 *         cdef float dL4 = dL ** 4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL3 = dL ** 3
 *         cdef float dL6 = dL3 ** 2
 */
  __pyx_v_dL4 = powf(__pyx_v_dL, 4.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1744")'> 1744:         cdef float dL3 = dL ** 3</pre>
<pre id='line1744' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1744
 *         # calculate terms resulting from differentiating energy function with respect to query and ring atom coordinates
 *         cdef float dL4 = dL ** 4
 *         cdef float dL3 = dL ** 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dL6 = dL3 ** 2
 * 
 */
  __pyx_v_dL3 = powf(__pyx_v_dL, 3.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1745")'> 1745:         cdef float dL6 = dL3 ** 2</pre>
<pre id='line1745' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1745
 *         cdef float dL4 = dL ** 4
 *         cdef float dL3 = dL ** 3
 *         cdef float dL6 = dL3 ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float nL = norm(ring_normal)
 */
  __pyx_v_dL6 = powf(__pyx_v_dL3, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1746")'> 1746: </pre>
<pre id='line1746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1747")'> 1747:         cdef float nL = norm(ring_normal)</pre>
<pre id='line1747' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1747
 *         cdef float dL6 = dL3 ** 2
 * 
 *         cdef float nL = norm(ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL
 */
  __pyx_v_nL = norm(__pyx_v_ring_normal);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1748")'> 1748:         cdef float nL2 = nL ** 2</pre>
<pre id='line1748' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1748
 * 
 *         cdef float nL = norm(ring_normal)
 *         cdef float nL2 = nL ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dLnL = dL * nL
 *         cdef dL3nL3 = dL3 * nL2 * nL
 */
  __pyx_v_nL2 = powf(__pyx_v_nL, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1749")'> 1749:         cdef float dLnL = dL * nL</pre>
<pre id='line1749' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1749
 *         cdef float nL = norm(ring_normal)
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef dL3nL3 = dL3 * nL2 * nL
 * 
 */
  __pyx_v_dLnL = (__pyx_v_dL * __pyx_v_nL);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1750")'> 1750:         cdef dL3nL3 = dL3 * nL2 * nL</pre>
<pre id='line1750' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1750
 *         cdef float nL2 = nL ** 2
 *         cdef float dLnL = dL * nL
 *         cdef dL3nL3 = dL3 * nL2 * nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float dn = dot(d, ring_normal)
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_dL3 * __pyx_v_nL2) * __pyx_v_nL));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_dL3nL3 = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1751")'> 1751: </pre>
<pre id='line1751' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1752")'> 1752:         cdef float dn = dot(d, ring_normal)</pre>
<pre id='line1752' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1752
 *         cdef dL3nL3 = dL3 * nL2 * nL
 * 
 *         cdef float dn = dot(d, ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float dn2 = dn ** 2
 * 
 */
  __pyx_v_dn = dot(__pyx_v_d, __pyx_v_ring_normal);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1753")'> 1753:         cdef float dn2 = dn ** 2</pre>
<pre id='line1753' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1753
 * 
 *         cdef float dn = dot(d, ring_normal)
 *         cdef float dn2 = dn ** 2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)
 */
  __pyx_v_dn2 = powf(__pyx_v_dn, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1754")'> 1754: </pre>
<pre id='line1754' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1755")'> 1755:         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)</pre>
<pre id='line1755' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1755
 *         cdef float dn2 = dn ** 2
 * 
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)
 */
  __pyx_t_2 = (3.0 * __pyx_v_dn2);
  __pyx_t_3 = (__pyx_v_dL2 * __pyx_v_nL2);
  if (unlikely(__pyx_t_3 == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_u = (1.0 - (__pyx_t_2 / __pyx_t_3));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1756")'> 1756: </pre>
<pre id='line1756' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1757")'> 1757:         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)</pre>
<pre id='line1757' class='code' style='background-color: #FFFFaa'>
  /* "Cython_shift_calculator.pyx":1757
 *         cdef float u = 1.0 - 3.0 * dn2 / (dL2 * nL2)
 * 
 *         cdef float gradUQ_factor = -6.0 * dn / (dL4 * nL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #TODO: remove temporarys and operator_mu;t#
 */
  __pyx_t_2 = (-6.0 * __pyx_v_dn);
  __pyx_t_3 = (__pyx_v_dL4 * __pyx_v_nL2);
  if (unlikely(__pyx_t_3 == 0)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_gradUQ_factor = (__pyx_t_2 / __pyx_t_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1758")'> 1758: </pre>
<pre id='line1758' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1759")'> 1759:         #TODO: remove temporarys and operator_mu;t#</pre>
<pre id='line1759' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1760")'> 1760:         cdef Vec3 scaled_d =  d</pre>
<pre id='line1760' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1760
 * 
 *         #TODO: remove temporarys and operator_mu;t#
 *         cdef Vec3 scaled_d =  d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal
 */
  __pyx_v_scaled_d = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1761")'> 1761:         operator_times(scaled_d,dn)</pre>
<pre id='line1761' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1761
 *         #TODO: remove temporarys and operator_mu;t#
 *         cdef Vec3 scaled_d =  d
 *         operator_times(scaled_d,dn)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 scaled_normal = ring_normal
 *         operator_times(scaled_normal,dL2)
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_scaled_d, __pyx_v_dn);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1762")'> 1762:         cdef Vec3 scaled_normal = ring_normal</pre>
<pre id='line1762' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1762
 *         cdef Vec3 scaled_d =  d
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(scaled_normal,dL2)
 * 
 */
  __pyx_v_scaled_normal = __pyx_v_ring_normal;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1763")'> 1763:         operator_times(scaled_normal,dL2)</pre>
<pre id='line1763' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1763
 *         operator_times(scaled_d,dn)
 *         cdef Vec3 scaled_normal = ring_normal
 *         operator_times(scaled_normal,dL2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_scaled_normal, __pyx_v_dL2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1764")'> 1764: </pre>
<pre id='line1764' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1765")'> 1765:         cdef Vec3 gradUQ = scaled_normal - scaled_d</pre>
<pre id='line1765' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1765
 *         operator_times(scaled_normal,dL2)
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(gradUQ,gradUQ_factor)
 * 
 */
  __pyx_v_gradUQ = (__pyx_v_scaled_normal - __pyx_v_scaled_d);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1766")'> 1766:         operator_times(gradUQ,gradUQ_factor)</pre>
<pre id='line1766' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1766
 * 
 *         cdef Vec3 gradUQ = scaled_normal - scaled_d
 *         operator_times(gradUQ,gradUQ_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_gradUQ, __pyx_v_gradUQ_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1767")'> 1767: </pre>
<pre id='line1767' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1768")'> 1768: </pre>
<pre id='line1768' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1769")'> 1769:         cdef float gradVQ_factor = 3.0 * dL</pre>
<pre id='line1769' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1769
 * 
 * 
 *         cdef float gradVQ_factor = 3.0 * dL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 gradVQ = d
 *         operator_times(gradVQ,gradVQ_factor)
 */
  __pyx_v_gradVQ_factor = (3.0 * __pyx_v_dL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1770")'> 1770:         cdef Vec3 gradVQ = d</pre>
<pre id='line1770' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1770
 * 
 *         cdef float gradVQ_factor = 3.0 * dL
 *         cdef Vec3 gradVQ = d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(gradVQ,gradVQ_factor)
 * 
 */
  __pyx_v_gradVQ = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1771")'> 1771:         operator_times(gradVQ,gradVQ_factor)</pre>
<pre id='line1771' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1771
 *         cdef float gradVQ_factor = 3.0 * dL
 *         cdef Vec3 gradVQ = d
 *         operator_times(gradVQ,gradVQ_factor)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         result.dL3nL3 = dL3nL3
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_gradVQ, __pyx_v_gradVQ_factor);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1772")'> 1772: </pre>
<pre id='line1772' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1773")'> 1773:         result.dL3nL3 = dL3nL3</pre>
<pre id='line1773' class='code' style='background-color: #FFFF7f'>
  /* "Cython_shift_calculator.pyx":1773
 *         operator_times(gradVQ,gradVQ_factor)
 * 
 *         result.dL3nL3 = dL3nL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dLnL =dLnL
 *         result.dn = dn
 */
  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_dL3nL3);<span class='error_goto'> if (unlikely((__pyx_t_3 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_result.dL3nL3 = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1774")'> 1774:         result.dLnL =dLnL</pre>
<pre id='line1774' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1774
 * 
 *         result.dL3nL3 = dL3nL3
 *         result.dLnL =dLnL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dn = dn
 *         result.dL = dL
 */
  __pyx_v_result.dLnL = __pyx_v_dLnL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1775")'> 1775:         result.dn = dn</pre>
<pre id='line1775' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1775
 *         result.dL3nL3 = dL3nL3
 *         result.dLnL =dLnL
 *         result.dn = dn             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL = dL
 *         result.nL = nL
 */
  __pyx_v_result.dn = __pyx_v_dn;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1776")'> 1776:         result.dL = dL</pre>
<pre id='line1776' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1776
 *         result.dLnL =dLnL
 *         result.dn = dn
 *         result.dL = dL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.nL = nL
 *         result.d = d
 */
  __pyx_v_result.dL = __pyx_v_dL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1777")'> 1777:         result.nL = nL</pre>
<pre id='line1777' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1777
 *         result.dn = dn
 *         result.dL = dL
 *         result.nL = nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.d = d
 *         result.gradUQ = gradUQ
 */
  __pyx_v_result.nL = __pyx_v_nL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1778")'> 1778:         result.d = d</pre>
<pre id='line1778' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1778
 *         result.dL = dL
 *         result.nL = nL
 *         result.d = d             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3
 */
  __pyx_v_result.d = __pyx_v_d;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1779")'> 1779:         result.gradUQ = gradUQ</pre>
<pre id='line1779' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1779
 *         result.nL = nL
 *         result.d = d
 *         result.gradUQ = gradUQ             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL3 =dL3
 *         result.u  = u
 */
  __pyx_v_result.gradUQ = __pyx_v_gradUQ;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1780")'> 1780:         result.dL3 =dL3</pre>
<pre id='line1780' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1780
 *         result.d = d
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.u  = u
 *         result.gradVQ = gradVQ
 */
  __pyx_v_result.dL3 = __pyx_v_dL3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1781")'> 1781:         result.u  = u</pre>
<pre id='line1781' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1781
 *         result.gradUQ = gradUQ
 *         result.dL3 =dL3
 *         result.u  = u             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6
 */
  __pyx_v_result.u = __pyx_v_u;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1782")'> 1782:         result.gradVQ = gradVQ</pre>
<pre id='line1782' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1782
 *         result.dL3 =dL3
 *         result.u  = u
 *         result.gradVQ = gradVQ             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.dL6 = dL6
 *         result.ring_normal =  ring_normal
 */
  __pyx_v_result.gradVQ = __pyx_v_gradVQ;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1783")'> 1783:         result.dL6 = dL6</pre>
<pre id='line1783' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1783
 *         result.u  = u
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         result.ring_normal =  ring_normal
 * 
 */
  __pyx_v_result.dL6 = __pyx_v_dL6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1784")'> 1784:         result.ring_normal =  ring_normal</pre>
<pre id='line1784' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1784
 *         result.gradVQ = gradVQ
 *         result.dL6 = dL6
 *         result.ring_normal =  ring_normal             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         return result
 */
  __pyx_v_result.ring_normal = __pyx_v_ring_normal;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1785")'> 1785: </pre>
<pre id='line1785' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line1786")'> 1786:         return result</pre>
<pre id='line1786' class='code' style='background-color: #FFFF1c'>
  /* "Cython_shift_calculator.pyx":1786
 *         result.ring_normal =  ring_normal
 * 
 *         return result             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #        return  dL3, u, dL6, ring_normal,  atom_type_id, coefficient, d, factor, dn, dL3nL3, dL, nL, dLnL
 * ##    ---
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("shift_calculators.Fast_ring_force_calculator._build_cython_force_terms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dL3nL3);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_21_calc_target_atom_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_26Fast_ring_force_calculator_21_calc_target_atom_forces(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_target_atom_id;
  float __pyx_v_force_factor;
  struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms = 0;
  struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__target_atom_id,&__pyx_n_s__force_factor,&__pyx_n_s__python_sub_terms,&__pyx_n_s__forces,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_target_atom_forces (wrapper)", 0);
  {
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__target_atom_id);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__force_factor);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__python_sub_terms);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__forces);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_calc_target_atom_forces") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_target_atom_id = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_target_atom_id == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_force_factor = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_force_factor == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_python_sub_terms = ((struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *)values[2]);
    __pyx_v_forces = ((struct __pyx_obj_17shift_calculators_Out_array *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_calc_target_atom_forces", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calc_target_atom_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_python_sub_terms), __pyx_ptype_17shift_calculators_Python_ring_force_sub_terms, 1, "python_sub_terms", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_forces), __pyx_ptype_17shift_calculators_Out_array, 1, "forces", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_26Fast_ring_force_calculator_20_calc_target_atom_forces(((struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *)__pyx_v_self), __pyx_v_target_atom_id, __pyx_v_force_factor, __pyx_v_python_sub_terms, __pyx_v_forces);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1787")'> 1787: #        return  dL3, u, dL6, ring_normal,  atom_type_id, coefficient, d, factor, dn, dL3nL3, dL, nL, dLnL</pre>
<pre id='line1787' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1788")'> 1788: ##    ---</pre>
<pre id='line1788' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1789")'> 1789: #</pre>
<pre id='line1789' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1790")'> 1790:     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):</pre>
<pre id='line1790' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1790
 * ##    ---
 * #
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 */

static PyObject *__pyx_pf_17shift_calculators_26Fast_ring_force_calculator_20_calc_target_atom_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, float __pyx_v_force_factor, struct __pyx_obj_17shift_calculators_Python_ring_force_sub_terms *__pyx_v_python_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_terms;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_calc_target_atom_forces", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_calc_target_atom_forces", __pyx_f[0], 1790);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1791")'> 1791:         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()</pre>
<pre id='line1791' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1791
 * #
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 * 
 */
  __pyx_v_terms = ((struct __pyx_vtabstruct_17shift_calculators_Python_ring_force_sub_terms *)__pyx_v_python_sub_terms->__pyx_vtab)->get_terms(__pyx_v_python_sub_terms);
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1792")'> 1792:         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)</pre>
<pre id='line1792' class='code' style='background-color: #FFFF8d'>
  /* "Cython_shift_calculator.pyx":1792
 *     def _calc_target_atom_forces(self, int target_atom_id, float force_factor, Python_ring_force_sub_terms python_sub_terms, Out_array forces):
 *         cdef Ring_force_sub_terms  terms  =  python_sub_terms.get_terms()
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef inline _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms& sub_terms, Out_array forces):
 */
  __pyx_t_1 = __pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(__pyx_v_self, __pyx_v_target_atom_id, __pyx_v_force_factor, __pyx_v_terms, __pyx_v_forces);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._calc_target_atom_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1793")'> 1793: </pre>
<pre id='line1793' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1794")'> 1794:     cdef inline _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms&amp; sub_terms, Out_array forces):</pre>
<pre id='line1794' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1794
 *         self._cython_calc_target_atom_forces(target_atom_id, force_factor, terms, forces)
 * 
 *     cdef inline _cython_calc_target_atom_forces(self, int target_atom_id, float force_factor, Ring_force_sub_terms& sub_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef object target_force_triplet
 *         cdef int axis
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calc_target_atom_forces(CYTHON_UNUSED struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, int __pyx_v_target_atom_id, float __pyx_v_force_factor, struct __pyx_t_17shift_calculators_Ring_force_sub_terms &__pyx_v_sub_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  int __pyx_v_axis;
  float __pyx_v_term1;
  Vec3 __pyx_v_result;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calc_target_atom_forces", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_cython_calc_target_atom_forces", __pyx_f[0], 1794);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1795")'> 1795:         cdef object target_force_triplet</pre>
<pre id='line1795' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1796")'> 1796:         cdef int axis</pre>
<pre id='line1796' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1797")'> 1797: #        target_force_triplet = self._get_or_make_target_force_triplet(forces, target_atom_id)</pre>
<pre id='line1797' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1798")'> 1798: #</pre>
<pre id='line1798' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1799")'> 1799: #        # update forces on query atom</pre>
<pre id='line1799' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1800")'> 1800:         cdef float term1</pre>
<pre id='line1800' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1801")'> 1801:         cdef Vec3 result</pre>
<pre id='line1801' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1802")'> 1802:         for axis in range(3):</pre>
<pre id='line1802' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1802
 *         cdef float term1
 *         cdef Vec3 result
 *         for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])
 */
  for (__pyx_t_1 = 0; __pyx_t_1 <code><</code> 3; __pyx_t_1+=1) {
    __pyx_v_axis = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1803")'> 1803:             #TODO: report this as a bug it produces an un initialized reference</pre>
<pre id='line1803' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1804")'> 1804:             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])</pre>
<pre id='line1804' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1804
 *         for axis in range(3):
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             result[axis] = -force_factor * term1 / sub_terms.dL6
 * 
 */
    __pyx_v_term1 = (((__pyx_v_sub_terms.gradUQ[__pyx_v_axis]) * __pyx_v_sub_terms.dL3) - (__pyx_v_sub_terms.u * (__pyx_v_sub_terms.gradVQ[__pyx_v_axis])));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1805")'> 1805:             result[axis] = -force_factor * term1 / sub_terms.dL6</pre>
<pre id='line1805' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1805
 *             #TODO: report this as a bug it produces an un initialized reference
 *             term1= (sub_terms.gradUQ[axis] * sub_terms.dL3 - sub_terms.u * sub_terms.gradVQ[axis])
 *             result[axis] = -force_factor * term1 / sub_terms.dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         forces.add(target_atom_id, result)
 */
    __pyx_t_2 = ((-__pyx_v_force_factor) * __pyx_v_term1);
    if (unlikely(__pyx_v_sub_terms.dL6 == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1805; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    (__pyx_v_result[__pyx_v_axis]) = (__pyx_t_2 / __pyx_v_sub_terms.dL6);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1806")'> 1806: </pre>
<pre id='line1806' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1807")'> 1807:         forces.add(target_atom_id, result)</pre>
<pre id='line1807' class='code' style='background-color: #FFFF9f'>
  /* "Cython_shift_calculator.pyx":1807
 *             result[axis] = -force_factor * term1 / sub_terms.dL6
 * 
 *         forces.add(target_atom_id, result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #             *  / sub_terms.dL6
 * #
 */
  __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_target_atom_id, __pyx_v_result);

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._cython_calc_target_atom_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1808")'> 1808: #             *  / sub_terms.dL6</pre>
<pre id='line1808' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1809")'> 1809: #</pre>
<pre id='line1809' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1810")'> 1810: #    #TODO: calculation of GradU and gradV are not consistent with force_terms for target atom correct</pre>
<pre id='line1810' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1811")'> 1811: #    #TODO: reduce number of parameters to method</pre>
<pre id='line1811' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1812")'> 1812: </pre>
<pre id='line1812' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1813")'> 1813:     cdef inline _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):</pre>
<pre id='line1813' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1813
 * #    #TODO: reduce number of parameters to method
 * 
 *     cdef inline _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal
 */

static CYTHON_INLINE PyObject *__pyx_f_17shift_calculators_26Fast_ring_force_calculator__cython_calculate_ring_forces(struct __pyx_obj_17shift_calculators_Fast_ring_force_calculator *__pyx_v_self, CYTHON_UNUSED int __pyx_v_atom_type_id, int __pyx_v_ring_id, float __pyx_v_force_factor, struct __pyx_t_17shift_calculators_Ring_force_sub_terms __pyx_v_force_terms, struct __pyx_obj_17shift_calculators_Out_array *__pyx_v_forces) {
  Vec3 __pyx_v_temp_normal;
  Vec3 __pyx_v_nSum;
  int __pyx_v_num_ring_atoms;
  int __pyx_v_limit;
  Vec3 __pyx_v_g;
  int __pyx_v_ring_atom_id;
  int __pyx_v_ring_atom_index;
  int __pyx_v_index_1;
  int __pyx_v_index_2;
  float __pyx_v_pos_1;
  float __pyx_v_pos_2;
  float __pyx_v_pos_3;
  float __pyx_v_pos_4;
  int __pyx_v_offset;
  int __pyx_v_indices_1[3];
  int __pyx_v_indices_2[3];
  float __pyx_v_ab[3];
  float __pyx_v_c[3];
  float __pyx_v_factor;
  float __pyx_v_factor2;
  float __pyx_v_one_over_num_ring_atoms;
  float __pyx_v_factor3;
  Vec3 __pyx_v_gradU;
  Vec3 __pyx_v_gradV;
  Vec3 __pyx_v_result;
  int __pyx_v_axis;
  float __pyx_v_sub_term;
  PyObject *__pyx_v_sub_force = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_cython_calculate_ring_forces", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("_cython_calculate_ring_forces", __pyx_f[0], 1813);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1814")'> 1814:         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)</pre>
<pre id='line1814' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1814
 * 
 *     cdef inline _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef Vec3 nSum = temp_normal
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 */
  __pyx_v_temp_normal = Vec3(__pyx_v_force_terms.ring_normal);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1815")'> 1815:         cdef Vec3 nSum = temp_normal</pre>
<pre id='line1815' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1815
 *     cdef inline _cython_calculate_ring_forces(self, int atom_type_id, int ring_id, float force_factor, Ring_force_sub_terms force_terms, Out_array forces):
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 */
  __pyx_v_nSum = __pyx_v_temp_normal;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1816")'> 1816:         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]</pre>
<pre id='line1816' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1816
 *         cdef Vec3 temp_normal =  Vec3(force_terms.ring_normal)
 *         cdef Vec3 nSum = temp_normal
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms
 */
  __pyx_f_17shift_calculators_operator_times(__pyx_v_nSum, 2.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1817")'> 1817:     #// 2 for a 5-membered ring, 3 for a 6-membered ring</pre>
<pre id='line1817' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1818")'> 1818:         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms</pre>
<pre id='line1818' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1818
 *         operator_times(nSum,2.0)  #            float_type g [3], ab [3], c [3]
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int limit = num_ring_atoms - 3
 * 
 */
  __pyx_v_num_ring_atoms = (__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).num_atoms;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1819")'> 1819:         cdef int limit = num_ring_atoms - 3</pre>
<pre id='line1819' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1819
 *     #// 2 for a 5-membered ring, 3 for a 6-membered ring
 *         cdef int num_ring_atoms = self._compiled_ring_components[ring_id].num_atoms
 *         cdef int limit = num_ring_atoms - 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #        for atom_type_id, ring_id, coefficient in coef_components:
 */
  __pyx_v_limit = (__pyx_v_num_ring_atoms - 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1820")'> 1820: </pre>
<pre id='line1820' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1821")'> 1821: #        for atom_type_id, ring_id, coefficient in coef_components:</pre>
<pre id='line1821' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1822")'> 1822:         cdef Vec3 g = Vec3()</pre>
<pre id='line1822' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1822
 * 
 * #        for atom_type_id, ring_id, coefficient in coef_components:
 *         cdef Vec3 g = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef int ring_atom_id
 *         cdef int ring_atom_index
 */
  __pyx_v_g = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1823")'> 1823:         cdef int ring_atom_id</pre>
<pre id='line1823' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1824")'> 1824:         cdef int ring_atom_index</pre>
<pre id='line1824' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1825")'> 1825:         cdef int index_1</pre>
<pre id='line1825' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1826")'> 1826:         cdef int index_2</pre>
<pre id='line1826' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1827")'> 1827:         cdef float pos_1</pre>
<pre id='line1827' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1828")'> 1828:         cdef float pos_2</pre>
<pre id='line1828' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1829")'> 1829:         cdef float pos_3</pre>
<pre id='line1829' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1830")'> 1830:         cdef float pos_4</pre>
<pre id='line1830' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1831")'> 1831:         cdef int offset</pre>
<pre id='line1831' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1832")'> 1832: </pre>
<pre id='line1832' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1833")'> 1833:         cdef int[3] indices_1</pre>
<pre id='line1833' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1834")'> 1834:         cdef int[3] indices_2</pre>
<pre id='line1834' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1835")'> 1835: </pre>
<pre id='line1835' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1836")'> 1836:         cdef float[3] ab</pre>
<pre id='line1836' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1837")'> 1837:         cdef float[3] c</pre>
<pre id='line1837' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1838")'> 1838: </pre>
<pre id='line1838' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1839")'> 1839:         cdef float factor</pre>
<pre id='line1839' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1840")'> 1840:         cdef float factor2</pre>
<pre id='line1840' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1841")'> 1841:         cdef float one_over_num_ring_atoms</pre>
<pre id='line1841' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1842")'> 1842:         cdef float factor3</pre>
<pre id='line1842' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1843")'> 1843: </pre>
<pre id='line1843' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1844")'> 1844:         cdef Vec3 gradU</pre>
<pre id='line1844' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1845")'> 1845:         cdef Vec3 gradV</pre>
<pre id='line1845' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1846")'> 1846:         cdef Vec3 result</pre>
<pre id='line1846' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1847")'> 1847: </pre>
<pre id='line1847' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1848")'> 1848:         cdef int axis</pre>
<pre id='line1848' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1849")'> 1849:         cdef float sub_term</pre>
<pre id='line1849' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1850")'> 1850:         for ring_atom_index in range(num_ring_atoms):</pre>
<pre id='line1850' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1850
 *         cdef int axis
 *         cdef float sub_term
 *         for ring_atom_index in range(num_ring_atoms):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:
 */
  __pyx_t_1 = __pyx_v_num_ring_atoms;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_ring_atom_index = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1851")'> 1851:             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]</pre>
<pre id='line1851' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1851
 *         cdef float sub_term
 *         for ring_atom_index in range(num_ring_atoms):
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):
 */
    __pyx_v_ring_atom_id = ((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_ring_atom_index]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1852")'> 1852:             if ring_atom_index &lt; limit:</pre>
<pre id='line1852' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1852
 *         for ring_atom_index in range(num_ring_atoms):
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3
 */
    __pyx_t_3 = (__pyx_v_ring_atom_index <code><</code> __pyx_v_limit);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1853")'> 1853:                 for axis in range(3):</pre>
<pre id='line1853' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1853
 *             ring_atom_id = self._compiled_ring_components[ring_id].atom_ids[ring_atom_index]
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3
 */
      for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
        __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1854")'> 1854:                     index_1 = (ring_atom_index + 1) % 3</pre>
<pre id='line1854' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1854
 *             if ring_atom_index <code><</code> limit:
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 */
        __pyx_v_index_1 = __Pyx_mod_long((__pyx_v_ring_atom_index + 1), 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1855")'> 1855:                     index_2 = (ring_atom_index + 2) % 3</pre>
<pre id='line1855' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1855
 *                 for axis in range(3):
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 */
        __pyx_v_index_2 = __Pyx_mod_long((__pyx_v_ring_atom_index + 2), 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1856")'> 1856:                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]</pre>
<pre id='line1856' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1856
 *                     index_1 = (ring_atom_index + 1) % 3
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)
 */
        __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1857")'> 1857:                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]</pre>
<pre id='line1857' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1857
 *                     index_2 = (ring_atom_index + 2) % 3
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)
 * 
 */
        __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_2]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1858")'> 1858:                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)</pre>
<pre id='line1858' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1858
 *                     pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                     pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                     g[axis] =  pos_1 - pos_2 # atoms 3,4 (5 member) or 3,4,5 (6 member)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             else:
 */
        (__pyx_v_g[__pyx_v_axis]) = (__pyx_v_pos_1 - __pyx_v_pos_2);
      }
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1859")'> 1859: </pre>
<pre id='line1859' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1860")'> 1860:             else:</pre>
<pre id='line1860' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1861")'> 1861:                 if  ring_atom_index &gt;= num_ring_atoms - limit:</pre>
<pre id='line1861' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1861
 * 
 *             else:
 *                 if  ring_atom_index >= num_ring_atoms - limit:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):
 */
      __pyx_t_3 = (__pyx_v_ring_atom_index >= (__pyx_v_num_ring_atoms - __pyx_v_limit));
      if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1862")'> 1862:                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring</pre>
<pre id='line1862' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1862
 *             else:
 *                 if  ring_atom_index >= num_ring_atoms - limit:
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 */
        __pyx_v_offset = (__pyx_v_num_ring_atoms - 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1863")'> 1863:                     for axis in range(3):</pre>
<pre id='line1863' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1863
 *                 if  ring_atom_index >= num_ring_atoms - limit:
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 */
        for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
          __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1864")'> 1864:                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset</pre>
<pre id='line1864' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1864
 *                     offset = num_ring_atoms - 3 #2 for a 5-membered ring, 3 for a 6-membered ring
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 */
          __pyx_v_index_1 = (__Pyx_mod_long(((__pyx_v_ring_atom_index + 1) - __pyx_v_offset), 3) + __pyx_v_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1865")'> 1865:                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset</pre>
<pre id='line1865' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1865
 *                     for axis in range(3):
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 */
          __pyx_v_index_2 = (__Pyx_mod_long(((__pyx_v_ring_atom_index + 2) - __pyx_v_offset), 3) + __pyx_v_offset);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1866")'> 1866:                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]</pre>
<pre id='line1866' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1866
 *                         index_1 = (ring_atom_index + 1 - offset) % 3 + offset
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                         g[axis] = pos_1 - pos_2
 */
          __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1867")'> 1867:                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]</pre>
<pre id='line1867' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1867
 *                         index_2 = (ring_atom_index + 2 - offset) % 3 + offset
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         g[axis] = pos_1 - pos_2
 *                 else:
 */
          __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[__pyx_v_index_2]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1868")'> 1868:                         g[axis] = pos_1 - pos_2</pre>
<pre id='line1868' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1868
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_1])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[index_2])[axis]
 *                         g[axis] = pos_1 - pos_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 else:
 * 
 */
          (__pyx_v_g[__pyx_v_axis]) = (__pyx_v_pos_1 - __pyx_v_pos_2);
        }
        goto __pyx_L8;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1869")'> 1869:                 else:</pre>
<pre id='line1869' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1870")'> 1870: </pre>
<pre id='line1870' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1871")'> 1871:                     for axis in range(3):</pre>
<pre id='line1871' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1871
 *                 else:
 * 
 *                     for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 */
        for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
          __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1872")'> 1872:                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]</pre>
<pre id='line1872' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1872
 * 
 *                     for axis in range(3):
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[2])[axis]
 */
          __pyx_v_pos_1 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[0]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1873")'> 1873:                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]</pre>
<pre id='line1873' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1873
 *                     for axis in range(3):
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[2])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 */
          __pyx_v_pos_2 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[1]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1874")'> 1874:                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[2])[axis]</pre>
<pre id='line1874' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1874
 *                         pos_1 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[0])[axis]
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[2])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4
 */
          __pyx_v_pos_3 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[2]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1875")'> 1875:                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]</pre>
<pre id='line1875' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1875
 *                         pos_2 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[1])[axis]
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[2])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4
 * 
 */
          __pyx_v_pos_4 = ((__pyx_v_self->__pyx_base._simulation[0]).atomPos(((__pyx_v_self->_compiled_ring_components[__pyx_v_ring_id]).atom_ids[3]))[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1876")'> 1876:                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4</pre>
<pre id='line1876' class='code' style='background-color: #FFFFff'>
          /* "Cython_shift_calculator.pyx":1876
 *                         pos_3 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[2])[axis]
 *                         pos_4 = self._simulation[0].atomPos(self._compiled_ring_components[ring_id].atom_ids[3])[axis]
 *                         g[axis] = pos_1 - pos_2 + pos_3 - pos_4             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # 0 1 2 2 1   (0+1) %3 (0+2) %3
 */
          (__pyx_v_g[__pyx_v_axis]) = (((__pyx_v_pos_1 - __pyx_v_pos_2) + __pyx_v_pos_3) - __pyx_v_pos_4);
        }
      }
      __pyx_L8:;
    }
    __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1877")'> 1877: </pre>
<pre id='line1877' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1878")'> 1878:             # 0 1 2 2 1   (0+1) %3 (0+2) %3</pre>
<pre id='line1878' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1879")'> 1879:             # 1 2 0 0 2</pre>
<pre id='line1879' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1880")'> 1880:             # 2 0 1 10</pre>
<pre id='line1880' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1881")'> 1881:             #atom 2 (5-membered rings)</pre>
<pre id='line1881' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1882")'> 1882:             for axis in range(3):</pre>
<pre id='line1882' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1882
 *             # 2 0 1 10
 *             #atom 2 (5-membered rings)
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 indices_1[axis] = (axis + 1) % 3
 *                 indices_2[axis] = (axis + 2) % 3
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1883")'> 1883:                 indices_1[axis] = (axis + 1) % 3</pre>
<pre id='line1883' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1883
 *             #atom 2 (5-membered rings)
 *             for axis in range(3):
 *                 indices_1[axis] = (axis + 1) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 indices_2[axis] = (axis + 2) % 3
 * 
 */
      (__pyx_v_indices_1[__pyx_v_axis]) = __Pyx_mod_long((__pyx_v_axis + 1), 3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1884")'> 1884:                 indices_2[axis] = (axis + 2) % 3</pre>
<pre id='line1884' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1884
 *             for axis in range(3):
 *                 indices_1[axis] = (axis + 1) % 3
 *                 indices_2[axis] = (axis + 2) % 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for axis in range(3):
 */
      (__pyx_v_indices_2[__pyx_v_axis]) = __Pyx_mod_long((__pyx_v_axis + 2), 3);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1885")'> 1885: </pre>
<pre id='line1885' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1886")'> 1886:             for axis in range(3):</pre>
<pre id='line1886' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1886
 *                 indices_2[axis] = (axis + 2) % 3
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1887")'> 1887:                 index_1 = indices_1[axis]</pre>
<pre id='line1887' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1887
 * 
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_2 = indices_2[axis]
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 */
      __pyx_v_index_1 = (__pyx_v_indices_1[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1888")'> 1888:                 index_2 = indices_2[axis]</pre>
<pre id='line1888' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1888
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 * 
 */
      __pyx_v_index_2 = (__pyx_v_indices_2[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1889")'> 1889:                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]</pre>
<pre id='line1889' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1889
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for axis in range(3):
 */
      (__pyx_v_ab[__pyx_v_axis]) = (((__pyx_v_force_terms.d[__pyx_v_index_1]) * (__pyx_v_g[__pyx_v_index_2])) - ((__pyx_v_force_terms.d[__pyx_v_index_2]) * (__pyx_v_g[__pyx_v_index_1])));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1890")'> 1890: </pre>
<pre id='line1890' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1891")'> 1891:             for axis in range(3):</pre>
<pre id='line1891' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1891
 *                 ab[axis] = force_terms.d[index_1] * g[index_2] - force_terms.d[index_2] * g[index_1]
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1892")'> 1892:                 index_1 = indices_1[axis]</pre>
<pre id='line1892' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1892
 * 
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 index_2 = indices_2[axis]
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 */
      __pyx_v_index_1 = (__pyx_v_indices_1[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1893")'> 1893:                 index_2 = indices_2[axis]</pre>
<pre id='line1893' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1893
 *             for axis in range(3):
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 * 
 */
      __pyx_v_index_2 = (__pyx_v_indices_2[__pyx_v_axis]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1894")'> 1894:                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]</pre>
<pre id='line1894' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1894
 *                 index_1 = indices_1[axis]
 *                 index_2 = indices_2[axis]
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 */
      (__pyx_v_c[__pyx_v_axis]) = (((__pyx_v_nSum[__pyx_v_index_1]) * (__pyx_v_g[__pyx_v_index_2])) - ((__pyx_v_nSum[__pyx_v_index_2]) * (__pyx_v_g[__pyx_v_index_1])));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1895")'> 1895: </pre>
<pre id='line1895' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1896")'> 1896:             factor = -6.0 * force_terms.dn / force_terms.dL3nL3</pre>
<pre id='line1896' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1896
 *                 c[axis] = nSum[index_1] * g[index_2] - nSum[index_2] * g[index_1]
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 */
    __pyx_t_5 = (-6.0 * __pyx_v_force_terms.dn);
    if (unlikely(__pyx_v_force_terms.dL3nL3 == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_factor = (__pyx_t_5 / __pyx_v_force_terms.dL3nL3);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1897")'> 1897:             factor2 = 0.25 * force_terms.dL / force_terms.nL</pre>
<pre id='line1897' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1897
 * 
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 */
    __pyx_t_5 = (0.25 * __pyx_v_force_terms.dL);
    if (unlikely(__pyx_v_force_terms.nL == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1897; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_factor2 = (__pyx_t_5 / __pyx_v_force_terms.nL);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1898")'> 1898:             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)</pre>
<pre id='line1898' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1898
 *             factor = -6.0 * force_terms.dn / force_terms.dL3nL3
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 * 
 */
    if (unlikely(((double)__pyx_v_num_ring_atoms) == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_one_over_num_ring_atoms = (1.0 / ((double)__pyx_v_num_ring_atoms));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1899")'> 1899:             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms</pre>
<pre id='line1899' class='code' style='background-color: #FFFFaa'>
    /* "Cython_shift_calculator.pyx":1899
 *             factor2 = 0.25 * force_terms.dL / force_terms.nL
 *             one_over_num_ring_atoms = 1.0 / float(num_ring_atoms)
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             gradU = Vec3()
 */
    if (unlikely(__pyx_v_force_terms.dL == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1899; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_factor3 = ((__pyx_v_force_terms.nL / __pyx_v_force_terms.dL) * __pyx_v_one_over_num_ring_atoms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1900")'> 1900: </pre>
<pre id='line1900' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1901")'> 1901:             gradU = Vec3()</pre>
<pre id='line1901' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1901
 *             factor3 = force_terms.nL / force_terms.dL * one_over_num_ring_atoms
 * 
 *             gradU = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for axis in range(3):
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 */
    __pyx_v_gradU = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1902")'> 1902:             for axis in range(3):</pre>
<pre id='line1902' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1902
 * 
 *             gradU = Vec3()
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 * 
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1903")'> 1903:                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))</pre>
<pre id='line1903' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1903
 *             gradU = Vec3()
 *             for axis in range(3):
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             gradV = Vec3()
 */
      (__pyx_v_gradU[__pyx_v_axis]) = (__pyx_v_factor * ((((0.5 * (__pyx_v_ab[__pyx_v_axis])) - ((__pyx_v_force_terms.ring_normal[__pyx_v_axis]) * __pyx_v_one_over_num_ring_atoms)) * __pyx_v_force_terms.dLnL) - (__pyx_v_force_terms.dn * ((__pyx_v_factor2 * (__pyx_v_c[__pyx_v_axis])) - (__pyx_v_factor3 * (__pyx_v_force_terms.d[__pyx_v_axis]))))));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1904")'> 1904: </pre>
<pre id='line1904' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1905")'> 1905:             gradV = Vec3()</pre>
<pre id='line1905' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1905
 *                 gradU[axis] = factor * ((0.5 * ab[axis] - force_terms.ring_normal[axis] * one_over_num_ring_atoms) * force_terms.dLnL - force_terms.dn * (factor2 * c[axis] - factor3 * force_terms.d[axis]))
 * 
 *             gradV = Vec3()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):
 */
    __pyx_v_gradV = Vec3();
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1906")'> 1906:             factor = -3 * force_terms.dL * one_over_num_ring_atoms</pre>
<pre id='line1906' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1906
 * 
 *             gradV = Vec3()
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for axis in range(3):
 *                 gradV[axis] = factor * force_terms.d[axis]
 */
    __pyx_v_factor = ((-3.0 * __pyx_v_force_terms.dL) * __pyx_v_one_over_num_ring_atoms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1907")'> 1907:             for axis in range(3):</pre>
<pre id='line1907' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1907
 *             gradV = Vec3()
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 gradV[axis] = factor * force_terms.d[axis]
 * 
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1908")'> 1908:                 gradV[axis] = factor * force_terms.d[axis]</pre>
<pre id='line1908' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1908
 *             factor = -3 * force_terms.dL * one_over_num_ring_atoms
 *             for axis in range(3):
 *                 gradV[axis] = factor * force_terms.d[axis]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #TODO: rename force terms  sub_terms or vice versa
 */
      (__pyx_v_gradV[__pyx_v_axis]) = (__pyx_v_factor * (__pyx_v_force_terms.d[__pyx_v_axis]));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1909")'> 1909: </pre>
<pre id='line1909' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1910")'> 1910: #TODO: rename force terms  sub_terms or vice versa</pre>
<pre id='line1910' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1911")'> 1911: </pre>
<pre id='line1911' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1912")'> 1912: #            ring_target_force_triplet = self._get_or_make_target_force_triplet(forces, ring_atom_id)</pre>
<pre id='line1912' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1913")'> 1913: </pre>
<pre id='line1913' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1914")'> 1914:             for axis in range(3):</pre>
<pre id='line1914' class='code' style='background-color: #FFFFff'>
    /* "Cython_shift_calculator.pyx":1914
 * #            ring_target_force_triplet = self._get_or_make_target_force_triplet(forces, ring_atom_id)
 * 
 *             for axis in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_axis = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1915")'> 1915:                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])</pre>
<pre id='line1915' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1915
 * 
 *             for axis in range(3):
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force
 */
      __pyx_v_sub_term = (((__pyx_v_gradU[__pyx_v_axis]) * __pyx_v_force_terms.dL3) - (__pyx_v_force_terms.u * (__pyx_v_gradV[__pyx_v_axis])));
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1916")'> 1916:                 sub_force = -force_factor * sub_term / force_terms.dL6</pre>
<pre id='line1916' class='code' style='background-color: #FFFF79'>
      /* "Cython_shift_calculator.pyx":1916
 *             for axis in range(3):
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 result[axis] = sub_force
 *             forces.add(ring_atom_id,result)
 */
      __pyx_t_6 = ((-__pyx_v_force_factor) * __pyx_v_sub_term);
      if (unlikely(__pyx_v_force_terms.dL6 == 0)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1916; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_t_6 / __pyx_v_force_terms.dL6));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1916; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sub_force);
      __pyx_v_sub_force = __pyx_t_7;
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1917")'> 1917:                 result[axis] = sub_force</pre>
<pre id='line1917' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":1917
 *                 sub_term = (gradU[axis] * force_terms.dL3 - force_terms.u * gradV[axis])
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             forces.add(ring_atom_id,result)
 * #                print AXIS_NAMES[axis],sub_force,-force_factor, gradU[axis], force_terms.dL3, force_terms.u, gradV[axis],force_terms.dL6
 */
      __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_sub_force);<span class='error_goto'> if (unlikely((__pyx_t_6 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1917; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      (__pyx_v_result[__pyx_v_axis]) = __pyx_t_6;
    }
</pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line1918")'> 1918:             forces.add(ring_atom_id,result)</pre>
<pre id='line1918' class='code' style='background-color: #FFFF23'>
    /* "Cython_shift_calculator.pyx":1918
 *                 sub_force = -force_factor * sub_term / force_terms.dL6
 *                 result[axis] = sub_force
 *             forces.add(ring_atom_id,result)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * #                print AXIS_NAMES[axis],sub_force,-force_factor, gradU[axis], force_terms.dL3, force_terms.u, gradV[axis],force_terms.dL6
 * #            print
 */
    __pyx_f_17shift_calculators_9Out_array_add(__pyx_v_forces, __pyx_v_ring_atom_id, __pyx_v_result);
  }

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_ring_force_calculator._cython_calculate_ring_forces", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sub_force);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_indices = 0;
  int __pyx_v_smoothed;
  PyObject *__pyx_v_name = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__smoothed,&__pyx_n_s__name,0};
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__smoothed);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__name);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_indices = values[0];
    __pyx_v_smoothed = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_smoothed == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_name = ((PyObject*)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_name), (&PyString_Type), 1, "name", 1)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator___init__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), __pyx_v_indices, __pyx_v_smoothed, __pyx_v_name);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1919")'> 1919: #                print AXIS_NAMES[axis],sub_force,-force_factor, gradU[axis], force_terms.dL3, force_terms.u, gradV[axis],force_terms.dL6</pre>
<pre id='line1919' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1920")'> 1920: #            print</pre>
<pre id='line1920' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1921")'> 1921: ##        print</pre>
<pre id='line1921' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1922")'> 1922: </pre>
<pre id='line1922' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1923")'> 1923: cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):</pre>
<pre id='line1923' class='code' style='background-color: #FFFFff'>
/* "Cython_shift_calculator.pyx":1923
 * ##        print
 * 
 * cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */
struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator {
  struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator __pyx_base;
  float _nb_cutoff;
};


/* "Cython_shift_calculator.pyx":1923
 * ##        print
 * 
 * cdef class Fast_non_bonded_shift_calculator(Fast_distance_shift_calculator):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float _nb_cutoff
 */

struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator {
  struct __pyx_vtabstruct_17shift_calculators_Fast_distance_shift_calculator __pyx_base;
};
static struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_vtabptr_17shift_calculators_Fast_non_bonded_shift_calculator;

</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1924")'> 1924: </pre>
<pre id='line1924' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1925")'> 1925:     cdef float _nb_cutoff</pre>
<pre id='line1925' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1926")'> 1926: </pre>
<pre id='line1926' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1927")'> 1927:     def __init__(self, object indices, bint smoothed, str name):</pre>
<pre id='line1927' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1927
 *     cdef float _nb_cutoff
 * 
 *     def __init__(self, object indices, bint smoothed, str name):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)
 *         global DEFAULT_NB_CUTOFF
 */

static int __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator___init__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_indices, int __pyx_v_smoothed, PyObject *__pyx_v_name) {
  int __pyx_r;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__init__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 1927);
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line1928")'> 1928:         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)</pre>
<pre id='line1928' class='code' style='background-color: #FFFF2f'>
  /* "Cython_shift_calculator.pyx":1928
 * 
 *     def __init__(self, object indices, bint smoothed, str name):
 *         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1928; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)__pyx_ptype_17shift_calculators_Fast_non_bonded_shift_calculator)));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self));
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_super, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1928; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s____init__);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1928; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_v_smoothed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1928; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1928; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_indices);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_name));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, ((PyObject *)__pyx_v_name));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_name));
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1928; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1929")'> 1929:         global DEFAULT_NB_CUTOFF</pre>
<pre id='line1929' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line1930")'> 1930:         self._nb_cutoff = DEFAULT_NB_CUTOFF</pre>
<pre id='line1930' class='code' style='background-color: #FFFF86'>
  /* "Cython_shift_calculator.pyx":1930
 *         super(Fast_non_bonded_shift_calculator, self).__init__(indices,smoothed,name)
 *         global DEFAULT_NB_CUTOFF
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def set_verbose(self,on):
 */
  __pyx_v_self->_nb_cutoff = __pyx_v_17shift_calculators_DEFAULT_NB_CUTOFF;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(Py_None);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_3set_verbose(PyObject *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose (wrapper)", 0);
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_2set_verbose(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), ((PyObject *)__pyx_v_on));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1931")'> 1931: </pre>
<pre id='line1931' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1932")'> 1932:     def set_verbose(self,on):</pre>
<pre id='line1932' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1932
 *         self._nb_cutoff = DEFAULT_NB_CUTOFF
 * 
 *     def set_verbose(self,on):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._verbose = on
 * 
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_2set_verbose(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_on) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("set_verbose", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("set_verbose", __pyx_f[0], 1932);
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line1933")'> 1933:         self._verbose = on</pre>
<pre id='line1933' class='code' style='background-color: #FFFF26'>
  /* "Cython_shift_calculator.pyx":1933
 * 
 *     def set_verbose(self,on):
 *         self._verbose = on             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     def __call__(self, object components, object results, object component_to_target):
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_on);<span class='error_goto'> if (unlikely((__pyx_t_1 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_self->__pyx_base.__pyx_base._verbose = __pyx_t_1;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.set_verbose", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_17shift_calculators_32Fast_non_bonded_shift_calculator_5__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_components = 0;
  PyObject *__pyx_v_results = 0;
  PyObject *__pyx_v_component_to_target = 0;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__components,&__pyx_n_s__results,&__pyx_n_s__component_to_target,0};
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__ (wrapper)", 0);
  {
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__components);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__results);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__component_to_target);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_components = values[0];
    __pyx_v_results = values[1];
    __pyx_v_component_to_target = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_4__call__(((struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self), __pyx_v_components, __pyx_v_results, __pyx_v_component_to_target);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1934")'> 1934: </pre>
<pre id='line1934' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1935")'> 1935:     def __call__(self, object components, object results, object component_to_target):</pre>
<pre id='line1935' class='code' style='background-color: #FFFFd4'>
/* "Cython_shift_calculator.pyx":1935
 *         self._verbose = on
 * 
 *     def __call__(self, object components, object results, object component_to_target):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self._components =  components
 *         self.set_simulation()
 */

static PyObject *__pyx_pf_17shift_calculators_32Fast_non_bonded_shift_calculator_4__call__(struct __pyx_obj_17shift_calculators_Fast_non_bonded_shift_calculator *__pyx_v_self, PyObject *__pyx_v_components, PyObject *__pyx_v_results, PyObject *__pyx_v_component_to_target) {
  float __pyx_v_default_smoothing_factor;
  float __pyx_v_smoothing_factor;
  float __pyx_v_ratio;
  struct __pyx_t_17shift_calculators_coefficient_exponent __pyx_v_coef_exp;
  PyObject *__pyx_v_component = 0;
  int __pyx_v_target_atom_id;
  int __pyx_v_distant_atom_id;
  double __pyx_v_start_time;
  double __pyx_v_end_time;
  PyObject *__pyx_v_index = NULL;
  PyObject *__pyx_v_distance = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__call__", 0);
  <span class='pyx_c_api'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 1935);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1936")'> 1936:         self._components =  components</pre>
<pre id='line1936' class='code' style='background-color: #FFFFd4'>
  /* "Cython_shift_calculator.pyx":1936
 * 
 *     def __call__(self, object components, object results, object component_to_target):
 *         self._components =  components             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         self.set_simulation()
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_components);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_v_self->__pyx_base._components);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self->__pyx_base._components);
  __pyx_v_self->__pyx_base._components = __pyx_v_components;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1937")'> 1937:         self.set_simulation()</pre>
<pre id='line1937' class='code' style='background-color: #FFFFe7'>
  /* "Cython_shift_calculator.pyx":1937
 *     def __call__(self, object components, object results, object component_to_target):
 *         self._components =  components
 *         self.set_simulation()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         cdef float default_smoothing_factor = self._smoothing_factor
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_17shift_calculators_Fast_non_bonded_shift_calculator *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base.set_simulation(((struct __pyx_obj_17shift_calculators_Base_shift_calculator *)__pyx_v_self));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1937; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1938")'> 1938: </pre>
<pre id='line1938' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1939")'> 1939:         cdef float default_smoothing_factor = self._smoothing_factor</pre>
<pre id='line1939' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1939
 *         self.set_simulation()
 * 
 *         cdef float default_smoothing_factor = self._smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef float smoothing_factor
 *         cdef float ratio
 */
  __pyx_v_default_smoothing_factor = __pyx_v_self->__pyx_base._smoothing_factor;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1940")'> 1940:         cdef float smoothing_factor</pre>
<pre id='line1940' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1941")'> 1941:         cdef float ratio</pre>
<pre id='line1941' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1942")'> 1942:         cdef float result</pre>
<pre id='line1942' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1943")'> 1943:         cdef target_distant_atom atom_indices</pre>
<pre id='line1943' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1944")'> 1944:         cdef coefficient_exponent coef_exp</pre>
<pre id='line1944' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1945")'> 1945:         cdef object component</pre>
<pre id='line1945' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1946")'> 1946:         cdef int target_atom_id</pre>
<pre id='line1946' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1947")'> 1947:         cdef int distant_atom_id</pre>
<pre id='line1947' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1948")'> 1948: </pre>
<pre id='line1948' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1949")'> 1949:         cdef double start_time =0.0</pre>
<pre id='line1949' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1949
 *         cdef int distant_atom_id
 * 
 *         cdef double start_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         cdef double end_time =0.0
 *         if self._verbose:
 */
  __pyx_v_start_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1950")'> 1950:         cdef double end_time =0.0</pre>
<pre id='line1950' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1950
 * 
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if self._verbose:
 *             start_time = time()
 */
  __pyx_v_end_time = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1951")'> 1951:         if self._verbose:</pre>
<pre id='line1951' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1951
 *         cdef double start_time =0.0
 *         cdef double end_time =0.0
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             start_time = time()
 * 
 */
  if (__pyx_v_self->__pyx_base.__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1952")'> 1952:             start_time = time()</pre>
<pre id='line1952' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1952
 *         cdef double end_time =0.0
 *         if self._verbose:
 *             start_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for index in range(len(components)):
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_start_time = __pyx_t_3;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1953")'> 1953: </pre>
<pre id='line1953' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line1954")'> 1954:         for index in range(len(components)):</pre>
<pre id='line1954' class='code' style='background-color: #FFFF1f'>
  /* "Cython_shift_calculator.pyx":1954
 *             start_time = time()
 * 
 *         for index in range(len(components)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             component = components[index]
 *             target_atom_id = component[self._distance_atom_index_1]
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_range, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (!__pyx_t_5 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else if (!__pyx_t_5 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_4 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_4++;
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
    __pyx_v_index = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1955")'> 1955:             component = components[index]</pre>
<pre id='line1955' class='code' style='background-color: #FFFF9f'>
    /* "Cython_shift_calculator.pyx":1955
 * 
 *         for index in range(len(components)):
 *             component = components[index]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             target_atom_id = component[self._distance_atom_index_1]
 *             distant_atom_id  = component[self._distance_atom_index_2]
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_components, __pyx_v_index);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
    __pyx_v_component = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1956")'> 1956:             target_atom_id = component[self._distance_atom_index_1]</pre>
<pre id='line1956' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":1956
 *         for index in range(len(components)):
 *             component = components[index]
 *             target_atom_id = component[self._distance_atom_index_1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             distant_atom_id  = component[self._distance_atom_index_2]
 * 
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, __pyx_v_self->__pyx_base._distance_atom_index_1, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_target_atom_id = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1957")'> 1957:             distant_atom_id  = component[self._distance_atom_index_2]</pre>
<pre id='line1957' class='code' style='background-color: #FFFF6e'>
    /* "Cython_shift_calculator.pyx":1957
 *             component = components[index]
 *             target_atom_id = component[self._distance_atom_index_1]
 *             distant_atom_id  = component[self._distance_atom_index_2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_component, __pyx_v_self->__pyx_base._distance_atom_index_2, sizeof(int), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1957; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_distant_atom_id = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1958")'> 1958: </pre>
<pre id='line1958' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line1959")'> 1959:             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)</pre>
<pre id='line1959' class='code' style='background-color: #FFFF73'>
    /* "Cython_shift_calculator.pyx":1959
 *             distant_atom_id  = component[self._distance_atom_index_2]
 * 
 *             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if distance <code><</code> self._nb_cutoff:
 * 
 */
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_distant_atom_id);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1959; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_17shift_calculators_calc_distance_simulation(__pyx_v_self->__pyx_base.__pyx_base._simulation, __pyx_v_target_atom_id, __pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1959; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_distance);
    __pyx_v_distance = __pyx_t_7;
    __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line1960")'> 1960:             if distance &lt; self._nb_cutoff:</pre>
<pre id='line1960' class='code' style='background-color: #FFFF5e'>
    /* "Cython_shift_calculator.pyx":1960
 * 
 *             distance = calc_distance_simulation(self._simulation, target_atom_id, distant_atom_id)
 *             if distance <code><</code> self._nb_cutoff:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_self->_nb_cutoff);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_distance, __pyx_t_7, Py_LT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_8 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_8 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1961")'> 1961: </pre>
<pre id='line1961' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1962")'> 1962: </pre>
<pre id='line1962' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1963")'> 1963: </pre>
<pre id='line1963' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1964")'> 1964: </pre>
<pre id='line1964' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1965")'> 1965: </pre>
<pre id='line1965' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1966")'> 1966: </pre>
<pre id='line1966' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1967")'> 1967: </pre>
<pre id='line1967' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1968")'> 1968: </pre>
<pre id='line1968' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line1969")'> 1969:                 coef_exp = self._get_coefficient_and_exponent(index)</pre>
<pre id='line1969' class='code' style='background-color: #FFFF7f'>
      /* "Cython_shift_calculator.pyx":1969
 * 
 * 
 *                 coef_exp = self._get_coefficient_and_exponent(index)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:
 */
      __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_v_index);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_v_coef_exp = __pyx_f_17shift_calculators_30Fast_distance_shift_calculator__get_coefficient_and_exponent(((struct __pyx_obj_17shift_calculators_Fast_distance_shift_calculator *)__pyx_v_self), __pyx_t_6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1970")'> 1970:                 smoothing_factor = default_smoothing_factor</pre>
<pre id='line1970' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1970
 * 
 *                 coef_exp = self._get_coefficient_and_exponent(index)
 *                 smoothing_factor = default_smoothing_factor             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff
 */
      __pyx_v_smoothing_factor = __pyx_v_default_smoothing_factor;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1971")'> 1971:                 if self._smoothed:</pre>
<pre id='line1971' class='code' style='background-color: #FFFFff'>
      /* "Cython_shift_calculator.pyx":1971
 *                 coef_exp = self._get_coefficient_and_exponent(index)
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8
 */
      if (__pyx_v_self->__pyx_base._smoothed) {
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line1972")'> 1972:                     ratio = distance / self._cutoff</pre>
<pre id='line1972' class='code' style='background-color: #FFFF4f'>
        /* "Cython_shift_calculator.pyx":1972
 *                 smoothing_factor = default_smoothing_factor
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     smoothing_factor = 1.0 - ratio ** 8
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 */
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_self->__pyx_base._cutoff);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        __pyx_t_7 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_v_distance, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_9 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_v_ratio = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1973")'> 1973:                     smoothing_factor = 1.0 - ratio ** 8</pre>
<pre id='line1973' class='code' style='background-color: #FFFFff'>
        /* "Cython_shift_calculator.pyx":1973
 *                 if self._smoothed:
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 */
        __pyx_v_smoothing_factor = (1.0 - powf(__pyx_v_ratio, 8.0));
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line1974")'> 1974:                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient</pre>
<pre id='line1974' class='code' style='background-color: #FFFF33'>
      /* "Cython_shift_calculator.pyx":1974
 *                     ratio = distance / self._cutoff
 *                     smoothing_factor = 1.0 - ratio ** 8
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if self._verbose:
 */
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_component_to_target, __pyx_v_index);<span class='error_goto'> if (!__pyx_t_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_results, __pyx_t_7);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_distance);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_smoothing_factor * pow(__pyx_t_3, __pyx_v_coef_exp.exponent)) * __pyx_v_coef_exp.coefficient));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_2, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_results, __pyx_t_7, __pyx_t_11) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1975")'> 1975: </pre>
<pre id='line1975' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1976")'> 1976:         if self._verbose:</pre>
<pre id='line1976' class='code' style='background-color: #FFFFff'>
  /* "Cython_shift_calculator.pyx":1976
 *                 results[component_to_target[index]]  += smoothing_factor * pow(distance,  coef_exp.exponent) * coef_exp.coefficient
 * 
 *         if self._verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 */
  if (__pyx_v_self->__pyx_base.__pyx_base._verbose) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1977")'> 1977:             end_time = time()</pre>
<pre id='line1977' class='code' style='background-color: #FFFF57'>
    /* "Cython_shift_calculator.pyx":1977
 * 
 *         if self._verbose:
 *             end_time = time()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_v_end_time = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line1978")'> 1978:             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"</pre>
<pre id='line1978' class='code' style='background-color: #FFFF28'>
    /* "Cython_shift_calculator.pyx":1978
 *         if self._verbose:
 *             end_time = time()
 *             print '   distance shift components ' ,self._name,len(components), 'in', "%.17g" % (end_time-start_time), "seconds"             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_components);<span class='error_goto'> if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_end_time - __pyx_v_start_time));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_18), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_11));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_17));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_17));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_17));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_self->__pyx_base.__pyx_base._name));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_7);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject *)__pyx_n_s__in));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__in));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, ((PyObject *)__pyx_t_11));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_11));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__seconds));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 5, ((PyObject *)__pyx_n_s__seconds));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__seconds));
    __pyx_t_7 = 0;
    __pyx_t_11 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_1), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("shift_calculators.Fast_non_bonded_shift_calculator.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_component);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_index);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_distance);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_TraceReturn</span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1979")'> 1979: </pre>
<pre id='line1979' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1980")'> 1980: </pre>
<pre id='line1980' class='code' style='background-color: #FFFFff'></pre></body></html>
